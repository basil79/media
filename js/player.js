/*! For license information please see player.js.LICENSE.txt */
(()=>{var t={704:(t,e,r)=>{"use strict";r.d(e,{Z:()=>s});var i=r(954),n=r.n(i)()((function(t){return t[1]}));n.push([t.id,'.adsrv-player:before,\n.adsrv-player:after {\n    content: unset;\n}\n.adsrv-player {\n    width: 100%;\n    height: 100%;\n}\n\n.adsrv-player,\n.adsrv-player:before,\n.adsrv-player:after,\n.adsrv-player * {\n    -webkit-hyphens: manual;\n            hyphens: manual;\n    font-size: 16px; /*inherit*/\n    font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif;\n    color: inherit;\n    background: 0 0;\n    border: 0;\n    border-radius: 0;\n    border-spacing: 0;\n    border-collapse: collapse;\n    box-sizing: content-box;\n    clear: none;\n    float: none;\n    font-variant: normal;\n    font-weight: inherit;\n    letter-spacing: normal;\n    line-height: 1.4; /*normal*/\n    margin: 0;\n    max-height: none;\n    max-width: none;\n    min-height: 0;\n    min-width: 0;\n    outline: 0;\n    padding: 0;\n    position: static;\n    text-align: left;\n    text-decoration: none;\n    text-indent: 0;\n    text-transform: none;\n    vertical-align: baseline;\n    visibility: inherit;\n    word-spacing: normal;\n}\n.adsrv-player {\n    position: relative;\n}\n.adsrv-player.adsrv-sticky .adsrv-wrapper {\n    position: fixed;\n    z-index: 99999;\n}\n.adsrv-player .adsrv-video-container {\n    padding-bottom: 56.25%;\n}\n.adsrv-player .adsrv-video {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n}\n.adsrv-player .adsrv-resizer {\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    border: none;\n    background-color: transparent\n}\n.adsrv-player .adsrv-ad-container {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n}\n.adsrv-player .adsrv-spinner {\n    display: none;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    margin: -25px 0 0 -25px;\n    opacity: 1;\n    text-align: left;\n    /*border: 6px solid rgba($primary-background-color, $primary-background-transparency);*/\n    border: 4px solid rgba(255, 255, 255, 0.5);\n    box-sizing: border-box;\n    background-clip: padding-box;\n    width: 50px;\n    height: 50px;\n    border-radius: 25px;\n    visibility: hidden;\n}\n.adsrv-player.adsrv-waiting .adsrv-spinner {\n    display: block;\n    animation: adsrv-spinner-show 0s linear 0.3s forwards;\n}\n.adsrv-player .adsrv-spinner:before,\n.adsrv-player .adsrv-spinner:after {\n    content: "";\n    position: absolute;\n    margin: -4px;\n    box-sizing: inherit;\n    width: inherit;\n    height: inherit;\n    border-radius: inherit;\n    opacity: 1;\n    border: inherit;\n    border-color: transparent;\n    border-top-color: white;\n}\n.adsrv-player.adsrv-waiting .adsrv-spinner:before,\n.adsrv-player.adsrv-waiting .adsrv-spinner:after {\n    /*-webkit-animation: spinner-spin 1.1s cubic-bezier(0.6, 0.2, 0, 0.8) infinite, spinner-fade 1.1s linear infinite;*/\n    animation: adsrv-spinner-spin 1.1s cubic-bezier(0.6, 0.2, 0, 0.8) infinite, adsrv-spinner-fade 1.1s linear infinite;\n}\n.adsrv-player.adsrv-waiting .adsrv-spinner:before {\n    border-top-color: rgb(255,255,255);\n}\n.adsrv-player.adsrv-waiting .adsrv-spinner:after {\n    border-top-color: rgb(255,255,255);\n    /*-webkit-animation-delay: 0.44s;*/\n    animation-delay: 0.44s;\n}\n@keyframes adsrv-spinner-show {\n    to {\n        visibility: visible;\n    }\n}\n/*\n@-webkit-keyframes adsrv-spinner-show {\n    to {\n        visibility: visible;\n    }\n}\n */\n@keyframes adsrv-spinner-spin {\n    100% {\n        transform: rotate(360deg);\n    }\n}\n/*\n@-webkit-keyframes adsrv-spinner-spin {\n    100% {\n        -webkit-transform: rotate(360deg);\n    }\n}\n */\n@keyframes adsrv-spinner-fade {\n    0% {\n        border-top-color: white;\n    }\n    20% {\n        border-top-color: white;\n    }\n    35% {\n        border-top-color: white;\n    }\n    60% {\n        border-top-color: white;\n    }\n    100% {\n        border-top-color: white;\n    }\n}\n/*\n@-webkit-keyframes adsrv-spinner-fade {\n    0% {\n        border-top-color: white;\n    }\n    20% {\n        border-top-color: white;\n    }\n    35% {\n        border-top-color: white;\n    }\n    60% {\n        border-top-color: white;\n    }\n    100% {\n        border-top-color: white;\n    }\n}\n */\n.adsrv-player .adsrv-gradient {\n    transition: opacity 250ms ease 0s, visibility 250ms ease 0s;\n    opacity: 0.01;\n    visibility: hidden;\n}\n.adsrv-player .adsrv-gradient.adsrv-show {\n    opacity: 1;\n    visibility: visible;\n}\n.adsrv-player .adsrv-overlay {\n    height: 100%;\n    width: 100%;\n    position: absolute;\n    z-index: 1;\n    top: 0px;\n    -webkit-user-select: none;\n       -moz-user-select: none;\n            user-select: none;\n    /*pointer-events: none;*/\n}\n\n\n.adsrv-player .adsrv-title-bar {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n    z-index: 1;\n    padding: 25px 20px;\n    color: rgb(255, 255, 255);\n\n    transition: opacity 250ms ease 0s, visibility 250ms ease 0s;\n    opacity: 0.01;\n    visibility: hidden;\n}\n.adsrv-player .adsrv-title-bar .adsrv-title {\n     overflow: hidden;\n     white-space: nowrap;\n     text-overflow: ellipsis;\n     width: 100%;\n     font-size: 18px;\n}\n.adsrv-player .adsrv-title-bar .adsrv-description {\n     font-size: 14px;\n}\n\n.adsrv-player.adsrv-user-active .adsrv-title-bar,\n.adsrv-player.adsrv-slider-active .adsrv-title-bar,\n.adsrv-player.adsrv-paused .adsrv-title-bar {\n    opacity: 1;\n    visibility: visible;\n}\n/*.adsrv-player.adsrv-sticky .adsrv-description { display: none }*/\n\n/*\n.adsrv-player .adsrv-header {\n    transition: opacity 250ms ease 0s, visibility 250ms ease 0s;\n    opacity: 0.01;\n    visibility: hidden;\n    box-sizing: border-box;\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    line-height: 22px;\n    padding: 25px 20px;\n    font-size: 17px;\n    width: 100%;\n    display: flex;\n    align-items: center;\n    z-index: 1;\n}\n */\n/*.adsrv--player.adsrv-hovered .adsrv-header,*/\n/*\n.adsrv-player.adsrv-user-active .adsrv-header,\n.adsrv-player.adsrv-slider-active .adsrv-header,\n.adsrv-player.adsrv-paused .adsrv-header {\n    opacity: 1;\n    visibility: visible;\n}\n.adsrv-player .adsrv-title {\n    box-sizing: border-box;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    Xcursor: pointer;\n    text-decoration: none;\n    background-image: none;\n    color: rgb(247, 247, 247);\n    user-select: none;\n    pointer-events: auto;\n}\n*/\n\n\n.adsrv-player .adsrv-gradient {\n    transition: opacity 250ms ease 0s, visibility 250ms ease 0s;\n    opacity: 0.01;\n    visibility: hidden;\n}\n/*.adsrv-player.adsrv-hovered .adsrv-gradient,*/\n.adsrv-player.adsrv-user-active .adsrv-gradient,\n.adsrv-player.adsrv-slider-active .adsrv-gradient,\n.adsrv-player.adsrv-paused .adsrv-gradient {\n    opacity: 1;\n    visibility: visible;\n}\n.adsrv-player .adsrv-gradient-top {\n    left: 0px;\n    pointer-events: none;\n    position: absolute;\n    width: 100%;\n    z-index: 0;\n    background: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.45) 40%, rgba(0, 0, 0, 0));\n    height: 40%;\n    top: 0px;\n}\n.adsrv-player .adsrv-gradient-bottom {\n    left: 0px;\n    pointer-events: none;\n    position: absolute;\n    width: 100%;\n    z-index: 0;\n    background: linear-gradient(0deg, rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.45) 40%, rgba(0, 0, 0, 0));\n    bottom: 0px;\n    height: 66%;\n}\n.adsrv-player .adsrv-control-bar {\n    position: absolute;\n    bottom: 0;\n    top: auto;\n    width: 100%;\n    left: 0;\n    right: 0;\n    height: 65px;\n}\n.adsrv-player .adsrv-controls {\n    bottom: 0px;\n    display: flex;\n    flex-direction: row;\n    /*-webkit-box-pack: start;*/\n    justify-content: flex-start;\n    position: absolute;\n    width: 100%;\n    color: rgb(247, 247, 247);\n    padding: 0px 20px 20px;\n    height: 45px;\n    /*-webkit-box-align: center;*/\n    align-items: center;\n    z-index: 10;\n    pointer-events: all;\n    transition: opacity 250ms ease 0s, visibility 250ms ease 0s;\n    opacity: 0.01;\n    visibility: hidden;\n    box-sizing: border-box;\n}\n/*.as-player.hovered .controls,*/\n.adsrv-player.adsrv-user-active .adsrv-controls,\n.adsrv-player.adsrv-slider-active .adsrv-controls,\n.adsrv-player.adsrv-paused .adsrv-controls {\n    opacity: 1;\n    visibility: visible;\n}\n.adsrv-player .adsrv-timeline {\n    position: absolute;\n    height: 4px;\n    left: 20px;\n    right: 20px;\n    bottom: 56px;\n    cursor: pointer;\n    background: rgb(100, 100, 100);\n    background: rgba(255, 255, 255, 0.5);\n    /*-webkit-box-shadow: 0 0 3px 0 rgb(0 0 0 / 10%);*/\n    /*-moz-box-shadow: 0 0 3px 0 rgba(0, 0, 0, 0.1);*/\n    box-shadow: 0 0 3px 0 rgb(0 0 0 / 10%);\n\n    transition: opacity 250ms ease 0s, visibility 250ms ease 0s;\n    opacity: 0.01;\n    visibility: hidden;\n}\n.adsrv-player.adsrv-slider-active .adsrv-timeline,\n.adsrv-player .adsrv-timeline:hover,\n.adsrv-player .adsrv-timeline.sliding {\n    height: 8px;\n    bottom: 54px;\n}\n/*.as-player.hovered .timeline,*/\n.adsrv-player.adsrv-user-active .adsrv-timeline,\n.adsrv-player.adsrv-slider-active .adsrv-timeline,\n.adsrv-player.adsrv-paused .adsrv-timeline {\n    opacity: 1;\n    visibility: visible;\n}\n.adsrv-player .adsrv-timeline:before {\n    content: "";\n    width: 100%;\n    position: absolute;\n    left: 0;\n    height: 100%\n}\n.adsrv-player .adsrv-timeline-buffer {\n    position: absolute;\n    left: 0;\n    height: 100%;\n    background: #fff;\n}\n.adsrv-player .adsrv-timeline-progress {\n    position: absolute;\n    left: 0;\n    height: 100%;\n    background: red;\n}\n.adsrv-player .adsrv-timeline-progress:before {\n    /*-webkit-transition-timing-function: cubic-bezier(0,0,0.2,1);*/\n    transition-timing-function: cubic-bezier(0,0,0.2,1);\n    /*-webkit-transition-duration: 167ms;*/\n    transition-duration: 167ms;\n    content: \'\';\n    position: absolute;\n    background-color: #fff;\n    width: 10px;\n    height: 10px;\n    border-radius: 5px;\n    /*-webkit-box-shadow: 0 1px 1px 1px rgb(0 0 0 / 40%);*/\n    box-shadow: 0 1px 1px 1px rgb(0 0 0 / 40%);\n    top: 50%;\n    right: -5px;\n    margin-top: -5px;\n}\n.adsrv-player .adsrv-timeline:hover .adsrv-timeline-progress:before {\n    /*-webkit-transform: scale(1.5);*/\n    transform: scale(1.5);\n}\n.adsrv-player .adsrv-time-tooltip {\n    /*-webkit-transition-timing-function: cubic-bezier(0,0,0.2,1);*/\n    transition-timing-function: cubic-bezier(0,0,0.2,1);\n    /*-webkit-transition-duration: 167ms;*/\n    transition-duration: 167ms;\n    background-color: rgba(0,0,0,0.75);\n    /*-webkit-box-shadow: 0 0 0 1px rgb(255 255 255 / 10%);*/\n    box-shadow: 0 0 0 1px rgb(255 255 255 / 10%);\n    border-radius: 2px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    /*font-size: 1.2rem;\n    line-height: 1.33333;\n    font-weight: 600;*/\n    color: #fff;\n    text-shadow: 0 1px 0 rgb(0 0 0 / 80%);\n    pointer-events: none;\n    position: static;\n    padding: 4px 8px;\n    max-width: 240px;\n    /*-webkit-transition-property: opacity;*/\n    transition-property: opacity;\n    display: none;\n    position: absolute;\n    bottom: 22px;\n}\n.adsrv-player .adsrv-play {\n    Xbackground-image: url(data:image/svg+xml;base64,DQo8c3ZnIHdpZHRoPSIzM3B4IiBoZWlnaHQ9IjM4cHgiIHZpZXdCb3g9IjMxIDI0IDMzIDM4IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPg0KICAgIDwhLS0gR2VuZXJhdG9yOiBTa2V0Y2ggNDIgKDM2NzgxKSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4NCiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4NCiAgICA8ZGVmcz48L2RlZnM+DQogICAgPHBhdGggZD0iTTQ2Ljc1MjQ1OTcsMjcuMjk5NDI0MSBDNDYuOTYzMzE0MiwyNi45Mzk3MDM4IDQ3LjMwNzMyNDEsMjYuOTQzMzY3IDQ3LjUxNjAzMTQsMjcuMjk5NDI0MSBMNjUuNDQxMzE5Nyw1Ny44ODAxODQ1IEM2NS42NTIxNzQyLDU4LjIzOTkwNDggNjUuNDg4NTU1OCw1OC41MzE1MTU4IDY1LjA3NjQ3MTUsNTguNTMxNTE1OCBMMjkuMTkyMDE5Niw1OC41MzE1MTU4IEMyOC43Nzk2NjUsNTguNTMxNTE1OCAyOC42MTg0NjQxLDU4LjIzNjI0MTYgMjguODI3MTcxNCw1Ny44ODAxODQ1IEw0Ni43NTI0NTk3LDI3LjI5OTQyNDEgWiIgaWQ9IlRyaWFuZ2xlIiBzdHJva2U9Im5vbmUiIGZpbGw9IiNGRkZGRkYiIGZpbGwtcnVsZT0iZXZlbm9kZCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNDcuMTM0NjkzLCA0Mi43ODEyNjEpIHJvdGF0ZSgtMjcwLjAwMDAwMCkgdHJhbnNsYXRlKC00Ny4xMzQ2OTMsIC00Mi43ODEyNjEpICI+PC9wYXRoPg0KPC9zdmc+);\n    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCA3NTIgMTAyNCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNzUyIDEwMjQ7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+DQoJLnN0MHtmaWxsOiNGRkZGRkY7fQ0KPC9zdHlsZT4NCjxwb2x5Z29uIGNsYXNzPSJzdDAiIHBvaW50cz0iNzUyLDUxMiAwLDAgMCwxMDI0ICIvPg0KPC9zdmc+DQo=);\n    padding: 0px;\n    background-color: transparent;\n    border: none;\n    background-repeat: no-repeat;\n    background-position: center center;\n    outline: none;\n    width: 24px;\n    height: 24px;\n    background-size: 15px;\n    cursor: pointer;\n}\n.adsrv-player .adsrv-play.adsrv-pause {\n    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCA3ODQgMTAyNCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgNzg0IDEwMjQ7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+DQoJLnN0MHtmaWxsOiNGRkZGRkY7fQ0KPC9zdHlsZT4NCjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik01ODIuMiwwaDkuOGMzOSwwLDY4LjMsMjkuMyw2OC4zLDY4LjN2ODg3LjVjMCwzOS0yOS4zLDY4LjMtNjguMyw2OC4zaC05LjhjLTM5LDAtNjguMy0yOS4zLTY4LjMtNjguM1Y2OC4zDQoJQzUxMy45LDI5LjMsNTQzLjIsMCw1ODIuMiwwTDU4Mi4yLDB6Ii8+DQo8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMTkyLjEsMGg5LjhjMzksMCw2OC4zLDI5LjMsNjguMyw2OC4zdjg4Ny41YzAsMzktMjkuMyw2OC4zLTY4LjMsNjguM2gtOS44Yy0zOSwwLTY4LjMtMjkuMy02OC4zLTY4LjNWNjguMw0KCUMxMjMuOCwyOS4zLDE1My4xLDAsMTkyLjEsMEwxOTIuMSwweiIvPg0KPC9zdmc+DQo=);\n    background-size: 14px;\n}\n.adsrv-player.adsrv-ended .adsrv-play {\n    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCAxMDEwLjQgOTc2LjEiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDEwMTAuNCA5NzYuMTsiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4NCgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9DQo8L3N0eWxlPg0KPHBhdGggY2xhc3M9InN0MCIgZD0iTTE1Ny4yLDU0djI3Ny4zYzAsMzQuMS0yOS45LDY0LTY0LDY0aC00LjNjLTM0LjEsMC01OS43LTI1LjYtNTkuNy01OS43VjExMy43QzI5LjIsNzkuNiw1NC44LDU0LDg4LjksNTQNCglDODguOSw1NCwxNTcuMiw1NCwxNTcuMiw1NHoiLz4NCjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik00MDguOSwzMTQuMkgxMTguOGMtMjkuOSwwLTU1LjUsMjUuNi01NS41LDU1LjVsMCwwYzAsMjkuOSwyNS42LDU1LjUsNTUuNSw1NS41aDIzMC40DQoJYzM0LjEsMCw1OS43LTI1LjYsNTkuNy01OS43VjMxNC4yTDQwOC45LDMxNC4yeiIvPg0KPHBhdGggY2xhc3M9InN0MCIgZD0iTTEyNi4xLDI0OS45QzI1OC4zLDMyLjMsNTM5LjktMzYsNzU3LjUsOTYuM3MyOTAuMSw0MTMuOSwxNTcuOSw2MzEuNXMtNDEzLjksMjgxLjYtNjMxLjUsMTUzLjYNCgljLTIxLjMtMTcuMS0yOS45LTQ2LjktMTcuMS03Mi41YzEyLjgtMjUuNiw0Ni45LTI5LjksNjguMy0xNy4xYzE3MC43LDEwMi40LDM4OC4zLDQ2LjksNDkwLjctMTE5LjUNCglDOTI4LjIsNTAxLjYsODcyLjcsMjg0LDcwMi4xLDE4MS42cy0zODguMy00Ni45LTQ5MC43LDExOS41Yy0xMi44LDI1LjYtNDYuOSwyOS45LTY4LjMsMTcuMVMxMTMuMywyNzUuNSwxMjYuMSwyNDkuOUwxMjYuMSwyNDkuOXoiDQoJLz4NCjwvc3ZnPg0K);\n    background-size: 20px;\n}\n.adsrv-player .adsrv-next {\n    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCA4ODAgMTAyNCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgODgwIDEwMjQ7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+DQoJLnN0MHtmaWxsOiNGRkZGRkY7fQ0KPC9zdHlsZT4NCjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik04MDAuOCwwaDkuOGMzOSwwLDY4LjMsMjkuMyw2OC4zLDY4LjN2ODg3LjVjMCwzOS0yOS4zLDY4LjMtNjguMyw2OC4zaC05LjhjLTM5LDAtNjguMy0yOS4zLTY4LjMtNjguM1Y2OC4zDQoJQzczMi42LDI5LjMsNzYxLjgsMCw4MDAuOCwwTDgwMC44LDB6Ii8+DQo8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMS4xLDEwMjRjMCwwLDAtMzQxLjMsMC0xMDI0YzAsMCwyNDMuOCwxNjAuOSw3MzEuNCw0ODcuNmMwLDE5LjUsMCwyNC40LDAsNDguOA0KCUM3MzIuNiw1MjEuOCw0ODguOCw2ODIuNywxLjEsMTAyNHoiLz4NCjwvc3ZnPg0K);\n    padding: 0px;\n    background-color: transparent;\n    border: none;\n    background-repeat: no-repeat;\n    background-position: center center;\n    outline: none;\n    width: 24px;\n    height: 24px;\n    background-size: 16px;\n    margin-left: 6px;\n    cursor: pointer;\n}\n.adsrv-player .adsrv-volume {\n    Xbackground-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTE0NyIgaGVpZ2h0PSIxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogPGc+CiAgPHRpdGxlPkxheWVyIDE8L3RpdGxlPgogIDxnIGlkPSJzdmdfMSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsLTEsMCw5NjApICI+CiAgIDxwYXRoIGlkPSJzdmdfMiIgZD0ibTc5NSw3OThxLTksMCAtMTUsLTZ0LTYsLTE1bDAsLTQycTAsLTkgNiwtMTUuNXQxNSwtNi41cTUxLC0zIDk1LjUsLTI1dDc3LjUsLTU3LjV0NTIsLTgydDE5LC05OC41dC0xOSwtOTh0LTUyLC04MS41dC03Ny41LC01Ny41dC05NS41LC0yNnEtOSwwIC0xNSwtNnQtNiwtMTVsMCwtNDJxMCwtOSA2LC0xNXQxNSwtNnE2OSw0IDEyOC41LDMzdDEwMy41LDc2dDY5LjUsMTA4LjV0MjUuNSwxMjkuNXEwLDY5IC0yNS41LDEzMC41dC02OS41LDEwOHQtMTAzLjUsNzZ0LTEyOC41LDMzLjVsMCwwem01LC00NzlxNDYsOSA3Niw0NXQzMCw4NHQtMzAsODR0LTc2LDQ1cS0xMSwyIC0xOC41LC00dC03LjUsLTE3bDAsLTIxNnEwLC05IDcuNSwtMTZ0MTguNSwtNWwwLDB6bS0yNTEsNTI4bC0zMTcsLTE5OWwtMTcwLDBxLTI2LDAgLTQ0LjUsLTE4LjV0LTE4LjUsLTQ1LjVsMCwtMjg2cTAsLTI3IDE4LjUsLTQ1LjV0NDQuNSwtMTguNWwxOTUsMGwyODcsLTE4NXEyMywtMTYgNTUsLTUuNXQzMiw0MC41bDAsNzI4cTIsMzAgLTI5LDM5LjV0LTUzLC00LjVsMCwweiIgZmlsbD0iI2Y3ZjdmNyIvPgogIDwvZz4KIDwvZz4KPC9zdmc+Cg==);\n    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCAxMjE2IDEwMjQiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDEyMTYgMTAyNDsiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4NCgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9DQo8L3N0eWxlPg0KPHBhdGggY2xhc3M9InN0MCIgZD0iTTAsNzExLjloMjYzLjNMNjc3LjgsMTAyNFYwTDI2My4zLDMxMi4xSDBWNzExLjl6Ii8+DQo8cGF0aCBjbGFzcz0ic3QwIiBkPSJNODc3LjcsMzQxLjNsLTY4LjMsNjguM2M1My42LDU4LjUsNTMuNiwxNDYuMywwLDIwNC44bDY4LjMsNjguM0M5NzAuNCw1OTAsOTcwLjQsNDM0LDg3Ny43LDM0MS4zTDg3Ny43LDM0MS4zeg0KCSIvPg0KPHBhdGggY2xhc3M9InN0MCIgZD0iTTEwODcuNCwyMDQuOGwtNzMuMSw3OGM2OC4zLDczLjEsMTAyLjQsMTY1LjgsMTAyLjQsMjYzLjNjMCwxMDIuNC0zNC4xLDE5NS0xMDIuNCwyNjMuM2w3My4xLDc4DQoJYzgyLjktOTIuNiwxMzEuNy0yMTQuNiwxMzEuNy0zNDEuM1MxMTcwLjMsMjk3LjQsMTA4Ny40LDIwNC44TDEwODcuNCwyMDQuOHoiLz4NCjwvc3ZnPg0K);\n    padding: 0px;\n    background-color: transparent;\n    border: none;\n    background-repeat: no-repeat;\n    background-position: center center;\n    outline: none;\n    width: 24px;\n    height: 24px;\n    background-size: 24px;\n    cursor: pointer;\n    margin-left: 10px;\n}\n.adsrv-player .adsrv-volume.adsrv-mid {\n    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCAxMjE2IDEwMjQiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDEyMTYgMTAyNDsiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4NCgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9DQo8L3N0eWxlPg0KPHBhdGggY2xhc3M9InN0MCIgZD0iTTAsNzExLjloMjYzLjNMNjc3LjgsMTAyNFYwTDI2My4zLDMxMi4xSDBWNzExLjl6Ii8+DQo8cGF0aCBjbGFzcz0ic3QwIiBkPSJNODc3LjcsMzQxLjNsLTY4LjMsNjguM2M1My42LDU4LjUsNTMuNiwxNDYuMywwLDIwNC44bDY4LjMsNjguM0M5NzAuNCw1OTAsOTcwLjQsNDM0LDg3Ny43LDM0MS4zTDg3Ny43LDM0MS4zeg0KCSIvPg0KPC9zdmc+DQo=);\n}\n.adsrv-player .adsrv-volume.adsrv-muted {\n    Xbackground-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTE0NCIgaGVpZ2h0PSIxMDI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogPGc+CiAgPHRpdGxlPkxheWVyIDE8L3RpdGxlPgogIDxnIGlkPSJzdmdfMSIgdHJhbnNmb3JtPSJtYXRyaXgoMSwwLDAsLTEsMCw5NjApICI+CiAgIDxwYXRoIGlkPSJzdmdfMiIgZD0ibTEwMTUsNDQxbDg5LDg5cTEyLDEzIDEyLDMwdC0xMiwyOXQtMjkuNSwxMnQtMjkuNSwtMTJsLTg5LC04OWwtODksODlxLTEzLDEyIC0zMCwxMnQtMjksLTEydC0xMiwtMjl0MTIsLTMwbDg5LC04OWwtODksLTg5cS0xMiwtMTMgLTEyLC0zMHQxMiwtMjlxNywtNyAxNC41LC05LjV0MTUuNSwtMi41cTksMCAxNi41LDMuNXQxNC41LDguNWw4OSw4OWw4OSwtODlxOCwtNyAxNSwtOS41dDE2LC0yLjV0MTYuNSwzLjV0MTQuNSw4LjVxMTIsMTIgMTIsMjl0LTEyLDMwbC05NCw4OWwwLDB6bS00NjgsNDA0bC0zMTQsLTE5N2wtMTcyLDBxLTI2LDAgLTQ0LjUsLTE4LjV0LTE4LjUsLTQ1LjVsMCwtMjg2cTAsLTI3IDE4LjUsLTQ1LjV0NDQuNSwtMTguNWwxOTUsMGwyODcsLTE4NXEyMiwtMTYgNTQsLTUuNXQzMiw0MC41bDAsNzI2cTIsMzAgLTI3LjUsNDAuNXQtNTQuNSwtNS41bDAsMHoiIGZpbGw9IiNmN2Y3ZjciLz4KICA8L2c+CiA8L2c+Cjwvc3ZnPgo=);\n    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCAxMjE2IDEwMjQiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDEyMTYgMTAyNDsiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4NCgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9DQo8L3N0eWxlPg0KPHBhdGggY2xhc3M9InN0MCIgZD0iTTAsNzExLjloMjYzLjNMNjc3LjgsMTAyNFYwTDI2My4zLDMxMi4xSDBWNzExLjl6Ii8+DQo8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMTE4Ny4xLDY4NC4ybC0zOC4xLDM1LjdjLTkuMyw4LjctMjMuOCw4LjItMzIuNS0xLjFMNzczLjEsMzUyLjJjLTguNy05LjMtOC4yLTIzLjgsMS4xLTMyLjVsMzguMS0zNS43DQoJYzkuMy04LjcsMjMuOC04LjIsMzIuNSwxLjFsMzQzLjUsMzY2LjZDMTE5Ni44LDY2MSwxMTk2LjMsNjc1LjYsMTE4Ny4xLDY4NC4yeiIvPg0KPHBhdGggY2xhc3M9InN0MCIgZD0iTTc3NC4xLDY4NC4ybDM4LjEsMzUuN2M5LjMsOC43LDIzLjgsOC4yLDMyLjUtMS4xbDM0My41LTM2Ni42YzguNy05LjMsOC4yLTIzLjgtMS4xLTMyLjVsLTM4LjEtMzUuNw0KCWMtOS4zLTguNy0yMy44LTguMi0zMi41LDEuMUw3NzMuMSw2NTEuOEM3NjQuNCw2NjEsNzY0LjksNjc1LjYsNzc0LjEsNjg0LjJ6Ii8+DQo8L3N2Zz4NCg==);\n}\n.adsrv-player .adsrv-timer {\n    margin-left: 10px;\n    display: flex;\n    flex: auto;\n    height: 24px;\n}\n.adsrv-player .adsrv-playback-rate {\n    padding: 0px;\n    border: none;\n    min-width: 24px;\n    height: 24px;\n    cursor: pointer;\n    margin-left: 10px;\n}\n.adsrv-player .adsrv-playback-rate-value {\n    font-weight: bold;\n    text-align: center;\n    padding: 0 3px;\n}\n.adsrv-player ul.adsrv-list-items {\n    display: none;\n    background-color: #2b333f;\n    background-color: rgba(43,51,63,.7);\n    bottom: 45px;\n    max-height: 15em;\n    position: absolute;\n    width: 10em;\n    right: 0;\n}\n.adsrv-player ul.adsrv-list-items li {\n    Xfont-size: 1.2em;\n    Xline-height: 1.4em;\n    list-style: none;\n    margin: 0;\n    padding: 3px 6px;\n    text-align: center;\n    Xtext-transform: lowercase;\n}\n.adsrv-player ul.adsrv-list-items li:hover,\n.adsrv-player ul.adsrv-list-items li:focus {\n    background-color: #73859f;\n    background-color: rgba(115,133,159,.5);\n}\n.adsrv-player ul.adsrv-list-items li.adsrv-selected,\n.adsrv-player ul.adsrv-list-items li.adsrv-selected:hover,\n.adsrv-player ul.adsrv-list-items li.adsrv-selected:focus {\n    background-color: #fff;\n    color: #2b333f;\n}\n.adsrv-player .adsrv-hover ul.adsrv-list-items {\n    display: block;\n}\n.adsrv-player .adsrv-fullscreen {\n    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCA5OTIgMTAyNCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgOTkyIDEwMjQ7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+DQoJLnN0MHtmaWxsOiNGRkZGRkY7fQ0KPC9zdHlsZT4NCjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik05MDEuMSw0MTguNWgtMTcuOGMtMjIuMywwLTQ0LjUtMTcuOC00NC41LTQ0LjVWMTY5LjJINjM0Yy0yMi4zLDAtNDQuNS0xNy44LTQ0LjUtNDQuNVY4OQ0KCWMwLTIyLjMsMTcuOC00NC41LDQ0LjUtNDQuNWgzMjkuNVYzNzRjMCwyMi4zLTE3LjgsNDQuNS00NC41LDQ0LjVIOTAxLjFMOTAxLjEsNDE4LjV6Ii8+DQo8cGF0aCBjbGFzcz0ic3QwIiBkPSJNNTg5LjUsOTE3LjF2LTE3LjhjMC0yMi4zLDE3LjgtNDQuNSw0NC41LTQ0LjVoMjA0LjhWNjUwYzAtMjIuMywxNy44LTQ0LjUsNDQuNS00NC41SDkxOQ0KCWMyMi4zLDAsNDQuNSwxNy44LDQ0LjUsNDQuNXYzMjkuNUg2MzRjLTIyLjMsMC00NC41LTE3LjgtNDQuNS00NC41VjkxNy4xTDU4OS41LDkxNy4xeiIvPg0KPHBhdGggY2xhc3M9InN0MCIgZD0iTTkwLjksNjA1LjVoMTcuOGMyMi4zLDAsNDQuNSwxNy44LDQ0LjUsNDQuNXYyMDQuOEgzNThjMjIuMywwLDQ0LjUsMTcuOCw0NC41LDQ0LjVWOTM1DQoJYzAsMjIuMy0xNy44LDQ0LjUtNDQuNSw0NC41SDI4LjVWNjUwYzAtMjIuMywxNy44LTQ0LjUsNDQuNS00NC41SDkwLjlMOTAuOSw2MDUuNXoiLz4NCjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik00MDIuNSwxMDYuOXYxNy44YzAsMjIuMy0xNy44LDQ0LjUtNDQuNSw0NC41SDE1My4yVjM3NGMwLDIyLjMtMTcuOCw0NC41LTQ0LjUsNDQuNUg3Mw0KCWMtMjIuMywwLTQ0LjUtMTcuOC00NC41LTQ0LjVWNDQuNUgzNThjMjIuMywwLDQ0LjUsMTcuOCw0NC41LDQ0LjVWMTA2LjlMNDAyLjUsMTA2Ljl6Ii8+DQo8L3N2Zz4NCg==);\n    padding: 0px;\n    background-color: transparent;\n    border: none;\n    background-repeat: no-repeat;\n    background-position: center center;\n    outline: none;\n    width: 24px;\n    height: 24px;\n    background-size: 18px;\n    cursor: pointer;\n    margin-left: 10px;\n}\n.adsrv-player .adsrv-fullscreen.adsrv-off {\n    background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDEwMjQgMTAyNDsiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4NCgkuc3Qwe2ZpbGw6I0ZGRkZGRjt9DQo8L3N0eWxlPg0KPHBhdGggY2xhc3M9InN0MCIgZD0iTTY4Mi43LDBoMjAuNUM3MzAuNSwwLDc1MSwyMC41LDc1MSw0Ny44djIyNS4zaDIyNS4zYzI3LjMsMCw0Ny44LDIwLjUsNDcuOCw0Ny44djQxDQoJYzAsMjcuMy0yMC41LDQ3LjgtNDcuOCw0Ny44SDYxNC40VjQ3LjhjMC0yNy4zLDIwLjUtNDcuOCw0Ny44LTQ3LjhINjgyLjdMNjgyLjcsMHoiLz4NCjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDI0LDY4Mi43djIwLjVjMCwyNy4zLTIwLjUsNDcuOC00Ny44LDQ3LjhINzUwLjl2MjI1LjNjMCwyNy4zLTIwLjUsNDcuOC00Ny44LDQ3LjhoLTQxDQoJYy0yNy4zLDAtNDcuOC0yMC41LTQ3LjgtNDcuOFY2MTQuNGgzNjEuOGMyNy4zLDAsNDcuOCwyMC41LDQ3LjgsNDcuOEwxMDI0LDY4Mi43TDEwMjQsNjgyLjd6Ii8+DQo8cGF0aCBjbGFzcz0ic3QwIiBkPSJNMCwzNDEuM3YtMjAuNUMwLDI5My41LDIwLjUsMjczLDQ3LjgsMjczaDIyNS4zVjQ3LjhjMC0yNy4zLDIwLjUtNDcuOCw0Ny44LTQ3LjhoNDENCgljMjcuMywwLDQ3LjgsMjAuNSw0Ny44LDQ3Ljh2MzYxLjhINDcuOEMyMC41LDQwOS42LDAsMzg5LjEsMCwzNjEuOFYzNDEuM0wwLDM0MS4zeiIvPg0KPHBhdGggY2xhc3M9InN0MCIgZD0iTTM0MS4zLDEwMjRoLTIwLjVjLTI3LjMsMC00Ny44LTIwLjUtNDcuOC00Ny44Vjc1MC45SDQ3LjhDMjAuNSw3NTAuOSwwLDczMC41LDAsNzAzLjF2LTQxDQoJYzAtMjcuMywyMC41LTQ3LjgsNDcuOC00Ny44aDM2MS44djM2MS44YzAsMjcuMy0yMC41LDQ3LjgtNDcuOCw0Ny44TDM0MS4zLDEwMjRMMzQxLjMsMTAyNHoiLz4NCjwvc3ZnPg0K);\n}\n.adsrv-player .adsrv-cc {\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBhcmlhLWhpZGRlbj0idHJ1ZSIgZm9jdXNhYmxlPSJmYWxzZSIgZGF0YS1wcmVmaXg9ImZhcyIgZGF0YS1pY29uPSJjbG9zZWQtY2FwdGlvbmluZyIgY2xhc3M9InN2Zy1pbmxpbmUtLWZhIGZhLWNsb3NlZC1jYXB0aW9uaW5nIGZhLXctMTYiIHJvbGU9ImltZyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgNTEyIDUxMiI+PHBhdGggZmlsbD0iI2ZmZmZmZiIgZD0iTTQ2NCA2NEg0OEMyMS41IDY0IDAgODUuNSAwIDExMnYyODhjMCAyNi41IDIxLjUgNDggNDggNDhoNDE2YzI2LjUgMCA0OC0yMS41IDQ4LTQ4VjExMmMwLTI2LjUtMjEuNS00OC00OC00OHpNMjE4LjEgMjg3LjdjMi44LTIuNSA3LjEtMi4xIDkuMi45bDE5LjUgMjcuN2MxLjcgMi40IDEuNSA1LjYtLjUgNy43LTUzLjYgNTYuOC0xNzIuOCAzMi4xLTE3Mi44LTY3LjkgMC05Ny4zIDEyMS43LTExOS41IDE3Mi41LTcwLjEgMi4xIDIgMi41IDMuMiAxIDUuN2wtMTcuNSAzMC41Yy0xLjkgMy4xLTYuMiA0LTkuMSAxLjctNDAuOC0zMi05NC42LTE0LjktOTQuNiAzMS4yLjEgNDggNTEuMSA3MC41IDkyLjMgMzIuNnptMTkwLjQgMGMyLjgtMi41IDcuMS0yLjEgOS4yLjlsMTkuNSAyNy43YzEuNyAyLjQgMS41IDUuNi0uNSA3LjctNTMuNSA1Ni45LTE3Mi43IDMyLjEtMTcyLjctNjcuOSAwLTk3LjMgMTIxLjctMTE5LjUgMTcyLjUtNzAuMSAyLjEgMiAyLjUgMy4yIDEgNS43TDQyMCAyMjIuMmMtMS45IDMuMS02LjIgNC05LjEgMS43LTQwLjgtMzItOTQuNi0xNC45LTk0LjYgMzEuMiAwIDQ4IDUxIDcwLjUgOTIuMiAzMi42eiI+PC9wYXRoPjwvc3ZnPg==);\n    padding: 0px;\n    background-color: transparent;\n    border: none;\n    background-repeat: no-repeat;\n    background-position: center center;\n    outline: none;\n    width: 24px;\n    height: 24px;\n    background-size: 24px;\n    cursor: pointer;\n    margin-left: 10px;\n}\n.adsrv-player .adsrv-cc.adsrv-off {\n    background-image: url(data:image/svg+xml;base64,PHN2ZyBhcmlhLWhpZGRlbj0idHJ1ZSIgZm9jdXNhYmxlPSJmYWxzZSIgZGF0YS1wcmVmaXg9ImZhciIgZGF0YS1pY29uPSJjbG9zZWQtY2FwdGlvbmluZyIgY2xhc3M9InN2Zy1pbmxpbmUtLWZhIGZhLWNsb3NlZC1jYXB0aW9uaW5nIGZhLXctMTYiIHJvbGU9ImltZyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgNTEyIDUxMiI+PHBhdGggZmlsbD0iI2ZmZmZmZiIgZD0iTTQ2NCA2NEg0OEMyMS41IDY0IDAgODUuNSAwIDExMnYyODhjMCAyNi41IDIxLjUgNDggNDggNDhoNDE2YzI2LjUgMCA0OC0yMS41IDQ4LTQ4VjExMmMwLTI2LjUtMjEuNS00OC00OC00OHptLTYgMzM2SDU0Yy0zLjMgMC02LTIuNy02LTZWMTE4YzAtMy4zIDIuNy02IDYtNmg0MDRjMy4zIDAgNiAyLjcgNiA2djI3NmMwIDMuMy0yLjcgNi02IDZ6bS0yMTEuMS04NS43YzEuNyAyLjQgMS41IDUuNi0uNSA3LjctNTMuNiA1Ni44LTE3Mi44IDMyLjEtMTcyLjgtNjcuOSAwLTk3LjMgMTIxLjctMTE5LjUgMTcyLjUtNzAuMSAyLjEgMiAyLjUgMy4yIDEgNS43bC0xNy41IDMwLjVjLTEuOSAzLjEtNi4yIDQtOS4xIDEuNy00MC44LTMyLTk0LjYtMTQuOS05NC42IDMxLjIgMCA0OCA1MSA3MC41IDkyLjIgMzIuNiAyLjgtMi41IDcuMS0yLjEgOS4yLjlsMTkuNiAyNy43em0xOTAuNCAwYzEuNyAyLjQgMS41IDUuNi0uNSA3LjctNTMuNiA1Ni45LTE3Mi44IDMyLjEtMTcyLjgtNjcuOSAwLTk3LjMgMTIxLjctMTE5LjUgMTcyLjUtNzAuMSAyLjEgMiAyLjUgMy4yIDEgNS43TDQyMCAyMjAuMmMtMS45IDMuMS02LjIgNC05LjEgMS43LTQwLjgtMzItOTQuNi0xNC45LTk0LjYgMzEuMiAwIDQ4IDUxIDcwLjUgOTIuMiAzMi42IDIuOC0yLjUgNy4xLTIuMSA5LjIuOWwxOS42IDI3Ljd6Ij48L3BhdGg+PC9zdmc+);\n}\n\n.adsrv-player .adsrv-close {\n    position: absolute;\n    height: 16px;\n    width: 16px;\n    margin: 0;\n    border: 1px solid #000;\n    padding: 0;\n    background-color: #fff;\n    right: 0;\n    top: -24px;\n    display: none;\n    cursor: pointer;\n}\n.adsrv-player .adsrv-close svg {\n    position: absolute;\n    top: 0px;\n    right: 0px;\n    height: 16px;\n    width: 16px;\n    stroke: #000;\n    fill: #000;\n    stroke-width: 1.25px;\n}\n.adsrv-player.adsrv-sticky .adsrv-close {\n    display: block;\n}\n\n.adsrv-player.adsrv-ads .adsrv-overlay,\n.adsrv-player.adsrv-ads .adsrv-gradient,\n.adsrv-player.adsrv-ads .adsrv-title-bar,\n.adsrv-player.adsrv-ads .adsrv-timeline,\n.adsrv-player.adsrv-ads .adsrv-controls {\n    transition: none;\n    opacity: 0;\n    visibility: hidden;\n}\n\n\n.adsrv-player.adsrv-hidden:not(.adsrv-ads) > * {\n    visibility: hidden;\n}\n.adsrv-player.adsrv-hidden:not(adsrv-ads) .adsrv-overlay,\n.adsrv-player.adsrv-hidden:not(adsrv-ads) .adsrv-gradient,\n.adsrv-player.adsrv-hidden:not(adsrv-ads) .adsrv-title-bar,\n.adsrv-player.adsrv-hidden:not(adsrv-ads) .adsrv-timeline,\n.adsrv-player.adsrv-hidden:not(adsrv-ads) .adsrv-controls {\n    opacity: 0;\n    visibility: hidden;\n}\n\n.adsrv-ended {\n    /* TODO */\n}\n',""]);const s=n},954:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r=t(e);return e[2]?"@media ".concat(e[2]," {").concat(r,"}"):r})).join("")},e.i=function(t,r,i){"string"==typeof t&&(t=[[null,t,""]]);var n={};if(i)for(var s=0;s<this.length;s++){var a=this[s][0];null!=a&&(n[a]=!0)}for(var o=0;o<t.length;o++){var l=[].concat(t[o]);i&&n[l[0]]||(r&&(l[2]?l[2]="".concat(r," and ").concat(l[2]):l[2]=r),e.push(l))}},e}},48:(t,e,r)=>{var i,n=void 0!==r.g?r.g:"undefined"!=typeof window?window:{},s=r(893);"undefined"!=typeof document?i=document:(i=n["__GLOBAL_DOCUMENT_CACHE@4"])||(i=n["__GLOBAL_DOCUMENT_CACHE@4"]=s),t.exports=i},11:(t,e,r)=>{var i;i="undefined"!=typeof window?window:void 0!==r.g?r.g:"undefined"!=typeof self?self:{},t.exports=i},286:function(t){var e;"undefined"!=typeof window&&(e=()=>(()=>{var t={"./src/config.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{enableStreamingMode:()=>_,hlsDefaultConfig:()=>L,mergeConfig:()=>A});var i=r("./src/controller/abr-controller.ts"),n=r("./src/controller/audio-stream-controller.ts"),s=r("./src/controller/audio-track-controller.ts"),a=r("./src/controller/subtitle-stream-controller.ts"),o=r("./src/controller/subtitle-track-controller.ts"),l=r("./src/controller/buffer-controller.ts"),d=r("./src/controller/timeline-controller.ts"),u=r("./src/controller/cap-level-controller.ts"),c=r("./src/controller/fps-controller.ts"),h=r("./src/controller/eme-controller.ts"),f=r("./src/controller/cmcd-controller.ts"),p=r("./src/utils/xhr-loader.ts"),v=r("./src/utils/fetch-loader.ts"),g=r("./src/utils/cues.ts"),m=r("./src/utils/mediakeys-helper.ts"),y=r("./src/utils/logger.ts");function E(){return E=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},E.apply(this,arguments)}function T(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function S(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?T(Object(r),!0).forEach((function(e){b(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function b(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var L=S(S({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:p.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:i.default,bufferController:l.default,capLevelController:u.default,fpsController:c.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:m.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:g.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:a.SubtitleStreamController,subtitleTrackController:o.default,timelineController:d.TimelineController,audioStreamController:n.default,audioTrackController:s.default,emeController:h.default,cmcdController:f.default});function A(t,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return E({},t,e)}function _(t){var e=t.loader;e!==v.default&&e!==p.default?(y.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1):(0,v.fetchSupported)()&&(t.loader=v.default,t.progressive=!0,t.enableSoftwareAES=!0,y.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>u});var i=r("./src/polyfills/number.ts"),n=r("./src/utils/ewma-bandwidth-estimator.ts"),s=r("./src/events.ts"),a=r("./src/errors.ts"),o=r("./src/types/loader.ts"),l=r("./src/utils/logger.ts");function d(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,s=void 0,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?s:String(s)),i)}var n,s}const u=function(){function t(t){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;var e=t.config;this.bwEstimator=new n.default(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate),this.registerListeners()}var e,r,u,c=t.prototype;return c.registerListeners=function(){var t=this.hls;t.on(s.Events.FRAG_LOADING,this.onFragLoading,this),t.on(s.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(s.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(s.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){var t=this.hls;t.off(s.Events.FRAG_LOADING,this.onFragLoading,this),t.off(s.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(s.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(s.Events.ERROR,this.onError,this)},c.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},c.onFragLoading=function(t,e){var r,i=e.frag;i.type===o.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=i,this.partCurrent=null!=(r=e.part)?r:null,this.timer=self.setInterval(this.onCheck,100)))},c.onLevelLoaded=function(t,e){var r=this.hls.config;e.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},c._abandonRulesCheck=function(){var t=this.fragCurrent,e=this.partCurrent,r=this.hls,n=r.autoLevelEnabled,a=r.media;if(t&&a){var o=e?e.stats:t.stats,d=e?e.duration:t.duration;if(o.aborted||o.loaded&&o.loaded===o.total||0===t.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(n&&!a.paused&&a.playbackRate&&a.readyState){var u=r.mainForwardBufferInfo;if(null!==u){var c=performance.now()-o.loading.start,h=Math.abs(a.playbackRate);if(!(c<=500*d/h)){var f=o.loaded&&o.loading.first,p=this.bwEstimator.getEstimate(),v=r.levels,g=r.minAutoLevel,m=v[t.level],y=o.total||Math.max(o.loaded,Math.round(d*m.maxBitrate/8)),E=f?1e3*o.loaded/c:0,T=E?(y-o.loaded)/E:8*y/p,S=u.len/h;if(!(T<=S)){var b,L=Number.POSITIVE_INFINITY;for(b=t.level-1;b>g;b--){var A=v[b].maxBitrate;if((L=E?d*A/(6.4*E):d*A/p)<S)break}L>=T||(l.logger.warn("Fragment "+t.sn+(e?" part "+e.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+b+"\n      Current BW estimate: "+((0,i.isFiniteNumber)(p)?(p/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+T.toFixed(3)+" s\n      Estimated load time for the next fragment: "+L.toFixed(3)+" s\n      Time to underbuffer: "+S.toFixed(3)+" s"),r.nextLoadLevel=b,f&&this.bwEstimator.sample(c,o.loaded),this.clearTimer(),(t.loader||t.keyLoader)&&(this.fragCurrent=this.partCurrent=null,t.abortRequests()),r.trigger(s.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:o}))}}}}}},c.onFragLoaded=function(t,e){var r=e.frag,n=e.part;if(r.type===o.PlaylistLevelType.MAIN&&(0,i.isFiniteNumber)(r.sn)){var a=n?n.stats:r.stats,l=n?n.duration:r.duration;if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var d=this.hls.levels[r.level],u=(d.loaded?d.loaded.bytes:0)+a.loaded,c=(d.loaded?d.loaded.duration:0)+l;d.loaded={bytes:u,duration:c},d.realBitrate=Math.round(8*u/c)}if(r.bitrateTest){var h={stats:a,frag:r,part:n,id:r.type};this.onFragBuffered(s.Events.FRAG_BUFFERED,h)}}},c.onFragBuffered=function(t,e){var r=e.frag,i=e.part,n=i?i.stats:r.stats;if(!n.aborted&&r.type===o.PlaylistLevelType.MAIN&&"initSegment"!==r.sn){var s=n.parsing.end-n.loading.start;this.bwEstimator.sample(s,n.loaded),n.bwEstimate=this.bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},c.onError=function(t,e){var r;if((null===(r=e.frag)||void 0===r?void 0:r.type)===o.PlaylistLevelType.MAIN){if(e.type===a.ErrorTypes.KEY_SYSTEM_ERROR)return void this.clearTimer();switch(e.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer()}}},c.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},c.getNextABRAutoLevel=function(){var t=this.fragCurrent,e=this.partCurrent,r=this.hls,i=r.maxAutoLevel,n=r.config,s=r.minAutoLevel,a=r.media,o=e?e.duration:t?t.duration:0,d=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,u=this.bwEstimator?this.bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,c=r.mainForwardBufferInfo,h=(c?c.len:0)/d,f=this.findBestLevel(u,s,i,h,n.abrBandWidthFactor,n.abrBandWidthUpFactor);if(f>=0)return f;l.logger.trace((h?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var p=o?Math.min(o,n.maxStarvationDelay):n.maxStarvationDelay,v=n.abrBandWidthFactor,g=n.abrBandWidthUpFactor;if(!h){var m=this.bitrateTestDelay;m&&(p=(o?Math.min(o,n.maxLoadingDelay):n.maxLoadingDelay)-m,l.logger.trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),v=g=1)}return f=this.findBestLevel(u,s,i,h+p,v,g),Math.max(f,0)},c.findBestLevel=function(t,e,r,n,s,a){for(var o,d=this.fragCurrent,u=this.partCurrent,c=this.lastLoadedFragLevel,h=this.hls.levels,f=h[c],p=!(null==f||null===(o=f.details)||void 0===o||!o.live),v=null==f?void 0:f.codecSet,g=u?u.duration:d?d.duration:0,m=r;m>=e;m--){var y=h[m];if(y&&(!v||y.codecSet===v)){var E=y.details,T=(u?null==E?void 0:E.partTarget:null==E?void 0:E.averagetargetduration)||g,S=void 0;S=m<=c?s*t:a*t;var b=h[m].maxBitrate,L=b*T/S;if(l.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+m+"/"+Math.round(S)+"/"+b+"/"+T+"/"+n+"/"+L),S>b&&(0===L||!(0,i.isFiniteNumber)(L)||p&&!this.bitrateTestDelay||L<n))return m}}return-1},e=t,(r=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this.bwEstimator;if(-1!==t&&!e.canEstimate())return t;var r=this.getNextABRAutoLevel();return-1!==t&&this.hls.levels[r].loadError?t:(-1!==t&&(r=Math.min(t,r)),r)},set:function(t){this._nextAutoLevel=t}}])&&d(e.prototype,r),u&&d(e,u),Object.defineProperty(e,"prototype",{writable:!1}),t}()},"./src/controller/audio-stream-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>E});var i=r("./src/polyfills/number.ts"),n=r("./src/controller/base-stream-controller.ts"),s=r("./src/events.ts"),a=r("./src/utils/buffer-helper.ts"),o=r("./src/controller/fragment-tracker.ts"),l=r("./src/types/level.ts"),d=r("./src/types/loader.ts"),u=r("./src/loader/fragment.ts"),c=r("./src/demux/chunk-cache.ts"),h=r("./src/demux/transmuxer-interface.ts"),f=r("./src/types/transmuxer.ts"),p=r("./src/controller/fragment-finders.ts"),v=r("./src/utils/discontinuities.ts"),g=r("./src/errors.ts");function m(){return m=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},m.apply(this,arguments)}function y(t,e){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},y(t,e)}const E=function(t){var e,r;function E(e,r,i){var n;return(n=t.call(this,e,r,i,"[audio-stream-controller]")||this).videoBuffer=null,n.videoTrackCC=-1,n.waitingVideoCC=-1,n.audioSwitch=!1,n.trackId=-1,n.waitingData=null,n.mainDetails=null,n.bufferFlushed=!1,n.cachedTrackLoadedData=null,n._registerListeners(),n}r=t,(e=E).prototype=Object.create(r.prototype),e.prototype.constructor=e,y(e,r);var T=E.prototype;return T.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},T._registerListeners=function(){var t=this.hls;t.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(s.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(s.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(s.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(s.Events.ERROR,this.onError,this),t.on(s.Events.BUFFER_RESET,this.onBufferReset,this),t.on(s.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(s.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(s.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(s.Events.FRAG_BUFFERED,this.onFragBuffered,this)},T._unregisterListeners=function(){var t=this.hls;t.off(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(s.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(s.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(s.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(s.Events.ERROR,this.onError,this),t.off(s.Events.BUFFER_RESET,this.onBufferReset,this),t.off(s.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(s.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(s.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(s.Events.FRAG_BUFFERED,this.onFragBuffered,this)},T.onInitPtsFound=function(t,e){var r=e.frag,i=e.id,s=e.initPTS;if("main"===i){var a=r.cc;this.initPTS[r.cc]=s,this.log("InitPTS for cc: "+a+" found from main: "+s),this.videoTrackCC=a,this.state===n.State.WAITING_INIT_PTS&&this.tick()}},T.startLoad=function(t){if(!this.levels)return this.startPosition=t,void(this.state=n.State.STOPPED);var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,e>0&&-1===t?(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e,this.state=n.State.IDLE):(this.loadedmetadata=!1,this.state=n.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},T.doTick=function(){switch(this.state){case n.State.IDLE:this.doTickIdle();break;case n.State.WAITING_TRACK:var e,r=this.levels,i=this.trackId,s=null==r||null===(e=r[i])||void 0===e?void 0:e.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=n.State.WAITING_INIT_PTS}break;case n.State.FRAG_LOADING_WAITING_RETRY:var o,l=performance.now(),d=this.retryDate;(!d||l>=d||null!==(o=this.media)&&void 0!==o&&o.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=n.State.IDLE);break;case n.State.WAITING_INIT_PTS:var u=this.waitingData;if(u){var c=u.frag,h=u.part,f=u.cache,v=u.complete;if(void 0!==this.initPTS[c.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=n.State.FRAG_LOADING;var g={frag:c,part:h,payload:f.flush(),networkDetails:null};this._handleFragmentLoadProgress(g),v&&t.prototype._handleFragmentLoadComplete.call(this,g)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+c.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var m=this.getLoadPosition(),y=a.BufferHelper.bufferInfo(this.mediaBuffer,m,this.config.maxBufferHole);(0,p.fragmentWithinToleranceTest)(y.end,this.config.maxFragLookUpTolerance,c)<0&&(this.log("Waiting fragment cc ("+c.cc+") @ "+c.start+" cancelled because another fragment at "+y.end+" is needed"),this.clearWaitingFragment())}}else this.state=n.State.IDLE}this.onTickEnd()},T.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=n.State.IDLE)},T.resetLoadingState=function(){this.clearWaitingFragment(),t.prototype.resetLoadingState.call(this)},T.onTickEnd=function(){var t=this.media;t&&t.readyState&&(this.lastCurrentTime=t.currentTime)},T.doTickIdle=function(){var t=this.hls,e=this.levels,r=this.media,i=this.trackId,a=t.config;if(e&&e[i]&&(r||!this.startFragRequested&&a.startFragPrefetch)){var o=e[i].details;if(!o||o.live&&this.levelLastLoaded!==i||this.waitForCdnTuneIn(o))this.state=n.State.WAITING_TRACK;else{var l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,u.ElementaryStreamTypes.AUDIO,d.PlaylistLevelType.AUDIO));var c=this.getFwdBufferInfo(l,d.PlaylistLevelType.AUDIO);if(null!==c){var h=this.audioSwitch;if(!h&&this._streamEnded(c,o))return t.trigger(s.Events.BUFFER_EOS,{type:"audio"}),void(this.state=n.State.ENDED);var f=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,d.PlaylistLevelType.MAIN);if(!(c.len>=this.getMaxBufferLength(null==f?void 0:f.len))||h){var p=o.fragments[0].start,v=c.end;if(h&&r){var g=this.getLoadPosition();v=g,o.PTSKnown&&g<p&&(c.end>p||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=p+.05)}if(!(f&&v>f.end+o.targetduration)&&(f&&f.len||!c.len)){var m=this.getNextFragment(v,o);m?this.loadFragment(m,o,v):this.bufferFlushed=!0}}}}}},T.getMaxBufferLength=function(e){var r=t.prototype.getMaxBufferLength.call(this);return e?Math.max(r,e):r},T.onMediaDetaching=function(){this.videoBuffer=null,t.prototype.onMediaDetaching.call(this)},T.onAudioTracksUpdated=function(t,e){var r=e.audioTracks;this.resetTransmuxer(),this.levels=r.map((function(t){return new l.Level(t)}))},T.onAudioTrackSwitching=function(t,e){var r=!!e.url;this.trackId=e.id;var i=this.fragCurrent;i&&i.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),r?this.setInterval(100):this.resetTransmuxer(),r?(this.audioSwitch=!0,this.state=n.State.IDLE):this.state=n.State.STOPPED,this.tick()},T.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},T.onLevelLoaded=function(t,e){this.mainDetails=e.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(s.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},T.onAudioTrackLoaded=function(t,e){var r;if(null!=this.mainDetails){var i=this.levels,s=e.details,a=e.id;if(i){this.log("Track "+a+" loaded ["+s.startSN+","+s.endSN+"],duration:"+s.totalduration);var o=i[a],l=0;if(s.live||null!==(r=o.details)&&void 0!==r&&r.live){var d=this.mainDetails;if(s.fragments[0]||(s.deltaUpdateFailed=!0),s.deltaUpdateFailed||!d)return;!o.details&&s.hasProgramDateTime&&d.hasProgramDateTime?((0,v.alignMediaPlaylistByPDT)(s,d),l=s.fragments[0].start):l=this.alignPlaylists(s,o.details)}o.details=s,this.levelLastLoaded=a,this.startFragRequested||!this.mainDetails&&s.live||this.setStartPosition(o.details,l),this.state!==n.State.WAITING_TRACK||this.waitForCdnTuneIn(s)||(this.state=n.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+a)}else this.cachedTrackLoadedData=e},T._handleFragmentLoadProgress=function(t){var e,r=t.frag,i=t.part,s=t.payload,a=this.config,o=this.trackId,l=this.levels;if(l){var u=l[o],p=u.details,v=a.defaultAudioCodec||u.audioCodec||"mp4a.40.2",g=this.transmuxer;g||(g=this.transmuxer=new h.default(this.hls,d.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var m=this.initPTS[r.cc],y=null===(e=r.initSegment)||void 0===e?void 0:e.data;if(void 0!==m){var E=i?i.index:-1,T=-1!==E,S=new f.ChunkMetadata(r.level,r.sn,r.stats.chunkCount,s.byteLength,E,T);g.push(s,y,v,"",r,i,p.totalduration,!1,S,m)}else this.log("Unknown video PTS for cc "+r.cc+", waiting for video PTS before demuxing audio frag "+r.sn+" of ["+p.startSN+" ,"+p.endSN+"],track "+o),(this.waitingData=this.waitingData||{frag:r,part:i,cache:new c.default,complete:!1}).cache.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=n.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},T._handleFragmentLoadComplete=function(e){this.waitingData?this.waitingData.complete=!0:t.prototype._handleFragmentLoadComplete.call(this,e)},T.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},T.onBufferCreated=function(t,e){var r=e.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer||null)},T.onFragBuffered=function(t,e){var r,i=e.frag,n=e.part;i.type===d.PlaylistLevelType.AUDIO?this.fragContextChanged(i)?this.warn("Fragment "+i.sn+(n?" p: "+n.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==i.sn&&(this.fragPrevious=i,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(s.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(i,n)):this.loadedmetadata||i.type!==d.PlaylistLevelType.MAIN||null!==(r=this.videoBuffer||this.media)&&void 0!==r&&r.buffered.length&&(this.loadedmetadata=!0)},T.onError=function(e,r){if(r.type!==g.ErrorTypes.KEY_SYSTEM_ERROR)switch(r.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:case g.ErrorDetails.FRAG_PARSING_ERROR:case g.ErrorDetails.KEY_LOAD_ERROR:case g.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(d.PlaylistLevelType.AUDIO,r);break;case g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==n.State.ERROR&&this.state!==n.State.STOPPED&&(this.state=r.fatal?n.State.ERROR:n.State.IDLE,this.warn(r.details+" while loading frag, switching to "+this.state+" state"));break;case g.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===r.parent&&(this.state===n.State.PARSING||this.state===n.State.PARSED)){var i=!0,s=this.getFwdBufferInfo(this.mediaBuffer,d.PlaylistLevelType.AUDIO);s&&s.len>.5&&(i=!this.reduceMaxBufferLength(s.len)),i&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}else this.onFragmentOrKeyLoadError(d.PlaylistLevelType.AUDIO,r)},T.onBufferFlushed=function(t,e){e.type===u.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===n.State.ENDED&&(this.state=n.State.IDLE))},T._handleTransmuxComplete=function(t){var e,r="audio",i=this.hls,a=t.remuxResult,o=t.chunkMeta,l=this.getCurrentContext(o);if(!l)return this.warn("The loading context changed while buffering fragment "+o.sn+" of level "+o.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(o.level);var d=l.frag,c=l.part,h=l.level.details,f=a.audio,p=a.text,v=a.id3,g=a.initSegment;if(!this.fragContextChanged(d)&&h){if(this.state=n.State.PARSING,this.audioSwitch&&f&&this.completeAudioSwitch(),null!=g&&g.tracks&&(this._bufferInitSegment(g.tracks,d,o),i.trigger(s.Events.FRAG_PARSING_INIT_SEGMENT,{frag:d,id:r,tracks:g.tracks})),f){var y=f.startPTS,E=f.endPTS,T=f.startDTS,S=f.endDTS;c&&(c.elementaryStreams[u.ElementaryStreamTypes.AUDIO]={startPTS:y,endPTS:E,startDTS:T,endDTS:S}),d.setElementaryStreamInfo(u.ElementaryStreamTypes.AUDIO,y,E,T,S),this.bufferFragmentData(f,d,c,o)}if(null!=v&&null!==(e=v.samples)&&void 0!==e&&e.length){var b=m({id:r,frag:d,details:h},v);i.trigger(s.Events.FRAG_PARSING_METADATA,b)}if(p){var L=m({id:r,frag:d,details:h},p);i.trigger(s.Events.FRAG_PARSING_USERDATA,L)}}},T._bufferInitSegment=function(t,e,r){if(this.state===n.State.PARSING){t.video&&delete t.video;var i=t.audio;if(i){i.levelCodec=i.codec,i.id="audio",this.log("Init audio buffer, container:"+i.container+", codecs[parsed]=["+i.codec+"]"),this.hls.trigger(s.Events.BUFFER_CODECS,t);var a=i.initSegment;if(null!=a&&a.byteLength){var o={type:"audio",frag:e,part:null,chunkMeta:r,parent:e.type,data:a};this.hls.trigger(s.Events.BUFFER_APPENDING,o)}this.tick()}}},T.loadFragment=function(e,r,s){var a=this.fragmentTracker.getState(e);this.fragCurrent=e,(this.audioSwitch||a===o.FragmentState.NOT_LOADED||a===o.FragmentState.PARTIAL)&&("initSegment"===e.sn?this._loadInitSegment(e,r):r.live&&!(0,i.isFiniteNumber)(this.initPTS[e.cc])?(this.log("Waiting for video PTS in continuity counter "+e.cc+" of live stream before loading audio fragment "+e.sn+" of level "+this.trackId),this.state=n.State.WAITING_INIT_PTS):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,e,r,s)))},T.completeAudioSwitch=function(){var e=this.hls,r=this.media,i=this.trackId;r&&(this.log("Switching audio track : flushing all audio"),t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,e.trigger(s.Events.AUDIO_TRACK_SWITCHED,{id:i})},E}(n.default)},"./src/controller/audio-track-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>d});var i=r("./src/events.ts"),n=r("./src/errors.ts"),s=r("./src/controller/base-playlist-controller.ts"),a=r("./src/types/loader.ts");function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,s=void 0,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?s:String(s)),i)}var n,s}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}const d=function(t){var e,r;function s(e){var r;return(r=t.call(this,e,"[audio-track-controller]")||this).tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.trackName="",r.selectDefaultTrack=!0,r.registerListeners(),r}r=t,(e=s).prototype=Object.create(r.prototype),e.prototype.constructor=e,l(e,r);var d,u,c,h=s.prototype;return h.registerListeners=function(){var t=this.hls;t.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(i.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(i.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(i.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(i.Events.ERROR,this.onError,this)},h.unregisterListeners=function(){var t=this.hls;t.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(i.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(i.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(i.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(i.Events.ERROR,this.onError,this)},h.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,t.prototype.destroy.call(this)},h.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},h.onManifestParsed=function(t,e){this.tracks=e.audioTracks||[]},h.onAudioTrackLoaded=function(t,e){var r=e.id,i=e.details,n=this.tracksInGroup[r];if(n){var s=n.details;n.details=e.details,this.log("audioTrack "+r+" loaded ["+i.startSN+"-"+i.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,e,s))}else this.warn("Invalid audio track id "+r)},h.onLevelLoading=function(t,e){this.switchLevel(e.level)},h.onLevelSwitching=function(t,e){this.switchLevel(e.level)},h.switchLevel=function(t){var e=this.hls.levels[t];if(null!=e&&e.audioGroupIds){var r=e.audioGroupIds[e.urlId];if(this.groupId!==r){this.groupId=r;var n=this.tracks.filter((function(t){return!r||t.groupId===r}));this.selectDefaultTrack&&!n.some((function(t){return t.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=n;var s={audioTracks:n};this.log("Updating audio tracks, "+n.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(i.Events.AUDIO_TRACKS_UPDATED,s),this.selectInitialTrack()}}},h.onError=function(e,r){t.prototype.onError.call(this,e,r),!r.fatal&&r.context&&r.context.type===a.PlaylistContextType.AUDIO_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},h.setAudioTrack=function(t){var e=this.tracksInGroup;if(t<0||t>=e.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var r=e[this.trackId];this.log("Now switching to audio-track index "+t);var n=e[t],s=n.id,a=n.groupId,o=void 0===a?"":a,l=n.name,d=n.type,u=n.url;if(this.trackId=t,this.trackName=l,this.selectDefaultTrack=!1,this.hls.trigger(i.Events.AUDIO_TRACK_SWITCHING,{id:s,groupId:o,name:l,type:d,url:u}),!n.details||n.details.live){var c=this.switchParams(n.url,null==r?void 0:r.details);this.loadPlaylist(c)}}},h.selectInitialTrack=function(){this.tracksInGroup;var t=this.trackName,e=this.findTrackId(t)||this.findTrackId();-1!==e?this.setAudioTrack(e):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},h.findTrackId=function(t){for(var e=this.tracksInGroup,r=0;r<e.length;r++){var i=e[r];if((!this.selectDefaultTrack||i.default)&&(!t||t===i.name))return i.id}return-1},h.loadPlaylist=function(e){t.prototype.loadPlaylist.call(this);var r=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(r)){var n=r.id,s=r.groupId,a=r.url;if(e)try{a=e.addDirectives(a)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("loading audio-track playlist for id: "+n),this.clearTimer(),this.hls.trigger(i.Events.AUDIO_TRACK_LOADING,{url:a,id:n,groupId:s,deliveryDirectives:e||null})}},d=s,(u=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}])&&o(d.prototype,u),c&&o(d,c),Object.defineProperty(d,"prototype",{writable:!1}),s}(s.default)},"./src/controller/base-playlist-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>o});var i=r("./src/types/level.ts"),n=r("./src/controller/level-helper.ts"),s=r("./src/utils/logger.ts"),a=r("./src/errors.ts"),o=function(){function t(t,e){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=s.logger.log.bind(s.logger,e+":"),this.warn=s.logger.warn.bind(s.logger,e+":"),this.hls=t}var e=t.prototype;return e.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},e.onError=function(t,e){!e.fatal||e.type!==a.ErrorTypes.NETWORK_ERROR&&e.type!==a.ErrorTypes.KEY_SYSTEM_ERROR||this.stopLoad()},e.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},e.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},e.stopLoad=function(){this.canLoad=!1,this.clearTimer()},e.switchParams=function(t,e){var r=null==e?void 0:e.renditionReports;if(r)for(var n=0;n<r.length;n++){var a=r[n],o=void 0;try{o=new self.URL(a.URI,e.url).href}catch(t){s.logger.warn("Could not construct new URL for Rendition Report: "+t),o=a.URI||""}if(o===t.slice(-o.length)){var l=parseInt(a["LAST-MSN"])||(null==e?void 0:e.lastPartSn),d=parseInt(a["LAST-PART"])||(null==e?void 0:e.lastPartIndex);if(this.hls.config.lowLatencyMode){var u=Math.min(e.age-e.partTarget,e.targetduration);d>=0&&u>e.partTarget&&(d+=1)}return new i.HlsUrlParameters(l,d>=0?d:void 0,i.HlsSkip.No)}}},e.loadPlaylist=function(t){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())},e.shouldLoadTrack=function(t){return this.canLoad&&t&&!!t.url&&(!t.details||t.details.live)},e.playlistLoaded=function(t,e,r){var i=this,s=e.details,a=e.stats,o=self.performance.now(),l=a.loading.first?Math.max(0,o-a.loading.first):0;if(s.advancedDateTime=Date.now()-l,s.live||null!=r&&r.live){if(s.reloaded(r),r&&this.log("live playlist "+t+" "+(s.advanced?"REFRESHED "+s.lastPartSn+"-"+s.lastPartIndex:"MISSED")),r&&s.fragments.length>0&&(0,n.mergeDetails)(r,s),!this.canLoad||!s.live)return;var d,u=void 0,c=void 0;if(s.canBlockReload&&s.endSN&&s.advanced){var h=this.hls.config.lowLatencyMode,f=s.lastPartSn,p=s.endSN,v=s.lastPartIndex,g=f===p;-1!==v?(u=g?p+1:f,c=g?h?0:v:v+1):u=p+1;var m=s.age,y=m+s.ageHeader,E=Math.min(y-s.partTarget,1.5*s.targetduration);if(E>0){if(r&&E>r.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+r.tuneInGoal+" to: "+E+" with playlist age: "+s.age),E=0;else{var T=Math.floor(E/s.targetduration);u+=T,void 0!==c&&(c+=Math.round(E%s.targetduration/s.partTarget)),this.log("CDN Tune-in age: "+s.ageHeader+"s last advanced "+m.toFixed(2)+"s goal: "+E+" skip sn "+T+" to part "+c)}s.tuneInGoal=E}if(d=this.getDeliveryDirectives(s,e.deliveryDirectives,u,c),h||!g)return void this.loadPlaylist(d)}else d=this.getDeliveryDirectives(s,e.deliveryDirectives,u,c);var S=this.hls.mainForwardBufferInfo,b=S?S.end-S.len:0,L=1e3*(s.edge-b),A=(0,n.computeReloadInterval)(s,L);s.updated?o>this.requestScheduled+A&&(this.requestScheduled=a.loading.start):this.requestScheduled=-1,void 0!==u&&s.canBlockReload?this.requestScheduled=a.loading.first+A-(1e3*s.partTarget||1e3):this.requestScheduled=(-1===this.requestScheduled?o:this.requestScheduled)+A;var _=this.requestScheduled-o;_=Math.max(0,_),this.log("reload live playlist "+t+" in "+Math.round(_)+" ms"),this.timer=self.setTimeout((function(){return i.loadPlaylist(d)}),_)}else this.clearTimer()},e.getDeliveryDirectives=function(t,e,r,n){var s=(0,i.getSkipValue)(t,r);return null!=e&&e.skip&&t.deltaUpdateFailed&&(r=e.msn,n=e.part,s=i.HlsSkip.No),new i.HlsUrlParameters(r,n,s)},e.retryLoadingOrFail=function(t){var e,r=this,i=this.hls.config,n=this.retryCount<i.levelLoadingMaxRetry;if(n)if(this.requestScheduled=-1,this.retryCount++,t.details.indexOf("LoadTimeOut")>-1&&null!==(e=t.context)&&void 0!==e&&e.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+t.details+'"'),this.loadPlaylist();else{var s=Math.min(Math.pow(2,this.retryCount)*i.levelLoadingRetryDelay,i.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout((function(){return r.loadPlaylist()}),s),this.warn("retry playlist loading #"+this.retryCount+" in "+s+' ms after "'+t.details+'"')}else this.warn('cannot recover from error "'+t.details+'"'),this.clearTimer(),t.fatal=!0;return n},t}()},"./src/controller/base-stream-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{State:()=>S,default:()=>b});var i=r("./src/polyfills/number.ts"),n=r("./src/task-loop.ts"),s=r("./src/controller/fragment-tracker.ts"),a=r("./src/utils/buffer-helper.ts"),o=r("./src/utils/logger.ts"),l=r("./src/events.ts"),d=r("./src/errors.ts"),u=r("./src/types/transmuxer.ts"),c=r("./src/utils/mp4-tools.ts"),h=r("./src/utils/discontinuities.ts"),f=r("./src/controller/fragment-finders.ts"),p=r("./src/controller/level-helper.ts"),v=r("./src/loader/fragment-loader.ts"),g=r("./src/crypt/decrypter.ts"),m=r("./src/utils/time-ranges.ts"),y=r("./src/types/loader.ts");function E(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,s=void 0,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?s:String(s)),i)}var n,s}function T(t,e){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},T(t,e)}var S={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},b=function(t){var e,r;function n(e,r,i,n){var s;return(s=t.call(this)||this).hls=void 0,s.fragPrevious=null,s.fragCurrent=null,s.fragmentTracker=void 0,s.transmuxer=null,s._state=S.STOPPED,s.media=null,s.mediaBuffer=null,s.config=void 0,s.bitrateTest=!1,s.lastCurrentTime=0,s.nextLoadPosition=0,s.startPosition=0,s.loadedmetadata=!1,s.fragLoadError=0,s.retryDate=0,s.levels=null,s.fragmentLoader=void 0,s.keyLoader=void 0,s.levelLastLoaded=null,s.startFragRequested=!1,s.decrypter=void 0,s.initPTS=[],s.onvseeking=null,s.onvended=null,s.logPrefix="",s.log=void 0,s.warn=void 0,s.logPrefix=n,s.log=o.logger.log.bind(o.logger,n+":"),s.warn=o.logger.warn.bind(o.logger,n+":"),s.hls=e,s.fragmentLoader=new v.default(e.config),s.keyLoader=i,s.fragmentTracker=r,s.config=e.config,s.decrypter=new g.default(e.config),e.on(l.Events.LEVEL_SWITCHING,s.onLevelSwitching,function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(s)),s}r=t,(e=n).prototype=Object.create(r.prototype),e.prototype.constructor=e,T(e,r);var b,L,A,_=n.prototype;return _.doTick=function(){this.onTickEnd()},_.onTickEnd=function(){},_.startLoad=function(t){},_.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var t=this.fragCurrent;t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=S.STOPPED},_._streamEnded=function(t,e){if(e.live||t.nextStart||!t.end||!this.media)return!1;var r=e.partList;if(null!=r&&r.length){var i=r[r.length-1];return a.BufferHelper.isBuffered(this.media,i.start+i.duration/2)}var n=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(n)},_.getLevelDetails=function(){var t;if(this.levels&&null!==this.levelLastLoaded)return null===(t=this.levels[this.levelLastLoaded])||void 0===t?void 0:t.details},_.onMediaAttached=function(t,e){var r=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);var i=this.config;this.levels&&i.autoStartLoad&&this.state===S.STOPPED&&this.startLoad(i.startPosition)},_.onMediaDetaching=function(){var t=this.media;null!=t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},_.onMediaSeeking=function(){var t=this.config,e=this.fragCurrent,r=this.media,n=this.mediaBuffer,s=this.state,o=r?r.currentTime:0,l=a.BufferHelper.bufferInfo(n||r,o,t.maxBufferHole);if(this.log("media seeking to "+((0,i.isFiniteNumber)(o)?o.toFixed(3):o)+", state: "+s),this.state===S.ENDED)this.resetLoadingState();else if(e){var d=t.maxFragLookUpTolerance,u=e.start-d,c=e.start+e.duration+d;if(!l.len||c<l.start||u>l.end){var h=o>c;(o<u||h)&&(h&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.abortRequests()),this.resetLoadingState())}}r&&(this.lastCurrentTime=o),this.loadedmetadata||l.len||(this.nextLoadPosition=this.startPosition=o),this.tickImmediate()},_.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},_.onLevelSwitching=function(t,e){this.fragLoadError=0},_.onHandlerDestroying=function(){this.stopLoad(),t.prototype.onHandlerDestroying.call(this)},_.onHandlerDestroyed=function(){this.state=S.STOPPED,this.hls.off(l.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,t.prototype.onHandlerDestroyed.call(this)},_.loadFragment=function(t,e,r){this._loadFragForPlayback(t,e,r)},_._loadFragForPlayback=function(t,e,r){var i=this;this._doFragLoad(t,e,r,(function(e){if(i.fragContextChanged(t))return i.warn("Fragment "+t.sn+(e.part?" p: "+e.part.index:"")+" of level "+t.level+" was dropped during download."),void i.fragmentTracker.removeFragment(t);t.stats.chunkCount++,i._handleFragmentLoadProgress(e)})).then((function(e){if(e){i.fragLoadError=0;var r=i.state;i.fragContextChanged(t)?(r===S.FRAG_LOADING||!i.fragCurrent&&r===S.PARSING)&&(i.fragmentTracker.removeFragment(t),i.state=S.IDLE):("payload"in e&&(i.log("Loaded fragment "+t.sn+" of level "+t.level),i.hls.trigger(l.Events.FRAG_LOADED,e)),i._handleFragmentLoadComplete(e))}})).catch((function(e){i.state!==S.STOPPED&&i.state!==S.ERROR&&(i.warn(e),i.resetFragmentLoading(t))}))},_.flushMainBuffer=function(t,e,r){if(void 0===r&&(r=null),t-e){var i={startOffset:t,endOffset:e,type:r};this.fragLoadError=0,this.hls.trigger(l.Events.BUFFER_FLUSHING,i)}},_._loadInitSegment=function(t,e){var r=this;this._doFragLoad(t,e).then((function(e){if(!e||r.fragContextChanged(t)||!r.levels)throw new Error("init load aborted");return e})).then((function(e){var i=r.hls,n=e.payload,s=t.decryptdata;if(n&&n.byteLength>0&&s&&s.key&&s.iv&&"AES-128"===s.method){var a=self.performance.now();return r.decrypter.decrypt(new Uint8Array(n),s.key.buffer,s.iv.buffer).then((function(r){var n=self.performance.now();return i.trigger(l.Events.FRAG_DECRYPTED,{frag:t,payload:r,stats:{tstart:a,tdecrypt:n}}),e.payload=r,e}))}return e})).then((function(e){var i=r.fragCurrent,n=r.hls,s=r.levels;if(!s)throw new Error("init load aborted, missing levels");s[t.level].details;var a=t.stats;r.state=S.IDLE,r.fragLoadError=0,t.data=new Uint8Array(e.payload),a.parsing.start=a.buffering.start=self.performance.now(),a.parsing.end=a.buffering.end=self.performance.now(),e.frag===i&&n.trigger(l.Events.FRAG_BUFFERED,{stats:a,frag:i,part:null,id:t.type}),r.tick()})).catch((function(e){r.state!==S.STOPPED&&r.state!==S.ERROR&&(r.warn(e),r.resetFragmentLoading(t))}))},_.fragContextChanged=function(t){var e=this.fragCurrent;return!t||!e||t.level!==e.level||t.sn!==e.sn||t.urlId!==e.urlId},_.fragBufferedComplete=function(t,e){var r,i,n,s,o=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+t.type+" sn: "+t.sn+(e?" part: "+e.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level+" (frag:["+(null!=(r=t.startPTS)?r:NaN).toFixed(3)+"-"+(null!=(i=t.endPTS)?i:NaN).toFixed(3)+"] > buffer:"+(o?m.default.toString(a.BufferHelper.getBuffered(o)):"(detached)")+")"),this.state=S.IDLE,o&&(!this.loadedmetadata&&t.type==y.PlaylistLevelType.MAIN&&o.buffered.length&&(null===(n=this.fragCurrent)||void 0===n?void 0:n.sn)===(null===(s=this.fragPrevious)||void 0===s?void 0:s.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},_.seekToStartPos=function(){},_._handleFragmentLoadComplete=function(t){var e=this.transmuxer;if(e){var r=t.frag,i=t.part,n=t.partsLoaded,s=!n||0===n.length||n.some((function(t){return!t})),a=new u.ChunkMetadata(r.level,r.sn,r.stats.chunkCount+1,0,i?i.index:-1,!s);e.flush(a)}},_._handleFragmentLoadProgress=function(t){},_._doFragLoad=function(t,e,r,n){var s,a=this;if(void 0===r&&(r=null),!this.levels)throw new Error("frag load aborted, missing levels");var o=null;if(!t.encrypted||null!==(s=t.decryptdata)&&void 0!==s&&s.key?!t.encrypted&&e.encryptedFragments.length&&this.keyLoader.loadClear(t,e.encryptedFragments):(this.log("Loading key for "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level),this.state=S.KEY_LOADING,this.fragCurrent=t,o=this.keyLoader.load(t).then((function(t){if(!a.fragContextChanged(t.frag))return a.hls.trigger(l.Events.KEY_LOADED,t),a.state===S.KEY_LOADING&&(a.state=S.IDLE),t})),this.hls.trigger(l.Events.KEY_LOADING,{frag:t}),this.throwIfFragContextChanged("KEY_LOADING")),r=Math.max(t.start,r||0),this.config.lowLatencyMode&&e){var d=e.partList;if(d&&n){r>t.end&&e.fragmentHint&&(t=e.fragmentHint);var u=this.getNextPart(d,t,r);if(u>-1){var c=d[u];return this.log("Loading part sn: "+t.sn+" p: "+c.index+" cc: "+t.cc+" of playlist ["+e.startSN+"-"+e.endSN+"] parts [0-"+u+"-"+(d.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(r.toFixed(3))),this.nextLoadPosition=c.start+c.duration,this.state=S.FRAG_LOADING,this.hls.trigger(l.Events.FRAG_LOADING,{frag:t,part:d[u],targetBufferTime:r}),this.throwIfFragContextChanged("FRAG_LOADING parts"),o?o.then((function(e){return!e||a.fragContextChanged(e.frag)?null:a.doFragPartsLoad(t,d,u,n)})).catch((function(t){return a.handleFragLoadError(t)})):this.doFragPartsLoad(t,d,u,n).catch((function(t){return a.handleFragLoadError(t)}))}if(!t.url||this.loadedEndOfParts(d,r))return Promise.resolve(null)}}this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(e?"of ["+e.startSN+"-"+e.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(r.toFixed(3))),(0,i.isFiniteNumber)(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=S.FRAG_LOADING,this.hls.trigger(l.Events.FRAG_LOADING,{frag:t,targetBufferTime:r}),this.throwIfFragContextChanged("FRAG_LOADING");var h=this.config.progressive;return h&&o?o.then((function(e){return!e||a.fragContextChanged(null==e?void 0:e.frag)?null:a.fragmentLoader.load(t,n)})).catch((function(t){return a.handleFragLoadError(t)})):Promise.all([this.fragmentLoader.load(t,h?n:void 0),o]).then((function(t){var e=t[0];return!h&&e&&n&&n(e),e})).catch((function(t){return a.handleFragLoadError(t)}))},_.throwIfFragContextChanged=function(t){if(null===this.fragCurrent)throw new Error("frag load aborted, context changed in "+t)},_.doFragPartsLoad=function(t,e,r,i){var n=this;return new Promise((function(s,a){var o=[];!function r(d){var u=e[d];n.fragmentLoader.loadPart(t,u,i).then((function(i){o[u.index]=i;var a=i.part;n.hls.trigger(l.Events.FRAG_LOADED,i);var c=e[d+1];if(!c||c.fragment!==t)return s({frag:t,part:a,partsLoaded:o});r(d+1)})).catch(a)}(r)}))},_.handleFragLoadError=function(t){if("data"in t){var e=t.data;t.data&&e.details===d.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):this.hls.trigger(l.Events.ERROR,e)}else this.hls.trigger(l.Events.ERROR,{type:d.ErrorTypes.OTHER_ERROR,details:d.ErrorDetails.INTERNAL_EXCEPTION,err:t,fatal:!0});return null},_._handleTransmuxerFlush=function(t){var e=this.getCurrentContext(t);if(e&&this.state===S.PARSING){var r=e.frag,i=e.part,n=e.level,s=self.performance.now();r.stats.parsing.end=s,i&&(i.stats.parsing.end=s),this.updateLevelTiming(r,i,n,t.partial)}else this.fragCurrent||this.state===S.STOPPED||this.state===S.ERROR||(this.state=S.IDLE)},_.getCurrentContext=function(t){var e=this.levels,r=t.level,i=t.sn,n=t.part;if(!e||!e[r])return this.warn("Levels object was unset while buffering fragment "+i+" of level "+r+". The current chunk will not be buffered."),null;var s=e[r],a=n>-1?(0,p.getPartWith)(s,i,n):null,o=a?a.fragment:(0,p.getFragmentWithSN)(s,i,this.fragCurrent);return o?{frag:o,part:a,level:s}:null},_.bufferFragmentData=function(t,e,r,i){if(t&&this.state===S.PARSING){var n=t.data1,s=t.data2,a=n;if(n&&s&&(a=(0,c.appendUint8Array)(n,s)),a&&a.length){var o={type:t.type,frag:e,part:r,chunkMeta:i,parent:e.type,data:a};this.hls.trigger(l.Events.BUFFER_APPENDING,o),t.dropped&&t.independent&&!r&&this.flushBufferGap(e)}}},_.flushBufferGap=function(t){var e=this.media;if(e)if(a.BufferHelper.isBuffered(e,e.currentTime)){var r=e.currentTime,i=a.BufferHelper.bufferInfo(e,r,0),n=t.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*n),o=Math.max(Math.min(t.start-s,i.end-s),r+s);t.start-o>s&&this.flushMainBuffer(o,t.start)}else this.flushMainBuffer(0,t.start)},_.getFwdBufferInfo=function(t,e){var r=this.config,n=this.getLoadPosition();if(!(0,i.isFiniteNumber)(n))return null;var s=a.BufferHelper.bufferInfo(t,n,r.maxBufferHole);if(0===s.len&&void 0!==s.nextStart){var o=this.fragmentTracker.getBufferedFrag(n,e);if(o&&s.nextStart<o.end)return a.BufferHelper.bufferInfo(t,n,Math.max(s.nextStart,r.maxBufferHole))}return s},_.getMaxBufferLength=function(t){var e,r=this.config;return e=t?Math.max(8*r.maxBufferSize/t,r.maxBufferLength):r.maxBufferLength,Math.min(e,r.maxMaxBufferLength)},_.reduceMaxBufferLength=function(t){var e=this.config,r=t||e.maxBufferLength;return e.maxMaxBufferLength>=r&&(e.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},_.getNextFragment=function(t,e){var r=e.fragments,i=r.length;if(!i)return null;var n,s=this.config,a=r[0].start;if(e.live){var o=s.initialLiveManifestSize;if(i<o)return this.warn("Not enough fragments to start playback (have: "+i+", need: "+o+")"),null;e.PTSKnown||this.startFragRequested||-1!==this.startPosition||(n=this.getInitialLiveFragment(e,r),this.startPosition=n?this.hls.liveSyncPosition||n.start:t)}else t<=a&&(n=r[0]);if(!n){var l=s.lowLatencyMode?e.partEnd:e.fragmentEnd;n=this.getFragmentAtPosition(t,l,e)}return this.mapToInitFragWhenRequired(n)},_.mapToInitFragWhenRequired=function(t){return null==t||!t.initSegment||null!=t&&t.initSegment.data||this.bitrateTest?t:t.initSegment},_.getNextPart=function(t,e,r){for(var i=-1,n=!1,s=!0,a=0,o=t.length;a<o;a++){var l=t[a];if(s=s&&!l.independent,i>-1&&r<l.start)break;var d=l.loaded;d?i=-1:(n||l.independent||s)&&l.fragment===e&&(i=a),n=d}return i},_.loadedEndOfParts=function(t,e){var r=t[t.length-1];return r&&e>r.start&&r.loaded},_.getInitialLiveFragment=function(t,e){var r=this.fragPrevious,i=null;if(r){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+r.programDateTime),i=(0,f.findFragmentByPDT)(e,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){var n=r.sn+1;if(n>=t.startSN&&n<=t.endSN){var s=e[n-t.startSN];r.cc===s.cc&&(i=s,this.log("Live playlist, switching playlist, load frag with next SN: "+i.sn))}i||(i=(0,f.findFragWithCC)(e,r.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+i.sn)}}else{var a=this.hls.liveSyncPosition;null!==a&&(i=this.getFragmentAtPosition(a,this.bitrateTest?t.fragmentEnd:t.edge,t))}return i},_.getFragmentAtPosition=function(t,e,r){var i,n=this.config,a=this.fragPrevious,o=r.fragments,l=r.endSN,d=r.fragmentHint,u=n.maxFragLookUpTolerance,c=!!(n.lowLatencyMode&&r.partList&&d);if(c&&d&&!this.bitrateTest&&(o=o.concat(d),l=d.sn),t<e){var h=t>e-u?0:u;i=(0,f.findFragmentByPTS)(a,o,t,h)}else i=o[o.length-1];if(i){var p=i.sn-r.startSN;if(this.fragmentTracker.getState(i)===s.FragmentState.OK&&(a=i),a&&i.sn===a.sn&&!c&&a&&i.level===a.level){var v=o[p+1];i.sn<l&&this.fragmentTracker.getState(v)!==s.FragmentState.OK?(this.log("SN "+i.sn+" just loaded, load next one: "+v.sn),i=v):i=null}}return i},_.synchronizeToLiveEdge=function(t){var e=this.config,r=this.media;if(r){var i=this.hls.liveSyncPosition,n=r.currentTime,s=t.fragments[0].start,a=t.edge,o=n>=s-e.maxFragLookUpTolerance&&n<=a;if(null!==i&&r.duration>i&&(n<i||!o)){var l=void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;(!o&&r.readyState<4||n<a-l)&&(this.loadedmetadata||(this.nextLoadPosition=i),r.readyState&&(this.warn("Playback: "+n.toFixed(3)+" is located too far from the end of live sliding playlist: "+a+", reset currentTime to : "+i.toFixed(3)),r.currentTime=i))}}},_.alignPlaylists=function(t,e){var r=this.levels,n=this.levelLastLoaded,s=this.fragPrevious,a=null!==n?r[n]:null,o=t.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;var l=t.fragments[0].start,d=!e,u=t.alignedSliding&&(0,i.isFiniteNumber)(l);if(d||!u&&!l){(0,h.alignStream)(s,a,t);var c=t.fragments[0].start;return this.log("Live playlist sliding: "+c.toFixed(2)+" start-sn: "+(e?e.startSN:"na")+"->"+t.startSN+" prev-sn: "+(s?s.sn:"na")+" fragments: "+o),c}return l},_.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},_.setStartPosition=function(t,e){var r=this.startPosition;if(r<e&&(r=-1),-1===r||-1===this.lastCurrentTime){var n=t.startTimeOffset;(0,i.isFiniteNumber)(n)?(r=e+n,n<0&&(r+=t.totalduration),r=Math.min(Math.max(e,r),e+t.totalduration),this.log("Start time offset "+n+" found in playlist, adjust startPosition to "+r),this.startPosition=r):t.live?r=this.hls.liveSyncPosition||e:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r},_.getLoadPosition=function(){var t=this.media,e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e},_.handleFragLoadAborted=function(t,e){this.transmuxer&&"initSegment"!==t.sn&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(e?" part"+e.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},_.resetFragmentLoading=function(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===S.FRAG_LOADING_WAITING_RETRY)||(this.state=S.IDLE)},_.onFragmentOrKeyLoadError=function(t,e){if(e.fatal)return this.stopLoad(),void(this.state=S.ERROR);var r=this.config;if(e.chunkMeta){var i=this.getCurrentContext(e.chunkMeta);i&&(e.frag=i.frag,e.levelRetry=!0,this.fragLoadError=r.fragLoadingMaxRetry)}var n=e.frag;if(n&&n.type===t)if(this.fragCurrent,this.fragLoadError+1<=r.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var s=Math.min(Math.pow(2,this.fragLoadError)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout);this.warn("Fragment "+n.sn+" of "+t+" "+n.level+" failed to load, retrying in "+s+"ms"),this.retryDate=self.performance.now()+s,this.fragLoadError++,this.state=S.FRAG_LOADING_WAITING_RETRY}else e.levelRetry?(t===y.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=S.IDLE):(o.logger.error(e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.stopLoad(),this.state=S.ERROR)},_.afterBufferFlushed=function(t,e,r){if(t){var i=a.BufferHelper.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,i,r),this.state===S.ENDED&&this.resetLoadingState()}},_.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=S.IDLE},_.resetStartWhenNotLoaded=function(t){if(!this.loadedmetadata){this.startFragRequested=!1;var e=this.levels?this.levels[t].details:null;null!=e&&e.live?(this.startPosition=-1,this.setStartPosition(e,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},_.updateLevelTiming=function(t,e,r,i){var n=this,s=r.details;Object.keys(t.elementaryStreams).reduce((function(e,a){var o=t.elementaryStreams[a];if(o){var d=o.endPTS-o.startPTS;if(d<=0)return n.warn("Could not parse fragment "+t.sn+" "+a+" duration reliably ("+d+")"),e||!1;var u=i?0:(0,p.updateFragPTSDTS)(s,t,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return n.hls.trigger(l.Events.LEVEL_PTS_UPDATED,{details:s,level:r,drift:u,type:a,frag:t,start:o.startPTS,end:o.endPTS}),!0}return e}),!1)||(this.warn("Found no media in fragment "+t.sn+" of level "+r.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=S.PARSED,this.hls.trigger(l.Events.FRAG_PARSED,{frag:t,part:e})},_.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},b=n,(L=[{key:"state",get:function(){return this._state},set:function(t){var e=this._state;e!==t&&(this._state=t,this.log(e+"->"+t))}}])&&E(b.prototype,L),A&&E(b,A),Object.defineProperty(b,"prototype",{writable:!1}),n}(n.default)},"./src/controller/buffer-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>f});var i=r("./src/polyfills/number.ts"),n=r("./src/events.ts"),s=r("./src/utils/logger.ts"),a=r("./src/errors.ts"),o=r("./src/utils/buffer-helper.ts"),l=r("./src/utils/mediasource-helper.ts"),d=r("./src/loader/fragment.ts"),u=r("./src/controller/buffer-operation-queue.ts"),c=(0,l.getMediaSource)(),h=/([ha]vc.)(?:\.[^.,]+)+/,f=function(){function t(t){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=e.media,r=e.mediaSource;s.logger.log("[buffer-controller]: Media source opened"),t&&(t.removeEventListener("emptied",e._onMediaEmptied),e.updateMediaElementDuration(),e.hls.trigger(n.Events.MEDIA_ATTACHED,{media:t})),r&&r.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){s.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){s.logger.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var t=e.media,r=e._objectUrl;t&&t.src!==r&&s.logger.error("Media element src was set while attaching MediaSource ("+r+" > "+t.src+")")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var e=t.prototype;return e.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},e.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},e.registerListeners=function(){var t=this.hls;t.on(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(n.Events.BUFFER_RESET,this.onBufferReset,this),t.on(n.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(n.Events.BUFFER_EOS,this.onBufferEos,this),t.on(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(n.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(n.Events.FRAG_PARSED,this.onFragParsed,this),t.on(n.Events.FRAG_CHANGED,this.onFragChanged,this)},e.unregisterListeners=function(){var t=this.hls;t.off(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(n.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(n.Events.BUFFER_RESET,this.onBufferReset,this),t.off(n.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(n.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(n.Events.BUFFER_EOS,this.onBufferEos,this),t.off(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(n.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(n.Events.FRAG_PARSED,this.onFragParsed,this),t.off(n.Events.FRAG_CHANGED,this.onFragChanged,this)},e._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new u.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},e.onManifestParsed=function(t,e){var r=2;(e.audio&&!e.video||!e.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.details=null,s.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},e.onMediaAttaching=function(t,e){var r=this.media=e.media;if(r&&c){var i=this.mediaSource=new c;i.addEventListener("sourceopen",this._onMediaSourceOpen),i.addEventListener("sourceended",this._onMediaSourceEnded),i.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(i),this._objectUrl=r.src,r.addEventListener("emptied",this._onMediaEmptied)}},e.onMediaDetaching=function(){var t=this.media,e=this.mediaSource,r=this._objectUrl;if(e){if(s.logger.log("[buffer-controller]: media source detaching"),"open"===e.readyState)try{e.endOfStream()}catch(t){s.logger.warn("[buffer-controller]: onMediaDetaching: "+t.message+" while calling endOfStream")}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(t.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),t.src===r?(t.removeAttribute("src"),t.load()):s.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(n.Events.MEDIA_DETACHED,void 0)},e.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach((function(e){var r=t.sourceBuffer[e];try{r&&(t.removeBufferListeners(e),t.mediaSource&&t.mediaSource.removeSourceBuffer(r),t.sourceBuffer[e]=void 0)}catch(t){s.logger.warn("[buffer-controller]: Failed to reset the "+e+" buffer",t)}})),this._initSourceBuffer()},e.onBufferCodecs=function(t,e){var r=this,i=this.getSourceBufferTypes().length;Object.keys(e).forEach((function(t){if(i){var n=r.tracks[t];if(n&&"function"==typeof n.buffer.changeType){var a=e[t],o=a.id,l=a.codec,d=a.levelCodec,u=a.container,c=a.metadata,f=(n.levelCodec||n.codec).replace(h,"$1"),p=(d||l).replace(h,"$1");if(f!==p){var v=u+";codecs="+(d||l);r.appendChangeType(t,v),s.logger.log("[buffer-controller]: switching codec "+f+" to "+p),r.tracks[t]={buffer:n.buffer,codec:l,container:u,levelCodec:d,metadata:c,id:o}}}}else r.pendingTracks[t]=e[t]})),i||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},e.appendChangeType=function(t,e){var r=this,i=this.operationQueue,n={execute:function(){var n=r.sourceBuffer[t];n&&(s.logger.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+e),n.changeType(e)),i.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(e){s.logger.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",e)}};i.append(n,t)},e.onBufferAppending=function(t,e){var r=this,i=this.hls,l=this.operationQueue,d=this.tracks,u=e.data,c=e.type,h=e.frag,f=e.part,p=e.chunkMeta,v=p.buffering[c],g=self.performance.now();v.start=g;var m=h.stats.buffering,y=f?f.stats.buffering:null;0===m.start&&(m.start=g),y&&0===y.start&&(y.start=g);var E=d.audio,T=!1;"audio"===c&&"audio/mpeg"===(null==E?void 0:E.container)&&(T=!this.lastMpegAudioChunk||1===p.id||this.lastMpegAudioChunk.sn!==p.sn,this.lastMpegAudioChunk=p);var S=h.start,b={execute:function(){if(v.executeStart=self.performance.now(),T){var t=r.sourceBuffer[c];if(t){var e=S-t.timestampOffset;Math.abs(e)>=.1&&(s.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+S+" (delta: "+e+") sn: "+h.sn+")"),t.timestampOffset=S)}}r.appendExecutor(u,c)},onStart:function(){},onComplete:function(){var t=self.performance.now();v.executeEnd=v.end=t,0===m.first&&(m.first=t),y&&0===y.first&&(y.first=t);var e=r.sourceBuffer,i={};for(var s in e)i[s]=o.BufferHelper.getBuffered(e[s]);r.appendError=0,r.hls.trigger(n.Events.BUFFER_APPENDED,{type:c,frag:h,part:f,chunkMeta:p,parent:h.type,timeRanges:i})},onError:function(t){s.logger.error("[buffer-controller]: Error encountered while trying to append to the "+c+" SourceBuffer",t);var e={type:a.ErrorTypes.MEDIA_ERROR,parent:h.type,details:a.ErrorDetails.BUFFER_APPEND_ERROR,err:t,fatal:!1};t.code===DOMException.QUOTA_EXCEEDED_ERR?e.details=a.ErrorDetails.BUFFER_FULL_ERROR:(r.appendError++,e.details=a.ErrorDetails.BUFFER_APPEND_ERROR,r.appendError>i.config.appendErrorMaxRetry&&(s.logger.error("[buffer-controller]: Failed "+i.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),e.fatal=!0,i.stopLoad())),i.trigger(n.Events.ERROR,e)}};l.append(b,c)},e.onBufferFlushing=function(t,e){var r=this,i=this.operationQueue,a=function(t){return{execute:r.removeExecutor.bind(r,t,e.startOffset,e.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(n.Events.BUFFER_FLUSHED,{type:t})},onError:function(e){s.logger.warn("[buffer-controller]: Failed to remove from "+t+" SourceBuffer",e)}}};e.type?i.append(a(e.type),e.type):this.getSourceBufferTypes().forEach((function(t){i.append(a(t),t)}))},e.onFragParsed=function(t,e){var r=this,i=e.frag,a=e.part,o=[],l=a?a.elementaryStreams:i.elementaryStreams;l[d.ElementaryStreamTypes.AUDIOVIDEO]?o.push("audiovideo"):(l[d.ElementaryStreamTypes.AUDIO]&&o.push("audio"),l[d.ElementaryStreamTypes.VIDEO]&&o.push("video")),0===o.length&&s.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+i.type+" level: "+i.level+" sn: "+i.sn),this.blockBuffers((function(){var t=self.performance.now();i.stats.buffering.end=t,a&&(a.stats.buffering.end=t);var e=a?a.stats:i.stats;r.hls.trigger(n.Events.FRAG_BUFFERED,{frag:i,part:a,stats:e,id:i.type})}),o)},e.onFragChanged=function(t,e){this.flushBackBuffer()},e.onBufferEos=function(t,e){var r=this;this.getSourceBufferTypes().reduce((function(t,i){var n=r.sourceBuffer[i];return!n||e.type&&e.type!==i||(n.ending=!0,n.ended||(n.ended=!0,s.logger.log("[buffer-controller]: "+i+" sourceBuffer now EOS"))),t&&!(n&&!n.ended)}),!0)&&(s.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers((function(){r.getSourceBufferTypes().forEach((function(t){var e=r.sourceBuffer[t];e&&(e.ending=!1)}));var t=r.mediaSource;t&&"open"===t.readyState?(s.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),t.endOfStream()):t&&s.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+t.readyState)})))},e.onLevelUpdated=function(t,e){var r=e.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},e.flushBackBuffer=function(){var t=this.hls,e=this.details,r=this.media,a=this.sourceBuffer;if(r&&null!==e){var l=this.getSourceBufferTypes();if(l.length){var d=e.live&&null!==t.config.liveBackBufferLength?t.config.liveBackBufferLength:t.config.backBufferLength;if((0,i.isFiniteNumber)(d)&&!(d<0)){var u=r.currentTime,c=e.levelTargetDuration,h=Math.max(d,c),f=Math.floor(u/c)*c-h;l.forEach((function(r){var i=a[r];if(i){var l=o.BufferHelper.getBuffered(i);if(l.length>0&&f>l.start(0)){if(t.trigger(n.Events.BACK_BUFFER_REACHED,{bufferEnd:f}),e.live)t.trigger(n.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:f});else if(i.ended&&l.end(l.length-1)-u<2*c)return void s.logger.info("[buffer-controller]: Cannot flush "+r+" back buffer while SourceBuffer is in ended state");t.trigger(n.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:f,type:r})}}}))}}}},e.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var t=this.details,e=this.hls,r=this.media,n=this.mediaSource,a=t.fragments[0].start+t.totalduration,o=r.duration,l=(0,i.isFiniteNumber)(n.duration)?n.duration:0;t.live&&e.config.liveDurationInfinity?(s.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(t)):(a>l&&a>o||!(0,i.isFiniteNumber)(o))&&(s.logger.log("[buffer-controller]: Updating Media Source duration to "+a.toFixed(3)),n.duration=a)}},e.updateSeekableRange=function(t){var e=this.mediaSource,r=t.fragments;if(r.length&&t.live&&null!=e&&e.setLiveSeekableRange){var i=Math.max(0,r[0].start),n=Math.max(i,i+t.totalduration);e.setLiveSeekableRange(i,n)}},e.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.operationQueue,r=this.pendingTracks,i=Object.keys(r).length;if(i&&!t||2===i){this.createSourceBuffers(r),this.pendingTracks={};var s=this.getSourceBufferTypes();if(0===s.length)return void this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});s.forEach((function(t){e.executeNext(t)}))}},e.createSourceBuffers=function(t){var e=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");var i=0;for(var o in t)if(!e[o]){var l=t[o];if(!l)throw Error("source buffer exists for track "+o+", however track does not");var d=l.levelCodec||l.codec,u=l.container+";codecs="+d;s.logger.log("[buffer-controller]: creating sourceBuffer("+u+")");try{var c=e[o]=r.addSourceBuffer(u),h=o;this.addBufferListener(h,"updatestart",this._onSBUpdateStart),this.addBufferListener(h,"updateend",this._onSBUpdateEnd),this.addBufferListener(h,"error",this._onSBUpdateError),this.tracks[o]={buffer:c,codec:d,container:l.container,levelCodec:l.levelCodec,metadata:l.metadata,id:l.id},i++}catch(t){s.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+t.message),this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,mimeType:u})}}i&&this.hls.trigger(n.Events.BUFFER_CREATED,{tracks:this.tracks})},e._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},e._onSBUpdateEnd=function(t){var e=this.operationQueue;e.current(t).onComplete(),e.shiftAndExecuteNext(t)},e._onSBUpdateError=function(t,e){s.logger.error("[buffer-controller]: "+t+" SourceBuffer error",e),this.hls.trigger(n.Events.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var r=this.operationQueue.current(t);r&&r.onError(e)},e.removeExecutor=function(t,e,r){var n=this.media,a=this.mediaSource,o=this.operationQueue,l=this.sourceBuffer[t];if(!n||!a||!l)return s.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void o.shiftAndExecuteNext(t);var d=(0,i.isFiniteNumber)(n.duration)?n.duration:1/0,u=(0,i.isFiniteNumber)(a.duration)?a.duration:1/0,c=Math.max(0,e),h=Math.min(r,d,u);h>c&&!l.ending?(l.ended=!1,s.logger.log("[buffer-controller]: Removing ["+c+","+h+"] from the "+t+" SourceBuffer"),l.remove(c,h)):o.shiftAndExecuteNext(t)},e.appendExecutor=function(t,e){var r=this.operationQueue,i=this.sourceBuffer[e];if(!i)return s.logger.warn("[buffer-controller]: Attempting to append to the "+e+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(e);i.ended=!1,i.appendBuffer(t)},e.blockBuffers=function(t,e){var r=this;if(void 0===e&&(e=this.getSourceBufferTypes()),!e.length)return s.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(t);var i=this.operationQueue,n=e.map((function(t){return i.appendBlocker(t)}));Promise.all(n).then((function(){t(),e.forEach((function(t){var e=r.sourceBuffer[t];e&&e.updating||i.shiftAndExecuteNext(t)}))}))},e.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},e.addBufferListener=function(t,e,r){var i=this.sourceBuffer[t];if(i){var n=r.bind(this,t);this.listeners[t].push({event:e,listener:n}),i.addEventListener(e,n)}},e.removeBufferListeners=function(t){var e=this.sourceBuffer[t];e&&this.listeners[t].forEach((function(t){e.removeEventListener(t.event,t.listener)}))},t}()},"./src/controller/buffer-operation-queue.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>n});var i=r("./src/utils/logger.ts"),n=function(){function t(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}var e=t.prototype;return e.append=function(t,e){var r=this.queues[e];r.push(t),1===r.length&&this.buffers[e]&&this.executeNext(e)},e.insertAbort=function(t,e){this.queues[e].unshift(t),this.executeNext(e)},e.appendBlocker=function(t){var e,r=new Promise((function(t){e=t})),i={execute:e,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(i,t),r},e.executeNext=function(t){var e=this.buffers,r=this.queues,n=e[t],s=r[t];if(s.length){var a=s[0];try{a.execute()}catch(e){i.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),a.onError(e),n&&n.updating||(s.shift(),this.executeNext(t))}}},e.shiftAndExecuteNext=function(t){this.queues[t].shift(),this.executeNext(t)},e.current=function(t){return this.queues[t][0]},t}()},"./src/controller/cap-level-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>s});var i=r("./src/events.ts");function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,s=void 0,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?s:String(s)),i)}var n,s}const s=function(){function t(t){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var e,r,s,a=t.prototype;return a.setStreamController=function(t){this.streamController=t},a.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},a.registerListeners=function(){var t=this.hls;t.on(i.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},a.unregisterListener=function(){var t=this.hls;t.off(i.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},a.onFpsDropLevelCapping=function(e,r){t.isLevelAllowed(r.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(r.droppedLevel)},a.onMediaAttaching=function(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null},a.onManifestParsed=function(t,e){var r=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,r.config.capLevelToPlayerSize&&e.video&&this.startCapping()},a.onBufferCodecs=function(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},a.onMediaDetaching=function(){this.stopCapping()},a.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var t=this.hls.levels;if(t.length){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t.length-1),e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},a.getMaxLevel=function(e){var r=this,i=this.hls.levels;if(!i.length)return-1;var n=i.filter((function(i,n){return t.isLevelAllowed(n,r.restrictedLevels)&&n<=e}));return this.clientRect=null,t.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},a.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},a.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},a.getDimensions=function(){if(this.clientRect)return this.clientRect;var t=this.media,e={width:0,height:0};if(t){var r=t.getBoundingClientRect();e.width=r.width,e.height=r.height,e.width||e.height||(e.width=r.right-r.left||t.width||0,e.height=r.bottom-r.top||t.height||0)}return this.clientRect=e,e},t.isLevelAllowed=function(t,e){return void 0===e&&(e=[]),-1===e.indexOf(t)},t.getMaxLevelByMediaSize=function(t,e,r){if(!t||!t.length)return-1;for(var i,n,s=t.length-1,a=0;a<t.length;a+=1){var o=t[a];if((o.width>=e||o.height>=r)&&(i=o,!(n=t[a+1])||i.width!==n.width||i.height!==n.height)){s=a;break}}return s},e=t,(r=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch(t){}return t}}])&&n(e.prototype,r),s&&n(e,s),Object.defineProperty(e,"prototype",{writable:!1}),t}()},"./src/controller/cmcd-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>h});var i=r("./src/events.ts"),n=r("./src/types/cmcd.ts"),s=r("./src/utils/buffer-helper.ts"),a=r("./src/utils/logger.ts");function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,s=void 0,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?s:String(s)),i)}var n,s}function l(t,e,r){return e&&o(t.prototype,e),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function d(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return u(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function c(){return c=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},c.apply(this,arguments)}var h=function(){function t(e){var r=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){r.initialized&&(r.starved=!0),r.buffering=!0},this.onPlaying=function(){r.initialized||(r.initialized=!0),r.buffering=!1},this.applyPlaylistData=function(t){try{r.apply(t,{ot:n.CMCDObjectType.MANIFEST,su:!r.initialized})}catch(t){a.logger.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=function(t){try{var e=t.frag,i=r.hls.levels[e.level],s=r.getObjectType(e),o={d:1e3*e.duration,ot:s};s!==n.CMCDObjectType.VIDEO&&s!==n.CMCDObjectType.AUDIO&&s!=n.CMCDObjectType.MUXED||(o.br=i.bitrate/1e3,o.tb=r.getTopBandwidth(s)/1e3,o.bl=r.getBufferLength(s)),r.apply(t,o)}catch(t){a.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=e;var i=this.config=e.config,s=i.cmcd;null!=s&&(i.pLoader=this.createPlaylistLoader(),i.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||t.uuid(),this.cid=s.contentId,this.useHeaders=!0===s.useHeaders,this.registerListeners())}var e=t.prototype;return e.registerListeners=function(){var t=this.hls;t.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(i.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.on(i.Events.BUFFER_CREATED,this.onBufferCreated,this)},e.unregisterListeners=function(){var t=this.hls;t.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(i.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.off(i.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},e.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},e.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},e.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},e.onBufferCreated=function(t,e){var r,i;this.audioBuffer=null===(r=e.tracks.audio)||void 0===r?void 0:r.buffer,this.videoBuffer=null===(i=e.tracks.video)||void 0===i?void 0:i.buffer},e.createData=function(){var t;return{v:n.CMCDVersion,sf:n.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:null===(t=this.media)||void 0===t?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},e.apply=function(e,r){void 0===r&&(r={}),c(r,this.createData());var i=r.ot===n.CMCDObjectType.INIT||r.ot===n.CMCDObjectType.VIDEO||r.ot===n.CMCDObjectType.MUXED;if(this.starved&&i&&(r.bs=!0,r.su=!0,this.starved=!1),null==r.su&&(r.su=this.buffering),this.useHeaders){var s=t.toHeaders(r);if(!Object.keys(s).length)return;e.headers||(e.headers={}),c(e.headers,s)}else{var a=t.toQuery(r);if(!a)return;e.url=t.appendQueryToUri(e.url,a)}},e.getObjectType=function(t){var e=t.type;return"subtitle"===e?n.CMCDObjectType.TIMED_TEXT:"initSegment"===t.sn?n.CMCDObjectType.INIT:"audio"===e?n.CMCDObjectType.AUDIO:"main"===e?this.hls.audioTracks.length?n.CMCDObjectType.VIDEO:n.CMCDObjectType.MUXED:void 0},e.getTopBandwidth=function(t){var e,r=0,i=this.hls;if(t===n.CMCDObjectType.AUDIO)e=i.audioTracks;else{var s=i.maxAutoLevel,a=s>-1?s+1:i.levels.length;e=i.levels.slice(0,a)}for(var o,l=d(e);!(o=l()).done;){var u=o.value;u.bitrate>r&&(r=u.bitrate)}return r>0?r:NaN},e.getBufferLength=function(t){var e=this.hls.media,r=t===n.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return r&&e?1e3*s.BufferHelper.bufferInfo(r,e.currentTime,this.config.maxBufferHole).len:NaN},e.createPlaylistLoader=function(){var t=this.config.pLoader,e=this.applyPlaylistData,r=t||this.config.loader;return function(){function t(t){this.loader=void 0,this.loader=new r(t)}var i=t.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(t,r,i){e(t),this.loader.load(t,r,i)},l(t,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),t}()},e.createFragmentLoader=function(){var t=this.config.fLoader,e=this.applyFragmentData,r=t||this.config.loader;return function(){function t(t){this.loader=void 0,this.loader=new r(t)}var i=t.prototype;return i.destroy=function(){this.loader.destroy()},i.abort=function(){this.loader.abort()},i.load=function(t,r,i){e(t),this.loader.load(t,r,i)},l(t,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),t}()},t.uuid=function(){var t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)},t.serialize=function(t){for(var e,r=[],i=function(t){return!Number.isNaN(t)&&null!=t&&""!==t&&!1!==t},n=function(t){return Math.round(t)},s=function(t){return 100*n(t/100)},a={br:n,d:n,bl:s,dl:s,mtp:s,nor:function(t){return encodeURIComponent(t)},rtp:s,tb:n},o=d(Object.keys(t||{}).sort());!(e=o()).done;){var l=e.value,u=t[l];if(i(u)&&!("v"===l&&1===u||"pr"==l&&1===u)){var c=a[l];c&&(u=c(u));var h=typeof u,f=void 0;f="ot"===l||"sf"===l||"st"===l?l+"="+u:"boolean"===h?l:"number"===h?l+"="+u:l+"="+JSON.stringify(u),r.push(f)}}return r.join(",")},t.toHeaders=function(e){for(var r={},i=["Object","Request","Session","Status"],n=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},a=0,o=Object.keys(e);a<o.length;a++){var l=o[a];n[null!=s[l]?s[l]:1][l]=e[l]}for(var d=0;d<n.length;d++){var u=t.serialize(n[d]);u&&(r["CMCD-"+i[d]]=u)}return r},t.toQuery=function(e){return"CMCD="+encodeURIComponent(t.serialize(e))},t.appendQueryToUri=function(t,e){if(!e)return t;var r=t.includes("?")?"&":"?";return""+t+r+e},t}()},"./src/controller/eme-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>S});var i=r("./src/events.ts"),n=r("./src/errors.ts"),s=r("./src/utils/logger.ts"),a=r("./src/utils/mediakeys-helper.ts"),o=r("./src/utils/keysystem-util.ts"),l=r("./src/utils/numeric-encoding-utils.ts"),d=r("./src/loader/level-key.ts"),u=r("./src/utils/hex.ts"),c=r("./src/utils/mp4-tools.ts"),h=r("./node_modules/eventemitter3/index.js"),f=r.n(h);function p(t){var e="function"==typeof Map?new Map:void 0;return p=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return v(t,arguments,m(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),g(i,t)},p(t)}function v(t,e,r){return v=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct.bind():function(t,e,r){var i=[null];i.push.apply(i,e);var n=new(Function.bind.apply(t,i));return r&&g(n,r.prototype),n},v.apply(null,arguments)}function g(t,e){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},g(t,e)}function m(t){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},m(t)}var y="[eme]",E=function(){function t(e){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=t.CDMCleanupPromise?[t.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=s.logger.debug.bind(s.logger,y),this.log=s.logger.log.bind(s.logger,y),this.warn=s.logger.warn.bind(s.logger,y),this.error=s.logger.error.bind(s.logger,y),this.hls=e,this.config=e.config,this.registerListeners()}var e=t.prototype;return e.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},e.registerListeners=function(){this.hls.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(i.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},e.unregisterListeners=function(){this.hls.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(i.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},e.getLicenseServerUrl=function(t){var e=this.config,r=e.drmSystems,i=e.widevineLicenseUrl,n=r[t];if(n)return n.licenseUrl;if(t===a.KeySystems.WIDEVINE&&i)return i;throw new Error('no license server URL configured for key-system "'+t+'"')},e.getServerCertificateUrl=function(t){var e=this.config.drmSystems[t];if(e)return e.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+t+'"]')},e.attemptKeySystemAccess=function(t){var e=this,r=this.hls.levels,i=function(t,e,r){return!!t&&r.indexOf(t)===e},s=r.map((function(t){return t.audioCodec})).filter(i),a=r.map((function(t){return t.videoCodec})).filter(i);return s.length+a.length===0&&a.push("avc1.42e01e"),new Promise((function(r,i){!function t(o){var l=o.shift();e.getMediaKeysPromise(l,s,a).then((function(t){return r({keySystem:l,mediaKeys:t})})).catch((function(e){o.length?t(o):i(e instanceof T?e:new T({type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:e,fatal:!0},e.message))}))}(t)}))},e.requestMediaKeySystemAccess=function(t,e){var r=this.config.requestMediaKeySystemAccessFunc;if("function"!=typeof r){var i="Configured requestMediaKeySystemAccess is not a function "+r;return null===a.requestMediaKeySystemAccess&&"http:"===self.location.protocol&&(i="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(i))}return r(t,e)},e.getMediaKeysPromise=function(t,e,r){var i=this,n=(0,a.getSupportedMediaKeySystemConfigurations)(t,e,r,this.config.drmSystemOptions),s=this.keySystemAccessPromises[t],o=null==s?void 0:s.keySystemAccess;if(!o){this.log('Requesting encrypted media "'+t+'" key-system access with config: '+JSON.stringify(n)),o=this.requestMediaKeySystemAccess(t,n);var l=this.keySystemAccessPromises[t]={keySystemAccess:o};return o.catch((function(e){i.log('Failed to obtain access to key-system "'+t+'": '+e)})),o.then((function(e){i.log('Access for key-system "'+e.keySystem+'" obtained');var r=i.fetchServerCertificate(t);return i.log('Create media-keys for "'+t+'"'),l.mediaKeys=e.createMediaKeys().then((function(e){return i.log('Media-keys created for "'+t+'"'),r.then((function(r){return r?i.setMediaKeysServerCertificate(e,t,r):e}))})),l.mediaKeys.catch((function(e){i.error('Failed to create media-keys for "'+t+'"}: '+e)})),l.mediaKeys}))}return o.then((function(){return s.mediaKeys}))},e.createMediaKeySessionContext=function(t){var e=t.decryptdata,r=t.keySystem,i=t.mediaKeys;this.log('Creating key-system session "'+r+'" keyId: '+u.default.hexDump(e.keyId||[]));var n=i.createSession(),s={decryptdata:e,keySystem:r,mediaKeys:i,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s},e.renewKeySession=function(t){var e=t.decryptdata;if(e.pssh){var r=this.createMediaKeySessionContext(t),i=this.getKeyIdString(e);this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(r,"cenc",e.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)},e.getKeyIdString=function(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(null===t.keyId)throw new Error("keyId is null");return u.default.hexDump(t.keyId)},e.updateKeySession=function(t,e){var r,i=t.mediaKeysSession;return this.log('Updating key-session "'+i.sessionId+'" for keyID '+u.default.hexDump((null===(r=t.decryptdata)||void 0===r?void 0:r.keyId)||[])+"\n      } (data length: "+(e?e.byteLength:e)+")"),i.update(e)},e.selectKeySystemFormat=function(t){var e=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+t.sn+" "+t.type+": "+t.level+") key formats "+e.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise},e.getKeyFormatPromise=function(t){var e=this;return new Promise((function(r,i){var n=(0,a.getKeySystemsForConfig)(e.config),s=t.map(a.keySystemFormatToKeySystemDomain).filter((function(t){return!!t&&-1!==n.indexOf(t)}));return e.getKeySystemSelectionPromise(s).then((function(t){var e=t.keySystem,n=(0,a.keySystemDomainToKeySystemFormat)(e);n?r(n):i(new Error('Unable to find format for key-system "'+e+'"'))})).catch(i)}))},e.loadKey=function(t){var e=this,r=t.keyInfo.decryptdata,i=this.getKeyIdString(r),n="(keyId: "+i+' format: "'+r.keyFormat+'" method: '+r.method+" uri: "+r.uri+")";this.log("Starting session for key "+n);var s=this.keyIdToKeySessionPromise[i];return s||(s=this.keyIdToKeySessionPromise[i]=this.getKeySystemForKeyPromise(r).then((function(i){var s=i.keySystem,a=i.mediaKeys;return e.throwIfDestroyed(),e.log("Handle encrypted media sn: "+t.frag.sn+" "+t.frag.type+": "+t.frag.level+" using key "+n),e.attemptSetMediaKeys(s,a).then((function(){e.throwIfDestroyed();var t=e.createMediaKeySessionContext({keySystem:s,mediaKeys:a,decryptdata:r});return e.generateRequestWithPreferredKeySession(t,"cenc",r.pssh,"playlist-key")}))}))).catch((function(t){return e.handleError(t)})),s},e.throwIfDestroyed=function(t){if(void 0===t&&(t="Invalid state"),!this.hls)throw new Error("invalid state")},e.handleError=function(t){this.hls&&(this.error(t.message),t instanceof T?this.hls.trigger(i.Events.ERROR,t.data):this.hls.trigger(i.Events.ERROR,{type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))},e.getKeySystemForKeyPromise=function(t){var e=this.getKeyIdString(t),r=this.keyIdToKeySessionPromise[e];if(!r){var i=(0,a.keySystemFormatToKeySystemDomain)(t.keyFormat),n=i?[i]:(0,a.getKeySystemsForConfig)(this.config);return this.attemptKeySystemAccess(n)}return r},e.getKeySystemSelectionPromise=function(t){if(t.length||(t=(0,a.getKeySystemsForConfig)(this.config)),0===t.length)throw new T({type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(t)},e._onMediaEncrypted=function(t){var e=this,r=t.initDataType,i=t.initData;if(this.debug('"'+t.type+'" event: init data type: "'+r+'"'),null!==i){var n,s;if("sinf"===r&&this.config.drmSystems[a.KeySystems.FAIRPLAY]){var o=(0,c.bin2str)(new Uint8Array(i));try{var h=(0,l.base64Decode)(JSON.parse(o).sinf),f=(0,c.parseSinf)(new Uint8Array(h));if(!f)return;n=f.subarray(8,24),s=a.KeySystems.FAIRPLAY}catch(t){return void this.warn('Failed to parse sinf "encrypted" event message initData')}}else{var p=(0,c.parsePssh)(i);if(null===p)return;0===p.version&&p.systemId===a.KeySystemIds.WIDEVINE&&p.data&&(n=p.data.subarray(8,24)),s=(0,a.keySystemIdToKeySystemDomain)(p.systemId)}if(s&&n){for(var v=u.default.hexDump(n),g=this.keyIdToKeySessionPromise,m=this.mediaKeySessions,y=g[v],E=function(t){var s=m[t],a=s.decryptdata;if(a.pssh||!a.keyId)return"continue";var o=u.default.hexDump(a.keyId);return v===o||-1!==a.uri.replace(/-/g,"").indexOf(v)?(y=g[o],delete g[o],a.pssh=new Uint8Array(i),a.keyId=n,y=g[v]=y.then((function(){return e.generateRequestWithPreferredKeySession(s,r,i,"encrypted-event-key-match")})),"break"):void 0},T=0;T<m.length;T++){var S=E(T);if("continue"!==S&&"break"===S)break}y||(y=g[v]=this.getKeySystemSelectionPromise([s]).then((function(t){var s,o=t.keySystem,l=t.mediaKeys;e.throwIfDestroyed();var u=new d.LevelKey("ISO-23001-7",v,null!=(s=(0,a.keySystemDomainToKeySystemFormat)(o))?s:"");return u.pssh=new Uint8Array(i),u.keyId=n,e.attemptSetMediaKeys(o,l).then((function(){e.throwIfDestroyed();var t=e.createMediaKeySessionContext({decryptdata:u,keySystem:o,mediaKeys:l});return e.generateRequestWithPreferredKeySession(t,r,i,"encrypted-event-no-match")}))}))),y.catch((function(t){return e.handleError(t)}))}}},e._onWaitingForKey=function(t){this.log('"'+t.type+'" event')},e.attemptSetMediaKeys=function(t,e){var r=this,i=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+t+'"');var n=Promise.all(i).then((function(){if(!r.media)throw new Error("Attempted to set mediaKeys without media element attached");return r.media.setMediaKeys(e)}));return this.setMediaKeysQueue.push(n),n.then((function(){r.log('Media-keys set for "'+t+'"'),i.push(n),r.setMediaKeysQueue=r.setMediaKeysQueue.filter((function(t){return-1===i.indexOf(t)}))}))},e.generateRequestWithPreferredKeySession=function(t,e,r,i){var s,l,d=this,u=null===(s=this.config.drmSystems)||void 0===s||null===(l=s[t.keySystem])||void 0===l?void 0:l.generateRequest;if(u)try{var c=u.call(this.hls,e,r,t);if(!c)throw new Error("Invalid response from configured generateRequest filter");e=c.initDataType,r=t.decryptdata.pssh=c.initData?new Uint8Array(c.initData):null}catch(t){var h;if(this.warn(t.message),null!==(h=this.hls)&&void 0!==h&&h.config.debug)throw t}if(null===r)return this.log('Skipping key-session request for "'+i+'" (no initData)'),Promise.resolve(t);var p=this.getKeyIdString(t.decryptdata);this.log('Generating key-session request for "'+i+'": '+p+" (init data type: "+e+" length: "+(r?r.byteLength:null)+")");var v=new(f());t.mediaKeysSession.onmessage=function(e){var r=t.mediaKeysSession;if(r){var i=e.messageType,n=e.message;d.log('"'+i+'" message event for session "'+r.sessionId+'" message size: '+n.byteLength),"license-request"===i||"license-renewal"===i?d.renewLicense(t,n).catch((function(t){d.handleError(t),v.emit("error",t)})):"license-release"===i?t.keySystem===a.KeySystems.FAIRPLAY&&(d.updateKeySession(t,(0,o.strToUtf8array)("acknowledged")),d.removeSession(t)):d.warn('unhandled media key message type "'+i+'"')}else v.emit("error",new Error("invalid state"))},t.mediaKeysSession.onkeystatuseschange=function(e){if(t.mediaKeysSession){d.onKeyStatusChange(t);var r=t.keyStatus;v.emit("keyStatus",r),"expired"===r&&(d.warn(t.keySystem+" expired for key "+p),d.renewKeySession(t))}else v.emit("error",new Error("invalid state"))};var g=new Promise((function(t,e){v.on("error",e),v.on("keyStatus",(function(r){r.startsWith("usable")?t():"output-restricted"===r?e(new T({type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):"internal-error"===r?e(new T({type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+r+'"')):"expired"===r?e(new Error("key expired while generating request")):d.warn('unhandled key status change "'+r+'"')}))}));return t.mediaKeysSession.generateRequest(e,r).then((function(){var e;d.log('Request generated for key-session "'+(null===(e=t.mediaKeysSession)||void 0===e?void 0:e.sessionId)+'" keyId: '+p)})).catch((function(t){throw new T({type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:t,fatal:!1},"Error generating key-session request: "+t)})).then((function(){return g})).catch((function(e){throw v.removeAllListeners(),d.removeSession(t),e})).then((function(){return v.removeAllListeners(),t}))},e.onKeyStatusChange=function(t){var e=this;t.mediaKeysSession.keyStatuses.forEach((function(r,i){e.log('key status change "'+r+'" for keyStatuses keyId: '+u.default.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))+" session keyId: "+u.default.hexDump(new Uint8Array(t.decryptdata.keyId||[]))+" uri: "+t.decryptdata.uri),t.keyStatus=r}))},e.fetchServerCertificate=function(t){var e=this;return new Promise((function(r,i){var s=e.getServerCertificateUrl(t);if(!s)return r();e.log('Fetching serverCertificate for "'+t+'"');var a=new XMLHttpRequest;a.open("GET",s,!0),a.responseType="arraybuffer",a.onreadystatechange=function(){a.readyState===XMLHttpRequest.DONE&&(200===a.status?r(a.response):i(new T({type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:a},'"'+t+'" certificate request XHR failed ('+s+"). Status: "+a.status+" ("+a.statusText+")")))},a.send()}))},e.setMediaKeysServerCertificate=function(t,e,r){var i=this;return new Promise((function(s,a){t.setServerCertificate(r).then((function(n){i.log("setServerCertificate "+(n?"success":"not supported by CDM")+" ("+(null==r?void 0:r.byteLength)+') on "'+e+'"'),s(t)})).catch((function(t){a(new T({type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:t,fatal:!0},t.message))}))}))},e.renewLicense=function(t,e){var r=this;return this.requestLicense(t,new Uint8Array(e)).then((function(e){return r.updateKeySession(t,new Uint8Array(e)).catch((function(t){throw new T({type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:t,fatal:!0},t.message)}))}))},e.setupLicenseXHR=function(t,e,r,i){var n=this,s=this.config.licenseXhrSetup;return s?Promise.resolve().then((function(){if(!r.decryptdata)throw new Error("Key removed");return s.call(n.hls,t,e,r,i)})).catch((function(a){if(!r.decryptdata)throw a;return t.open("POST",e,!0),s.call(n.hls,t,e,r,i)})).then((function(r){return t.readyState||t.open("POST",e,!0),{xhr:t,licenseChallenge:r||i}})):(t.open("POST",e,!0),Promise.resolve({xhr:t,licenseChallenge:i}))},e.requestLicense=function(t,e){var r=this;return new Promise((function(i,s){var a=r.getLicenseServerUrl(t.keySystem);r.log("Sending license request to URL: "+a);var o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=function(){if(!r.hls||!t.mediaKeysSession)return s(new Error("invalid state"));if(4===o.readyState)if(200===o.status){r._requestLicenseFailureCount=0;var l=o.response;r.log("License received "+(l instanceof ArrayBuffer?l.byteLength:l));var d=r.config.licenseResponseCallback;if(d)try{l=d.call(r.hls,o,a,t)}catch(t){r.error(t)}i(l)}else if(r._requestLicenseFailureCount++,r._requestLicenseFailureCount>3||o.status>=400&&o.status<500)s(new T({type:n.ErrorTypes.KEY_SYSTEM_ERROR,details:n.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:o},"License Request XHR failed ("+a+"). Status: "+o.status+" ("+o.statusText+")"));else{var u=3-r._requestLicenseFailureCount+1;r.warn("Retrying license request, "+u+" attempts left"),r.requestLicense(t,e).then(i,s)}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=o,r.setupLicenseXHR(o,a,t,e).then((function(t){var e=t.xhr,r=t.licenseChallenge;e.send(r)}))}))},e.onMediaAttached=function(t,e){if(this.config.emeEnabled){var r=e.media;this.media=r,r.addEventListener("encrypted",this.onMediaEncrypted),r.addEventListener("waitingforkey",this.onWaitingForKey)}},e.onMediaDetached=function(){var e=this,r=this.media,i=this.mediaKeySessions;r&&(r.removeEventListener("encrypted",this.onMediaEncrypted),r.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},d.LevelKey.clearKeyUriToKeyIdMap();var n=i.length;t.CDMCleanupPromise=Promise.all(i.map((function(t){return e.removeSession(t)})).concat(null==r?void 0:r.setMediaKeys(null).catch((function(t){e.log("Could not clear media keys: "+t+". media.src: "+(null==r?void 0:r.src))})))).then((function(){n&&(e.log("finished closing key sessions and clearing media keys"),i.length=0)})).catch((function(t){e.log("Could not close sessions and clear media keys: "+t+". media.src: "+(null==r?void 0:r.src))}))},e.onManifestLoaded=function(t,e){var r=e.sessionKeys;if(r&&this.config.emeEnabled&&!this.keyFormatPromise){var i=r.reduce((function(t,e){return-1===t.indexOf(e.keyFormat)&&t.push(e.keyFormat),t}),[]);this.log("Selecting key-system from session-keys "+i.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(i)}},e.removeSession=function(t){var e=this,r=t.mediaKeysSession,i=t.licenseXhr;if(r){this.log("Remove licenses and keys and close session "+r.sessionId),r.onmessage=null,r.onkeystatuseschange=null,i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;var n=this.mediaKeySessions.indexOf(t);return n>-1&&this.mediaKeySessions.splice(n,1),r.remove().catch((function(t){e.log("Could not remove session: "+t)})).then((function(){return r.close()})).catch((function(t){e.log("Could not close session: "+t)}))}},t}();E.CDMCleanupPromise=void 0;var T=function(t){var e,r;function i(e,r){var i;return(i=t.call(this,r)||this).data=void 0,i.data=e,e.err=e.error,i}return r=t,(e=i).prototype=Object.create(r.prototype),e.prototype.constructor=e,g(e,r),i}(p(Error));const S=E},"./src/controller/fps-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>s});var i=r("./src/events.ts"),n=r("./src/utils/logger.ts");const s=function(){function t(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}var e=t.prototype;return e.setStreamController=function(t){this.streamController=t},e.registerListeners=function(){this.hls.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},e.unregisterListeners=function(){this.hls.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching)},e.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},e.onMediaAttaching=function(t,e){var r=this.hls.config;if(r.capLevelOnFPSDrop){var i=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=i,i&&"function"==typeof i.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},e.checkFPS=function(t,e,r){var s=performance.now();if(e){if(this.lastTime){var a=s-this.lastTime,o=r-this.lastDroppedFrames,l=e-this.lastDecodedFrames,d=1e3*o/a,u=this.hls;if(u.trigger(i.Events.FPS_DROP,{currentDropped:o,currentDecoded:l,totalDroppedFrames:r}),d>0&&o>u.config.fpsDroppedMonitoringThreshold*l){var c=u.currentLevel;n.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+c),c>0&&(-1===u.autoLevelCapping||u.autoLevelCapping>=c)&&(c-=1,u.trigger(i.Events.FPS_DROP_LEVEL_CAPPING,{level:c,droppedLevel:u.currentLevel}),u.autoLevelCapping=c,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=r,this.lastDecodedFrames=e}},e.checkFPSInterval=function(){var t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},t}()},"./src/controller/fragment-finders.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{findFragWithCC:()=>d,findFragmentByPDT:()=>s,findFragmentByPTS:()=>a,fragmentWithinToleranceTest:()=>o,pdtWithinToleranceTest:()=>l});var i=r("./src/polyfills/number.ts"),n=r("./src/utils/binary-search.ts");function s(t,e,r){if(null===e||!Array.isArray(t)||!t.length||!(0,i.isFiniteNumber)(e))return null;if(e<(t[0].programDateTime||0))return null;if(e>=(t[t.length-1].endProgramDateTime||0))return null;r=r||0;for(var n=0;n<t.length;++n){var s=t[n];if(l(e,r,s))return s}return null}function a(t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var s=null;if(t?s=e[t.sn-e[0].sn+1]||null:0===r&&0===e[0].start&&(s=e[0]),s&&0===o(r,i,s))return s;var a=n.default.search(e,o.bind(null,r,i));return!a||a===t&&s?s:a}function o(t,e,r){if(void 0===t&&(t=0),void 0===e&&(e=0),r.start<=t&&r.start+r.duration>t)return 0;var i=Math.min(e,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-i<=t?1:r.start-i>t&&r.start?-1:0}function l(t,e,r){var i=1e3*Math.min(e,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-i>t}function d(t,e){return n.default.search(t,(function(t){return t.cc<e?1:t.cc>e?-1:0}))}},"./src/controller/fragment-tracker.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{FragmentState:()=>i,FragmentTracker:()=>a});var i,n=r("./src/events.ts"),s=r("./src/types/loader.ts");!function(t){t.NOT_LOADED="NOT_LOADED",t.APPENDING="APPENDING",t.PARTIAL="PARTIAL",t.OK="OK"}(i||(i={}));var a=function(){function t(t){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=t,this._registerListeners()}var e=t.prototype;return e._registerListeners=function(){var t=this.hls;t.on(n.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.on(n.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(n.Events.FRAG_LOADED,this.onFragLoaded,this)},e._unregisterListeners=function(){var t=this.hls;t.off(n.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.off(n.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(n.Events.FRAG_LOADED,this.onFragLoaded,this)},e.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},e.getAppendedFrag=function(t,e){if(e===s.PlaylistLevelType.MAIN){var r=this.activeFragment,i=this.activeParts;if(!r)return null;if(i)for(var n=i.length;n--;){var a=i[n],o=a?a.end:r.appendedPTS;if(a.start<=t&&void 0!==o&&t<=o)return n>9&&(this.activeParts=i.slice(n-9)),a}else if(r.start<=t&&void 0!==r.appendedPTS&&t<=r.appendedPTS)return r}return this.getBufferedFrag(t,e)},e.getBufferedFrag=function(t,e){for(var r=this.fragments,i=Object.keys(r),n=i.length;n--;){var s=r[i[n]];if((null==s?void 0:s.body.type)===e&&s.buffered){var a=s.body;if(a.start<=t&&t<=a.end)return a}}return null},e.detectEvictedFragments=function(t,e,r){var i=this;this.timeRanges&&(this.timeRanges[t]=e),Object.keys(this.fragments).forEach((function(n){var s=i.fragments[n];if(s)if(s.buffered||s.loaded){var a=s.range[t];a&&a.time.some((function(t){var r=!i.isTimeBuffered(t.startPTS,t.endPTS,e);return r&&i.removeFragment(s.body),r}))}else s.body.type===r&&i.removeFragment(s.body)}))},e.detectPartialFragments=function(t){var e=this,r=this.timeRanges,i=t.frag,n=t.part;if(r&&"initSegment"!==i.sn){var s=l(i),a=this.fragments[s];a&&(Object.keys(r).forEach((function(t){var s=i.elementaryStreams[t];if(s){var o=r[t],l=null!==n||!0===s.partial;a.range[t]=e.getBufferedTimes(i,n,l,o)}})),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,a.body.endList&&(this.endListFragments[a.body.type]=a)):this.removeFragment(a.body))}},e.fragBuffered=function(t){var e=l(t),r=this.fragments[e];r&&(r.loaded=null,r.buffered=!0)},e.getBufferedTimes=function(t,e,r,i){for(var n={time:[],partial:r},s=e?e.start:t.start,a=e?e.end:t.end,o=t.minEndPTS||a,l=t.maxStartPTS||s,d=0;d<i.length;d++){var u=i.start(d)-this.bufferPadding,c=i.end(d)+this.bufferPadding;if(l>=u&&o<=c){n.time.push({startPTS:Math.max(s,i.start(d)),endPTS:Math.min(a,i.end(d))});break}if(s<c&&a>u)n.partial=!0,n.time.push({startPTS:Math.max(s,i.start(d)),endPTS:Math.min(a,i.end(d))});else if(a<=u)break}return n},e.getPartialFragment=function(t){var e,r,i,n=null,s=0,a=this.bufferPadding,l=this.fragments;return Object.keys(l).forEach((function(d){var u=l[d];u&&o(u)&&(r=u.body.start-a,i=u.body.end+a,t>=r&&t<=i&&(e=Math.min(t-r,i-t),s<=e&&(n=u.body,s=e)))})),n},e.isEndListAppended=function(t){var e=this.endListFragments[t];return void 0!==e&&(e.buffered||o(e))},e.getState=function(t){var e=l(t),r=this.fragments[e];return r?r.buffered?o(r)?i.PARTIAL:i.OK:i.APPENDING:i.NOT_LOADED},e.isTimeBuffered=function(t,e,r){for(var i,n,s=0;s<r.length;s++){if(i=r.start(s)-this.bufferPadding,n=r.end(s)+this.bufferPadding,t>=i&&e<=n)return!0;if(e<=i)return!1}return!1},e.onFragLoaded=function(t,e){var r=e.frag,i=e.part;if("initSegment"!==r.sn&&!r.bitrateTest&&!i){var n=l(r);this.fragments[n]={body:r,loaded:e,buffered:!1,range:Object.create(null)}}},e.onBufferAppended=function(t,e){var r=this,i=e.frag,n=e.part,a=e.timeRanges;if(i.type===s.PlaylistLevelType.MAIN)if(this.activeFragment!==i&&(this.activeFragment=i,i.appendedPTS=void 0),n){var o=this.activeParts;o||(this.activeParts=o=[]),o.push(n)}else this.activeParts=null;this.timeRanges=a,Object.keys(a).forEach((function(t){var e=a[t];if(r.detectEvictedFragments(t,e),!n&&i.type===s.PlaylistLevelType.MAIN){var o=i.elementaryStreams[t];if(!o)return;for(var l=0;l<e.length;l++){var d=e.end(l);d<=o.endPTS&&d>o.startPTS?i.appendedPTS=Math.max(d,i.appendedPTS||0):i.appendedPTS=o.endPTS}}}))},e.onFragBuffered=function(t,e){this.detectPartialFragments(e)},e.hasFragment=function(t){var e=l(t);return!!this.fragments[e]},e.removeFragmentsInRange=function(t,e,r){var i=this;Object.keys(this.fragments).forEach((function(n){var s=i.fragments[n];if(s&&s.buffered){var a=s.body;a.type===r&&a.start<e&&a.end>t&&i.removeFragment(a)}}))},e.removeFragment=function(t){var e=l(t);t.stats.loaded=0,t.clearElementaryStreamInfo(),t.appendedPTS=void 0,delete this.fragments[e],t.endList&&delete this.endListFragments[t.type]},e.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},t}();function o(t){var e,r;return t.buffered&&((null===(e=t.range.video)||void 0===e?void 0:e.partial)||(null===(r=t.range.audio)||void 0===r?void 0:r.partial))}function l(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn}},"./src/controller/gap-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{MAX_START_GAP_JUMP:()=>l,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>d,SKIP_BUFFER_RANGE_START:()=>u,STALL_MINIMUM_DURATION_MS:()=>o,default:()=>c});var i=r("./src/utils/buffer-helper.ts"),n=r("./src/errors.ts"),s=r("./src/events.ts"),a=r("./src/utils/logger.ts"),o=250,l=2,d=.1,u=.05,c=function(){function t(t,e,r,i){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=r,this.hls=i}var e=t.prototype;return e.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},e.poll=function(t,e){var r=this.config,n=this.media,s=this.stalled;if(null!==n){var d=n.currentTime,u=n.seeking,c=this.seeking&&!u,h=!this.seeking&&u;if(this.seeking=u,d===t){if((h||c)&&(this.stalled=null),!(n.paused&&!u||n.ended||0===n.playbackRate)&&i.BufferHelper.getBuffered(n).length){var f=i.BufferHelper.bufferInfo(n,d,0),p=f.len>0,v=f.nextStart||0;if(p||v){if(u){var g=f.len>l,m=!v||e&&e.start<=d||v-d>l&&!this.fragmentTracker.getPartialFragment(d);if(g||m)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var y,E=Math.max(v,f.start||0)-d,T=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,S=(null==T||null===(y=T.details)||void 0===y?void 0:y.live)?2*T.details.targetduration:l;if(E>0&&E<=S)return void this._trySkipBufferHole(null)}var b=self.performance.now();if(null!==s){var L=b-s;if(u||!(L>=o)||(this._reportStall(f),this.media)){var A=i.BufferHelper.bufferInfo(n,d,r.maxBufferHole);this._tryFixBufferStall(A,L)}}else this.stalled=b}}}else if(this.moved=!0,null!==s){if(this.stallReported){var _=self.performance.now()-s;a.logger.warn("playback not stuck anymore @"+d+", after "+Math.round(_)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},e._tryFixBufferStall=function(t,e){var r=this.config,i=this.fragmentTracker,n=this.media;if(null!==n){var s=n.currentTime,o=i.getPartialFragment(s);if(o&&(this._trySkipBufferHole(o)||!this.media))return;t.len>r.maxBufferHole&&e>1e3*r.highBufferWatchdogPeriod&&(a.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},e._reportStall=function(t){var e=this.hls,r=this.media;!this.stallReported&&r&&(this.stallReported=!0,a.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer ("+JSON.stringify(t)+")"),e.trigger(s.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:t.len}))},e._trySkipBufferHole=function(t){var e=this.config,r=this.hls,o=this.media;if(null===o)return 0;for(var l=o.currentTime,c=0,h=i.BufferHelper.getBuffered(o),f=0;f<h.length;f++){var p=h.start(f);if(l+e.maxBufferHole>=c&&l<p){var v=Math.max(p+u,o.currentTime+d);return a.logger.warn("skipping hole, adjusting currentTime from "+l+" to "+v),this.moved=!0,this.stalled=null,o.currentTime=v,t&&r.trigger(s.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+l+" to "+v,frag:t}),v}c=h.end(f)}return 0},e._tryNudgeBuffer=function(){var t=this.config,e=this.hls,r=this.media,i=this.nudgeRetry;if(null!==r){var o=r.currentTime;if(this.nudgeRetry++,i<t.nudgeMaxRetry){var l=o+(i+1)*t.nudgeOffset;a.logger.warn("Nudging 'currentTime' from "+o+" to "+l),r.currentTime=l,e.trigger(s.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else a.logger.error("Playhead still not moving while enough data buffered @"+o+" after "+t.nudgeMaxRetry+" nudges"),e.trigger(s.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},t}()},"./src/controller/id3-track-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>h});var i=r("./src/polyfills/number.ts"),n=r("./src/events.ts"),s=r("./src/utils/texttrack-utils.ts"),a=r("./src/demux/id3.ts"),o=r("./src/loader/date-range.ts"),l=r("./src/types/demuxer.ts");function d(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var u=function(){var t=d();try{new t(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function c(t,e){return t.getTime()/1e3-e}const h=function(){function t(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}var e=t.prototype;return e.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},e._registerListeners=function(){var t=this.hls;t.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(n.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(n.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},e._unregisterListeners=function(){var t=this.hls;t.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(n.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(n.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},e.onMediaAttached=function(t,e){this.media=e.media},e.onMediaDetaching=function(){this.id3Track&&((0,s.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},e.onManifestLoading=function(){this.dateRangeCuesAppended={}},e.createTrack=function(t){var e=this.getID3Track(t.textTracks);return e.mode="hidden",e},e.getID3Track=function(t){if(this.media){for(var e=0;e<t.length;e++){var r=t[e];if("metadata"===r.kind&&"id3"===r.label)return(0,s.sendAddTrackEvent)(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},e.onFragParsingMetadata=function(t,e){if(this.media){var r=this.hls.config,i=r.enableEmsgMetadataCues,n=r.enableID3MetadataCues;if(i||n){var s=e.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var o=d(),c=0;c<s.length;c++){var h=s[c].type;if((h!==l.MetadataSchema.emsg||i)&&n){var f=a.getID3Frames(s[c].data);if(f){var p=s[c].pts,v=p+s[c].duration;v>u&&(v=u),v-p<=0&&(v=p+.25);for(var g=0;g<f.length;g++){var m=f[g];if(!a.isTimeStampFrame(m)){this.updateId3CueEnds(p);var y=new o(p,v,"");y.value=m,h&&(y.type=h),this.id3Track.addCue(y)}}}}}}}},e.updateId3CueEnds=function(t){var e,r=null===(e=this.id3Track)||void 0===e?void 0:e.cues;if(r)for(var i=r.length;i--;){var n=r[i];n.startTime<t&&n.endTime===u&&(n.endTime=t)}},e.onBufferFlushing=function(t,e){var r=e.startOffset,i=e.endOffset,n=e.type,a=this.id3Track,o=this.hls;if(o){var d,u=o.config,c=u.enableEmsgMetadataCues,h=u.enableID3MetadataCues;a&&(c||h)&&(d="audio"===n?function(t){return t.type===l.MetadataSchema.audioId3&&h}:"video"===n?function(t){return t.type===l.MetadataSchema.emsg&&c}:function(t){return t.type===l.MetadataSchema.audioId3&&h||t.type===l.MetadataSchema.emsg&&c},(0,s.removeCuesInRange)(a,r,i,d))}},e.onLevelUpdated=function(t,e){var r=this,n=e.details;if(this.media&&n.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var s=this.dateRangeCuesAppended,a=this.id3Track,h=n.dateRanges,f=Object.keys(h);if(a)for(var p=Object.keys(s).filter((function(t){return!f.includes(t)})),v=function(t){var e=p[t];Object.keys(s[e].cues).forEach((function(t){a.removeCue(s[e].cues[t])})),delete s[e]},g=p.length;g--;)v(g);var m=n.fragments[n.fragments.length-1];if(0!==f.length&&(0,i.isFiniteNumber)(null==m?void 0:m.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var y=m.programDateTime/1e3-m.start,E=d(),T=function(t){var e=f[t],i=h[e],n=s[e],a=(null==n?void 0:n.cues)||{},d=(null==n?void 0:n.durationKnown)||!1,p=c(i.startDate,y),v=u,g=i.endDate;if(g)v=c(g,y),d=!0;else if(i.endOnNext&&!d){var m=f.reduce((function(t,e){var r=h[e];return r.class===i.class&&r.id!==e&&r.startDate>i.startDate&&t.push(r),t}),[]).sort((function(t,e){return t.startDate.getTime()-e.startDate.getTime()}))[0];m&&(v=c(m.startDate,y),d=!0)}for(var T,S=Object.keys(i.attr),b=0;b<S.length;b++){var L=S[b];if(L!==o.DateRangeAttribute.ID&&L!==o.DateRangeAttribute.CLASS&&L!==o.DateRangeAttribute.START_DATE&&L!==o.DateRangeAttribute.DURATION&&L!==o.DateRangeAttribute.END_DATE&&L!==o.DateRangeAttribute.END_ON_NEXT){var A=a[L];if(A)d&&!n.durationKnown&&(A.endTime=v);else{var _=i.attr[L];A=new E(p,v,""),L!==o.DateRangeAttribute.SCTE35_OUT&&L!==o.DateRangeAttribute.SCTE35_IN||(T=_,_=Uint8Array.from(T.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),A.value={key:L,data:_},A.type=l.MetadataSchema.dateRange,r.id3Track.addCue(A),a[L]=A}}}s[e]={cues:a,dateRange:i,durationKnown:d}},S=0;S<f.length;S++)T(S)}}},t}()},"./src/controller/latency-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>o});var i=r("./src/errors.ts"),n=r("./src/events.ts"),s=r("./src/utils/logger.ts");function a(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,s=void 0,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?s:String(s)),i)}var n,s}var o=function(){function t(t){var e=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return e.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}var e,r,o,l=t.prototype;return l.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},l.registerListeners=function(){this.hls.on(n.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(n.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(n.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){this.hls.off(n.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(n.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(n.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(n.Events.ERROR,this.onError)},l.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},l.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},l.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},l.onLevelUpdated=function(t,e){var r=e.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},l.onError=function(t,e){e.details===i.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,s.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},l.timeupdate=function(){var t=this.media,e=this.levelDetails;if(t&&e){this.currentTime=t.currentTime;var r=this.computeLatency();if(null!==r){this._latency=r;var i=this.config,n=i.lowLatencyMode,s=i.maxLiveSyncPlaybackRate;if(n&&1!==s){var a=this.targetLatency;if(null!==a){var o=r-a,l=o<Math.min(this.maxLatency,a+e.targetduration);if(e.live&&l&&o>.05&&this.forwardBufferLength>1){var d=Math.min(2,Math.max(1,s)),u=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;t.playbackRate=Math.min(d,Math.max(1,u))}else 1!==t.playbackRate&&0!==t.playbackRate&&(t.playbackRate=1)}}}}},l.estimateLiveEdge=function(){var t=this.levelDetails;return null===t?null:t.edge+t.age},l.computeLatency=function(){var t=this.estimateLiveEdge();return null===t?null:t-this.currentTime},e=t,(r=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var t=this.config,e=this.levelDetails;return void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}},{key:"targetLatency",get:function(){var t=this.levelDetails;if(null===t)return null;var e=t.holdBack,r=t.partHoldBack,i=t.targetduration,n=this.config,s=n.liveSyncDuration,a=n.liveSyncDurationCount,o=n.lowLatencyMode,l=this.hls.userConfig,d=o&&r||e;(l.liveSyncDuration||l.liveSyncDurationCount||0===d)&&(d=void 0!==s?s:a*i);var u=i;return d+Math.min(1*this.stallCount,u)}},{key:"liveSyncPosition",get:function(){var t=this.estimateLiveEdge(),e=this.targetLatency,r=this.levelDetails;if(null===t||null===e||null===r)return null;var i=r.edge,n=t-e-this.edgeStalled,s=i-r.totalduration,a=i-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(s,n),a)}},{key:"drift",get:function(){var t=this.levelDetails;return null===t?1:t.drift}},{key:"edgeStalled",get:function(){var t=this.levelDetails;if(null===t)return 0;var e=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.max(t.age-e,0)}},{key:"forwardBufferLength",get:function(){var t=this.media,e=this.levelDetails;if(!t||!e)return 0;var r=t.buffered.length;return(r?t.buffered.end(r-1):e.edge)-this.currentTime}}])&&a(e.prototype,r),o&&a(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}()},"./src/controller/level-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>p});var i=r("./src/types/level.ts"),n=r("./src/events.ts"),s=r("./src/errors.ts"),a=r("./src/utils/codecs.ts"),o=r("./src/controller/level-helper.ts"),l=r("./src/controller/base-playlist-controller.ts"),d=r("./src/types/loader.ts");function u(){return u=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},u.apply(this,arguments)}function c(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,s=void 0,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?s:String(s)),i)}var n,s}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}var f=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),p=function(t){var e,r;function l(e){var r;return(r=t.call(this,e,"[level-controller]")||this)._levels=[],r._firstLevel=-1,r._startLevel=void 0,r.currentLevelIndex=-1,r.manualLevelIndex=-1,r.onParsedComplete=void 0,r._registerListeners(),r}r=t,(e=l).prototype=Object.create(r.prototype),e.prototype.constructor=e,h(e,r);var p,v,g,m=l.prototype;return m._registerListeners=function(){var t=this.hls;t.on(n.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(n.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(n.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(n.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(n.Events.ERROR,this.onError,this)},m._unregisterListeners=function(){var t=this.hls;t.off(n.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(n.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(n.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(n.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(n.Events.ERROR,this.onError,this)},m.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,t.prototype.destroy.call(this)},m.startLoad=function(){this._levels.forEach((function(t){t.loadError=0})),t.prototype.startLoad.call(this)},m.onManifestLoaded=function(t,e){var r,l,d=[],u=[],c=[],h={},p=!1,v=!1,g=!1;if(e.levels.forEach((function(t){var e=t.attrs;p=p||!(!t.width||!t.height),v=v||!!t.videoCodec,g=g||!!t.audioCodec,f&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0);var r=t.bitrate+"-"+t.attrs.RESOLUTION+"-"+t.attrs.CODECS;(l=h[r])?l.url.push(t.url):(l=new i.Level(t),h[r]=l,d.push(l)),e&&(e.AUDIO&&(0,o.addGroupId)(l,"audio",e.AUDIO),e.SUBTITLES&&(0,o.addGroupId)(l,"text",e.SUBTITLES))})),(p||v)&&g&&(d=d.filter((function(t){var e=t.videoCodec,r=t.width,i=t.height;return!!e||!(!r||!i)}))),d=d.filter((function(t){var e=t.audioCodec,r=t.videoCodec;return(!e||(0,a.isCodecSupportedInMp4)(e,"audio"))&&(!r||(0,a.isCodecSupportedInMp4)(r,"video"))})),e.audioTracks&&(u=e.audioTracks.filter((function(t){return!t.audioCodec||(0,a.isCodecSupportedInMp4)(t.audioCodec,"audio")})),(0,o.assignTrackIdsByGroup)(u)),e.subtitles&&(c=e.subtitles,(0,o.assignTrackIdsByGroup)(c)),d.length>0){r=d[0].bitrate,d.sort((function(t,e){return t.attrs["HDCP-LEVEL"]!==e.attrs["HDCP-LEVEL"]?(t.attrs["HDCP-LEVEL"]||"")>(e.attrs["HDCP-LEVEL"]||"")?1:-1:t.bitrate!==e.bitrate?t.bitrate-e.bitrate:t.attrs.SCORE!==e.attrs.SCORE?t.attrs.decimalFloatingPoint("SCORE")-e.attrs.decimalFloatingPoint("SCORE"):p&&t.height!==e.height?t.height-e.height:0})),this._levels=d;for(var m=0;m<d.length;m++)if(d[m].bitrate===r){this._firstLevel=m,this.log("manifest loaded, "+d.length+" level(s) found, first bitrate: "+r);break}var y=g&&!v,E={levels:d,audioTracks:u,subtitleTracks:c,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:g,video:v,altAudio:!y&&u.some((function(t){return!!t.url}))};this.hls.trigger(n.Events.MANIFEST_PARSED,E),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(n.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,reason:"no level with compatible codecs found in manifest"})},m.onError=function(e,r){var n,a;if(t.prototype.onError.call(this,e,r),!r.fatal){var o=r.context,l=this._levels[this.currentLevelIndex];if(o&&(o.type===d.PlaylistContextType.AUDIO_TRACK&&l.audioGroupIds&&o.groupId===l.audioGroupIds[l.urlId]||o.type===d.PlaylistContextType.SUBTITLE_TRACK&&l.textGroupIds&&o.groupId===l.textGroupIds[l.urlId]))this.redundantFailover(this.currentLevelIndex);else{var u,c=!1,h=!0;switch(r.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:if(r.frag){var f=r.frag.type===d.PlaylistLevelType.MAIN?r.frag.level:this.currentLevelIndex,p=this._levels[f];p?(p.fragmentError++,p.fragmentError>this.hls.config.fragLoadingMaxRetry&&(u=f)):u=f}break;case s.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var v=l.attrs["HDCP-LEVEL"];v&&(this.hls.maxHdcpLevel=i.HdcpLevels[i.HdcpLevels.indexOf(v)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'));case s.ErrorDetails.FRAG_PARSING_ERROR:case s.ErrorDetails.KEY_SYSTEM_NO_SESSION:u=(null===(n=r.frag)||void 0===n?void 0:n.type)===d.PlaylistLevelType.MAIN?r.frag.level:this.currentLevelIndex,r.levelRetry=!1;break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:o&&(o.deliveryDirectives&&(h=!1),u=o.level),c=!0;break;case s.ErrorDetails.REMUX_ALLOC_ERROR:u=null!=(a=r.level)?a:this.currentLevelIndex,c=!0}void 0!==u&&this.recoverLevel(r,u,c,h)}}},m.recoverLevel=function(t,e,r,i){var n=t.details,s=this._levels[e];if(s.loadError++,r){if(!this.retryLoadingOrFail(t))return void(this.currentLevelIndex=-1);t.levelRetry=!0}if(i){var a=s.url.length;if(a>1&&s.loadError<a)t.levelRetry=!0,this.redundantFailover(e);else if(-1===this.manualLevelIndex){for(var o=-1,l=this._levels,d=l.length;d--;){var u=(d+this.currentLevelIndex)%l.length;if(u!==this.currentLevelIndex&&0===l[u].loadError){o=u;break}}o>-1&&this.currentLevelIndex!==o?(this.warn(n+": switch to "+o),t.levelRetry=!0,this.hls.nextAutoLevel=o):!1===t.levelRetry&&(t.fatal=!0)}}},m.redundantFailover=function(t){var e=this._levels[t],r=e.url.length;if(r>1){var i=(e.urlId+1)%r;this.warn("Switching to redundant URL-id "+i),this._levels.forEach((function(t){t.urlId=i})),this.level=t}},m.onFragLoaded=function(t,e){var r=e.frag;if(void 0!==r&&r.type===d.PlaylistLevelType.MAIN){var i=this._levels[r.level];void 0!==i&&(i.fragmentError=0,i.loadError=0)}},m.onLevelLoaded=function(t,e){var r,i,n=e.level,s=e.details,a=this._levels[n];if(!a)return this.warn("Invalid level index "+n),void(null!==(i=e.deliveryDirectives)&&void 0!==i&&i.skip&&(s.deltaUpdateFailed=!0));n===this.currentLevelIndex?(0===a.fragmentError&&(a.loadError=0,this.retryCount=0),this.playlistLoaded(n,e,a.details)):null!==(r=e.deliveryDirectives)&&void 0!==r&&r.skip&&(s.deltaUpdateFailed=!0)},m.onAudioTrackSwitched=function(t,e){var r=this.hls.levels[this.currentLevelIndex];if(r&&r.audioGroupIds){for(var i=-1,n=this.hls.audioTracks[e.id].groupId,s=0;s<r.audioGroupIds.length;s++)if(r.audioGroupIds[s]===n){i=s;break}i!==r.urlId&&(r.urlId=i,this.startLoad())}},m.loadPlaylist=function(e){t.prototype.loadPlaylist.call(this);var r=this.currentLevelIndex,i=this._levels[r];if(this.canLoad&&i&&i.url.length>0){var s=i.urlId,a=i.url[s];if(e)try{a=e.addDirectives(a)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Attempt loading level index "+r+(void 0!==(null==e?void 0:e.msn)?" at sn "+e.msn+" part "+e.part:"")+" with URL-id "+s+" "+a),this.clearTimer(),this.hls.trigger(n.Events.LEVEL_LOADING,{url:a,level:r,id:s,deliveryDirectives:e||null})}},m.removeLevel=function(t,e){var r=function(t,r){return r!==e},i=this._levels.filter((function(i,n){return n!==t||i.url.length>1&&void 0!==e&&(i.url=i.url.filter(r),i.audioGroupIds&&(i.audioGroupIds=i.audioGroupIds.filter(r)),i.textGroupIds&&(i.textGroupIds=i.textGroupIds.filter(r)),i.urlId=0,!0)})).map((function(t,e){var r=t.details;return null!=r&&r.fragments&&r.fragments.forEach((function(t){t.level=e})),t}));this._levels=i,this.hls.trigger(n.Events.LEVELS_UPDATED,{levels:i})},p=l,(v=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e,r=this._levels;if(0!==r.length&&(this.currentLevelIndex!==t||null===(e=r[t])||void 0===e||!e.details)){if(t<0||t>=r.length){var i=t<0;if(this.hls.trigger(n.Events.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:i,reason:"invalid level idx"}),i)return;t=Math.min(t,r.length-1)}this.clearTimer();var a=this.currentLevelIndex,o=r[a],l=r[t];this.log("switching to level "+t+" from "+a),this.currentLevelIndex=t;var d=u({},l,{level:t,maxBitrate:l.maxBitrate,uri:l.uri,urlId:l.urlId});delete d._urlId,this.hls.trigger(n.Events.LEVEL_SWITCHING,d);var c=l.details;if(!c||c.live){var h=this.switchParams(l.uri,null==o?void 0:o.details);this.loadPlaylist(h)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}])&&c(p.prototype,v),g&&c(p,g),Object.defineProperty(p,"prototype",{writable:!1}),l}(l.default)},"./src/controller/level-helper.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{addGroupId:()=>o,addSliding:()=>g,adjustSliding:()=>v,assignTrackIdsByGroup:()=>l,computeReloadInterval:()=>m,getFragmentWithSN:()=>y,getPartWith:()=>E,mapFragmentIntersection:()=>p,mapPartIntersection:()=>f,mergeDetails:()=>h,updateFragPTSDTS:()=>c,updatePTS:()=>d});var i=r("./src/polyfills/number.ts"),n=r("./src/utils/logger.ts"),s=r("./src/loader/date-range.ts");function a(){return a=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},a.apply(this,arguments)}function o(t,e,r){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(r);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(r)}}function l(t){var e={};t.forEach((function(t){var r=t.groupId||"";t.id=e[r]=e[r]||0,e[r]++}))}function d(t,e,r){u(t[e],t[r])}function u(t,e){var r=e.startPTS;if((0,i.isFiniteNumber)(r)){var n,s=0;e.sn>t.sn?(s=r-t.start,n=t):(s=t.start-r,n=e),n.duration!==s&&(n.duration=s)}else e.sn>t.sn?t.cc===e.cc&&t.minEndPTS?e.start=t.start+(t.minEndPTS-t.start):e.start=t.start+t.duration:e.start=Math.max(t.start-e.duration,0)}function c(t,e,r,s,a,o){s-r<=0&&(n.logger.warn("Fragment should have a positive duration",e),s=r+e.duration,o=a+e.duration);var l=r,d=s,c=e.startPTS,h=e.endPTS;if((0,i.isFiniteNumber)(c)){var f=Math.abs(c-r);(0,i.isFiniteNumber)(e.deltaPTS)?e.deltaPTS=Math.max(f,e.deltaPTS):e.deltaPTS=f,l=Math.max(r,c),r=Math.min(r,c),a=Math.min(a,e.startDTS),d=Math.min(s,h),s=Math.max(s,h),o=Math.max(o,e.endDTS)}e.duration=s-r;var p=r-e.start;e.start=e.startPTS=r,e.maxStartPTS=l,e.startDTS=a,e.endPTS=s,e.minEndPTS=d,e.endDTS=o;var v,g=e.sn;if(!t||g<t.startSN||g>t.endSN)return 0;var m=g-t.startSN,y=t.fragments;for(y[m]=e,v=m;v>0;v--)u(y[v],y[v-1]);for(v=m;v<y.length-1;v++)u(y[v],y[v+1]);return t.fragmentHint&&u(y[y.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,p}function h(t,e){for(var r=null,o=t.fragments,l=o.length-1;l>=0;l--){var d=o[l].initSegment;if(d){r=d;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var u,h,g,m,y,E=0;if(p(t,e,(function(t,n){t.relurl&&(E=t.cc-n.cc),(0,i.isFiniteNumber)(t.startPTS)&&(0,i.isFiniteNumber)(t.endPTS)&&(n.start=n.startPTS=t.startPTS,n.startDTS=t.startDTS,n.appendedPTS=t.appendedPTS,n.maxStartPTS=t.maxStartPTS,n.endPTS=t.endPTS,n.endDTS=t.endDTS,n.minEndPTS=t.minEndPTS,n.duration=t.endPTS-t.startPTS,n.duration&&(u=n),e.PTSKnown=e.alignedSliding=!0),n.elementaryStreams=t.elementaryStreams,n.loader=t.loader,n.stats=t.stats,n.urlId=t.urlId,t.initSegment&&(n.initSegment=t.initSegment,r=t.initSegment)})),r&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach((function(t){var e;t.initSegment&&t.initSegment.relurl!==(null===(e=r)||void 0===e?void 0:e.relurl)||(t.initSegment=r)})),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some((function(t){return!t})),e.deltaUpdateFailed){n.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var T=e.skippedSegments;T--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=(h=t.dateRanges,g=e.dateRanges,m=e.recentlyRemovedDateranges,y=a({},h),m&&m.forEach((function(t){delete y[t]})),Object.keys(g).forEach((function(t){var e=new s.DateRange(g[t].attr,y[t]);e.isValid?y[t]=e:n.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(g[t].attr)+'"')})),y));var S=e.fragments;if(E){n.logger.warn("discontinuity sliding from playlist, take drift into account");for(var b=0;b<S.length;b++)S[b].cc+=E}e.skippedSegments&&(e.startCC=e.fragments[0].cc),f(t.partList,e.partList,(function(t,e){e.elementaryStreams=t.elementaryStreams,e.stats=t.stats})),u?c(e,u,u.startPTS,u.endPTS,u.startDTS,u.endDTS):v(t,e),S.length&&(e.totalduration=e.edge-S[0].start),e.driftStartTime=t.driftStartTime,e.driftStart=t.driftStart;var L=e.advancedDateTime;if(e.advanced&&L){var A=e.edge;e.driftStart||(e.driftStartTime=L,e.driftStart=A),e.driftEndTime=L,e.driftEnd=A}else e.driftEndTime=t.driftEndTime,e.driftEnd=t.driftEnd,e.advancedDateTime=t.advancedDateTime}function f(t,e,r){if(t&&e)for(var i=0,n=0,s=t.length;n<=s;n++){var a=t[n],o=e[n+i];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?r(a,o):i--}}function p(t,e,r){for(var i=e.skippedSegments,n=Math.max(t.startSN,e.startSN)-e.startSN,s=(t.fragmentHint?1:0)+(i?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,a=e.startSN-t.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,d=n;d<=s;d++){var u=l[a+d],c=o[d];i&&!c&&d<i&&(c=e.fragments[d]=u),u&&c&&r(u,c)}}function v(t,e){var r=e.startSN+e.skippedSegments-t.startSN,i=t.fragments;r<0||r>=i.length||g(e,i[r].start)}function g(t,e){if(e){for(var r=t.fragments,i=t.skippedSegments;i<r.length;i++)r[i].start+=e;t.fragmentHint&&(t.fragmentHint.start+=e)}}function m(t,e){void 0===e&&(e=1/0);var r=1e3*t.targetduration;if(t.updated){var i=t.fragments;if(i.length&&4*r>e){var n=1e3*i[i.length-1].duration;n<r&&(r=n)}}else r/=2;return Math.round(r)}function y(t,e,r){if(!t||!t.details)return null;var i=t.details,n=i.fragments[e-i.startSN];return n||((n=i.fragmentHint)&&n.sn===e?n:e<i.startSN&&r&&r.sn===e?r:null)}function E(t,e,r){if(!t||!t.details)return null;var i=t.details.partList;if(i)for(var n=i.length;n--;){var s=i[n];if(s.index===r&&s.fragment.sn===e)return s}return null}},"./src/controller/stream-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>m});var i=r("./src/polyfills/number.ts"),n=r("./src/controller/base-stream-controller.ts"),s=r("./src/is-supported.ts"),a=r("./src/events.ts"),o=r("./src/utils/buffer-helper.ts"),l=r("./src/controller/fragment-tracker.ts"),d=r("./src/types/loader.ts"),u=r("./src/loader/fragment.ts"),c=r("./src/demux/transmuxer-interface.ts"),h=r("./src/types/transmuxer.ts"),f=r("./src/controller/gap-controller.ts"),p=r("./src/errors.ts");function v(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,s=void 0,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?s:String(s)),i)}var n,s}function g(t,e){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},g(t,e)}var m=function(t){var e,r;function m(e,r,i){var n;return(n=t.call(this,e,r,i,"[stream-controller]")||this).audioCodecSwap=!1,n.gapController=null,n.level=-1,n._forceStartLoad=!1,n.altAudio=!1,n.audioOnly=!1,n.fragPlaying=null,n.onvplaying=null,n.onvseeked=null,n.fragLastKbps=0,n.couldBacktrack=!1,n.backtrackFragment=null,n.audioCodecSwitch=!1,n.videoBuffer=null,n._registerListeners(),n}r=t,(e=m).prototype=Object.create(r.prototype),e.prototype.constructor=e,g(e,r);var y,E,T,S=m.prototype;return S._registerListeners=function(){var t=this.hls;t.on(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(a.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(a.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(a.Events.ERROR,this.onError,this),t.on(a.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(a.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(a.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(a.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(a.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},S._unregisterListeners=function(){var t=this.hls;t.off(a.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(a.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(a.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(a.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(a.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(a.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(a.Events.ERROR,this.onError,this),t.off(a.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(a.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(a.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(a.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(a.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(a.Events.FRAG_BUFFERED,this.onFragBuffered,this)},S.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},S.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var i=r.startLevel;-1===i&&(r.config.testBandwidth&&this.levels.length>1?(i=0,this.bitrateTest=!0):i=r.nextAutoLevel),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}e>0&&-1===t&&(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=n.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=n.State.STOPPED},S.stopLoad=function(){this._forceStartLoad=!1,t.prototype.stopLoad.call(this)},S.doTick=function(){switch(this.state){case n.State.IDLE:this.doTickIdle();break;case n.State.WAITING_LEVEL:var t,e=this.levels,r=this.level,i=null==e||null===(t=e[r])||void 0===t?void 0:t.details;if(i&&(!i.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(i))break;this.state=n.State.IDLE;break}break;case n.State.FRAG_LOADING_WAITING_RETRY:var s,a=self.performance.now(),o=this.retryDate;(!o||a>=o||null!==(s=this.media)&&void 0!==s&&s.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=n.State.IDLE)}this.onTickEnd()},S.onTickEnd=function(){t.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},S.doTickIdle=function(){var t=this.hls,e=this.levelLastLoaded,r=this.levels,i=this.media,s=t.config,o=t.nextLoadLevel;if(null!==e&&(i||!this.startFragRequested&&s.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&r&&r[o]){var c=r[o],h=this.getMainFwdBufferInfo();if(null!==h){var f=this.getLevelDetails();if(f&&this._streamEnded(h,f)){var p={};return this.altAudio&&(p.type="video"),this.hls.trigger(a.Events.BUFFER_EOS,p),void(this.state=n.State.ENDED)}this.level=t.nextLoadLevel=o;var v=c.details;if(!v||this.state===n.State.WAITING_LEVEL||v.live&&this.levelLastLoaded!==o)return this.level=o,void(this.state=n.State.WAITING_LEVEL);if(!(h.len>=this.getMaxBufferLength(c.maxBitrate))){this.backtrackFragment&&this.backtrackFragment.start>h.end&&(this.backtrackFragment=null);var g=this.backtrackFragment?this.backtrackFragment.start:h.end,m=this.getNextFragment(g,v);if(this.couldBacktrack&&!this.fragPrevious&&m&&"initSegment"!==m.sn&&this.fragmentTracker.getState(m)!==l.FragmentState.OK){var y,E=(null!=(y=this.backtrackFragment)?y:m).sn-v.startSN,T=v.fragments[E-1];T&&m.cc===T.cc&&(m=T,this.fragmentTracker.removeFragment(T))}else this.backtrackFragment&&h.len&&(this.backtrackFragment=null);if(m&&this.fragmentTracker.getState(m)===l.FragmentState.OK&&this.nextLoadPosition>g){var S=this.audioOnly&&!this.altAudio?u.ElementaryStreamTypes.AUDIO:u.ElementaryStreamTypes.VIDEO,b=(S===u.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;b&&this.afterBufferFlushed(b,S,d.PlaylistLevelType.MAIN),m=this.getNextFragment(this.nextLoadPosition,v)}m&&(!m.initSegment||m.initSegment.data||this.bitrateTest||(m=m.initSegment),this.loadFragment(m,v,g))}}}},S.loadFragment=function(e,r,i){var n,s=this.fragmentTracker.getState(e);this.fragCurrent=e,s===l.FragmentState.NOT_LOADED?"initSegment"===e.sn?this._loadInitSegment(e,r):this.bitrateTest?(this.log("Fragment "+e.sn+" of level "+e.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(e,r)):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,e,r,i)):s===l.FragmentState.APPENDING?this.reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e):0===(null===(n=this.media)||void 0===n?void 0:n.buffered.length)&&this.fragmentTracker.removeAllFragments()},S.getAppendedFrag=function(t){var e=this.fragmentTracker.getAppendedFrag(t,d.PlaylistLevelType.MAIN);return e&&"fragment"in e?e.fragment:e},S.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,d.PlaylistLevelType.MAIN)},S.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},S.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},S.nextLevelSwitch=function(){var t=this.levels,e=this.media;if(null!=e&&e.readyState){var r,i=this.getAppendedFrag(e.currentTime);if(i&&i.start>1&&this.flushMainBuffer(0,i.start-1),!e.paused&&t){var n=t[this.hls.nextLoadLevel],s=this.fragLastKbps;r=s&&this.fragCurrent?this.fragCurrent.duration*n.maxBitrate/(1e3*s)+1:0}else r=0;var a=this.getBufferedFrag(e.currentTime+r);if(a){var o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();var l=o.maxStartPTS?o.maxStartPTS:o.start,d=o.duration,u=Math.max(a.end,l+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,.5*d),.75*d));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}},S.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&t.abortRequests(),this.state){case n.State.KEY_LOADING:case n.State.FRAG_LOADING:case n.State.FRAG_LOADING_WAITING_RETRY:case n.State.PARSING:case n.State.PARSED:this.state=n.State.IDLE}this.nextLoadPosition=this.getLoadPosition()},S.flushMainBuffer=function(e,r){t.prototype.flushMainBuffer.call(this,e,r,this.altAudio?"video":null)},S.onMediaAttached=function(e,r){t.prototype.onMediaAttached.call(this,e,r);var i=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new f.default(this.config,i,this.fragmentTracker,this.hls)},S.onMediaDetaching=function(){var e=this.media;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),t.prototype.onMediaDetaching.call(this)},S.onMediaPlaying=function(){this.tick()},S.onMediaSeeked=function(){var t=this.media,e=t?t.currentTime:null;(0,i.isFiniteNumber)(e)&&this.log("Media seeked to "+e.toFixed(3)),this.tick()},S.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(a.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},S.onManifestParsed=function(t,e){var r,i=!1,n=!1;e.levels.forEach((function(t){(r=t.audioCodec)&&(-1!==r.indexOf("mp4a.40.2")&&(i=!0),-1!==r.indexOf("mp4a.40.5")&&(n=!0))})),this.audioCodecSwitch=i&&n&&!(0,s.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1},S.onLevelLoading=function(t,e){var r=this.levels;if(r&&this.state===n.State.IDLE){var i=r[e.level];(!i.details||i.details.live&&this.levelLastLoaded!==e.level||this.waitForCdnTuneIn(i.details))&&(this.state=n.State.WAITING_LEVEL)}},S.onLevelLoaded=function(t,e){var r,i=this.levels,s=e.level,o=e.details,l=o.totalduration;if(i){this.log("Level "+s+" loaded ["+o.startSN+","+o.endSN+"], cc ["+o.startCC+", "+o.endCC+"] duration:"+l);var d=this.fragCurrent;!d||this.state!==n.State.FRAG_LOADING&&this.state!==n.State.FRAG_LOADING_WAITING_RETRY||d.level!==e.level&&d.loader&&(this.state=n.State.IDLE,this.backtrackFragment=null,d.abortRequests());var u=i[s],c=0;if(o.live||null!==(r=u.details)&&void 0!==r&&r.live){if(o.fragments[0]||(o.deltaUpdateFailed=!0),o.deltaUpdateFailed)return;c=this.alignPlaylists(o,u.details)}if(u.details=o,this.levelLastLoaded=s,this.hls.trigger(a.Events.LEVEL_UPDATED,{details:o,level:s}),this.state===n.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=n.State.IDLE}this.startFragRequested?o.live&&this.synchronizeToLiveEdge(o):this.setStartPosition(o,c),this.tick()}else this.warn("Levels were reset while loading level "+s)},S._handleFragmentLoadProgress=function(t){var e,r=t.frag,i=t.part,n=t.payload,s=this.levels;if(s){var a=s[r.level],o=a.details;if(o){var l=a.videoCodec,u=o.PTSKnown||!o.live,f=null===(e=r.initSegment)||void 0===e?void 0:e.data,p=this._getAudioCodec(a),v=this.transmuxer=this.transmuxer||new c.default(this.hls,d.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=i?i.index:-1,m=-1!==g,y=new h.ChunkMetadata(r.level,r.sn,r.stats.chunkCount,n.byteLength,g,m),E=this.initPTS[r.cc];v.push(n,f,p,l,r,i,o.totalduration,u,y,E)}else this.warn("Dropping fragment "+r.sn+" of level "+r.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered")},S.onAudioTrackSwitching=function(t,e){var r=this.altAudio,i=!!e.url,n=e.id;if(!i){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var s=this.fragCurrent;s&&(this.log("Switching to main audio track, cancel main fragment load"),s.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var o=this.hls;r&&o.trigger(a.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),o.trigger(a.Events.AUDIO_TRACK_SWITCHED,{id:n})}},S.onAudioTrackSwitched=function(t,e){var r=e.id,i=!!this.hls.audioTracks[r].url;if(i){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i,this.tick()},S.onBufferCreated=function(t,e){var r,i,n=e.tracks,s=!1;for(var a in n){var o=n[a];if("main"===o.id){if(i=a,r=o,"video"===a){var l=n[a];l&&(this.videoBuffer=l.buffer)}}else s=!0}s&&r?(this.log("Alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media},S.onFragBuffered=function(t,e){var r=e.frag,i=e.part;if(!r||r.type===d.PlaylistLevelType.MAIN){if(this.fragContextChanged(r))return this.warn("Fragment "+r.sn+(i?" p: "+i.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===n.State.PARSED&&(this.state=n.State.IDLE));var s=i?i.stats:r.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,i)}},S.onError=function(t,e){if(e.type!==p.ErrorTypes.KEY_SYSTEM_ERROR)switch(e.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.FRAG_PARSING_ERROR:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(d.PlaylistLevelType.MAIN,e);break;case p.ErrorDetails.LEVEL_LOAD_ERROR:case p.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==n.State.ERROR&&(e.fatal?(this.warn(""+e.details),this.state=n.State.ERROR):e.levelRetry||this.state!==n.State.WAITING_LEVEL||(this.state=n.State.IDLE));break;case p.ErrorDetails.BUFFER_FULL_ERROR:if("main"===e.parent&&(this.state===n.State.PARSING||this.state===n.State.PARSED)){var r=!0,i=this.getFwdBufferInfo(this.media,d.PlaylistLevelType.MAIN);i&&i.len>.5&&(r=!this.reduceMaxBufferLength(i.len)),r&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}else this.onFragmentOrKeyLoadError(d.PlaylistLevelType.MAIN,e)},S.checkBuffer=function(){var t=this.media,e=this.gapController;if(t&&e&&t.readyState){if(this.loadedmetadata||!o.BufferHelper.getBuffered(t).length){var r=this.state!==n.State.IDLE?this.fragCurrent:null;e.poll(this.lastCurrentTime,r)}this.lastCurrentTime=t.currentTime}},S.onFragLoadEmergencyAborted=function(){this.state=n.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},S.onBufferFlushed=function(t,e){var r=e.type;if(r!==u.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var i=(r===u.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(i,r,d.PlaylistLevelType.MAIN)}},S.onLevelsUpdated=function(t,e){this.levels=e.levels},S.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},S.seekToStartPos=function(){var t=this.media;if(t){var e=t.currentTime,r=this.startPosition;if(r>=0&&e<r){if(t.seeking)return void this.log("could not seek to "+r+", already seeking at "+e);var i=o.BufferHelper.getBuffered(t),n=(i.length?i.start(0):0)-r;n>0&&(n<this.config.maxBufferHole||n<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+n+" to match buffer start"),r+=n,this.startPosition=r),this.log("seek to target start position "+r+" from current time "+e),t.currentTime=r}}},S._getAudioCodec=function(t){var e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),e},S._loadBitrateTestFrag=function(t,e){var r=this;t.bitrateTest=!0,this._doFragLoad(t,e).then((function(e){var i=r.hls;if(e&&!r.fragContextChanged(t)){r.fragLoadError=0,r.state=n.State.IDLE,r.startFragRequested=!1,r.bitrateTest=!1;var s=t.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),i.trigger(a.Events.FRAG_LOADED,e),t.bitrateTest=!1}}))},S._handleTransmuxComplete=function(t){var e,r="main",s=this.hls,o=t.remuxResult,l=t.chunkMeta,d=this.getCurrentContext(l);if(!d)return this.warn("The loading context changed while buffering fragment "+l.sn+" of level "+l.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(l.level);var c=d.frag,h=d.part,f=d.level,p=o.video,v=o.text,g=o.id3,m=o.initSegment,y=f.details,E=this.altAudio?void 0:o.audio;if(!this.fragContextChanged(c)){if(this.state=n.State.PARSING,m){m.tracks&&(this._bufferInitSegment(f,m.tracks,c,l),s.trigger(a.Events.FRAG_PARSING_INIT_SEGMENT,{frag:c,id:r,tracks:m.tracks}));var T=m.initPTS,S=m.timescale;(0,i.isFiniteNumber)(T)&&(this.initPTS[c.cc]=T,s.trigger(a.Events.INIT_PTS_FOUND,{frag:c,id:r,initPTS:T,timescale:S}))}if(p&&!1!==o.independent){if(y){var b=p.startPTS,L=p.endPTS,A=p.startDTS,_=p.endDTS;if(h)h.elementaryStreams[p.type]={startPTS:b,endPTS:L,startDTS:A,endDTS:_};else if(p.firstKeyFrame&&p.independent&&1===l.id&&(this.couldBacktrack=!0),p.dropped&&p.independent){var I=this.getMainFwdBufferInfo();if((I?I.end:this.getLoadPosition())+this.config.maxBufferHole<(p.firstKeyFramePTS?p.firstKeyFramePTS:b)-this.config.maxBufferHole)return void this.backtrack(c);c.setElementaryStreamInfo(p.type,c.start,L,c.start,_,!0)}c.setElementaryStreamInfo(p.type,b,L,A,_),this.backtrackFragment&&(this.backtrackFragment=c),this.bufferFragmentData(p,c,h,l)}}else if(!1===o.independent)return void this.backtrack(c);if(E){var D=E.startPTS,k=E.endPTS,w=E.startDTS,C=E.endDTS;h&&(h.elementaryStreams[u.ElementaryStreamTypes.AUDIO]={startPTS:D,endPTS:k,startDTS:w,endDTS:C}),c.setElementaryStreamInfo(u.ElementaryStreamTypes.AUDIO,D,k,w,C),this.bufferFragmentData(E,c,h,l)}if(y&&null!=g&&null!==(e=g.samples)&&void 0!==e&&e.length){var R={id:r,frag:c,details:y,samples:g.samples};s.trigger(a.Events.FRAG_PARSING_METADATA,R)}if(y&&v){var M={id:r,frag:c,details:y,samples:v.samples};s.trigger(a.Events.FRAG_PARSING_USERDATA,M)}}},S._bufferInitSegment=function(t,e,r,i){var s=this;if(this.state===n.State.PARSING){this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&delete e.audio;var o=e.audio,l=e.video,d=e.audiovideo;if(o){var u=t.audioCodec,c=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(u&&(u=-1!==u.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==o.metadata.channelCount&&-1===c.indexOf("firefox")&&(u="mp4a.40.5")),-1!==c.indexOf("android")&&"audio/mpeg"!==o.container&&(u="mp4a.40.2",this.log("Android: force audio codec to "+u)),t.audioCodec&&t.audioCodec!==u&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+u+'"'),o.levelCodec=u,o.id="main",this.log("Init audio buffer, container:"+o.container+", codecs[selected/level/parsed]=["+(u||"")+"/"+(t.audioCodec||"")+"/"+o.codec+"]")}l&&(l.levelCodec=t.videoCodec,l.id="main",this.log("Init video buffer, container:"+l.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+l.codec+"]")),d&&this.log("Init audiovideo buffer, container:"+d.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+d.codec+"]"),this.hls.trigger(a.Events.BUFFER_CODECS,e),Object.keys(e).forEach((function(t){var n=e[t].initSegment;null!=n&&n.byteLength&&s.hls.trigger(a.Events.BUFFER_APPENDING,{type:t,data:n,frag:r,part:null,chunkMeta:i,parent:r.type})})),this.tick()}},S.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,d.PlaylistLevelType.MAIN)},S.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=n.State.IDLE},S.checkFragmentChanged=function(){var t=this.media,e=null;if(t&&t.readyState>1&&!1===t.seeking){var r=t.currentTime;if(o.BufferHelper.isBuffered(t,r)?e=this.getAppendedFrag(r):o.BufferHelper.isBuffered(t,r+.1)&&(e=this.getAppendedFrag(r+.1)),e){this.backtrackFragment=null;var i=this.fragPlaying,n=e.level;i&&e.sn===i.sn&&i.level===n&&e.urlId===i.urlId||(this.fragPlaying=e,this.hls.trigger(a.Events.FRAG_CHANGED,{frag:e}),i&&i.level===n||this.hls.trigger(a.Events.LEVEL_SWITCHED,{level:n}))}}},y=m,(E=[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var e=t.currentTime,r=this.currentFrag;if(r&&(0,i.isFiniteNumber)(e)&&(0,i.isFiniteNumber)(r.programDateTime)){var n=r.programDateTime+1e3*(e-r.start);return new Date(n)}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&v(y.prototype,E),T&&v(y,T),Object.defineProperty(y,"prototype",{writable:!1}),m}(n.default)},"./src/controller/subtitle-stream-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{SubtitleStreamController:()=>p});var i=r("./src/events.ts"),n=r("./src/utils/buffer-helper.ts"),s=r("./src/controller/fragment-finders.ts"),a=r("./src/utils/discontinuities.ts"),o=r("./src/controller/level-helper.ts"),l=r("./src/controller/fragment-tracker.ts"),d=r("./src/controller/base-stream-controller.ts"),u=r("./src/types/loader.ts"),c=r("./src/types/level.ts");function h(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,s=void 0,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?s:String(s)),i)}var n,s}function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(t,e)}var p=function(t){var e,r;function p(e,r,i){var n;return(n=t.call(this,e,r,i,"[subtitle-stream-controller]")||this).levels=[],n.currentTrackId=-1,n.tracksBuffered=[],n.mainDetails=null,n._registerListeners(),n}r=t,(e=p).prototype=Object.create(r.prototype),e.prototype.constructor=e,f(e,r);var g,m,y,E=p.prototype;return E.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},E._registerListeners=function(){var t=this.hls;t.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(i.Events.ERROR,this.onError,this),t.on(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(i.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(i.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(i.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(i.Events.FRAG_BUFFERED,this.onFragBuffered,this)},E._unregisterListeners=function(){var t=this.hls;t.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(i.Events.ERROR,this.onError,this),t.off(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(i.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(i.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(i.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(i.Events.FRAG_BUFFERED,this.onFragBuffered,this)},E.startLoad=function(t){this.stopLoad(),this.state=d.State.IDLE,this.setInterval(500),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},E.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},E.onLevelLoaded=function(t,e){this.mainDetails=e.details},E.onSubtitleFragProcessed=function(t,e){var r=e.frag,i=e.success;if(this.fragPrevious=r,this.state=d.State.IDLE,i){var n=this.tracksBuffered[this.currentTrackId];if(n){for(var s,a=r.start,o=0;o<n.length;o++)if(a>=n[o].start&&a<=n[o].end){s=n[o];break}var l=r.start+r.duration;s?s.end=l:(s={start:a,end:l},n.push(s)),this.fragmentTracker.fragBuffered(r)}}},E.onBufferFlushing=function(t,e){var r=e.startOffset,i=e.endOffset;if(0===r&&i!==Number.POSITIVE_INFINITY){var n=this.currentTrackId,s=this.levels;if(!s.length||!s[n]||!s[n].details)return;var a=i-s[n].details.targetduration;if(a<=0)return;e.endOffsetSubtitles=Math.max(0,a),this.tracksBuffered.forEach((function(t){for(var e=0;e<t.length;)if(t[e].end<=a)t.shift();else{if(!(t[e].start<a))break;t[e].start=a,e++}})),this.fragmentTracker.removeFragmentsInRange(r,a,u.PlaylistLevelType.SUBTITLE)}},E.onFragBuffered=function(t,e){var r;this.loadedmetadata||e.frag.type!==u.PlaylistLevelType.MAIN||null!==(r=this.media)&&void 0!==r&&r.buffered.length&&(this.loadedmetadata=!0)},E.onError=function(t,e){var r=e.frag;r&&r.type===u.PlaylistLevelType.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=d.State.IDLE)},E.onSubtitleTracksUpdated=function(t,e){var r=this,i=e.subtitleTracks;this.tracksBuffered=[],this.levels=i.map((function(t){return new c.Level(t)})),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach((function(t){r.tracksBuffered[t.id]=[]})),this.mediaBuffer=null},E.onSubtitleTrackSwitch=function(t,e){if(this.currentTrackId=e.id,this.levels.length&&-1!==this.currentTrackId){var r=this.levels[this.currentTrackId];null!=r&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.setInterval(500)}else this.clearInterval()},E.onSubtitleTrackLoaded=function(t,e){var r,i=e.details,n=e.id,l=this.currentTrackId,u=this.levels;if(u.length){var c=u[l];if(!(n>=u.length||n!==l)&&c){this.mediaBuffer=this.mediaBufferTimeRanges;var h=0;if(i.live||null!==(r=c.details)&&void 0!==r&&r.live){var f=this.mainDetails;if(i.deltaUpdateFailed||!f)return;var p=f.fragments[0];c.details?0===(h=this.alignPlaylists(i,c.details))&&p&&(h=p.start,(0,o.addSliding)(i,h)):i.hasProgramDateTime&&f.hasProgramDateTime?((0,a.alignMediaPlaylistByPDT)(i,f),h=i.fragments[0].start):p&&(h=p.start,(0,o.addSliding)(i,h))}c.details=i,this.levelLastLoaded=n,this.startFragRequested||!this.mainDetails&&i.live||this.setStartPosition(c.details,h),this.tick(),i.live&&!this.fragCurrent&&this.media&&this.state===d.State.IDLE&&((0,s.findFragmentByPTS)(null,i.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),c.details=void 0))}}},E._handleFragmentLoadComplete=function(t){var e=this,r=t.frag,n=t.payload,s=r.decryptdata,a=this.hls;if(!this.fragContextChanged(r)&&n&&n.byteLength>0&&s&&s.key&&s.iv&&"AES-128"===s.method){var o=performance.now();this.decrypter.decrypt(new Uint8Array(n),s.key.buffer,s.iv.buffer).then((function(t){var e=performance.now();a.trigger(i.Events.FRAG_DECRYPTED,{frag:r,payload:t,stats:{tstart:o,tdecrypt:e}})})).catch((function(t){e.warn(t.name+": "+t.message),e.state=d.State.IDLE}))}},E.doTick=function(){if(this.media){if(this.state===d.State.IDLE){var t=this.currentTrackId,e=this.levels;if(!e.length||!e[t]||!e[t].details)return;var r=e[t].details,i=r.targetduration,a=this.config,o=this.getLoadPosition(),c=n.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],o-i,a.maxBufferHole),h=c.end,f=c.len,p=this.getFwdBufferInfo(this.media,u.PlaylistLevelType.MAIN);if(f>this.getMaxBufferLength(null==p?void 0:p.len)+i)return;var v=r.fragments,g=v.length,m=r.edge,y=null,E=this.fragPrevious;if(h<m){var T=a.maxFragLookUpTolerance;!(y=(0,s.findFragmentByPTS)(E,v,Math.max(v[0].start,h),T))&&E&&E.start<v[0].start&&(y=v[0])}else y=v[g-1];if(!y)return;y=this.mapToInitFragWhenRequired(y),this.fragmentTracker.getState(y)===l.FragmentState.NOT_LOADED&&this.loadFragment(y,r,h)}}else this.state=d.State.IDLE},E.getMaxBufferLength=function(e){var r=t.prototype.getMaxBufferLength.call(this);return e?Math.max(r,e):r},E.loadFragment=function(e,r,i){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e,r):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,e,r,i))},g=p,(m=[{key:"mediaBufferTimeRanges",get:function(){return new v(this.tracksBuffered[this.currentTrackId]||[])}}])&&h(g.prototype,m),y&&h(g,y),Object.defineProperty(g,"prototype",{writable:!1}),p}(d.default),v=function(t){this.buffered=void 0;var e=function(e,r,i){if((r>>>=0)>i-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+r+") is greater than the maximum bound ("+i+")");return t[r][e]};this.buffered={get length(){return t.length},end:function(r){return e("end",r,t.length)},start:function(r){return e("start",r,t.length)}}}},"./src/controller/subtitle-track-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>u});var i=r("./src/events.ts"),n=r("./src/utils/texttrack-utils.ts"),s=r("./src/controller/base-playlist-controller.ts"),a=r("./src/types/loader.ts");function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,s=void 0,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?s:String(s)),i)}var n,s}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}function d(t){for(var e=[],r=0;r<t.length;r++){var i=t[r];"subtitles"!==i.kind&&"captions"!==i.kind||!i.label||e.push(t[r])}return e}const u=function(t){var e,r;function s(e){var r;return(r=t.call(this,e,"[subtitle-track-controller]")||this).media=null,r.tracks=[],r.groupId=null,r.tracksInGroup=[],r.trackId=-1,r.selectDefaultTrack=!0,r.queuedDefaultTrack=-1,r.trackChangeListener=function(){return r.onTextTracksChanged()},r.asyncPollTrackChange=function(){return r.pollTrackChange(0)},r.useTextTrackPolling=!1,r.subtitlePollingInterval=-1,r._subtitleDisplay=!0,r.registerListeners(),r}r=t,(e=s).prototype=Object.create(r.prototype),e.prototype.constructor=e,l(e,r);var u,c,h,f=s.prototype;return f.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,t.prototype.destroy.call(this)},f.registerListeners=function(){var t=this.hls;t.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(i.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(i.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(i.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(i.Events.ERROR,this.onError,this)},f.unregisterListeners=function(){var t=this.hls;t.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(i.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(i.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(i.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(i.Events.ERROR,this.onError,this)},f.onMediaAttached=function(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},f.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},f.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),d(this.media.textTracks).forEach((function(t){(0,n.clearCurrentCues)(t)})),this.subtitleTrack=-1,this.media=null)},f.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},f.onManifestParsed=function(t,e){this.tracks=e.subtitleTracks},f.onSubtitleTrackLoaded=function(t,e){var r=e.id,i=e.details,n=this.trackId,s=this.tracksInGroup[n];if(s){var a=s.details;s.details=e.details,this.log("subtitle track "+r+" loaded ["+i.startSN+"-"+i.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,e,a))}else this.warn("Invalid subtitle track id "+r)},f.onLevelLoading=function(t,e){this.switchLevel(e.level)},f.onLevelSwitching=function(t,e){this.switchLevel(e.level)},f.switchLevel=function(t){var e=this.hls.levels[t];if(null!=e&&e.textGroupIds){var r=e.textGroupIds[e.urlId];if(this.groupId!==r){var n=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,s=this.tracks.filter((function(t){return!r||t.groupId===r}));this.tracksInGroup=s;var a=this.findTrackId(null==n?void 0:n.name)||this.findTrackId();this.groupId=r;var o={subtitleTracks:s};this.log("Updating subtitle tracks, "+s.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(i.Events.SUBTITLE_TRACKS_UPDATED,o),-1!==a&&this.setSubtitleTrack(a,n)}}},f.findTrackId=function(t){for(var e=this.tracksInGroup,r=0;r<e.length;r++){var i=e[r];if((!this.selectDefaultTrack||i.default)&&(!t||t===i.name))return i.id}return-1},f.onError=function(e,r){t.prototype.onError.call(this,e,r),!r.fatal&&r.context&&r.context.type===a.PlaylistContextType.SUBTITLE_TRACK&&r.context.id===this.trackId&&r.context.groupId===this.groupId&&this.retryLoadingOrFail(r)},f.loadPlaylist=function(e){t.prototype.loadPlaylist.call(this);var r=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(r)){var n=r.id,s=r.groupId,a=r.url;if(e)try{a=e.addDirectives(a)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Loading subtitle playlist for id "+n),this.hls.trigger(i.Events.SUBTITLE_TRACK_LOADING,{url:a,id:n,groupId:s,deliveryDirectives:e||null})}},f.toggleTrackModes=function(t){var e=this,r=this.media,i=this.trackId;if(r){var n=d(r.textTracks),s=n.filter((function(t){return t.groupId===e.groupId}));if(-1===t)[].slice.call(n).forEach((function(t){t.mode="disabled"}));else{var a=s[i];a&&(a.mode="disabled")}var o=s[t];o&&(o.mode=this.subtitleDisplay?"showing":"hidden")}},f.setSubtitleTrack=function(t,e){var r,n=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(-1===t||null!==(r=n[t])&&void 0!==r&&r.details)||t<-1||t>=n.length)){this.clearTimer();var s=n[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,s){var a=s.id,o=s.groupId,l=void 0===o?"":o,d=s.name,u=s.type,c=s.url;this.hls.trigger(i.Events.SUBTITLE_TRACK_SWITCH,{id:a,groupId:l,name:d,type:u,url:c});var h=this.switchParams(s.url,null==e?void 0:e.details);this.loadPlaylist(h)}else this.hls.trigger(i.Events.SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},f.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,e=d(this.media.textTracks),r=0;r<e.length;r++)if("hidden"===e[r].mode)t=r;else if("showing"===e[r].mode){t=r;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},u=s,(c=[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,e)}}])&&o(u.prototype,c),h&&o(u,h),Object.defineProperty(u,"prototype",{writable:!1}),s}(s.default)},"./src/controller/timeline-controller.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{TimelineController:()=>f});var i=r("./src/polyfills/number.ts"),n=r("./src/events.ts"),s=r("./src/utils/cea-608-parser.ts"),a=r("./src/utils/output-filter.ts"),o=r("./src/utils/webvtt-parser.ts"),l=r("./src/utils/texttrack-utils.ts"),d=r("./src/utils/imsc1-ttml-parser.ts"),u=r("./src/utils/mp4-tools.ts"),c=r("./src/types/loader.ts"),h=r("./src/utils/logger.ts"),f=function(){function t(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var e=new a.default(this,"textTrack1"),r=new a.default(this,"textTrack2"),i=new a.default(this,"textTrack3"),o=new a.default(this,"textTrack4");this.cea608Parser1=new s.default(1,e,r),this.cea608Parser2=new s.default(3,i,o)}t.on(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(n.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(n.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(n.Events.FRAG_LOADING,this.onFragLoading,this),t.on(n.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(n.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(n.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(n.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(n.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=t.prototype;return e.destroy=function(){var t=this.hls;t.off(n.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(n.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(n.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(n.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(n.Events.FRAG_LOADING,this.onFragLoading,this),t.off(n.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(n.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(n.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(n.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(n.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(n.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},e.addCues=function(t,e,r,i,s){for(var a,o,l,d,u=!1,c=s.length;c--;){var h=s[c],f=(a=h[0],o=h[1],l=e,d=r,Math.min(o,d)-Math.max(a,l));if(f>=0&&(h[0]=Math.min(h[0],e),h[1]=Math.max(h[1],r),u=!0,f/(r-e)>.5))return}if(u||s.push([e,r]),this.config.renderTextTracksNatively){var p=this.captionsTracks[t];this.Cues.newCue(p,e,r,i)}else{var v=this.Cues.newCue(null,e,r,i);this.hls.trigger(n.Events.CUES_PARSED,{type:"captions",cues:v,track:t})}},e.onInitPtsFound=function(t,e){var r=this,i=e.frag,s=e.id,a=e.initPTS,o=e.timescale,l=this.unparsedVttFrags;"main"===s&&(this.initPTS[i.cc]=a,this.timescale[i.cc]=o),l.length&&(this.unparsedVttFrags=[],l.forEach((function(t){r.onFragLoaded(n.Events.FRAG_LOADED,t)})))},e.getExistingTrack=function(t){var e=this.media;if(e)for(var r=0;r<e.textTracks.length;r++){var i=e.textTracks[r];if(i[t])return i}return null},e.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},e.createNativeTrack=function(t){if(!this.captionsTracks[t]){var e=this.captionsProperties,r=this.captionsTracks,i=this.media,n=e[t],s=n.label,a=n.languageCode,o=this.getExistingTrack(t);if(o)r[t]=o,(0,l.clearCurrentCues)(r[t]),(0,l.sendAddTrackEvent)(r[t],i);else{var d=this.createTextTrack("captions",s,a);d&&(d[t]=!0,r[t]=d)}}},e.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var e=this.captionsProperties[t];if(e){var r={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=r,this.hls.trigger(n.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}},e.createTextTrack=function(t,e,r){var i=this.media;if(i)return i.addTextTrack(t,e,r)},e.onMediaAttaching=function(t,e){this.media=e.media,this._cleanTracks()},e.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach((function(e){(0,l.clearCurrentCues)(t[e]),delete t[e]})),this.nonNativeCaptionsTracks={}},e.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var r=0;r<e.length;r++)(0,l.clearCurrentCues)(e[r])}},e.onSubtitleTracksUpdated=function(t,e){var r=this;this.textTracks=[];var i=e.subtitleTracks||[],s=i.some((function(t){return t.textCodec===d.IMSC1_CODEC}));if(this.config.enableWebVTT||s&&this.config.enableIMSC1){var a=this.tracks&&i&&this.tracks.length===i.length;if(this.tracks=i||[],this.config.renderTextTracksNatively){var o=this.media?this.media.textTracks:[];this.tracks.forEach((function(t,e){var i;if(e<o.length){for(var n=null,s=0;s<o.length;s++)if(p(o[s],t)){n=o[s];break}n&&(i=n)}if(i)(0,l.clearCurrentCues)(i);else{var a=r._captionsOrSubtitlesFromCharacteristics(t);(i=r.createTextTrack(a,t.name,t.lang))&&(i.mode="disabled")}i&&(i.groupId=t.groupId,r.textTracks.push(i))}))}else if(!a&&this.tracks&&this.tracks.length){var u=this.tracks.map((function(t){return{label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}}));this.hls.trigger(n.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}},e._captionsOrSubtitlesFromCharacteristics=function(t){var e;if(null!==(e=t.attrs)&&void 0!==e&&e.CHARACTERISTICS){var r=/transcribes-spoken-dialog/gi.test(t.attrs.CHARACTERISTICS),i=/describes-music-and-sound/gi.test(t.attrs.CHARACTERISTICS);if(r&&i)return"captions"}return"subtitles"},e.onManifestLoaded=function(t,e){var r=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach((function(t){var e=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);if(e){var i="textTrack"+e[1],n=r.captionsProperties[i];n&&(n.label=t.name,t.lang&&(n.languageCode=t.lang),n.media=t)}}))},e.closedCaptionsForLevel=function(t){var e=this.hls.levels[t.level];return null==e?void 0:e.attrs["CLOSED-CAPTIONS"]},e.onFragLoading=function(t,e){var r=this.cea608Parser1,i=this.cea608Parser2,n=this.lastSn,s=this.lastPartIndex;if(this.enabled&&r&&i&&e.frag.type===c.PlaylistLevelType.MAIN){var a,o,l=e.frag.sn,d=null!=(a=null==e||null===(o=e.part)||void 0===o?void 0:o.index)?a:-1;l===n+1||l===n&&d===s+1||(r.reset(),i.reset()),this.lastSn=l,this.lastPartIndex=d}},e.onFragLoaded=function(t,e){var r=e.frag,s=e.payload,a=this.initPTS,o=this.unparsedVttFrags;if(r.type===c.PlaylistLevelType.SUBTITLE)if(s.byteLength){if(!(0,i.isFiniteNumber)(a[r.cc]))return o.push(e),void(a.length&&this.hls.trigger(n.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Missing initial subtitle PTS")}));var l=r.decryptdata,u="stats"in e;if(null==l||!l.encrypted||u){var h=this.tracks[r.level],f=this.vttCCs;f[r.cc]||(f[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),h&&h.textCodec===d.IMSC1_CODEC?this._parseIMSC1(r,s):this._parseVTTs(r,s,f)}}else this.hls.trigger(n.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})},e._parseIMSC1=function(t,e){var r=this,i=this.hls;(0,d.parseIMSC1)(e,this.initPTS[t.cc],this.timescale[t.cc],(function(e){r._appendCues(e,t.level),i.trigger(n.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(e){h.logger.log("Failed to parse IMSC1: "+e),i.trigger(n.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:e})}))},e._parseVTTs=function(t,e,r){var i,s=this,a=this.hls,l=null!==(i=t.initSegment)&&void 0!==i&&i.data?(0,u.appendUint8Array)(t.initSegment.data,new Uint8Array(e)):e;(0,o.parseWebVTT)(l,this.initPTS[t.cc],this.timescale[t.cc],r,t.cc,t.start,(function(e){s._appendCues(e,t.level),a.trigger(n.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(r){s._fallbackToIMSC1(t,e),h.logger.log("Failed to parse VTT cue: "+r),a.trigger(n.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:r})}))},e._fallbackToIMSC1=function(t,e){var r=this,i=this.tracks[t.level];i.textCodec||(0,d.parseIMSC1)(e,this.initPTS[t.cc],this.timescale[t.cc],(function(){i.textCodec=d.IMSC1_CODEC,r._parseIMSC1(t,e)}),(function(){i.textCodec="wvtt"}))},e._appendCues=function(t,e){var r=this.hls;if(this.config.renderTextTracksNatively){var i=this.textTracks[e];if(!i||"disabled"===i.mode)return;t.forEach((function(t){return(0,l.addCueToTrack)(i,t)}))}else{var s=this.tracks[e];if(!s)return;var a=s.default?"default":"subtitles"+e;r.trigger(n.Events.CUES_PARSED,{type:"subtitles",cues:t,track:a})}},e.onFragDecrypted=function(t,e){var r=e.frag;if(r.type===c.PlaylistLevelType.SUBTITLE){if(!(0,i.isFiniteNumber)(this.initPTS[r.cc]))return void this.unparsedVttFrags.push(e);this.onFragLoaded(n.Events.FRAG_LOADED,e)}},e.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},e.onFragParsingUserdata=function(t,e){var r=this.cea608Parser1,i=this.cea608Parser2;if(this.enabled&&r&&i){var n=e.frag,s=e.samples;if(n.type!==c.PlaylistLevelType.MAIN||"NONE"!==this.closedCaptionsForLevel(n))for(var a=0;a<s.length;a++){var o=s[a].bytes;if(o){var l=this.extractCea608Data(o);r.addData(s[a].pts,l[0]),i.addData(s[a].pts,l[1])}}}},e.onBufferFlushing=function(t,e){var r=e.startOffset,i=e.endOffset,n=e.endOffsetSubtitles,s=e.type,a=this.media;if(a&&!(a.currentTime<i)){if(!s||"video"===s){var o=this.captionsTracks;Object.keys(o).forEach((function(t){return(0,l.removeCuesInRange)(o[t],r,i)}))}if(this.config.renderTextTracksNatively&&0===r&&void 0!==n){var d=this.textTracks;Object.keys(d).forEach((function(t){return(0,l.removeCuesInRange)(d[t],r,n)}))}}},e.extractCea608Data=function(t){for(var e=[[],[]],r=31&t[0],i=2,n=0;n<r;n++){var s=t[i++],a=127&t[i++],o=127&t[i++];if((0!==a||0!==o)&&0!=(4&s)){var l=3&s;0!==l&&1!==l||(e[l].push(a),e[l].push(o))}}return e},t}();function p(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}},"./src/crypt/aes-crypto.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>i});var i=function(){function t(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}return t.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}()},"./src/crypt/aes-decryptor.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>s,removePadding:()=>n});var i=r("./src/utils/typed-array.ts");function n(t){var e=t.byteLength,r=e&&new DataView(t.buffer).getUint8(e-1);return r?(0,i.sliceUint8)(t,0,e-r):t}var s=function(){function t(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var e=t.prototype;return e.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),r=new Uint32Array(4),i=0;i<4;i++)r[i]=e.getUint32(4*i);return r},e.initTable=function(){var t=this.sBox,e=this.invSBox,r=this.subMix,i=r[0],n=r[1],s=r[2],a=r[3],o=this.invSubMix,l=o[0],d=o[1],u=o[2],c=o[3],h=new Uint32Array(256),f=0,p=0,v=0;for(v=0;v<256;v++)h[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var g=p^p<<1^p<<2^p<<3^p<<4;g=g>>>8^255&g^99,t[f]=g,e[g]=f;var m=h[f],y=h[m],E=h[y],T=257*h[g]^16843008*g;i[f]=T<<24|T>>>8,n[f]=T<<16|T>>>16,s[f]=T<<8|T>>>24,a[f]=T,T=16843009*E^65537*y^257*m^16843008*f,l[g]=T<<24|T>>>8,d[g]=T<<16|T>>>16,u[g]=T<<8|T>>>24,c[g]=T,f?(f=m^h[h[h[E^m]]],p^=h[h[p]]):f=p=1}},e.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),r=!0,i=0;i<e.length&&r;)r=e[i]===this.key[i],i++;if(!r){this.key=e;var n=this.keySize=e.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var s,a,o,l,d=this.ksRows=4*(n+6+1),u=this.keySchedule=new Uint32Array(d),c=this.invKeySchedule=new Uint32Array(d),h=this.sBox,f=this.rcon,p=this.invSubMix,v=p[0],g=p[1],m=p[2],y=p[3];for(s=0;s<d;s++)s<n?o=u[s]=e[s]:(l=o,s%n==0?(l=h[(l=l<<8|l>>>24)>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l],l^=f[s/n|0]<<24):n>6&&s%n==4&&(l=h[l>>>24]<<24|h[l>>>16&255]<<16|h[l>>>8&255]<<8|h[255&l]),u[s]=o=(u[s-n]^l)>>>0);for(a=0;a<d;a++)s=d-a,l=3&a?u[s]:u[s-4],c[a]=a<4||s<=4?l:v[h[l>>>24]]^g[h[l>>>16&255]]^m[h[l>>>8&255]]^y[h[255&l]],c[a]=c[a]>>>0}},e.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},e.decrypt=function(t,e,r){for(var i,n,s,a,o,l,d,u,c,h,f,p,v,g,m=this.keySize+6,y=this.invKeySchedule,E=this.invSBox,T=this.invSubMix,S=T[0],b=T[1],L=T[2],A=T[3],_=this.uint8ArrayToUint32Array_(r),I=_[0],D=_[1],k=_[2],w=_[3],C=new Int32Array(t),R=new Int32Array(C.length),M=this.networkToHostOrderSwap;e<C.length;){for(c=M(C[e]),h=M(C[e+1]),f=M(C[e+2]),p=M(C[e+3]),o=c^y[0],l=p^y[1],d=f^y[2],u=h^y[3],v=4,g=1;g<m;g++)i=S[o>>>24]^b[l>>16&255]^L[d>>8&255]^A[255&u]^y[v],n=S[l>>>24]^b[d>>16&255]^L[u>>8&255]^A[255&o]^y[v+1],s=S[d>>>24]^b[u>>16&255]^L[o>>8&255]^A[255&l]^y[v+2],a=S[u>>>24]^b[o>>16&255]^L[l>>8&255]^A[255&d]^y[v+3],o=i,l=n,d=s,u=a,v+=4;i=E[o>>>24]<<24^E[l>>16&255]<<16^E[d>>8&255]<<8^E[255&u]^y[v],n=E[l>>>24]<<24^E[d>>16&255]<<16^E[u>>8&255]<<8^E[255&o]^y[v+1],s=E[d>>>24]<<24^E[u>>16&255]<<16^E[o>>8&255]<<8^E[255&l]^y[v+2],a=E[u>>>24]<<24^E[o>>16&255]<<16^E[l>>8&255]<<8^E[255&d]^y[v+3],R[e]=M(i^I),R[e+1]=M(a^D),R[e+2]=M(s^k),R[e+3]=M(n^w),I=c,D=h,k=f,w=p,e+=4}return R.buffer},t}()},"./src/crypt/decrypter.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>d});var i=r("./src/crypt/aes-crypto.ts"),n=r("./src/crypt/fast-aes-key.ts"),s=r("./src/crypt/aes-decryptor.ts"),a=r("./src/utils/logger.ts"),o=r("./src/utils/mp4-tools.ts"),l=r("./src/utils/typed-array.ts"),d=function(){function t(t,e){var r=(void 0===e?{}:e).removePKCS7Padding,i=void 0===r||r;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=t.enableSoftwareAES,this.removePKCS7Padding=i,i)try{var n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch(t){}null===this.subtle&&(this.useSoftware=!0)}var e=t.prototype;return e.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},e.isSync=function(){return this.useSoftware},e.flush=function(){var t=this.currentResult,e=this.remainderData;if(!t||e)return this.reset(),null;var r=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?(0,s.removePadding)(r):r},e.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},e.decrypt=function(t,e,r){var i=this;return this.useSoftware?new Promise((function(n,s){i.softwareDecrypt(new Uint8Array(t),e,r);var a=i.flush();a?n(a.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(t),e,r)},e.softwareDecrypt=function(t,e,r){var i=this.currentIV,n=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(t=(0,o.appendUint8Array)(a,t),this.remainderData=null);var d=this.getValidChunk(t);if(!d.length)return null;i&&(r=i);var u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new s.default),u.expandKey(e);var c=n;return this.currentResult=u.decrypt(d.buffer,0,r),this.currentIV=(0,l.sliceUint8)(d,-16).buffer,c||null},e.webCryptoDecrypt=function(t,e,r){var s=this,o=this.subtle;return this.key===e&&this.fastAesKey||(this.key=e,this.fastAesKey=new n.default(o,e)),this.fastAesKey.expandKey().then((function(e){return o?(s.logOnce("WebCrypto AES decrypt"),new i.default(o,new Uint8Array(r)).decrypt(t.buffer,e)):Promise.reject(new Error("web crypto not initialized"))})).catch((function(i){return a.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+i.name+": "+i.message),s.onWebCryptoError(t,e,r)}))},e.onWebCryptoError=function(t,e,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(t,e,r);var i=this.flush();if(i)return i.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},e.getValidChunk=function(t){var e=t,r=t.length-t.length%16;return r!==t.length&&(e=(0,l.sliceUint8)(t,0,r),this.remainderData=(0,l.sliceUint8)(t,r)),e},e.logOnce=function(t){this.logEnabled&&(a.logger.log("[decrypter]: "+t),this.logEnabled=!1)},t}()},"./src/crypt/fast-aes-key.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>i});var i=function(){function t(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}()},"./src/demux/aacdemuxer.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>l});var i=r("./src/demux/base-audio-demuxer.ts"),n=r("./src/demux/adts.ts"),s=r("./src/utils/logger.ts"),a=r("./src/demux/id3.ts");function o(t,e){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},o(t,e)}const l=function(t){var e,r;function i(e,r){var i;return(i=t.call(this)||this).observer=void 0,i.config=void 0,i.observer=e,i.config=r,i}r=t,(e=i).prototype=Object.create(r.prototype),e.prototype.constructor=e,o(e,r);var l=i.prototype;return l.resetInitSegment=function(e,r,i,n){t.prototype.resetInitSegment.call(this,e,r,i,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:r,duration:n,inputTimeScale:9e4,dropped:0}},i.probe=function(t){if(!t)return!1;for(var e=(a.getID3Data(t,0)||[]).length,r=t.length;e<r;e++)if(n.probe(t,e))return s.logger.log("ADTS sync word found !"),!0;return!1},l.canParse=function(t,e){return n.canParse(t,e)},l.appendFrame=function(t,e,r){n.initTrackConfig(t,this.observer,e,r,t.manifestCodec);var i=n.appendFrame(t,e,r,this.basePTS,this.frameIndex);if(i&&0===i.missing)return i},i}(i.default)},"./src/demux/adts.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{appendFrame:()=>m,canGetFrameLength:()=>u,canParse:()=>h,getAudioConfig:()=>a,getFrameDuration:()=>v,getFullFrameLength:()=>d,getHeaderLength:()=>l,initTrackConfig:()=>p,isHeader:()=>c,isHeaderPattern:()=>o,parseFrameHeader:()=>g,probe:()=>f});var i=r("./src/utils/logger.ts"),n=r("./src/errors.ts"),s=r("./src/events.ts");function a(t,e,r,a){var o,l,d,u,c=navigator.userAgent.toLowerCase(),h=a,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];o=1+((192&e[r+2])>>>6);var p=(60&e[r+2])>>>2;if(!(p>f.length-1))return d=(1&e[r+2])<<2,d|=(192&e[r+3])>>>6,i.logger.log("manifest codec:"+a+", ADTS type:"+o+", samplingIndex:"+p),/firefox/i.test(c)?p>=6?(o=5,u=new Array(4),l=p-3):(o=2,u=new Array(2),l=p):-1!==c.indexOf("android")?(o=2,u=new Array(2),l=p):(o=5,u=new Array(4),a&&(-1!==a.indexOf("mp4a.40.29")||-1!==a.indexOf("mp4a.40.5"))||!a&&p>=6?l=p-3:((a&&-1!==a.indexOf("mp4a.40.2")&&(p>=6&&1===d||/vivaldi/i.test(c))||!a&&1===d)&&(o=2,u=new Array(2)),l=p)),u[0]=o<<3,u[0]|=(14&p)>>1,u[1]|=(1&p)<<7,u[1]|=d<<3,5===o&&(u[1]|=(14&l)>>1,u[2]=(1&l)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:f[p],channelCount:d,codec:"mp4a.40."+o,manifestCodec:h};t.trigger(s.Events.ERROR,{type:n.ErrorTypes.MEDIA_ERROR,details:n.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+p})}function o(t,e){return 255===t[e]&&240==(246&t[e+1])}function l(t,e){return 1&t[e+1]?7:9}function d(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function u(t,e){return e+5<t.length}function c(t,e){return e+1<t.length&&o(t,e)}function h(t,e){return u(t,e)&&o(t,e)&&d(t,e)<=t.length-e}function f(t,e){if(c(t,e)){var r=l(t,e);if(e+r>=t.length)return!1;var i=d(t,e);if(i<=r)return!1;var n=e+i;return n===t.length||c(t,n)}return!1}function p(t,e,r,n,s){if(!t.samplerate){var o=a(e,r,n,s);if(!o)return;t.config=o.config,t.samplerate=o.samplerate,t.channelCount=o.channelCount,t.codec=o.codec,t.manifestCodec=o.manifestCodec,i.logger.log("parsed codec:"+t.codec+", rate:"+o.samplerate+", channels:"+o.channelCount)}}function v(t){return 9216e4/t}function g(t,e){var r=l(t,e);if(e+r<=t.length){var i=d(t,e)-r;if(i>0)return{headerLength:r,frameLength:i}}}function m(t,e,r,i,n){var s,a=i+n*v(t.samplerate),o=g(e,r);if(o){var l=o.frameLength,d=o.headerLength,u=d+l,c=Math.max(0,r+u-e.length);c?(s=new Uint8Array(u-d)).set(e.subarray(r+d,e.length),0):s=e.subarray(r+d,r+u);var h={unit:s,pts:a};return c||t.samples.push(h),{sample:h,length:u,missing:c}}var f=e.length-r;return(s=new Uint8Array(f)).set(e.subarray(r,e.length),0),{sample:{unit:s,pts:a},length:f,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>c,initPTSFn:()=>u});var i=r("./src/polyfills/number.ts"),n=r("./src/demux/id3.ts"),s=r("./src/types/demuxer.ts"),a=r("./src/demux/dummy-demuxed-track.ts"),o=r("./src/utils/mp4-tools.ts"),l=r("./src/utils/typed-array.ts"),d=function(){function t(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var e=t.prototype;return e.resetInitSegment=function(t,e,r,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},e.resetTimeStamp=function(t){this.initPTS=t,this.resetContiguity()},e.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},e.canParse=function(t,e){return!1},e.appendFrame=function(t,e,r){},e.demux=function(t,e){this.cachedData&&(t=(0,o.appendUint8Array)(this.cachedData,t),this.cachedData=null);var r,d=n.getID3Data(t,0),c=d?d.length:0,h=this._audioTrack,f=this._id3Track,p=d?n.getTimeStamp(d):void 0,v=t.length;for((null===this.basePTS||0===this.frameIndex&&(0,i.isFiniteNumber)(p))&&(this.basePTS=u(p,e,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),d&&d.length>0&&f.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:d,type:s.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});c<v;){if(this.canParse(t,c)){var g=this.appendFrame(h,t,c);g?(this.frameIndex++,this.lastPTS=g.sample.pts,r=c+=g.length):c=v}else n.canParse(t,c)?(d=n.getID3Data(t,c),f.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:d,type:s.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),r=c+=d.length):c++;if(c===v&&r!==v){var m=(0,l.sliceUint8)(t,r);this.cachedData?this.cachedData=(0,o.appendUint8Array)(this.cachedData,m):this.cachedData=m}}return{audioTrack:h,videoTrack:(0,a.dummyTrack)(),id3Track:f,textTrack:(0,a.dummyTrack)()}},e.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},e.flush=function(t){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:(0,a.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,a.dummyTrack)()}},e.destroy=function(){},t}(),u=function(t,e,r){return(0,i.isFiniteNumber)(t)?90*t:9e4*e+(r||0)};const c=d},"./src/demux/chunk-cache.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>i});var i=function(){function t(){this.chunks=[],this.dataLength=0}var e=t.prototype;return e.push=function(t){this.chunks.push(t),this.dataLength+=t.length},e.flush=function(){var t,e=this.chunks,r=this.dataLength;return e.length?(t=1===e.length?e[0]:function(t,e){for(var r=new Uint8Array(e),i=0,n=0;n<t.length;n++){var s=t[n];r.set(s,i),i+=s.length}return r}(e,r),this.reset(),t):new Uint8Array(0)},e.reset=function(){this.chunks.length=0,this.dataLength=0},t}()},"./src/demux/dummy-demuxed-track.ts":(t,e,r)=>{"use strict";function i(t,e){return void 0===t&&(t=""),void 0===e&&(e=9e4),{type:t,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}r.r(e),r.d(e,{dummyTrack:()=>i})},"./src/demux/exp-golomb.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>n});var i=r("./src/utils/logger.ts");const n=function(){function t(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}var e=t.prototype;return e.loadWord=function(){var t=this.data,e=this.bytesAvailable,r=t.byteLength-e,i=new Uint8Array(4),n=Math.min(4,e);if(0===n)throw new Error("no bytes available");i.set(t.subarray(r,r+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},e.skipBits=function(t){var e;t=Math.min(t,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,t-=(e=t>>3)<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},e.readBits=function(t){var e=Math.min(this.bitsAvailable,t),r=this.word>>>32-e;if(t>32&&i.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return(e=t-e)>0&&this.bitsAvailable?r<<e|this.readBits(e):r},e.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},e.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.skipEG=function(){this.skipBits(1+this.skipLZ())},e.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},e.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},e.readBoolean=function(){return 1===this.readBits(1)},e.readUByte=function(){return this.readBits(8)},e.readUShort=function(){return this.readBits(16)},e.readUInt=function(){return this.readBits(32)},e.skipScalingList=function(t){for(var e=8,r=8,i=0;i<t;i++)0!==r&&(r=(e+this.readEG()+256)%256),e=0===r?e:r},e.readSPS=function(){var t,e,r,i=0,n=0,s=0,a=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),d=this.readUEG.bind(this),u=this.readBoolean.bind(this),c=this.skipBits.bind(this),h=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);o();var v=o();if(l(5),c(3),o(),f(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){var g=d();if(3===g&&c(1),f(),f(),c(1),u())for(e=3!==g?8:12,r=0;r<e;r++)u()&&p(r<6?16:64)}f();var m=d();if(0===m)d();else if(1===m)for(c(1),h(),h(),t=d(),r=0;r<t;r++)h();f(),c(1);var y=d(),E=d(),T=l(1);0===T&&c(1),c(1),u()&&(i=d(),n=d(),s=d(),a=d());var S=[1,1];if(u()&&u())switch(o()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil(16*(y+1)-2*i-2*n),height:(2-T)*(E+1)*16-(T?2:4)*(s+a),pixelRatio:S}},e.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}()},"./src/demux/id3.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{canParse:()=>l,decodeFrame:()=>f,getID3Data:()=>a,getID3Frames:()=>h,getTimeStamp:()=>d,isFooter:()=>s,isHeader:()=>n,isTimeStampFrame:()=>u,testables:()=>E,utf8ArrayToStr:()=>y});var i,n=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},s=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},a=function(t,e){for(var r=e,i=0;n(t,e);)i+=10,i+=o(t,e+6),s(t,e+10)&&(i+=10),e+=i;if(i>0)return t.subarray(r,r+i)},o=function(t,e){var r=0;return r=(127&t[e])<<21,r|=(127&t[e+1])<<14,r|=(127&t[e+2])<<7,r|=127&t[e+3]},l=function(t,e){return n(t,e)&&o(t,e+6)+10<=t.length-e},d=function(t){for(var e=h(t),r=0;r<e.length;r++){var i=e[r];if(u(i))return m(i)}},u=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},c=function(t){var e=String.fromCharCode(t[0],t[1],t[2],t[3]),r=o(t,4);return{type:e,size:r,data:t.subarray(10,10+r)}},h=function(t){for(var e=0,r=[];n(t,e);){for(var i=o(t,e+6),a=(e+=10)+i;e+8<a;){var l=c(t.subarray(e)),d=f(l);d&&r.push(d),e+=l.size+10}s(t,e)&&(e+=10)}return r},f=function(t){return"PRIV"===t.type?p(t):"W"===t.type[0]?g(t):v(t)},p=function(t){if(!(t.size<2)){var e=y(t.data,!0),r=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:r.buffer}}},v=function(t){if(!(t.size<2)){if("TXXX"===t.type){var e=1,r=y(t.data.subarray(e),!0);e+=r.length+1;var i=y(t.data.subarray(e));return{key:t.type,info:r,data:i}}var n=y(t.data.subarray(1));return{key:t.type,data:n}}},g=function(t){if("WXXX"===t.type){if(t.size<2)return;var e=1,r=y(t.data.subarray(e),!0);e+=r.length+1;var i=y(t.data.subarray(e));return{key:t.type,info:r,data:i}}var n=y(t.data);return{key:t.type,data:n}},m=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),r=1&e[3],i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,r&&(i+=47721858.84),Math.round(i)}},y=function(t,e){void 0===e&&(e=!1);var r=T();if(r){var i=r.decode(t);if(e){var n=i.indexOf("\0");return-1!==n?i.substring(0,n):i}return i.replace(/\0/g,"")}for(var s,a,o,l=t.length,d="",u=0;u<l;){if(0===(s=t[u++])&&e)return d;if(0!==s&&3!==s)switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=String.fromCharCode(s);break;case 12:case 13:a=t[u++],d+=String.fromCharCode((31&s)<<6|63&a);break;case 14:a=t[u++],o=t[u++],d+=String.fromCharCode((15&s)<<12|(63&a)<<6|(63&o)<<0)}}return d},E={decodeTextFrame:v};function T(){return i||void 0===self.TextDecoder||(i=new self.TextDecoder("utf-8")),i}},"./src/demux/mp3demuxer.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>d});var i=r("./src/demux/base-audio-demuxer.ts"),n=r("./src/demux/id3.ts"),s=r("./src/utils/logger.ts"),a=r("./src/demux/mpegaudio.ts");function o(t,e){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},o(t,e)}var l=function(t){var e,r;function i(){return t.apply(this,arguments)||this}r=t,(e=i).prototype=Object.create(r.prototype),e.prototype.constructor=e,o(e,r);var l=i.prototype;return l.resetInitSegment=function(e,r,i,n){t.prototype.resetInitSegment.call(this,e,r,i,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:r,duration:n,inputTimeScale:9e4,dropped:0}},i.probe=function(t){if(!t)return!1;for(var e=(n.getID3Data(t,0)||[]).length,r=t.length;e<r;e++)if(a.probe(t,e))return s.logger.log("MPEG Audio sync word found !"),!0;return!1},l.canParse=function(t,e){return a.canParse(t,e)},l.appendFrame=function(t,e,r){if(null!==this.basePTS)return a.appendFrame(t,e,r,this.basePTS,this.frameIndex)},i}(i.default);const d=l},"./src/demux/mp4demuxer.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>l});var i=r("./src/polyfills/number.ts"),n=r("./src/types/demuxer.ts"),s=r("./src/utils/mp4-tools.ts"),a=r("./src/demux/dummy-demuxed-track.ts"),o=/\/emsg[-/]ID3/i;const l=function(){function t(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}var e=t.prototype;return e.resetTimeStamp=function(){},e.resetInitSegment=function(t,e,r,i){var n=this.videoTrack=(0,a.dummyTrack)("video",1),o=this.audioTrack=(0,a.dummyTrack)("audio",1),l=this.txtTrack=(0,a.dummyTrack)("text",1);if(this.id3Track=(0,a.dummyTrack)("id3",1),this.timeOffset=0,t&&t.byteLength){var d=(0,s.parseInitSegment)(t);if(d.video){var u=d.video,c=u.id,h=u.timescale,f=u.codec;n.id=c,n.timescale=l.timescale=h,n.codec=f}if(d.audio){var p=d.audio,v=p.id,g=p.timescale,m=p.codec;o.id=v,o.timescale=g,o.codec=m}l.id=s.RemuxerTrackIdConfig.text,n.sampleDuration=0,n.duration=o.duration=i}},e.resetContiguity=function(){},t.probe=function(t){return t=t.length>16384?t.subarray(0,16384):t,(0,s.findBox)(t,["moof"]).length>0},e.demux=function(t,e){this.timeOffset=e;var r=t,i=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=(0,s.appendUint8Array)(this.remainderData,t));var a=(0,s.segmentValidRange)(r);this.remainderData=a.remainder,i.samples=a.valid||new Uint8Array}else i.samples=r;var o=this.extractID3Track(i,e);return n.samples=(0,s.parseSamples)(e,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}},e.flush=function(){var t=this.timeOffset,e=this.videoTrack,r=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;var i=this.extractID3Track(e,this.timeOffset);return r.samples=(0,s.parseSamples)(t,e),{videoTrack:e,audioTrack:(0,a.dummyTrack)(),id3Track:i,textTrack:(0,a.dummyTrack)()}},e.extractID3Track=function(t,e){var r=this.id3Track;if(t.samples.length){var a=(0,s.findBox)(t.samples,["emsg"]);a&&a.forEach((function(t){var a=(0,s.parseEmsg)(t);if(o.test(a.schemeIdUri)){var l=(0,i.isFiniteNumber)(a.presentationTime)?a.presentationTime/a.timeScale:e+a.presentationTimeDelta/a.timeScale,d=4294967295===a.eventDuration?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);var u=a.payload;r.samples.push({data:u,len:u.byteLength,dts:l,pts:l,type:n.MetadataSchema.emsg,duration:d})}}))}return r},e.demuxSampleAes=function(t,e,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},e.destroy=function(){},t}()},"./src/demux/mpegaudio.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{appendFrame:()=>l,canParse:()=>h,isHeader:()=>c,isHeaderPattern:()=>u,parseHeader:()=>d,probe:()=>f});var i=null,n=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],s=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],a=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],o=[0,1,1,4];function l(t,e,r,i,n){if(!(r+24>e.length)){var s=d(e,r);if(s&&r+s.frameLength<=e.length){var a=i+n*(9e4*s.samplesPerFrame/s.sampleRate),o={unit:e.subarray(r,r+s.frameLength),pts:a,dts:a};return t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(o),{sample:o,length:s.frameLength,missing:0}}}}function d(t,e){var r=t[e+1]>>3&3,l=t[e+1]>>1&3,d=t[e+2]>>4&15,u=t[e+2]>>2&3;if(1!==r&&0!==d&&15!==d&&3!==u){var c=t[e+2]>>1&1,h=t[e+3]>>6,f=1e3*n[14*(3===r?3-l:3===l?3:4)+d-1],p=s[3*(3===r?0:2===r?1:2)+u],v=3===h?1:2,g=a[r][l],m=o[l],y=8*g*m,E=Math.floor(g*f/p+c)*m;if(null===i){var T=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);i=T?parseInt(T[1]):0}return!!i&&i<=87&&2===l&&f>=224e3&&0===h&&(t[e+3]=128|t[e+3]),{sampleRate:p,channelCount:v,frameLength:E,samplesPerFrame:y}}}function u(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])}function c(t,e){return e+1<t.length&&u(t,e)}function h(t,e){return u(t,e)&&4<=t.length-e}function f(t,e){if(e+1<t.length&&u(t,e)){var r=d(t,e),i=4;null!=r&&r.frameLength&&(i=r.frameLength);var n=e+i;return n===t.length||c(t,n)}return!1}},"./src/demux/sample-aes.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>s});var i=r("./src/crypt/decrypter.ts"),n=r("./src/utils/mp4-tools.ts");const s=function(){function t(t,e,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new i.default(e,{removePKCS7Padding:!1})}var e=t.prototype;return e.decryptBuffer=function(t){return this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer)},e.decryptAacSample=function(t,e,r){var i=this,n=t[e].unit;if(!(n.length<=16)){var s=n.subarray(16,n.length-n.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(a).then((function(s){var a=new Uint8Array(s);n.set(a,16),i.decrypter.isSync()||i.decryptAacSamples(t,e+1,r)}))}},e.decryptAacSamples=function(t,e,r){for(;;e++){if(e>=t.length)return void r();if(!(t[e].unit.length<32||(this.decryptAacSample(t,e,r),this.decrypter.isSync())))return}},e.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,r=new Int8Array(e),i=0,n=32;n<t.length-16;n+=160,i+=16)r.set(t.subarray(n,n+16),i);return r},e.getAvcDecryptedUnit=function(t,e){for(var r=new Uint8Array(e),i=0,n=32;n<t.length-16;n+=160,i+=16)t.set(r.subarray(i,i+16),n);return t},e.decryptAvcSample=function(t,e,r,i,s){var a=this,o=(0,n.discardEPB)(s.data),l=this.getAvcEncryptedData(o);this.decryptBuffer(l.buffer).then((function(n){s.data=a.getAvcDecryptedUnit(o,n),a.decrypter.isSync()||a.decryptAvcSamples(t,e,r+1,i)}))},e.decryptAvcSamples=function(t,e,r,i){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,r=0){if(e>=t.length)return void i();for(var n=t[e].units;!(r>=n.length);r++){var s=n[r];if(!(s.data.length<=48||1!==s.type&&5!==s.type||(this.decryptAvcSample(t,e,r,i,s),this.decrypter.isSync())))return}}},t}()},"./src/demux/transmuxer-interface.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>c});var i=r("./src/demux/webworkify-webpack.js"),n=r("./src/events.ts"),s=r("./src/demux/transmuxer.ts"),a=r("./src/utils/logger.ts"),o=r("./src/errors.ts"),l=r("./src/utils/mediasource-helper.ts"),d=r("./node_modules/eventemitter3/index.js"),u=(0,l.getMediaSource)()||{isTypeSupported:function(){return!1}},c=function(){function t(t,e,r,l){var c=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var h=t.config;this.hls=t,this.id=e,this.useWorker=!!h.enableWorker,this.onTransmuxComplete=r,this.onFlush=l;var f=function(t,e){(e=e||{}).frag=c.frag,e.id=c.id,c.hls.trigger(t,e)};this.observer=new d.EventEmitter,this.observer.on(n.Events.FRAG_DECRYPTED,f),this.observer.on(n.Events.ERROR,f);var p={mp4:u.isTypeSupported("video/mp4"),mpeg:u.isTypeSupported("audio/mpeg"),mp3:u.isTypeSupported('audio/mp4; codecs="mp3"')},v=navigator.vendor;if(this.useWorker&&"undefined"!=typeof Worker){var g;a.logger.log("demuxing in webworker");try{g=this.worker=(0,i.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),g.addEventListener("message",this.onwmsg),g.onerror=function(t){c.useWorker=!1,a.logger.warn("Exception in webworker, fallback to inline"),c.hls.trigger(n.Events.ERROR,{type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(t.message+"  ("+t.filename+":"+t.lineno+")")})},g.postMessage({cmd:"init",typeSupported:p,vendor:v,id:e,config:JSON.stringify(h)})}catch(t){a.logger.warn("Error in worker:",t),a.logger.error("Error while initializing DemuxerWorker, fallback to inline"),g&&self.URL.revokeObjectURL(g.objectURL),this.transmuxer=new s.default(this.observer,p,h,v,e),this.worker=null}}else this.transmuxer=new s.default(this.observer,p,h,v,e)}var e=t.prototype;return e.destroy=function(){var t=this.worker;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null,this.onwmsg=void 0;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var r=this.observer;r&&r.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},e.push=function(t,e,r,i,n,o,l,d,u,c){var h,f,p=this;u.transmuxing.start=self.performance.now();var v=this.transmuxer,g=this.worker,m=o?o.start:n.start,y=n.decryptdata,E=this.frag,T=!(E&&n.cc===E.cc),S=!(E&&u.level===E.level),b=E?u.sn-E.sn:-1,L=this.part?u.part-this.part.index:-1,A=0===b&&u.id>1&&u.id===(null==E?void 0:E.stats.chunkCount),_=!S&&(1===b||0===b&&(1===L||A&&L<=0)),I=self.performance.now();(S||b||0===n.stats.parsing.start)&&(n.stats.parsing.start=I),!o||!L&&_||(o.stats.parsing.start=I);var D=!(E&&(null===(h=n.initSegment)||void 0===h?void 0:h.url)===(null===(f=E.initSegment)||void 0===f?void 0:f.url)),k=new s.TransmuxState(T,_,d,S,m,D);if(!_||T||D){a.logger.log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+u.sn+" p: "+u.part+" level: "+u.level+" id: "+u.id+"\n        discontinuity: "+T+"\n        trackSwitch: "+S+"\n        contiguous: "+_+"\n        accurateTimeOffset: "+d+"\n        timeOffset: "+m+"\n        initSegmentChange: "+D);var w=new s.TransmuxConfig(r,i,e,l,c);this.configureTransmuxer(w)}if(this.frag=n,this.part=o,g)g.postMessage({cmd:"demux",data:t,decryptdata:y,chunkMeta:u,state:k},t instanceof ArrayBuffer?[t]:[]);else if(v){var C=v.push(t,y,u,k);(0,s.isPromise)(C)?(v.async=!0,C.then((function(t){p.handleTransmuxComplete(t)})).catch((function(t){p.transmuxerError(t,u,"transmuxer-interface push error")}))):(v.async=!1,this.handleTransmuxComplete(C))}},e.flush=function(t){var e=this;t.transmuxing.start=self.performance.now();var r=this.transmuxer,i=this.worker;if(i)i.postMessage({cmd:"flush",chunkMeta:t});else if(r){var n=r.flush(t);(0,s.isPromise)(n)||r.async?((0,s.isPromise)(n)||(n=Promise.resolve(n)),n.then((function(r){e.handleFlushResult(r,t)})).catch((function(r){e.transmuxerError(r,t,"transmuxer-interface flush error")}))):this.handleFlushResult(n,t)}},e.transmuxerError=function(t,e,r){this.hls&&this.hls.trigger(n.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:e,fatal:!1,error:t,err:t,reason:r})},e.handleFlushResult=function(t,e){var r=this;t.forEach((function(t){r.handleTransmuxComplete(t)})),this.onFlush(e)},e.onWorkerMessage=function(t){var e=t.data,r=this.hls;switch(e.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;case"workerLog":a.logger[e.data.logType]&&a.logger[e.data.logType](e.data.message);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,r.trigger(e.event,e.data)}},e.configureTransmuxer=function(t){var e=this.worker,r=this.transmuxer;e?e.postMessage({cmd:"configure",config:t}):r&&r.configure(t)},e.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},t}()},"./src/demux/transmuxer-worker.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>l});var i=r("./src/demux/transmuxer.ts"),n=r("./src/events.ts"),s=r("./src/utils/logger.ts"),a=r("./node_modules/eventemitter3/index.js"),o=r("./src/errors.ts");function l(t){var e=new a.EventEmitter,r=function(e,r){t.postMessage({event:e,data:r})};e.on(n.Events.FRAG_DECRYPTED,r),e.on(n.Events.ERROR,r),t.addEventListener("message",(function(a){var l=a.data;switch(l.cmd){case"init":var u=JSON.parse(l.config);t.transmuxer=new i.default(e,l.typeSupported,u,l.vendor,l.id),(0,s.enableLogs)(u.debug,l.id),function(){var t=function(t){s.logger[t]=function(e){r("workerLog",{logType:t,message:e})}};for(var e in s.logger)t(e)}(),r("init",null);break;case"configure":t.transmuxer.configure(l.config);break;case"demux":var h=t.transmuxer.push(l.data,l.decryptdata,l.chunkMeta,l.state);(0,i.isPromise)(h)?(t.transmuxer.async=!0,h.then((function(e){d(t,e)})).catch((function(t){r(n.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:l.chunkMeta,fatal:!1,error:t,err:t,reason:"transmuxer-worker push error"})}))):(t.transmuxer.async=!1,d(t,h));break;case"flush":var f=l.chunkMeta,p=t.transmuxer.flush(f);(0,i.isPromise)(p)||t.transmuxer.async?((0,i.isPromise)(p)||(p=Promise.resolve(p)),p.then((function(e){c(t,e,f)})).catch((function(t){r(n.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:l.chunkMeta,fatal:!1,error:t,err:t,reason:"transmuxer-worker flush error"})}))):c(t,p,f)}}))}function d(t,e){if(!((r=e.remuxResult).audio||r.video||r.text||r.id3||r.initSegment))return!1;var r,i=[],n=e.remuxResult,s=n.audio,a=n.video;return s&&u(i,s),a&&u(i,a),t.postMessage({event:"transmuxComplete",data:e},i),!0}function u(t,e){e.data1&&t.push(e.data1.buffer),e.data2&&t.push(e.data2.buffer)}function c(t,e,r){e.reduce((function(e,r){return d(t,r)||e}),!1)||t.postMessage({event:"transmuxComplete",data:e[0]}),t.postMessage({event:"flush",data:r})}},"./src/demux/transmuxer.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{TransmuxConfig:()=>y,TransmuxState:()=>E,default:()=>v,isPromise:()=>m});var i,n=r("./src/events.ts"),s=r("./src/errors.ts"),a=r("./src/crypt/decrypter.ts"),o=r("./src/demux/aacdemuxer.ts"),l=r("./src/demux/mp4demuxer.ts"),d=r("./src/demux/tsdemuxer.ts"),u=r("./src/demux/mp3demuxer.ts"),c=r("./src/remux/mp4-remuxer.ts"),h=r("./src/remux/passthrough-remuxer.ts"),f=r("./src/utils/logger.ts");try{i=self.performance.now.bind(self.performance)}catch(t){f.logger.debug("Unable to use Performance API on this environment"),i=self.Date.now}var p=[{demux:l.default,remux:h.default},{demux:d.default,remux:c.default},{demux:o.default,remux:c.default},{demux:u.default,remux:c.default}],v=function(){function t(t,e,r,i,n){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=r,this.vendor=i,this.id=n}var e=t.prototype;return e.configure=function(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()},e.push=function(t,e,r,n){var s=this,a=r.transmuxing;a.executeStart=i();var o=new Uint8Array(t),l=this.currentTransmuxState,d=this.transmuxConfig;n&&(this.currentTransmuxState=n);var u=n||l,c=u.contiguous,h=u.discontinuity,f=u.trackSwitch,p=u.accurateTimeOffset,v=u.timeOffset,m=u.initSegmentChange,y=d.audioCodec,E=d.videoCodec,T=d.defaultInitPts,S=d.duration,b=d.initSegmentData,L=function(t,e){var r=null;return t.byteLength>0&&null!=e&&null!=e.key&&null!==e.iv&&null!=e.method&&(r=e),r}(o,e);if(L&&"AES-128"===L.method){var A=this.getDecrypter();if(!A.isSync())return this.decryptionPromise=A.webCryptoDecrypt(o,L.key.buffer,L.iv.buffer).then((function(t){var e=s.push(t,null,r);return s.decryptionPromise=null,e})),this.decryptionPromise;var _=A.softwareDecrypt(o,L.key.buffer,L.iv.buffer);if(r.part>-1&&(_=A.flush()),!_)return a.executeEnd=i(),g(r);o=new Uint8Array(_)}var I=this.needsProbing(h,f);I&&this.configureTransmuxer(o),(h||f||m||I)&&this.resetInitSegment(b,y,E,S,e),(h||m||I)&&this.resetInitialTimestamp(T),c||this.resetContiguity();var D=this.transmux(o,L,v,p,r),k=this.currentTransmuxState;return k.contiguous=!0,k.discontinuity=!1,k.trackSwitch=!1,a.executeEnd=i(),D},e.flush=function(t){var e=this,r=t.transmuxing;r.executeStart=i();var a=this.decrypter,o=this.currentTransmuxState,l=this.decryptionPromise;if(l)return l.then((function(){return e.flush(t)}));var d=[],u=o.timeOffset;if(a){var c=a.flush();c&&d.push(this.push(c,null,t))}var h=this.demuxer,f=this.remuxer;if(!h||!f)return this.observer.emit(n.Events.ERROR,n.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),r.executeEnd=i(),[g(t)];var p=h.flush(u);return m(p)?p.then((function(r){return e.flushRemux(d,r,t),d})):(this.flushRemux(d,p,t),d)},e.flushRemux=function(t,e,r){var n=e.audioTrack,s=e.videoTrack,a=e.id3Track,o=e.textTrack,l=this.currentTransmuxState,d=l.accurateTimeOffset,u=l.timeOffset;f.logger.log("[transmuxer.ts]: Flushed fragment "+r.sn+(r.part>-1?" p: "+r.part:"")+" of level "+r.level);var c=this.remuxer.remux(n,s,a,o,u,d,!0,this.id);t.push({remuxResult:c,chunkMeta:r}),r.transmuxing.executeEnd=i()},e.resetInitialTimestamp=function(t){var e=this.demuxer,r=this.remuxer;e&&r&&(e.resetTimeStamp(t),r.resetTimeStamp(t))},e.resetContiguity=function(){var t=this.demuxer,e=this.remuxer;t&&e&&(t.resetContiguity(),e.resetNextTimestamp())},e.resetInitSegment=function(t,e,r,i,n){var s=this.demuxer,a=this.remuxer;s&&a&&(s.resetInitSegment(t,e,r,i),a.resetInitSegment(t,e,r,n))},e.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},e.transmux=function(t,e,r,i,n){return e&&"SAMPLE-AES"===e.method?this.transmuxSampleAes(t,e,r,i,n):this.transmuxUnencrypted(t,r,i,n)},e.transmuxUnencrypted=function(t,e,r,i){var n=this.demuxer.demux(t,e,!1,!this.config.progressive),s=n.audioTrack,a=n.videoTrack,o=n.id3Track,l=n.textTrack;return{remuxResult:this.remuxer.remux(s,a,o,l,e,r,!1,this.id),chunkMeta:i}},e.transmuxSampleAes=function(t,e,r,i,n){var s=this;return this.demuxer.demuxSampleAes(t,e,r).then((function(t){return{remuxResult:s.remuxer.remux(t.audioTrack,t.videoTrack,t.id3Track,t.textTrack,r,i,!1,s.id),chunkMeta:n}}))},e.configureTransmuxer=function(t){for(var e,r=this.config,i=this.observer,n=this.typeSupported,s=this.vendor,a=0,o=p.length;a<o;a++)if(p[a].demux.probe(t)){e=p[a];break}e||(f.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),e={demux:l.default,remux:h.default});var d=this.demuxer,u=this.remuxer,c=e.remux,v=e.demux;u&&u instanceof c||(this.remuxer=new c(i,r,n,s)),d&&d instanceof v||(this.demuxer=new v(i,r,n),this.probe=v.probe)},e.needsProbing=function(t,e){return!this.demuxer||!this.remuxer||t||e},e.getDecrypter=function(){var t=this.decrypter;return t||(t=this.decrypter=new a.default(this.config)),t},t}(),g=function(t){return{remuxResult:{},chunkMeta:t}};function m(t){return"then"in t&&t.then instanceof Function}var y=function(t,e,r,i,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=r,this.duration=i,this.defaultInitPts=n},E=function(t,e,r,i,n,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=n,this.initSegmentChange=s}},"./src/demux/tsdemuxer.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>T});var i=r("./src/demux/adts.ts"),n=r("./src/demux/mpegaudio.ts"),s=r("./src/demux/exp-golomb.ts"),a=r("./src/demux/sample-aes.ts"),o=r("./src/events.ts"),l=r("./src/utils/mp4-tools.ts"),d=r("./src/utils/logger.ts"),u=r("./src/errors.ts"),c=r("./src/types/demuxer.ts");function h(){return h=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},h.apply(this,arguments)}var f=188;function p(t,e,r,i){return{key:t,frame:!1,pts:e,dts:r,units:[],debug:i,length:0}}function v(t,e){return((31&t[e+1])<<8)+t[e+2]}function g(t,e){return(31&t[e+10])<<8|t[e+11]}function m(t,e,r,i){var n={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},s=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<s;){var a=v(t,e);switch(t[e]){case 207:if(!i){d.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===n.audio&&(n.audio=a);break;case 21:-1===n.id3&&(n.id3=a);break;case 219:if(!i){d.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===n.avc&&(n.avc=a);break;case 3:case 4:!0!==r.mpeg&&!0!==r.mp3?d.logger.log("MPEG audio found, not supported in this browser"):-1===n.audio&&(n.audio=a,n.segmentCodec="mp3");break;case 36:d.logger.warn("Unsupported HEVC stream type found")}e+=5+((15&t[e+3])<<8|t[e+4])}return n}function y(t){var e,r,i,n,s,a=0,o=t.data;if(!t||0===t.size)return null;for(;o[0].length<19&&o.length>1;){var l=new Uint8Array(o[0].length+o[1].length);l.set(o[0]),l.set(o[1],o[0].length),o[0]=l,o.splice(1,1)}if(1===((e=o[0])[0]<<16)+(e[1]<<8)+e[2]){if((r=(e[4]<<8)+e[5])&&r>t.size-6)return null;var u=e[7];192&u&&(n=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&u?n-(s=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)>54e5&&(d.logger.warn(Math.round((n-s)/9e4)+"s delta between PTS and DTS, align them"),n=s):s=n);var c=(i=e[8])+9;if(t.size<=c)return null;t.size-=c;for(var h=new Uint8Array(t.size),f=0,p=o.length;f<p;f++){var v=(e=o[f]).byteLength;if(c){if(c>v){c-=v;continue}e=e.subarray(c),v-=c,c=0}h.set(e,a),a+=v}return r&&(r-=i+3),{data:h,pts:n,dts:s,len:r}}return null}function E(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){var r=e.samples,i=r.length;if(!i)return void e.dropped++;var n=r[i-1];t.pts=n.pts,t.dts=n.dts}e.samples.push(t)}t.debug.length&&d.logger.log(t.pts+"/"+t.dts+":"+t.debug)}const T=function(){function t(t,e,r){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=e,this.typeSupported=r}t.probe=function(e){var r=t.syncOffset(e);return r>0&&d.logger.warn("MPEG2-TS detected but first sync word found @ offset "+r),-1!==r},t.syncOffset=function(t){for(var e=t.length,r=Math.min(940,t.length-f)+1,i=0;i<r;){for(var n=!1,s=i;s<e&&71===t[s];s+=f)if(n||0!==v(t,s)||(n=!0),n&&s+f>r)return i;i++}return-1},t.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:l.RemuxerTrackIdConfig[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?e:void 0}};var e=t.prototype;return e.resetInitSegment=function(e,r,i,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack("video"),this._audioTrack=t.createTrack("audio",n),this._id3Track=t.createTrack("id3"),this._txtTrack=t.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=r,this.videoCodec=i,this._duration=n},e.resetTimeStamp=function(){},e.resetContiguity=function(){var t=this._audioTrack,e=this._avcTrack,r=this._id3Track;t&&(t.pesData=null),e&&(e.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},e.demux=function(e,r,i,n){var s;void 0===i&&(i=!1),void 0===n&&(n=!1),i||(this.sampleAes=null);var a=this._avcTrack,c=this._audioTrack,h=this._id3Track,p=this._txtTrack,E=a.pid,T=a.pesData,S=c.pid,b=h.pid,L=c.pesData,A=h.pesData,_=null,I=this.pmtParsed,D=this._pmtId,k=e.length;if(this.remainderData&&(k=(e=(0,l.appendUint8Array)(this.remainderData,e)).length,this.remainderData=null),k<f&&!n)return this.remainderData=e,{audioTrack:c,videoTrack:a,id3Track:h,textTrack:p};var w=Math.max(0,t.syncOffset(e));(k-=(k-w)%f)<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,k,e.buffer.byteLength-k));for(var C=0,R=w;R<k;R+=f)if(71===e[R]){var M=!!(64&e[R+1]),x=v(e,R),N=void 0;if((48&e[R+3])>>4>1){if((N=R+5+e[R+4])===R+f)continue}else N=R+4;switch(x){case E:M&&(T&&(s=y(T))&&this.parseAVCPES(a,p,s,!1),T={data:[],size:0}),T&&(T.data.push(e.subarray(N,R+f)),T.size+=R+f-N);break;case S:if(M){if(L&&(s=y(L)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,s);break;case"mp3":this.parseMPEGPES(c,s)}L={data:[],size:0}}L&&(L.data.push(e.subarray(N,R+f)),L.size+=R+f-N);break;case b:M&&(A&&(s=y(A))&&this.parseID3PES(h,s),A={data:[],size:0}),A&&(A.data.push(e.subarray(N,R+f)),A.size+=R+f-N);break;case 0:M&&(N+=e[N]+1),D=this._pmtId=g(e,N);break;case D:M&&(N+=e[N]+1);var P=m(e,N,this.typeSupported,i);(E=P.avc)>0&&(a.pid=E),(S=P.audio)>0&&(c.pid=S,c.segmentCodec=P.segmentCodec),(b=P.id3)>0&&(h.pid=b),null===_||I||(d.logger.warn("MPEG-TS PMT found at "+R+" after unknown PID '"+_+"'. Backtracking to sync byte @"+w+" to parse all TS packets."),_=null,R=w-188),I=this.pmtParsed=!0;break;case 17:case 8191:break;default:_=x}}else C++;C>0&&this.observer.emit(o.Events.ERROR,o.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+C+" TS packet/s that do not start with 0x47"}),a.pesData=T,c.pesData=L,h.pesData=A;var O={audioTrack:c,videoTrack:a,id3Track:h,textTrack:p};return n&&this.extractRemainingSamples(O),O},e.flush=function(){var t,e=this.remainderData;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t},e.extractRemainingSamples=function(t){var e,r=t.audioTrack,i=t.videoTrack,n=t.id3Track,s=t.textTrack,a=i.pesData,o=r.pesData,l=n.pesData;if(a&&(e=y(a))?(this.parseAVCPES(i,s,e,!0),i.pesData=null):i.pesData=a,o&&(e=y(o))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,e);break;case"mp3":this.parseMPEGPES(r,e)}r.pesData=null}else null!=o&&o.size&&d.logger.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=o;l&&(e=y(l))?(this.parseID3PES(n,e),n.pesData=null):n.pesData=l},e.demuxSampleAes=function(t,e,r){var i=this.demux(t,r,!0,!this.config.progressive),n=this.sampleAes=new a.default(this.observer,this.config,e);return this.decrypt(i,n)},e.decrypt=function(t,e){return new Promise((function(r){var i=t.audioTrack,n=t.videoTrack;i.samples&&"aac"===i.segmentCodec?e.decryptAacSamples(i.samples,0,(function(){n.samples?e.decryptAvcSamples(n.samples,0,0,(function(){r(t)})):r(t)})):n.samples&&e.decryptAvcSamples(n.samples,0,0,(function(){r(t)}))}))},e.destroy=function(){this._duration=0},e.parseAVCPES=function(t,e,r,i){var n,a=this,o=this.parseAVCNALu(t,r.data),d=this.avcSample,u=!1;r.data=null,d&&o.length&&!t.audFound&&(E(d,t),d=this.avcSample=p(!1,r.pts,r.dts,"")),o.forEach((function(i){switch(i.type){case 1:n=!0,d||(d=a.avcSample=p(!0,r.pts,r.dts,"")),d.frame=!0;var o=i.data;if(u&&o.length>4){var c=new s.default(o).readSliceType();2!==c&&4!==c&&7!==c&&9!==c||(d.key=!0)}break;case 5:n=!0,d||(d=a.avcSample=p(!0,r.pts,r.dts,"")),d.key=!0,d.frame=!0;break;case 6:n=!0,(0,l.parseSEIMessageFromNALu)(i.data,1,r.pts,e.samples);break;case 7:if(n=!0,u=!0,!t.sps){var h=new s.default(i.data).readSPS();t.width=h.width,t.height=h.height,t.pixelRatio=h.pixelRatio,t.sps=[i.data],t.duration=a._duration;for(var f=i.data.subarray(1,4),v="avc1.",g=0;g<3;g++){var m=f[g].toString(16);m.length<2&&(m="0"+m),v+=m}t.codec=v}break;case 8:n=!0,t.pps||(t.pps=[i.data]);break;case 9:n=!1,t.audFound=!0,d&&E(d,t),d=a.avcSample=p(!1,r.pts,r.dts,"");break;case 12:n=!0;break;default:n=!1,d&&(d.debug+="unknown NAL "+i.type+" ")}d&&n&&d.units.push(i)})),i&&d&&(E(d,t),this.avcSample=null)},e.getLastNalUnit=function(t){var e,r,i=this.avcSample;if(i&&0!==i.units.length||(i=t[t.length-1]),null!==(e=i)&&void 0!==e&&e.units){var n=i.units;r=n[n.length-1]}return r},e.parseAVCNALu=function(t,e){var r,i,n=e.byteLength,s=t.naluState||0,a=s,o=[],l=0,d=-1,u=0;for(-1===s&&(d=0,u=31&e[0],s=0,l=1);l<n;)if(r=e[l++],s)if(1!==s)if(r)if(1===r){if(d>=0){var c={data:e.subarray(d,l-s-1),type:u};o.push(c)}else{var h=this.getLastNalUnit(t.samples);if(h&&(a&&l<=4-a&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-a)),(i=l-s-1)>0)){var f=new Uint8Array(h.data.byteLength+i);f.set(h.data,0),f.set(e.subarray(0,i),h.data.byteLength),h.data=f,h.state=0}}l<n?(d=l,u=31&e[l],s=0):s=-1}else s=0;else s=3;else s=r?0:2;else s=r?0:1;if(d>=0&&s>=0){var p={data:e.subarray(d,n),type:u,state:s};o.push(p)}if(0===o.length){var v=this.getLastNalUnit(t.samples);if(v){var g=new Uint8Array(v.data.byteLength+e.byteLength);g.set(v.data,0),g.set(e,v.data.byteLength),v.data=g}}return t.naluState=s,o},e.parseAACPES=function(t,e){var r,n,s,a,l,c=0,h=this.aacOverFlow,f=e.data;if(h){this.aacOverFlow=null;var p=h.missing,v=h.sample.unit.byteLength;if(-1===p){var g=new Uint8Array(v+f.byteLength);g.set(h.sample.unit,0),g.set(f,v),f=g}else{var m=v-p;h.sample.unit.set(f.subarray(0,p),m),t.samples.push(h.sample),c=h.missing}}for(r=c,n=f.length;r<n-1&&!i.isHeader(f,r);r++);if(r===c||(r<n-1?(s="AAC PES did not start with ADTS header,offset:"+r,a=!1):(s="no ADTS header found in AAC PES",a=!0),d.logger.warn("parsing error:"+s),this.observer.emit(o.Events.ERROR,o.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.FRAG_PARSING_ERROR,fatal:a,reason:s}),!a)){if(i.initTrackConfig(t,this.observer,f,r,this.audioCodec),void 0!==e.pts)l=e.pts;else{if(!h)return void d.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var y=i.getFrameDuration(t.samplerate);l=h.sample.pts+y}for(var E,T=0;r<n;){if(r+=(E=i.appendFrame(t,f,r,l,T)).length,E.missing){this.aacOverFlow=E;break}for(T++;r<n-1&&!i.isHeader(f,r);r++);}}},e.parseMPEGPES=function(t,e){var r=e.data,i=r.length,s=0,a=0,o=e.pts;if(void 0!==o)for(;a<i;)if(n.isHeader(r,a)){var l=n.appendFrame(t,r,a,o,s);if(!l)break;a+=l.length,s++}else a++;else d.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},e.parseID3PES=function(t,e){if(void 0!==e.pts){var r=h({},e,{type:this._avcTrack?c.MetadataSchema.emsg:c.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(r)}else d.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},t}()},"./src/demux/webworkify-webpack.js":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>u});var i=function(){var t=ENTRY_MODULE,e={},r=function r(i){var n=e[i];if(void 0!==n)return n.exports;var s=e[i]={exports:{}};return t[i].call(s.exports,s,s.exports,r),s.exports};r.m=t,r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,{a:e}),e},r.d=function(t,e){for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i=r(ENTRY_MODULE);return i.default||i}.toString().split("ENTRY_MODULE"),n="[\\.|\\-|\\+|\\w|/|@]+",s="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+n+").*?\\)";function a(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(t,e,i){var o={};o[i]=[];var l=e.toString().replace(/^"[^"]+"/,"function"),d=l.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||l.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!d)return o;for(var u,c=d[1],h=new RegExp("(\\\\n|\\W)"+a(c)+s,"g");u=h.exec(l);)"dll-reference"!==u[3]&&o[i].push(u[3]);for(h=new RegExp("\\("+a(c)+'\\("(dll-reference\\s('+n+'))"\\)\\)'+s,"g");u=h.exec(l);)t[u[2]]||(o[i].push(u[1]),t[u[2]]=r(u[1]).m),o[u[2]]=o[u[2]]||[],o[u[2]].push(u[4]);for(var f,p=Object.keys(o),v=0;v<p.length;v++)for(var g=0;g<o[p[v]].length;g++)f=o[p[v]][g],isNaN(1*f)||(o[p[v]][g]=1*o[p[v]][g]);return o}function l(t){return Object.keys(t).reduce((function(e,r){return e||t[r].length>0}),!1)}function d(t,e,r,n){var s=t[n].map((function(t){return'"'+t+'": '+e[n][t].toString().replace(/^"[^"]+"/,"function")})).join(",");return i[0]+"{"+s+"}"+i[1]+'"'+r+'"'+i[2]}function u(t,e){e=e||{};var i={main:r.m},n=e.all?{main:Object.keys(i.main)}:function(t,e){for(var r={main:[e]},i={main:[]},n={main:{}};l(r);)for(var s=Object.keys(r),a=0;a<s.length;a++){var d=s[a],u=r[d].pop();if(n[d]=n[d]||{},!n[d][u]&&t[d][u]){n[d][u]=!0,i[d]=i[d]||[],i[d].push(u);for(var c=o(t,t[d][u],d),h=Object.keys(c),f=0;f<h.length;f++)r[h[f]]=r[h[f]]||[],r[h[f]]=r[h[f]].concat(c[h[f]])}}return i}(i,t),s="";Object.keys(n).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;n[t][e];)e++;n[t].push(e),i[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+"var "+t+" = ("+d(n,i,e,modules)+")();\n"})),s=s+"new (("+d(n,i,t,"main")+")())(self);";var a=new window.Blob([s],{type:"text/javascript"}),u=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(a),c=new window.Worker(u);return c.objectURL=u,c}},"./src/errors.ts":(t,e,r)=>{"use strict";var i,n;r.r(e),r.d(e,{ErrorDetails:()=>n,ErrorTypes:()=>i}),function(t){t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError"}(i||(i={})),function(t){t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",t.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",t.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",t.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",t.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",t.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted",t.UNKNOWN="unknown"}(n||(n={}))},"./src/events.ts":(t,e,r)=>{"use strict";var i;r.r(e),r.d(e,{Events:()=>i}),function(t){t.MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached"}(i||(i={}))},"./src/hls.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>E});var i=r("./node_modules/url-toolkit/src/url-toolkit.js"),n=r("./src/loader/playlist-loader.ts"),s=r("./src/controller/id3-track-controller.ts"),a=r("./src/controller/latency-controller.ts"),o=r("./src/controller/level-controller.ts"),l=r("./src/controller/fragment-tracker.ts"),d=r("./src/loader/key-loader.ts"),u=r("./src/controller/stream-controller.ts"),c=r("./src/is-supported.ts"),h=r("./src/utils/logger.ts"),f=r("./src/config.ts"),p=r("./node_modules/eventemitter3/index.js"),v=r("./src/events.ts"),g=r("./src/errors.ts"),m=r("./src/types/level.ts");function y(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,s=void 0,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?s:String(s)),i)}var n,s}var E=function(){function t(e){void 0===e&&(e={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new p.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var r=this.config=(0,f.mergeConfig)(t.DefaultConfig,e);this.userConfig=e,(0,h.enableLogs)(r.debug,"Hls instance"),this._autoLevelCapping=-1,r.progressive&&(0,f.enableStreamingMode)(r);var i=r.abrController,c=r.bufferController,v=r.capLevelController,g=r.fpsController,m=this.abrController=new i(this),y=this.bufferController=new c(this),E=this.capLevelController=new v(this),T=new g(this),S=new n.default(this),b=new s.default(this),L=this.levelController=new o.default(this),A=new l.FragmentTracker(this),_=new d.default(this.config),I=this.streamController=new u.default(this,A,_);E.setStreamController(I),T.setStreamController(I);var D=[S,L,I];this.networkControllers=D;var k=[m,y,E,T,b,A];this.audioTrackController=this.createController(r.audioTrackController,D);var w=r.audioStreamController;w&&D.push(new w(this,A,_)),this.subtitleTrackController=this.createController(r.subtitleTrackController,D);var C=r.subtitleStreamController;C&&D.push(new C(this,A,_)),this.createController(r.timelineController,k),_.emeController=this.emeController=this.createController(r.emeController,k),this.cmcdController=this.createController(r.cmcdController,k),this.latencyController=this.createController(a.default,k),this.coreComponents=k}t.isSupported=function(){return(0,c.isSupported)()};var e,r,E,T=t.prototype;return T.createController=function(t,e){if(t){var r=new t(this);return e&&e.push(r),r}return null},T.on=function(t,e,r){void 0===r&&(r=this),this._emitter.on(t,e,r)},T.once=function(t,e,r){void 0===r&&(r=this),this._emitter.once(t,e,r)},T.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},T.off=function(t,e,r,i){void 0===r&&(r=this),this._emitter.off(t,e,r,i)},T.listeners=function(t){return this._emitter.listeners(t)},T.emit=function(t,e,r){return this._emitter.emit(t,e,r)},T.trigger=function(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(e){h.logger.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.trigger(v.Events.ERROR,{type:g.ErrorTypes.OTHER_ERROR,details:g.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,error:e})}return!1},T.listenerCount=function(t){return this._emitter.listenerCount(t)},T.destroy=function(){h.logger.log("destroy"),this.trigger(v.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(t){return t.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(t){return t.destroy()})),this.coreComponents.length=0},T.attachMedia=function(t){h.logger.log("attachMedia"),this._media=t,this.trigger(v.Events.MEDIA_ATTACHING,{media:t})},T.detachMedia=function(){h.logger.log("detachMedia"),this.trigger(v.Events.MEDIA_DETACHING,void 0),this._media=null},T.loadSource=function(t){this.stopLoad();var e=this.media,r=this.url,n=this.url=i.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});h.logger.log("loadSource:"+n),e&&r&&r!==n&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(e)),this.trigger(v.Events.MANIFEST_LOADING,{url:t})},T.startLoad=function(t){void 0===t&&(t=-1),h.logger.log("startLoad("+t+")"),this.networkControllers.forEach((function(e){e.startLoad(t)}))},T.stopLoad=function(){h.logger.log("stopLoad"),this.networkControllers.forEach((function(t){t.stopLoad()}))},T.swapAudioCodec=function(){h.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},T.recoverMediaError=function(){h.logger.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},T.removeLevel=function(t,e){void 0===e&&(e=0),this.levelController.removeLevel(t,e)},e=t,E=[{key:"version",get:function(){return"1.3.5"}},{key:"Events",get:function(){return v.Events}},{key:"ErrorTypes",get:function(){return g.ErrorTypes}},{key:"ErrorDetails",get:function(){return g.ErrorDetails}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:f.hlsDefaultConfig},set:function(e){t.defaultConfig=e}}],(r=[{key:"levels",get:function(){var t=this.levelController.levels;return t||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){h.logger.log("set currentLevel:"+t),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){h.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){h.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){h.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){h.logger.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){var e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(h.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t)}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(t){m.HdcpLevels.indexOf(t)>-1&&(this._maxHdcpLevel=t)}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,e=this.config.minAutoBitrate;if(!t)return 0;for(var r=t.length,i=0;i<r;i++)if(t[i].maxBitrate>=e)return i;return 0}},{key:"maxAutoLevel",get:function(){var t,e=this.levels,r=this.autoLevelCapping,i=this.maxHdcpLevel;if(t=-1===r&&e&&e.length?e.length-1:r,i)for(var n=t;n--;){var s=e[n].attrs["HDCP-LEVEL"];if(s&&s<=i)return n}return t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&y(e.prototype,r),E&&y(e,E),Object.defineProperty(e,"prototype",{writable:!1}),t}();E.defaultConfig=void 0},"./src/is-supported.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{changeTypeSupported:()=>a,isSupported:()=>s});var i=r("./src/utils/mediasource-helper.ts");function n(){return self.SourceBuffer||self.WebKitSourceBuffer}function s(){var t=(0,i.getMediaSource)();if(!t)return!1;var e=n(),r=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),s=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!r&&!!s}function a(){var t,e=n();return"function"==typeof(null==e||null===(t=e.prototype)||void 0===t?void 0:t.changeType)}},"./src/loader/date-range.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{DateRange:()=>d,DateRangeAttribute:()=>i});var i,n=r("./src/polyfills/number.ts"),s=r("./src/utils/attr-list.ts"),a=r("./src/utils/logger.ts");function o(){return o=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},o.apply(this,arguments)}function l(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,s=void 0,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?s:String(s)),i)}var n,s}!function(t){t.ID="ID",t.CLASS="CLASS",t.START_DATE="START-DATE",t.DURATION="DURATION",t.END_DATE="END-DATE",t.END_ON_NEXT="END-ON-NEXT",t.PLANNED_DURATION="PLANNED-DURATION",t.SCTE35_OUT="SCTE35-OUT",t.SCTE35_IN="SCTE35-IN"}(i||(i={}));var d=function(){function t(t,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){var r=e.attr;for(var l in r)if(Object.prototype.hasOwnProperty.call(t,l)&&t[l]!==r[l]){a.logger.warn('DATERANGE tag attribute: "'+l+'" does not match for tags with ID: "'+t.ID+'"'),this._badValueForSameId=l;break}t=o(new s.AttrList({}),r,t)}if(this.attr=t,this._startDate=new Date(t[i.START_DATE]),i.END_DATE in this.attr){var d=new Date(this.attr[i.END_DATE]);(0,n.isFiniteNumber)(d.getTime())&&(this._endDate=d)}}var e,r,d;return e=t,(r=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var t=this.duration;return null!==t?new Date(this._startDate.getTime()+1e3*t):null}},{key:"duration",get:function(){if(i.DURATION in this.attr){var t=this.attr.decimalFloatingPoint(i.DURATION);if((0,n.isFiniteNumber)(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return i.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(i.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(i.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,n.isFiniteNumber)(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&l(e.prototype,r),d&&l(e,d),Object.defineProperty(e,"prototype",{writable:!1}),t}()},"./src/loader/fragment-loader.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{LoadError:()=>h,default:()=>u});var i=r("./src/polyfills/number.ts"),n=r("./src/errors.ts");function s(t){var e="function"==typeof Map?new Map:void 0;return s=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return a(t,arguments,l(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),o(i,t)},s(t)}function a(t,e,r){return a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct.bind():function(t,e,r){var i=[null];i.push.apply(i,e);var n=new(Function.bind.apply(t,i));return r&&o(n,r.prototype),n},a.apply(null,arguments)}function o(t,e){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},o(t,e)}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}var d=Math.pow(2,17),u=function(){function t(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var e=t.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(t,e){var r=this,i=t.url;if(!i)return Promise.reject(new h({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(i?"part list":"url")));this.abort();var s=this.config,a=s.fLoader,o=s.loader;return new Promise((function(i,l){r.loader&&r.loader.destroy();var u=r.loader=t.loader=a?new a(s):new o(s),f=c(t),p={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:"initSegment"===t.sn?1/0:d};t.stats=u.stats,u.load(f,p,{onSuccess:function(e,n,s,a){r.resetLoader(t,u);var o=e.data;s.resetIV&&t.decryptdata&&(t.decryptdata.iv=new Uint8Array(o.slice(0,16)),o=o.slice(16)),i({frag:t,part:null,payload:o,networkDetails:a})},onError:function(e,i,s){r.resetLoader(t,u),l(new h({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:e,networkDetails:s}))},onAbort:function(e,i,s){r.resetLoader(t,u),l(new h({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:s}))},onTimeout:function(e,i,s){r.resetLoader(t,u),l(new h({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:s}))},onProgress:function(r,i,n,s){e&&e({frag:t,part:null,payload:n,networkDetails:s})}})}))},e.loadPart=function(t,e,r){var i=this;this.abort();var s=this.config,a=s.fLoader,o=s.loader;return new Promise((function(l,u){i.loader&&i.loader.destroy();var f=i.loader=t.loader=a?new a(s):new o(s),p=c(t,e),v={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:d};e.stats=f.stats,f.load(p,v,{onSuccess:function(n,s,a,o){i.resetLoader(t,f),i.updateStatsFromPart(t,e);var d={frag:t,part:e,payload:n.data,networkDetails:o};r(d),l(d)},onError:function(r,s,a){i.resetLoader(t,f),u(new h({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:r,networkDetails:a}))},onAbort:function(r,s,a){t.stats.aborted=e.stats.aborted,i.resetLoader(t,f),u(new h({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,networkDetails:a}))},onTimeout:function(r,s,a){i.resetLoader(t,f),u(new h({type:n.ErrorTypes.NETWORK_ERROR,details:n.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,networkDetails:a}))}})}))},e.updateStatsFromPart=function(t,e){var r=t.stats,i=e.stats,n=i.total;if(r.loaded+=i.loaded,n){var s=Math.round(t.duration/e.duration),a=Math.min(Math.round(r.loaded/n),s),o=(s-a)*Math.round(r.loaded/a);r.total=r.loaded+o}else r.total=Math.max(r.loaded,r.total);var l=r.loading,d=i.loading;l.start?l.first+=d.first-d.start:(l.start=d.start,l.first=d.first),l.end=d.end},e.resetLoader=function(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},t}();function c(t,e){void 0===e&&(e=null);var r=e||t,n={frag:t,part:e,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},s=r.byteRangeStartOffset,a=r.byteRangeEndOffset;if((0,i.isFiniteNumber)(s)&&(0,i.isFiniteNumber)(a)){var o,l=s,d=a;if("initSegment"===t.sn&&"AES-128"===(null===(o=t.decryptdata)||void 0===o?void 0:o.method)){var u=a-s;u%16&&(d=a+(16-u%16)),0!==s&&(n.resetIV=!0,l=s-16)}n.rangeStart=l,n.rangeEnd=d}return n}var h=function(t){var e,r;function i(e){for(var r,i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];return(r=t.call.apply(t,[this].concat(n))||this).data=void 0,r.data=e,r}return r=t,(e=i).prototype=Object.create(r.prototype),e.prototype.constructor=e,o(e,r),i}(s(Error))},"./src/loader/fragment.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{BaseSegment:()=>c,ElementaryStreamTypes:()=>i,Fragment:()=>h,Part:()=>f});var i,n=r("./src/polyfills/number.ts"),s=r("./node_modules/url-toolkit/src/url-toolkit.js"),a=r("./src/loader/load-stats.ts");function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,l(t,e)}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}function d(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,s=void 0,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?s:String(s)),i)}var n,s}function u(t,e,r){return e&&d(t.prototype,e),r&&d(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}!function(t){t.AUDIO="audio",t.VIDEO="video",t.AUDIOVIDEO="audiovideo"}(i||(i={}));var c=function(){function t(t){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((e={})[i.AUDIO]=null,e[i.VIDEO]=null,e[i.AUDIOVIDEO]=null,e),this.baseurl=t}return t.prototype.setByteRange=function(t,e){var r=t.split("@",2),i=[];1===r.length?i[0]=e?e.byteRangeEndOffset:0:i[0]=parseInt(r[1]),i[1]=parseInt(r[0])+i[0],this._byteRange=i},u(t,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,s.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),t}(),h=function(t){function e(e,r){var i;return(i=t.call(this,r)||this)._decryptdata=null,i.rawProgramDateTime=null,i.programDateTime=null,i.tagList=[],i.duration=0,i.sn=0,i.levelkeys=void 0,i.type=void 0,i.loader=null,i.keyLoader=null,i.level=-1,i.cc=0,i.startPTS=void 0,i.endPTS=void 0,i.appendedPTS=void 0,i.startDTS=void 0,i.endDTS=void 0,i.start=0,i.deltaPTS=void 0,i.maxStartPTS=void 0,i.minEndPTS=void 0,i.stats=new a.LoadStats,i.urlId=0,i.data=void 0,i.bitrateTest=!1,i.title=null,i.initSegment=null,i.endList=void 0,i.type=e,i}o(e,t);var r=e.prototype;return r.setKeyFormat=function(t){if(this.levelkeys){var e=this.levelkeys[t];e&&!this._decryptdata&&(this._decryptdata=e.getDecryptData(this.sn))}},r.abortRequests=function(){var t,e;null===(t=this.loader)||void 0===t||t.abort(),null===(e=this.keyLoader)||void 0===e||e.abort()},r.setElementaryStreamInfo=function(t,e,r,i,n,s){void 0===s&&(s=!1);var a=this.elementaryStreams,o=a[t];o?(o.startPTS=Math.min(o.startPTS,e),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,i),o.endDTS=Math.max(o.endDTS,n)):a[t]={startPTS:e,endPTS:r,startDTS:i,endDTS:n,partial:s}},r.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[i.AUDIO]=null,t[i.VIDEO]=null,t[i.AUDIOVIDEO]=null},u(e,[{key:"decryptdata",get:function(){if(!this.levelkeys&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{var e=Object.keys(this.levelkeys);if(1===e.length)return this._decryptdata=this.levelkeys[e[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!(0,n.isFiniteNumber)(this.programDateTime))return null;var t=(0,n.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;if(null!==(t=this._decryptdata)&&void 0!==t&&t.encrypted)return!0;if(this.levelkeys){var e=Object.keys(this.levelkeys),r=e.length;if(r>1||1===r&&this.levelkeys[e[0]].encrypted)return!0}return!1}}]),e}(c),f=function(t){function e(e,r,i,n,s){var o;(o=t.call(this,i)||this).fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.stats=new a.LoadStats,o.duration=e.decimalFloatingPoint("DURATION"),o.gap=e.bool("GAP"),o.independent=e.bool("INDEPENDENT"),o.relurl=e.enumeratedString("URI"),o.fragment=r,o.index=n;var l=e.enumeratedString("BYTERANGE");return l&&o.setByteRange(l,s),s&&(o.fragOffset=s.fragOffset+s.duration),o}return o(e,t),u(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),e}(c)},"./src/loader/key-loader.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>s});var i=r("./src/errors.ts"),n=r("./src/loader/fragment-loader.ts"),s=function(){function t(t){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=t}var e=t.prototype;return e.abort=function(){for(var t in this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[t].loader;e&&e.abort()}},e.detach=function(){for(var t in this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[t];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[t]}},e.destroy=function(){for(var t in this.detach(),this.keyUriToKeyInfo){var e=this.keyUriToKeyInfo[t].loader;e&&e.destroy()}this.keyUriToKeyInfo={}},e.createKeyLoadError=function(t,e,r,s){return void 0===e&&(e=i.ErrorDetails.KEY_LOAD_ERROR),new n.LoadError({type:i.ErrorTypes.NETWORK_ERROR,details:e,fatal:!1,frag:t,networkDetails:r})},e.loadClear=function(t,e){var r=this;if(this.emeController&&this.config.emeEnabled)for(var i=t.sn,n=t.cc,s=function(t){var s=e[t];if(n<=s.cc&&("initSegment"===i||i<s.sn))return r.emeController.selectKeySystemFormat(s).then((function(t){s.setKeyFormat(t)})),"break"},a=0;a<e.length&&"break"!==s(a);a++);},e.load=function(t){var e=this;return!t.decryptdata&&t.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(t).then((function(r){return e.loadInternal(t,r)})):this.loadInternal(t)},e.loadInternal=function(t,e){var r,n;e&&t.setKeyFormat(e);var s=t.decryptdata;if(!s){var a=e?"Expected frag.decryptdata to be defined after setting format "+e:"Missing decryption data on fragment in onKeyLoading";return Promise.reject(this.createKeyLoadError(t,i.ErrorDetails.KEY_LOAD_ERROR,null,a))}var o=s.uri;if(!o)return Promise.reject(this.createKeyLoadError(t,i.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+o+'"'));var l,d=this.keyUriToKeyInfo[o];if(null!==(r=d)&&void 0!==r&&r.decryptdata.key)return s.key=d.decryptdata.key,Promise.resolve({frag:t,keyInfo:d});if(null!==(n=d)&&void 0!==n&&n.keyLoadPromise)switch(null===(l=d.mediaKeySessionContext)||void 0===l?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return d.keyLoadPromise.then((function(e){return s.key=e.keyInfo.decryptdata.key,{frag:t,keyInfo:d}}))}switch(d=this.keyUriToKeyInfo[o]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===s.keyFormat?this.loadKeyHTTP(d,t):this.loadKeyEME(d,t);case"AES-128":return this.loadKeyHTTP(d,t);default:return Promise.reject(this.createKeyLoadError(t,i.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+s.method+'"'))}},e.loadKeyEME=function(t,e){var r={frag:e,keyInfo:t};if(this.emeController&&this.config.emeEnabled){var i=this.emeController.loadKey(r);if(i)return(t.keyLoadPromise=i.then((function(e){return t.mediaKeySessionContext=e,r}))).catch((function(e){throw t.keyLoadPromise=null,e}))}return Promise.resolve(r)},e.loadKeyHTTP=function(t,e){var r=this,n=this.config,s=new(0,n.loader)(n);return e.keyLoader=t.loader=s,t.keyLoadPromise=new Promise((function(a,o){var l={keyInfo:t,frag:e,responseType:"arraybuffer",url:t.decryptdata.uri},d={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:n.fragLoadingRetryDelay,maxRetryDelay:n.fragLoadingMaxRetryTimeout,highWaterMark:0},u={onSuccess:function(t,e,n,s){var l=n.frag,d=n.keyInfo,u=n.url;if(!l.decryptdata||d!==r.keyUriToKeyInfo[u])return o(r.createKeyLoadError(l,i.ErrorDetails.KEY_LOAD_ERROR,s,"after key load, decryptdata unset or changed"));d.decryptdata.key=l.decryptdata.key=new Uint8Array(t.data),l.keyLoader=null,d.loader=null,a({frag:l,keyInfo:d})},onError:function(t,n,s){r.resetLoader(n),o(r.createKeyLoadError(e,i.ErrorDetails.KEY_LOAD_ERROR,s))},onTimeout:function(t,n,s){r.resetLoader(n),o(r.createKeyLoadError(e,i.ErrorDetails.KEY_LOAD_TIMEOUT,s))},onAbort:function(t,n,s){r.resetLoader(n),o(r.createKeyLoadError(e,i.ErrorDetails.INTERNAL_ABORTED,s))}};s.load(l,d,u)}))},e.resetLoader=function(t){var e=t.frag,r=t.keyInfo,i=t.url,n=r.loader;e.keyLoader===n&&(e.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[i],n&&n.destroy()},t}()},"./src/loader/level-details.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{LevelDetails:()=>s});var i=r("./src/polyfills/number.ts");function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,s=void 0,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?s:String(s)),i)}var n,s}var s=function(){function t(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=t}var e,r,s;return t.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var e=this.lastPartSn-t.lastPartSn,r=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!r||!!e,this.advanced=this.endSN>t.endSN||e>0||0===e&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay},e=t,(r=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&(0,i.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return t>0?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return null!==(t=this.fragments)&&void 0!==t&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&n(e.prototype,r),s&&n(e,s),Object.defineProperty(e,"prototype",{writable:!1}),t}()},"./src/loader/level-key.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{LevelKey:()=>d});var i=r("./src/utils/keysystem-util.ts"),n=r("./src/utils/mediakeys-helper.ts"),s=r("./src/utils/mp4-tools.ts"),a=r("./src/utils/logger.ts"),o=r("./src/utils/numeric-encoding-utils.ts"),l={},d=function(){function t(t,e,r,i,n){void 0===i&&(i=[1]),void 0===n&&(n=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=e,this.keyFormat=r,this.keyFormatVersions=i,this.iv=n,this.encrypted=!!t&&"NONE"!==t,this.isCommonEncryption=this.encrypted&&"AES-128"!==t}t.clearKeyUriToKeyIdMap=function(){l={}};var e=t.prototype;return e.isSupported=function(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;switch(this.keyFormat){case"identity":return"SAMPLE-AES"===this.method;case n.KeySystemFormats.FAIRPLAY:case n.KeySystemFormats.WIDEVINE:case n.KeySystemFormats.PLAYREADY:case n.KeySystemFormats.CLEARKEY:return-1!==["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1},e.getDecryptData=function(e){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof e&&("AES-128"!==this.method||this.iv||a.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),e=0);var r=function(t){for(var e=new Uint8Array(16),r=12;r<16;r++)e[r]=t>>8*(15-r)&255;return e}(e);return new t(this.method,this.uri,"identity",this.keyFormatVersions,r)}var d=(0,i.convertDataUriToArrayBytes)(this.uri);if(d)switch(this.keyFormat){case n.KeySystemFormats.WIDEVINE:this.pssh=d,d.length>=22&&(this.keyId=d.subarray(d.length-22,d.length-6));break;case n.KeySystemFormats.PLAYREADY:var u=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,s.mp4pssh)(u,null,d);var c=new Uint16Array(d.buffer,d.byteOffset,d.byteLength/2),h=String.fromCharCode.apply(null,Array.from(c)),f=h.substring(h.indexOf("<"),h.length),p=(new DOMParser).parseFromString(f,"text/xml").getElementsByTagName("KID")[0];if(p){var v=p.childNodes[0]?p.childNodes[0].nodeValue:p.getAttribute("VALUE");if(v){var g=(0,o.base64Decode)(v).subarray(0,16);(0,i.changeEndianness)(g),this.keyId=g}}break;default:var m=d.subarray(0,16);if(16!==m.length){var y=new Uint8Array(16);y.set(m,16-m.length),m=y}this.keyId=m}if(!this.keyId||16!==this.keyId.byteLength){var E=l[this.uri];if(!E){var T=Object.keys(l).length%Number.MAX_SAFE_INTEGER;E=new Uint8Array(16),new DataView(E.buffer,12,4).setUint32(0,T),l[this.uri]=E}this.keyId=E}return this},t}()},"./src/loader/load-stats.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{LoadStats:()=>i});var i=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>m});var i=r("./src/polyfills/number.ts"),n=r("./node_modules/url-toolkit/src/url-toolkit.js"),s=r("./src/loader/date-range.ts"),a=r("./src/loader/fragment.ts"),o=r("./src/loader/level-details.ts"),l=r("./src/loader/level-key.ts"),d=r("./src/utils/attr-list.ts"),u=r("./src/utils/logger.ts"),c=r("./src/utils/codecs.ts");function h(){return h=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},h.apply(this,arguments)}var f=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,p=/#EXT-X-MEDIA:(.*)/g,v=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),g=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),m=function(){function t(){}return t.findGroup=function(t,e){for(var r=0;r<t.length;r++){var i=t[r];if(i.id===e)return i}},t.convertAVC1ToAVCOTI=function(t){var e=t.split(".");if(e.length>2){var r=e.shift()+".";return r+=parseInt(e.shift()).toString(16),r+=("000"+parseInt(e.shift()).toString(16)).slice(-4)}return t},t.resolve=function(t,e){return(0,n.buildAbsoluteURL)(e,t,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(e,r){var i,n=[],s=[],a={},o=[],l=!1;for(f.lastIndex=0;null!=(i=f.exec(e));)if(i[1]){var c,h=new d.AttrList(i[1]),p={attrs:h,bitrate:h.decimalInteger("AVERAGE-BANDWIDTH")||h.decimalInteger("BANDWIDTH"),name:h.NAME,url:t.resolve(i[2],r)},v=h.decimalResolution("RESOLUTION");v&&(p.width=v.width,p.height=v.height),E((h.CODECS||"").split(/[ ,]+/).filter((function(t){return t})),p),p.videoCodec&&-1!==p.videoCodec.indexOf("avc1")&&(p.videoCodec=t.convertAVC1ToAVCOTI(p.videoCodec)),null!==(c=p.unknownCodecs)&&void 0!==c&&c.length||s.push(p),n.push(p)}else if(i[3]){var g=new d.AttrList(i[3]);g["DATA-ID"]&&(l=!0,a[g["DATA-ID"]]=g)}else if(i[4]){var m=i[4],T=y(m,r);T.encrypted&&T.isSupported()?o.push(T):u.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+m+'"')}return{levels:s.length>0&&s.length<n.length?s:n,sessionData:l?a:null,sessionKeys:o.length?o:null}},t.parseMasterPlaylistMedia=function(e,r,i,n){var s;void 0===n&&(n=[]);var a=[],o=0;for(p.lastIndex=0;null!==(s=p.exec(e));){var l=new d.AttrList(s[1]);if(l.TYPE===i){var u={attrs:l,bitrate:0,id:o++,groupId:l["GROUP-ID"],instreamId:l["INSTREAM-ID"],name:l.NAME||l.LANGUAGE||"",type:i,default:l.bool("DEFAULT"),autoselect:l.bool("AUTOSELECT"),forced:l.bool("FORCED"),lang:l.LANGUAGE,url:l.URI?t.resolve(l.URI,r):""};if(n.length){var c=t.findGroup(n,u.groupId)||n[0];T(u,c,"audioCodec"),T(u,c,"textCodec")}a.push(u)}}return a},t.parseLevelPlaylist=function(t,e,r,n,l){var c,f,p,m=new o.LevelDetails(e),E=m.fragments,T=null,A=0,_=0,I=0,D=0,k=null,w=new a.Fragment(n,e),C=-1,R=!1;for(v.lastIndex=0,m.m3u8=t;null!==(c=v.exec(t));){R&&(R=!1,(w=new a.Fragment(n,e)).start=I,w.sn=A,w.cc=D,w.level=r,T&&(w.initSegment=T,w.rawProgramDateTime=T.rawProgramDateTime,T.rawProgramDateTime=null));var M=c[1];if(M){w.duration=parseFloat(M);var x=(" "+c[2]).slice(1);w.title=x||null,w.tagList.push(x?["INF",M,x]:["INF",M])}else if(c[3])(0,i.isFiniteNumber)(w.duration)&&(w.start=I,p&&L(w,p,m),w.sn=A,w.level=r,w.cc=D,w.urlId=l,E.push(w),w.relurl=(" "+c[3]).slice(1),S(w,k),k=w,I+=w.duration,A++,_=0,R=!0);else if(c[4]){var N=(" "+c[4]).slice(1);k?w.setByteRange(N,k):w.setByteRange(N)}else if(c[5])w.rawProgramDateTime=(" "+c[5]).slice(1),w.tagList.push(["PROGRAM-DATE-TIME",w.rawProgramDateTime]),-1===C&&(C=E.length);else{if(!(c=c[0].match(g))){u.logger.warn("No matches on slow regex match for level playlist!");continue}for(f=1;f<c.length&&void 0===c[f];f++);var P=(" "+c[f]).slice(1),O=(" "+c[f+1]).slice(1),F=c[f+2]?(" "+c[f+2]).slice(1):"";switch(P){case"PLAYLIST-TYPE":m.type=O.toUpperCase();break;case"MEDIA-SEQUENCE":A=m.startSN=parseInt(O);break;case"SKIP":var U=new d.AttrList(O),B=U.decimalInteger("SKIPPED-SEGMENTS");if((0,i.isFiniteNumber)(B)){m.skippedSegments=B;for(var j=B;j--;)E.unshift(null);A+=B}var V=U.enumeratedString("RECENTLY-REMOVED-DATERANGES");V&&(m.recentlyRemovedDateranges=V.split("\t"));break;case"TARGETDURATION":m.targetduration=parseFloat(O);break;case"VERSION":m.version=parseInt(O);break;case"EXTM3U":break;case"ENDLIST":m.live=!1;break;case"#":(O||F)&&w.tagList.push(F?[O,F]:[O]);break;case"DISCONTINUITY":D++,w.tagList.push(["DIS"]);break;case"GAP":w.tagList.push([P]);break;case"BITRATE":w.tagList.push([P,O]);break;case"DATERANGE":var G=new d.AttrList(O),H=new s.DateRange(G,m.dateRanges[G.ID]);H.isValid||m.skippedSegments?m.dateRanges[H.id]=H:u.logger.warn('Ignoring invalid DATERANGE tag: "'+O+'"'),w.tagList.push(["EXT-X-DATERANGE",O]);break;case"DISCONTINUITY-SEQUENCE":D=parseInt(O);break;case"KEY":var z=y(O,e);if(z.isSupported()){if("NONE"===z.method){p=void 0;break}p||(p={}),p[z.keyFormat]&&(p=h({},p)),p[z.keyFormat]=z}else u.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+O+'"');break;case"START":var K=new d.AttrList(O).decimalFloatingPoint("TIME-OFFSET");(0,i.isFiniteNumber)(K)&&(m.startTimeOffset=K);break;case"MAP":var Y=new d.AttrList(O);if(w.duration){var W=new a.Fragment(n,e);b(W,Y,r,p),T=W,w.initSegment=T,T.rawProgramDateTime&&!w.rawProgramDateTime&&(w.rawProgramDateTime=T.rawProgramDateTime)}else b(w,Y,r,p),T=w,R=!0;break;case"SERVER-CONTROL":var Q=new d.AttrList(O);m.canBlockReload=Q.bool("CAN-BLOCK-RELOAD"),m.canSkipUntil=Q.optionalFloat("CAN-SKIP-UNTIL",0),m.canSkipDateRanges=m.canSkipUntil>0&&Q.bool("CAN-SKIP-DATERANGES"),m.partHoldBack=Q.optionalFloat("PART-HOLD-BACK",0),m.holdBack=Q.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Z=new d.AttrList(O);m.partTarget=Z.decimalFloatingPoint("PART-TARGET");break;case"PART":var X=m.partList;X||(X=m.partList=[]);var q=_>0?X[X.length-1]:void 0,J=_++,$=new a.Part(new d.AttrList(O),w,e,J,q);X.push($),w.duration+=$.duration;break;case"PRELOAD-HINT":var tt=new d.AttrList(O);m.preloadHint=tt;break;case"RENDITION-REPORT":var et=new d.AttrList(O);m.renditionReports=m.renditionReports||[],m.renditionReports.push(et);break;default:u.logger.warn("line parsed but not handled: "+c)}}}k&&!k.relurl?(E.pop(),I-=k.duration,m.partList&&(m.fragmentHint=k)):m.partList&&(S(w,k),w.cc=D,m.fragmentHint=w,p&&L(w,p,m));var rt=E.length,it=E[0],nt=E[rt-1];if((I+=m.skippedSegments*m.targetduration)>0&&rt&&nt){m.averagetargetduration=I/rt;var st=nt.sn;m.endSN="initSegment"!==st?st:0,m.live||(nt.endList=!0),it&&(m.startCC=it.cc)}else m.endSN=0,m.startCC=0;return m.fragmentHint&&(I+=m.fragmentHint.duration),m.totalduration=I,m.endCC=D,C>0&&function(t,e){for(var r=t[e],i=e;i--;){var n=t[i];if(!n)return;n.programDateTime=r.programDateTime-1e3*n.duration,r=n}}(E,C),m},t}();function y(t,e){var r,i,n=new d.AttrList(t),s=null!=(r=n.enumeratedString("METHOD"))?r:"",a=n.URI,o=n.hexadecimalInteger("IV"),c=n.enumeratedString("KEYFORMATVERSIONS"),h=null!=(i=n.enumeratedString("KEYFORMAT"))?i:"identity";a&&n.IV&&!o&&u.logger.error("Invalid IV: "+n.IV);var f=a?m.resolve(a,e):"",p=(c||"1").split("/").map(Number).filter(Number.isFinite);return new l.LevelKey(s,f,h,p,o)}function E(t,e){["video","audio","text"].forEach((function(r){var i=t.filter((function(t){return(0,c.isCodecType)(t,r)}));if(i.length){var n=i.filter((function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}));e[r+"Codec"]=n.length>0?n[0]:i[0],t=t.filter((function(t){return-1===i.indexOf(t)}))}})),e.unknownCodecs=t}function T(t,e,r){var i=e[r];i&&(t[r]=i)}function S(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):null!=e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),(0,i.isFiniteNumber)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}function b(t,e,r,i){t.relurl=e.URI,e.BYTERANGE&&t.setByteRange(e.BYTERANGE),t.level=r,t.sn="initSegment",i&&(t.levelkeys=i),t.initSegment=null}function L(t,e,r){t.levelkeys=e;var i=r.encryptedFragments;i.length&&i[i.length-1].levelkeys===e||!Object.keys(e).some((function(t){return e[t].isCommonEncryption}))||i.push(t)}},"./src/loader/playlist-loader.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>c});var i=r("./src/polyfills/number.ts"),n=r("./src/events.ts"),s=r("./src/errors.ts"),a=r("./src/utils/logger.ts"),o=r("./src/loader/m3u8-parser.ts"),l=r("./src/types/loader.ts"),d=r("./src/utils/attr-list.ts");function u(t,e){var r=t.url;return void 0!==r&&0!==r.indexOf("data:")||(r=e.url),r}const c=function(){function t(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}var e=t.prototype;return e.startLoad=function(t){},e.stopLoad=function(){this.destroyInternalLoaders()},e.registerListeners=function(){var t=this.hls;t.on(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(n.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(n.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(n.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.unregisterListeners=function(){var t=this.hls;t.off(n.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(n.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(n.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(n.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.createInternalLoader=function(t){var e=this.hls.config,r=e.pLoader,i=e.loader,n=new(r||i)(e);return t.loader=n,this.loaders[t.type]=n,n},e.getInternalLoader=function(t){return this.loaders[t.type]},e.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},e.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},e.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},e.onManifestLoading=function(t,e){var r=e.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:l.PlaylistContextType.MANIFEST,url:r,deliveryDirectives:null})},e.onLevelLoading=function(t,e){var r=e.id,i=e.level,n=e.url,s=e.deliveryDirectives;this.load({id:r,groupId:null,level:i,responseType:"text",type:l.PlaylistContextType.LEVEL,url:n,deliveryDirectives:s})},e.onAudioTrackLoading=function(t,e){var r=e.id,i=e.groupId,n=e.url,s=e.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:l.PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:s})},e.onSubtitleTrackLoading=function(t,e){var r=e.id,i=e.groupId,n=e.url,s=e.deliveryDirectives;this.load({id:r,groupId:i,level:null,responseType:"text",type:l.PlaylistContextType.SUBTITLE_TRACK,url:n,deliveryDirectives:s})},e.load=function(t){var e,r,i,n,s,o,d=this.hls.config,u=this.getInternalLoader(t);if(u){var c=u.context;if(c&&c.url===t.url)return void a.logger.trace("[playlist-loader]: playlist request ongoing");a.logger.log("[playlist-loader]: aborting previous loader for type: "+t.type),u.abort()}switch(t.type){case l.PlaylistContextType.MANIFEST:r=d.manifestLoadingMaxRetry,i=d.manifestLoadingTimeOut,n=d.manifestLoadingRetryDelay,s=d.manifestLoadingMaxRetryTimeout;break;case l.PlaylistContextType.LEVEL:case l.PlaylistContextType.AUDIO_TRACK:case l.PlaylistContextType.SUBTITLE_TRACK:r=0,i=d.levelLoadingTimeOut;break;default:r=d.levelLoadingMaxRetry,i=d.levelLoadingTimeOut,n=d.levelLoadingRetryDelay,s=d.levelLoadingMaxRetryTimeout}if(u=this.createInternalLoader(t),null!==(e=t.deliveryDirectives)&&void 0!==e&&e.part&&(t.type===l.PlaylistContextType.LEVEL&&null!==t.level?o=this.hls.levels[t.level].details:t.type===l.PlaylistContextType.AUDIO_TRACK&&null!==t.id?o=this.hls.audioTracks[t.id].details:t.type===l.PlaylistContextType.SUBTITLE_TRACK&&null!==t.id&&(o=this.hls.subtitleTracks[t.id].details),o)){var h=o.partTarget,f=o.targetduration;h&&f&&(i=Math.min(1e3*Math.max(3*h,.8*f),i))}var p={timeout:i,maxRetry:r,retryDelay:n,maxRetryDelay:s,highWaterMark:0},v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(t,p,v)},e.loadsuccess=function(t,e,r,i){void 0===i&&(i=null),this.resetInternalLoader(r.type);var n=t.data;0===n.indexOf("#EXTM3U")?(e.parsing.start=performance.now(),n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,e,r,i):this.handleMasterPlaylist(t,e,r,i)):this.handleManifestParsingError(t,r,"no EXTM3U delimiter",i)},e.loaderror=function(t,e,r){void 0===r&&(r=null),this.handleNetworkError(e,r,!1,t)},e.loadtimeout=function(t,e,r){void 0===r&&(r=null),this.handleNetworkError(e,r,!0)},e.handleMasterPlaylist=function(t,e,r,i){var s=this.hls,l=t.data,c=u(t,r),h=o.default.parseMasterPlaylist(l,c),f=h.levels,p=h.sessionData,v=h.sessionKeys;if(f.length){var g=f.map((function(t){return{id:t.attrs.AUDIO,audioCodec:t.audioCodec}})),m=f.map((function(t){return{id:t.attrs.SUBTITLES,textCodec:t.textCodec}})),y=o.default.parseMasterPlaylistMedia(l,c,"AUDIO",g),E=o.default.parseMasterPlaylistMedia(l,c,"SUBTITLES",m),T=o.default.parseMasterPlaylistMedia(l,c,"CLOSED-CAPTIONS");y.length&&(y.some((function(t){return!t.url}))||!f[0].audioCodec||f[0].attrs.AUDIO||(a.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),y.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new d.AttrList({}),bitrate:0,url:""}))),s.trigger(n.Events.MANIFEST_LOADED,{levels:f,audioTracks:y,subtitles:E,captions:T,url:c,stats:e,networkDetails:i,sessionData:p,sessionKeys:v})}else this.handleManifestParsingError(t,r,"no level found in manifest",i)},e.handleTrackOrLevelPlaylist=function(t,e,r,a){var c=this.hls,h=r.id,f=r.level,p=r.type,v=u(t,r),g=(0,i.isFiniteNumber)(h)?h:0,m=(0,i.isFiniteNumber)(f)?f:g,y=function(t){switch(t.type){case l.PlaylistContextType.AUDIO_TRACK:return l.PlaylistLevelType.AUDIO;case l.PlaylistContextType.SUBTITLE_TRACK:return l.PlaylistLevelType.SUBTITLE;default:return l.PlaylistLevelType.MAIN}}(r),E=o.default.parseLevelPlaylist(t.data,v,m,y,g);if(E.fragments.length){if(p===l.PlaylistContextType.MANIFEST){var T={attrs:new d.AttrList({}),bitrate:0,details:E,name:"",url:v};c.trigger(n.Events.MANIFEST_LOADED,{levels:[T],audioTracks:[],url:v,stats:e,networkDetails:a,sessionData:null,sessionKeys:null})}e.parsing.end=performance.now(),r.levelDetails=E,this.handlePlaylistLoaded(t,e,r,a)}else c.trigger(n.Events.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:v,reason:"no fragments found in level",level:"number"==typeof r.level?r.level:void 0})},e.handleManifestParsingError=function(t,e,r,i){this.hls.trigger(n.Events.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:e.type===l.PlaylistContextType.MANIFEST,url:t.url,reason:r,response:t,context:e,networkDetails:i})},e.handleNetworkError=function(t,e,r,i){void 0===r&&(r=!1),a.logger.warn("[playlist-loader]: A network "+(r?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var o=s.ErrorDetails.UNKNOWN,d=!1,u=this.getInternalLoader(t);switch(t.type){case l.PlaylistContextType.MANIFEST:o=r?s.ErrorDetails.MANIFEST_LOAD_TIMEOUT:s.ErrorDetails.MANIFEST_LOAD_ERROR,d=!0;break;case l.PlaylistContextType.LEVEL:o=r?s.ErrorDetails.LEVEL_LOAD_TIMEOUT:s.ErrorDetails.LEVEL_LOAD_ERROR,d=!1;break;case l.PlaylistContextType.AUDIO_TRACK:o=r?s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case l.PlaylistContextType.SUBTITLE_TRACK:o=r?s.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:s.ErrorDetails.SUBTITLE_LOAD_ERROR,d=!1}u&&this.resetInternalLoader(t.type);var c={type:s.ErrorTypes.NETWORK_ERROR,details:o,fatal:d,url:t.url,loader:u,context:t,networkDetails:e};i&&(c.response=i),this.hls.trigger(n.Events.ERROR,c)},e.handlePlaylistLoaded=function(t,e,r,i){var s=r.type,a=r.level,o=r.id,d=r.groupId,u=r.loader,c=r.levelDetails,h=r.deliveryDirectives;if(null!=c&&c.targetduration){if(u)switch(c.live&&(u.getCacheAge&&(c.ageHeader=u.getCacheAge()||0),u.getCacheAge&&!isNaN(c.ageHeader)||(c.ageHeader=0)),s){case l.PlaylistContextType.MANIFEST:case l.PlaylistContextType.LEVEL:this.hls.trigger(n.Events.LEVEL_LOADED,{details:c,level:a||0,id:o||0,stats:e,networkDetails:i,deliveryDirectives:h});break;case l.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(n.Events.AUDIO_TRACK_LOADED,{details:c,id:o||0,groupId:d||"",stats:e,networkDetails:i,deliveryDirectives:h});break;case l.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(n.Events.SUBTITLE_TRACK_LOADED,{details:c,id:o||0,groupId:d||"",stats:e,networkDetails:i,deliveryDirectives:h})}}else this.handleManifestParsingError(t,r,"invalid target duration",i)},t}()},"./src/polyfills/number.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{MAX_SAFE_INTEGER:()=>n,isFiniteNumber:()=>i});var i=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},n=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>i});const i=function(){function t(){}return t.getSilentFrame=function(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},t}()},"./src/remux/mp4-generator.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>s});var i=Math.pow(2,32)-1,n=function(){function t(){}return t.init=function(){var e;for(e in t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:r,audio:i};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=s,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,a,l,a,o),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,n))},t.box=function(t){for(var e=8,r=arguments.length,i=new Array(r>1?r-1:0),n=1;n<r;n++)i[n-1]=arguments[n];for(var s=i.length,a=s;s--;)e+=i[s].byteLength;var o=new Uint8Array(e);for(o[0]=e>>24&255,o[1]=e>>16&255,o[2]=e>>8&255,o[3]=255&e,o.set(t,4),s=0,e=8;s<a;s++)o.set(i[s],e),e+=i[s].byteLength;return o},t.hdlr=function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])},t.mdat=function(e){return t.box(t.types.mdat,e)},t.mdhd=function(e,r){r*=e;var n=Math.floor(r/(i+1)),s=Math.floor(r%(i+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s,85,196,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))},t.mfhd=function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},t.minf=function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))},t.moof=function(e,r,i){return t.box(t.types.moof,t.mfhd(e),t.traf(i,r))},t.moov=function(e){for(var r=e.length,i=[];r--;)i[r]=t.trak(e[r]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(t.mvex(e)))},t.mvex=function(e){for(var r=e.length,i=[];r--;)i[r]=t.trex(e[r]);return t.box.apply(null,[t.types.mvex].concat(i))},t.mvhd=function(e,r){r*=e;var n=Math.floor(r/(i+1)),s=Math.floor(r%(i+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,a)},t.sdtp=function(e){var r,i,n=e.samples||[],s=new Uint8Array(4+n.length);for(r=0;r<n.length;r++)i=n[r].flags,s[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return t.box(t.types.sdtp,s)},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(e){var r,i,n,s=[],a=[];for(r=0;r<e.sps.length;r++)n=(i=e.sps[r]).byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(i));for(r=0;r<e.pps.length;r++)n=(i=e.pps[r]).byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(i));var o=t.box(t.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|e.sps.length].concat(s).concat([e.pps.length]).concat(a))),l=e.width,d=e.height,u=e.pixelRatio[0],c=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c])))},t.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},t.mp4a=function(e){var r=e.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),t.box(t.types.esds,t.esds(e)))},t.mp3=function(e){var r=e.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))},t.stsd=function(e){return"audio"===e.type?"mp3"===e.segmentCodec&&"mp3"===e.codec?t.box(t.types.stsd,t.STSD,t.mp3(e)):t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))},t.tkhd=function(e){var r=e.id,n=e.duration*e.timescale,s=e.width,a=e.height,o=Math.floor(n/(i+1)),l=Math.floor(n%(i+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,a>>8&255,255&a,0,0]))},t.traf=function(e,r){var n=t.sdtp(e),s=e.id,a=Math.floor(r/(i+1)),o=Math.floor(r%(i+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o])),t.trun(e,n.length+16+20+8+16+8+8),n)},t.trak=function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.trex=function(e){var r=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(e,r){var i,n,s,a,o,l,d=e.samples||[],u=d.length,c=12+16*u,h=new Uint8Array(c);for(r+=8+c,h.set(["video"===e.type?1:0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),i=0;i<u;i++)s=(n=d[i]).duration,a=n.size,o=n.flags,l=n.cts,h.set([s>>>24&255,s>>>16&255,s>>>8&255,255&s,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return t.box(t.types.trun,h)},t.initSegment=function(e){t.types||t.init();var r=t.moov(e),i=new Uint8Array(t.FTYP.byteLength+r.byteLength);return i.set(t.FTYP),i.set(r,t.FTYP.byteLength),i},t}();n.types=void 0,n.HDLR_TYPES=void 0,n.STTS=void 0,n.STSC=void 0,n.STCO=void 0,n.STSZ=void 0,n.VMHD=void 0,n.SMHD=void 0,n.STSD=void 0,n.FTYP=void 0,n.DINF=void 0;const s=n},"./src/remux/mp4-remuxer.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>p,flushTextTrackMetadataCueSamples:()=>g,flushTextTrackUserdataCueSamples:()=>m,normalizePts:()=>v});var i=r("./src/polyfills/number.ts"),n=r("./src/remux/aac-helper.ts"),s=r("./src/remux/mp4-generator.ts"),a=r("./src/events.ts"),o=r("./src/errors.ts"),l=r("./src/utils/logger.ts"),d=r("./src/types/loader.ts"),u=r("./src/utils/timescale-conversion.ts");function c(){return c=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},c.apply(this,arguments)}var h=null,f=null,p=function(){function t(t,e,r,i){if(void 0===i&&(i=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=e,this.typeSupported=r,this.ISGenerated=!1,null===h){var n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);h=n?parseInt(n[1]):0}if(null===f){var s=navigator.userAgent.match(/Safari\/(\d+)/i);f=s?parseInt(s[1]):0}}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(t){l.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},e.resetNextTimestamp=function(){l.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},e.resetInitSegment=function(){l.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},e.getVideoStartPts=function(t){var e=!1,r=t.reduce((function(t,r){var i=r.pts-t;return i<-4294967296?(e=!0,v(t,r.pts)):i>0?t:r.pts}),t[0].pts);return e&&l.logger.debug("PTS rollover detected"),r},e.remux=function(t,e,r,i,n,s,a,o){var u,c,h,f,p,y,E=n,T=n,S=t.pid>-1,b=e.pid>-1,L=e.samples.length,A=t.samples.length>0,_=a&&L>0||L>1;if((!S||A)&&(!b||_)||this.ISGenerated||a){this.ISGenerated||(h=this.generateIS(t,e,n));var I,D=this.isVideoContiguous,k=-1;if(_&&(k=function(t){for(var e=0;e<t.length;e++)if(t[e].key)return e;return-1}(e.samples),!D&&this.config.forceKeyFrameOnDiscontinuity))if(y=!0,k>0){l.logger.warn("[mp4-remuxer]: Dropped "+k+" out of "+L+" video samples due to a missing keyframe");var w=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(k),e.dropped+=k,I=T+=(e.samples[0].pts-w)/e.inputTimeScale}else-1===k&&(l.logger.warn("[mp4-remuxer]: No keyframe found out of "+L+" video samples"),y=!1);if(this.ISGenerated){if(A&&_){var C=this.getVideoStartPts(e.samples),R=(v(t.samples[0].pts,C)-C)/e.inputTimeScale;E+=Math.max(0,R),T+=Math.max(0,-R)}if(A){if(t.samplerate||(l.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),h=this.generateIS(t,e,n)),c=this.remuxAudio(t,E,this.isAudioContiguous,s,b||_||o===d.PlaylistLevelType.AUDIO?T:void 0),_){var M=c?c.endPTS-c.startPTS:0;e.inputTimeScale||(l.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),h=this.generateIS(t,e,n)),u=this.remuxVideo(e,T,D,M)}}else _&&(u=this.remuxVideo(e,T,D,0));u&&(u.firstKeyFrame=k,u.independent=-1!==k,u.firstKeyFramePTS=I)}}return this.ISGenerated&&(r.samples.length&&(p=g(r,n,this._initPTS,this._initDTS)),i.samples.length&&(f=m(i,n,this._initPTS))),{audio:c,video:u,initSegment:h,independent:y,text:f,id3:p}},e.generateIS=function(t,e,r){var n,a,o,l=t.samples,d=e.samples,u=this.typeSupported,c={},h=!(0,i.isFiniteNumber)(this._initPTS),f="audio/mp4";if(h&&(n=a=1/0),t.config&&l.length&&(t.timescale=t.samplerate,"mp3"===t.segmentCodec&&(u.mpeg?(f="audio/mpeg",t.codec=""):u.mp3&&(t.codec="mp3")),c.audio={id:"audio",container:f,codec:t.codec,initSegment:"mp3"===t.segmentCodec&&u.mpeg?new Uint8Array(0):s.default.initSegment([t]),metadata:{channelCount:t.channelCount}},h&&(o=t.inputTimeScale,n=a=l[0].pts-Math.round(o*r))),e.sps&&e.pps&&d.length&&(e.timescale=e.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:s.default.initSegment([e]),metadata:{width:e.width,height:e.height}},h)){o=e.inputTimeScale;var p=this.getVideoStartPts(d),g=Math.round(o*r);a=Math.min(a,v(d[0].dts,p)-g),n=Math.min(n,p-g)}if(Object.keys(c).length)return this.ISGenerated=!0,h&&(this._initPTS=n,this._initDTS=a),{tracks:c,initPTS:n,timescale:o}},e.remuxVideo=function(t,e,r,i){var n,d,p=t.inputTimeScale,g=t.samples,m=[],E=g.length,T=this._initPTS,S=this.nextAvcDts,b=8,L=this.videoSampleDuration,A=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,I=!1;r&&null!==S||(S=e*p-(g[0].pts-v(g[0].dts,g[0].pts)));for(var D=0;D<E;D++){var k=g[D];k.pts=v(k.pts-T,S),k.dts=v(k.dts-T,S),k.dts<g[D>0?D-1:D].dts&&(I=!0)}I&&g.sort((function(t,e){var r=t.dts-e.dts,i=t.pts-e.pts;return r||i})),n=g[0].dts;var w=(d=g[g.length-1].dts)-n,C=w?Math.round(w/(E-1)):L||t.inputTimeScale/30;if(r){var R=n-S,M=R>C,x=R<-1;if((M||x)&&(M?l.logger.warn("AVC: "+(0,u.toMsFromMpegTsClock)(R,!0)+" ms ("+R+"dts) hole between fragments detected, filling it"):l.logger.warn("AVC: "+(0,u.toMsFromMpegTsClock)(-R,!0)+" ms ("+R+"dts) overlapping between fragments detected"),!x||S>g[0].pts)){n=S;var N=g[0].pts-R;g[0].dts=n,g[0].pts=N,l.logger.log("Video: First PTS/DTS adjusted: "+(0,u.toMsFromMpegTsClock)(N,!0)+"/"+(0,u.toMsFromMpegTsClock)(n,!0)+", delta: "+(0,u.toMsFromMpegTsClock)(R,!0)+" ms")}}n=Math.max(0,n);for(var P=0,O=0,F=0;F<E;F++){for(var U=g[F],B=U.units,j=B.length,V=0,G=0;G<j;G++)V+=B[G].data.length;O+=V,P+=j,U.length=V,U.dts=Math.max(U.dts,n),A=Math.min(U.pts,A),_=Math.max(U.pts,_)}d=g[E-1].dts;var H,z=O+4*P+8;try{H=new Uint8Array(z)}catch(t){return void this.observer.emit(a.Events.ERROR,a.Events.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:z,reason:"fail allocating video mdat "+z})}var K=new DataView(H.buffer);K.setUint32(0,z),H.set(s.default.types.mdat,4);for(var Y=!1,W=Number.POSITIVE_INFINITY,Q=Number.POSITIVE_INFINITY,Z=Number.NEGATIVE_INFINITY,X=Number.NEGATIVE_INFINITY,q=0;q<E;q++){for(var J=g[q],$=J.units,tt=0,et=0,rt=$.length;et<rt;et++){var it=$[et],nt=it.data,st=it.data.byteLength;K.setUint32(b,st),b+=4,H.set(nt,b),b+=st,tt+=4+st}var at=void 0;if(q<E-1)L=g[q+1].dts-J.dts,at=g[q+1].pts-J.pts;else{var ot=this.config,lt=q>0?J.dts-g[q-1].dts:C;if(at=q>0?J.pts-g[q-1].pts:C,ot.stretchShortVideoTrack&&null!==this.nextAudioPts){var dt=Math.floor(ot.maxBufferHole*p),ut=(i?A+i*p:this.nextAudioPts)-J.pts;ut>dt?((L=ut-lt)<0?L=lt:Y=!0,l.logger.log("[mp4-remuxer]: It is approximately "+ut/90+" ms to the next segment; using duration "+L/90+" ms for the last video frame.")):L=lt}else L=lt}var ct=Math.round(J.pts-J.dts);W=Math.min(W,L),Z=Math.max(Z,L),Q=Math.min(Q,at),X=Math.max(X,at),m.push(new y(J.key,L,tt,ct))}if(m.length)if(h){if(h<70){var ht=m[0].flags;ht.dependsOn=2,ht.isNonSync=0}}else if(f&&X-Q<Z-W&&C/Z<.025&&0===m[0].cts){l.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var ft=n,pt=0,vt=m.length;pt<vt;pt++){var gt=ft+m[pt].duration,mt=ft+m[pt].cts;if(pt<vt-1){var yt=gt+m[pt+1].cts;m[pt].duration=yt-mt}else m[pt].duration=pt?m[pt-1].duration:C;m[pt].cts=0,ft=gt}}L=Y||!L?C:L,this.nextAvcDts=S=d+L,this.videoSampleDuration=L,this.isVideoContiguous=!0;var Et={data1:s.default.moof(t.sequenceNumber++,n,c({},t,{samples:m})),data2:H,startPTS:A/p,endPTS:(_+L)/p,startDTS:n/p,endDTS:S/p,type:"video",hasAudio:!1,hasVideo:!0,nb:m.length,dropped:t.dropped};return t.samples=[],t.dropped=0,Et},e.remuxAudio=function(t,e,r,i,d){var u=t.inputTimeScale,h=u/(t.samplerate?t.samplerate:u),f="aac"===t.segmentCodec?1024:1152,p=f*h,g=this._initPTS,m="mp3"===t.segmentCodec&&this.typeSupported.mpeg,E=[],T=void 0!==d,S=t.samples,b=m?0:8,L=this.nextAudioPts||-1,A=e*u;if(this.isAudioContiguous=r=r||S.length&&L>0&&(i&&Math.abs(A-L)<9e3||Math.abs(v(S[0].pts-g,A)-L)<20*p),S.forEach((function(t){t.pts=v(t.pts-g,A)})),!r||L<0){if(S=S.filter((function(t){return t.pts>=0})),!S.length)return;L=0===d?0:i&&!T?Math.max(0,A):S[0].pts}if("aac"===t.segmentCodec)for(var _=this.config.maxAudioFramesDrift,I=0,D=L;I<S.length;I++){var k=S[I],w=k.pts,C=w-D,R=Math.abs(1e3*C/u);if(C<=-_*p&&T)0===I&&(l.logger.warn("Audio frame @ "+(w/u).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*C/u)+" ms."),this.nextAudioPts=L=D=w);else if(C>=_*p&&R<1e4&&T){var M=Math.round(C/p);(D=w-M*p)<0&&(M--,D+=p),0===I&&(this.nextAudioPts=L=D),l.logger.warn("[mp4-remuxer]: Injecting "+M+" audio frame @ "+(D/u).toFixed(3)+"s due to "+Math.round(1e3*C/u)+" ms gap.");for(var x=0;x<M;x++){var N=Math.max(D,0),P=n.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);P||(l.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),P=k.unit.subarray()),S.splice(I,0,{unit:P,pts:N}),D+=p,I++}}k.pts=D,D+=p}for(var O,F=null,U=null,B=0,j=S.length;j--;)B+=S[j].unit.byteLength;for(var V=0,G=S.length;V<G;V++){var H=S[V],z=H.unit,K=H.pts;if(null!==U)E[V-1].duration=Math.round((K-U)/h);else{if(r&&"aac"===t.segmentCodec&&(K=L),F=K,!(B>0))return;B+=b;try{O=new Uint8Array(B)}catch(t){return void this.observer.emit(a.Events.ERROR,a.Events.ERROR,{type:o.ErrorTypes.MUX_ERROR,details:o.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:B,reason:"fail allocating audio mdat "+B})}m||(new DataView(O.buffer).setUint32(0,B),O.set(s.default.types.mdat,4))}O.set(z,b);var Y=z.byteLength;b+=Y,E.push(new y(!0,f,Y,0)),U=K}var W=E.length;if(W){var Q=E[E.length-1];this.nextAudioPts=L=U+h*Q.duration;var Z=m?new Uint8Array(0):s.default.moof(t.sequenceNumber++,F/h,c({},t,{samples:E}));t.samples=[];var X=F/u,q=L/u,J={data1:Z,data2:O,startPTS:X,endPTS:q,startDTS:X,endDTS:q,type:"audio",hasAudio:!0,hasVideo:!1,nb:W};return this.isAudioContiguous=!0,J}},e.remuxEmptyAudio=function(t,e,r,i){var s=t.inputTimeScale,a=s/(t.samplerate?t.samplerate:s),o=this.nextAudioPts,d=(null!==o?o:i.startDTS*s)+this._initDTS,u=i.endDTS*s+this._initDTS,c=1024*a,h=Math.ceil((u-d)/c),f=n.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(l.logger.warn("[mp4-remuxer]: remux empty Audio"),f){for(var p=[],v=0;v<h;v++){var g=d+v*c;p.push({unit:f,pts:g,dts:g})}return t.samples=p,this.remuxAudio(t,e,r,!1)}l.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},t}();function v(t,e){var r;if(null===e)return t;for(r=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=r;return t}function g(t,e,r,i){var n=t.samples.length;if(n){for(var s=t.inputTimeScale,a=0;a<n;a++){var o=t.samples[a];o.pts=v(o.pts-r,e*s)/s,o.dts=v(o.dts-i,e*s)/s}var l=t.samples;return t.samples=[],{samples:l}}}function m(t,e,r){var i=t.samples.length;if(i){for(var n=t.inputTimeScale,s=0;s<i;s++){var a=t.samples[s];a.pts=v(a.pts-r,e*n)/n}t.samples.sort((function(t,e){return t.pts-e.pts}));var o=t.samples;return t.samples=[],{samples:o}}}var y=function(t,e,r,i){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=r,this.cts=i,this.flags=new E(t)},E=function(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}},"./src/remux/passthrough-remuxer.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>d});var i=r("./src/polyfills/number.ts"),n=r("./src/remux/mp4-remuxer.ts"),s=r("./src/utils/mp4-tools.ts"),a=r("./src/loader/fragment.ts"),o=r("./src/utils/logger.ts");function l(t,e){var r=null==t?void 0:t.codec;return r&&r.length>4?r:"hvc1"===r||"hev1"===r?"hvc1.1.c.L120.90":"av01"===r?"av01.0.04M.08":"avc1"===r||e===a.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const d=function(){function t(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(t){this.initPTS=t,this.lastEndTime=null},e.resetNextTimestamp=function(){this.lastEndTime=null},e.resetInitSegment=function(t,e,r,i){this.audioCodec=e,this.videoCodec=r,this.generateInitSegment((0,s.patchEncyptionData)(t,i)),this.emitInitSegment=!0},e.generateInitSegment=function(t){var e=this.audioCodec,r=this.videoCodec;if(!t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var i=this.initData=(0,s.parseInitSegment)(t);e||(e=l(i.audio,a.ElementaryStreamTypes.AUDIO)),r||(r=l(i.video,a.ElementaryStreamTypes.VIDEO));var n={};i.audio&&i.video?n.audiovideo={container:"video/mp4",codec:e+","+r,initSegment:t,id:"main"}:i.audio?n.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:i.video?n.video={container:"video/mp4",codec:r,initSegment:t,id:"main"}:o.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n},e.remux=function(t,e,r,a,l){var d,u=this.initPTS,c=this.lastEndTime,h={audio:void 0,video:void 0,text:a,id3:r,initSegment:void 0};(0,i.isFiniteNumber)(c)||(c=this.lastEndTime=l||0);var f=e.samples;if(!f||!f.length)return h;var p={initPTS:void 0,timescale:1},v=this.initData;if(v&&v.length||(this.generateInitSegment(f),v=this.initData),!v||!v.length)return o.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),h;this.emitInitSegment&&(p.tracks=this.initTracks,this.emitInitSegment=!1);var g=(0,s.getStartDTS)(v,f);(0,i.isFiniteNumber)(u)||(this.initPTS=p.initPTS=u=g-l);var m=(0,s.getDuration)(f,v),y=t?g-u:c,E=y+m;(0,s.offsetStartDTS)(v,f,u),m>0?this.lastEndTime=E:(o.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var T=!!v.audio,S=!!v.video,b="";T&&(b+="audio"),S&&(b+="video");var L={data1:f,startPTS:y,startDTS:y,endPTS:E,endDTS:E,type:b,hasAudio:T,hasVideo:S,nb:1,dropped:0};h.audio="audio"===L.type?L:void 0,h.video="audio"!==L.type?L:void 0,h.initSegment=p;var A=null!=(d=this.initPTS)?d:0;return h.id3=(0,n.flushTextTrackMetadataCueSamples)(r,l,A,A),a.samples.length&&(h.text=(0,n.flushTextTrackUserdataCueSamples)(a,l,A)),h},t}()},"./src/task-loop.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>i});var i=function(){function t(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var e=t.prototype;return e.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},e.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},e.onHandlerDestroyed=function(){},e.hasInterval=function(){return!!this._tickInterval},e.hasNextTick=function(){return!!this._tickTimer},e.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,t),!0)},e.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},e.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},e.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},e.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},e.doTick=function(){},t}()},"./src/types/cmcd.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{CMCDObjectType:()=>i,CMCDStreamType:()=>s,CMCDStreamingFormat:()=>n,CMCDVersion:()=>a});var i,n,s,a=1;!function(t){t.MANIFEST="m",t.AUDIO="a",t.VIDEO="v",t.MUXED="av",t.INIT="i",t.CAPTION="c",t.TIMED_TEXT="tt",t.KEY="k",t.OTHER="o"}(i||(i={})),function(t){t.DASH="d",t.HLS="h",t.SMOOTH="s",t.OTHER="o"}(n||(n={})),function(t){t.VOD="v",t.LIVE="l"}(s||(s={}))},"./src/types/demuxer.ts":(t,e,r)=>{"use strict";var i;r.r(e),r.d(e,{MetadataSchema:()=>i}),function(t){t.audioId3="org.id3",t.dateRange="com.apple.quicktime.HLS",t.emsg="https://aomedia.org/emsg/ID3"}(i||(i={}))},"./src/types/level.ts":(t,e,r)=>{"use strict";function i(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,s=void 0,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(n,"string"))?s:String(s)),i)}var n,s}r.r(e),r.d(e,{HdcpLevels:()=>s,HlsSkip:()=>n,HlsUrlParameters:()=>o,Level:()=>l,getSkipValue:()=>a});var n,s=["NONE","TYPE-0","TYPE-1","TYPE-2",null];function a(t,e){var r=t.canSkipUntil,i=t.canSkipDateRanges,s=t.endSN;return r&&(void 0!==e?e-s:0)<r?i?n.v2:n.Yes:n.No}!function(t){t.No="",t.Yes="YES",t.v2="v2"}(n||(n={}));var o=function(){function t(t,e,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=r}return t.prototype.addDirectives=function(t){var e=new self.URL(t);return void 0!==this.msn&&e.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href},t}(),l=function(){function t(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter((function(t){return t})).join(",").replace(/\.[^.,]+/g,"")}var e,r,n;return e=t,(r=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){var e=t%this.url.length;this._urlId!==e&&(this.details=void 0,this._urlId=e)}}])&&i(e.prototype,r),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}()},"./src/types/loader.ts":(t,e,r)=>{"use strict";var i,n;r.r(e),r.d(e,{PlaylistContextType:()=>i,PlaylistLevelType:()=>n}),function(t){t.MANIFEST="manifest",t.LEVEL="level",t.AUDIO_TRACK="audioTrack",t.SUBTITLE_TRACK="subtitleTrack"}(i||(i={})),function(t){t.MAIN="main",t.AUDIO="audio",t.SUBTITLE="subtitle"}(n||(n={}))},"./src/types/transmuxer.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{ChunkMetadata:()=>i});var i=function(t,e,r,i,n,s){void 0===i&&(i=0),void 0===n&&(n=-1),void 0===s&&(s=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=e,this.id=r,this.size=i,this.part=n,this.partial=s}},"./src/utils/attr-list.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{AttrList:()=>s});var i=/^(\d+)x(\d+)$/,n=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,s=function(){function t(e){for(var r in"string"==typeof e&&(e=t.parseAttrList(e)),e)e.hasOwnProperty(r)&&(this[r]=e[r])}var e=t.prototype;return e.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var r=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)r[i]=parseInt(e.slice(2*i,2*i+2),16);return r}return null},e.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.decimalFloatingPoint=function(t){return parseFloat(this[t])},e.optionalFloat=function(t,e){var r=this[t];return r?parseFloat(r):e},e.enumeratedString=function(t){return this[t]},e.bool=function(t){return"YES"===this[t]},e.decimalResolution=function(t){var e=i.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},t.parseAttrList=function(t){var e,r={};for(n.lastIndex=0;null!==(e=n.exec(t));){var i=e[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[e[1]]=i}return r},t}()},"./src/utils/binary-search.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>i});const i={search:function(t,e){for(var r=0,i=t.length-1,n=null,s=null;r<=i;){var a=e(s=t[n=(r+i)/2|0]);if(a>0)r=n+1;else{if(!(a<0))return s;i=n-1}}return null}}},"./src/utils/buffer-helper.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{BufferHelper:()=>s});var i=r("./src/utils/logger.ts"),n={length:0,start:function(){return 0},end:function(){return 0}},s=function(){function t(){}return t.isBuffered=function(e,r){try{if(e)for(var i=t.getBuffered(e),n=0;n<i.length;n++)if(r>=i.start(n)&&r<=i.end(n))return!0}catch(t){}return!1},t.bufferInfo=function(e,r,i){try{if(e){var n,s=t.getBuffered(e),a=[];for(n=0;n<s.length;n++)a.push({start:s.start(n),end:s.end(n)});return this.bufferedInfo(a,r,i)}}catch(t){}return{len:0,start:r,end:r,nextStart:void 0}},t.bufferedInfo=function(t,e,r){e=Math.max(0,e),t.sort((function(t,e){var r=t.start-e.start;return r||e.end-t.end}));var i=[];if(r)for(var n=0;n<t.length;n++){var s=i.length;if(s){var a=i[s-1].end;t[n].start-a<r?t[n].end>a&&(i[s-1].end=t[n].end):i.push(t[n])}else i.push(t[n])}else i=t;for(var o,l=0,d=e,u=e,c=0;c<i.length;c++){var h=i[c].start,f=i[c].end;if(e+r>=h&&e<f)d=h,l=(u=f)-e;else if(e+r<h){o=h;break}}return{len:l,start:d||0,end:u||0,nextStart:o}},t.getBuffered=function(t){try{return t.buffered}catch(t){return i.logger.log("failed to get media.buffered",t),n}},t}()},"./src/utils/cea-608-parser.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{CaptionScreen:()=>E,Row:()=>y,default:()=>L});var i,n=r("./src/utils/logger.ts"),s={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},a=function(t){var e=t;return s.hasOwnProperty(t)&&(e=s[t]),String.fromCharCode(e)},o=15,l=100,d={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},u={17:2,18:4,21:6,22:8,23:10,19:13,20:15},c={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},h={25:2,26:4,29:6,30:8,31:10,27:13,28:15},f=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(t){t[t.ERROR=0]="ERROR",t[t.TEXT=1]="TEXT",t[t.WARNING=2]="WARNING",t[t.INFO=2]="INFO",t[t.DEBUG=3]="DEBUG",t[t.DATA=3]="DATA"}(i||(i={}));var p=function(){function t(){this.time=null,this.verboseLevel=i.ERROR}return t.prototype.log=function(t,e){if(this.verboseLevel>=t){var r="function"==typeof e?e():e;n.logger.log(this.time+" ["+t+"] "+r)}},t}(),v=function(t){for(var e=[],r=0;r<t.length;r++)e.push(t[r].toString(16));return e},g=function(){function t(t,e,r,i,n){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=r||!1,this.background=i||"black",this.flash=n||!1}var e=t.prototype;return e.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},e.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],r=0;r<e.length;r++){var i=e[r];t.hasOwnProperty(i)&&(this[i]=t[i])}},e.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},e.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},e.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},e.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),m=function(){function t(t,e,r,i,n,s){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new g(e,r,i,n,s)}var e=t.prototype;return e.reset=function(){this.uchar=" ",this.penState.reset()},e.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},e.setPenState=function(t){this.penState.copy(t)},e.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},e.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},e.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),y=function(){function t(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<l;e++)this.chars.push(new m);this.logger=t,this.pos=0,this.currPenState=new g}var e=t.prototype;return e.equals=function(t){for(var e=!0,r=0;r<l;r++)if(!this.chars[r].equals(t.chars[r])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<l;e++)this.chars[e].copy(t.chars[e])},e.isEmpty=function(){for(var t=!0,e=0;e<l;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},e.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(i.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>l&&(this.logger.log(i.DEBUG,"Too large cursor position "+this.pos),this.pos=l)},e.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var r=this.pos+1;r<e+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(e)},e.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.insertChar=function(t){var e=this;t>=144&&this.backSpace();var r=a(t);this.pos>=l?this.logger.log(i.ERROR,(function(){return"Cannot insert "+t.toString(16)+" ("+r+") at position "+e.pos+". Skipping it!"})):(this.chars[this.pos].setChar(r,this.currPenState),this.moveCursor(1))},e.clearFromPos=function(t){var e;for(e=t;e<l;e++)this.chars[e].reset()},e.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.getTextString=function(){for(var t=[],e=!0,r=0;r<l;r++){var i=this.chars[r].uchar;" "!==i&&(e=!1),t.push(i)}return e?"":t.join("")},e.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),E=function(){function t(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<o;e++)this.rows.push(new y(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var e=t.prototype;return e.reset=function(){for(var t=0;t<o;t++)this.rows[t].clear();this.currRow=14},e.equals=function(t){for(var e=!0,r=0;r<o;r++)if(!this.rows[r].equals(t.rows[r])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<o;e++)this.rows[e].copy(t.rows[e])},e.isEmpty=function(){for(var t=!0,e=0;e<o;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},e.backSpace=function(){this.rows[this.currRow].backSpace()},e.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},e.insertChar=function(t){this.rows[this.currRow].insertChar(t)},e.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},e.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},e.setCursor=function(t){this.logger.log(i.INFO,"setCursor: "+t),this.rows[this.currRow].setCursor(t)},e.setPAC=function(t){this.logger.log(i.INFO,(function(){return"pacData = "+JSON.stringify(t)}));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var r=0;r<o;r++)this.rows[r].clear();var n=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var a=s.rows[n].cueStartTime,l=this.logger.time;if(a&&null!==l&&a<l)for(var d=0;d<this.nrRollUpRows;d++)this.rows[e-this.nrRollUpRows+d+1].copy(s.rows[n+d])}}this.currRow=e;var u=this.rows[this.currRow];if(null!==t.indent){var c=t.indent,h=Math.max(c-1,0);u.setCursor(t.indent),t.color=u.chars[h].penState.foreground}var f={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(f)},e.setBkgData=function(t){this.logger.log(i.INFO,(function(){return"bkgData = "+JSON.stringify(t)})),this.backSpace(),this.setPen(t),this.insertChar(32)},e.setRollUpRows=function(t){this.nrRollUpRows=t},e.rollUp=function(){var t=this;if(null!==this.nrRollUpRows){this.logger.log(i.TEXT,(function(){return t.getDisplayText()}));var e=this.currRow+1-this.nrRollUpRows,r=this.rows.splice(e,1)[0];r.clear(),this.rows.splice(this.currRow,0,r),this.logger.log(i.INFO,"Rolling up")}else this.logger.log(i.DEBUG,"roll_up but nrRollUpRows not set yet")},e.getDisplayText=function(t){t=t||!1;for(var e=[],r="",i=-1,n=0;n<o;n++){var s=this.rows[n].getTextString();s&&(i=n+1,t?e.push("Row "+i+": '"+s+"'"):e.push(s.trim()))}return e.length>0&&(r=t?"["+e.join(" | ")+"]":e.join("\n")),r},e.getTextAndFormat=function(){return this.rows},t}(),T=function(){function t(t,e,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new E(r),this.nonDisplayedMemory=new E(r),this.lastOutputScreen=new E(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}var e=t.prototype;return e.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},e.getHandler=function(){return this.outputFilter},e.setHandler=function(t){this.outputFilter=t},e.setPAC=function(t){this.writeScreen.setPAC(t)},e.setBkgData=function(t){this.writeScreen.setBkgData(t)},e.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(i.INFO,(function(){return"MODE="+t})),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},e.insertChars=function(t){for(var e=this,r=0;r<t.length;r++)this.writeScreen.insertChar(t[r]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(i.INFO,(function(){return n+": "+e.writeScreen.getDisplayText(!0)})),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(i.TEXT,(function(){return"DISPLAYED: "+e.displayedMemory.getDisplayText(!0)})),this.outputDataUpdate())},e.ccRCL=function(){this.logger.log(i.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.ccBS=function(){this.logger.log(i.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.ccAOF=function(){},e.ccAON=function(){},e.ccDER=function(){this.logger.log(i.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.ccRU=function(t){this.logger.log(i.INFO,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},e.ccFON=function(){this.logger.log(i.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},e.ccRDC=function(){this.logger.log(i.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.ccTR=function(){this.logger.log(i.INFO,"TR"),this.setMode("MODE_TEXT")},e.ccRTD=function(){this.logger.log(i.INFO,"RTD"),this.setMode("MODE_TEXT")},e.ccEDM=function(){this.logger.log(i.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.ccCR=function(){this.logger.log(i.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.ccENM=function(){this.logger.log(i.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},e.ccEOC=function(){var t=this;if(this.logger.log(i.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(i.TEXT,(function(){return"DISP: "+t.displayedMemory.getDisplayText()}))}this.outputDataUpdate(!0)},e.ccTO=function(t){this.logger.log(i.INFO,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},e.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var r=Math.floor(t/2)-16;e.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}this.logger.log(i.INFO,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},e.outputDataUpdate=function(t){void 0===t&&(t=!1);var e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},e.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}();function S(t,e,r){r.a=t,r.b=e}function b(t,e,r){return r.a===t&&r.b===e}const L=function(){function t(t,e,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var i=new p;this.channels=[null,new T(t,e,i),new T(t+1,r,i)],this.cmdHistory={a:null,b:null},this.logger=i}var e=t.prototype;return e.getHandler=function(t){return this.channels[t].getHandler()},e.setHandler=function(t,e){this.channels[t].setHandler(e)},e.addData=function(t,e){var r,n,s,a=!1;this.logger.time=t;for(var o=0;o<e.length;o+=2)if(n=127&e[o],s=127&e[o+1],0!==n||0!==s){if(this.logger.log(i.DATA,"["+v([e[o],e[o+1]])+"] -> ("+v([n,s])+")"),(r=this.parseCmd(n,s))||(r=this.parseMidrow(n,s)),r||(r=this.parsePAC(n,s)),r||(r=this.parseBackgroundAttributes(n,s)),!r&&(a=this.parseChars(n,s))){var l=this.currentChannel;l&&l>0?this.channels[l].insertChars(a):this.logger.log(i.WARNING,"No channel found yet. TEXT-MODE?")}r||a||this.logger.log(i.WARNING,"Couldn't parse cleaned data "+v([n,s])+" orig: "+v([e[o],e[o+1]]))}},e.parseCmd=function(t,e){var r=this.cmdHistory;if(!((20===t||28===t||21===t||29===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=33&&e<=35))return!1;if(b(t,e,r))return S(null,null,r),this.logger.log(i.DEBUG,"Repeated command ("+v([t,e])+") is dropped"),!0;var n=20===t||21===t||23===t?1:2,s=this.channels[n];return 20===t||21===t||28===t||29===t?32===e?s.ccRCL():33===e?s.ccBS():34===e?s.ccAOF():35===e?s.ccAON():36===e?s.ccDER():37===e?s.ccRU(2):38===e?s.ccRU(3):39===e?s.ccRU(4):40===e?s.ccFON():41===e?s.ccRDC():42===e?s.ccTR():43===e?s.ccRTD():44===e?s.ccEDM():45===e?s.ccCR():46===e?s.ccENM():47===e&&s.ccEOC():s.ccTO(e-32),S(t,e,r),this.currentChannel=n,!0},e.parseMidrow=function(t,e){var r=0;if((17===t||25===t)&&e>=32&&e<=47){if((r=17===t?1:2)!==this.currentChannel)return this.logger.log(i.ERROR,"Mismatch channel in midrow parsing"),!1;var n=this.channels[r];return!!n&&(n.ccMIDROW(e),this.logger.log(i.DEBUG,"MIDROW ("+v([t,e])+")"),!0)}return!1},e.parsePAC=function(t,e){var r,i=this.cmdHistory;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127||(16===t||24===t)&&e>=64&&e<=95))return!1;if(b(t,e,i))return S(null,null,i),!0;var n=t<=23?1:2;r=e>=64&&e<=95?1===n?d[t]:c[t]:1===n?u[t]:h[t];var s=this.channels[n];return!!s&&(s.setPAC(this.interpretPAC(r,e)),S(t,e,i),this.currentChannel=n,!0)},e.interpretPAC=function(t,e){var r,i={color:null,italics:!1,indent:null,underline:!1,row:t};return r=e>95?e-96:e-64,i.underline=1==(1&r),r<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((r-16)/2),i},e.parseChars=function(t,e){var r,n,s=null,o=null;if(t>=25?(r=2,o=t-8):(r=1,o=t),o>=17&&o<=19?(n=17===o?e+80:18===o?e+112:e+144,this.logger.log(i.INFO,"Special char '"+a(n)+"' in channel "+r),s=[n]):t>=32&&t<=127&&(s=0===e?[t]:[t,e]),s){var l=v(s);this.logger.log(i.DEBUG,"Char codes =  "+l.join(",")),S(t,e,this.cmdHistory)}return s},e.parseBackgroundAttributes=function(t,e){var r;if(!((16===t||24===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=45&&e<=47))return!1;var i={};16===t||24===t?(r=Math.floor((e-32)/2),i.background=f[r],e%2==1&&(i.background=i.background+"_semi")):45===e?i.background="transparent":(i.foreground="black",47===e&&(i.underline=!0));var n=t<=23?1:2;return this.channels[n].setBkgData(i),S(t,e,this.cmdHistory),!0},e.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var e=this.channels[t];e&&e.reset()}this.cmdHistory={a:null,b:null}},e.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++){var r=this.channels[e];r&&r.cueSplitAtTime(t)}},t}()},"./src/utils/codecs.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{isCodecSupportedInMp4:()=>s,isCodecType:()=>n});var i={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function n(t,e){var r=i[e];return!!r&&!0===r[t.slice(0,4)]}function s(t,e){return MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}},"./src/utils/cues.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>o});var i=r("./src/utils/vttparser.ts"),n=r("./src/utils/webvtt-parser.ts"),s=r("./src/utils/texttrack-utils.ts"),a=/\s/;const o={newCue:function(t,e,r,o){for(var l,d,u,c,h,f=[],p=self.VTTCue||self.TextTrackCue,v=0;v<o.rows.length;v++)if(u=!0,c=0,h="",!(l=o.rows[v]).isEmpty()){for(var g=0;g<l.chars.length;g++)a.test(l.chars[g].uchar)&&u?c++:(h+=l.chars[g].uchar,u=!1);l.cueStartTime=e,e===r&&(r+=1e-4),c>=16?c--:c++;var m=(0,i.fixLineBreaks)(h.trim()),y=(0,n.generateCueId)(e,r,m);t&&t.cues&&t.cues.getCueById(y)||((d=new p(e,r,m)).id=y,d.line=v+1,d.align="left",d.position=10+Math.min(80,10*Math.floor(8*c/32)),f.push(d))}return t&&f.length&&(f.sort((function(t,e){return"auto"===t.line||"auto"===e.line?0:t.line>8&&e.line>8?e.line-t.line:t.line-e.line})),f.forEach((function(e){return(0,s.addCueToTrack)(t,e)}))),f}}},"./src/utils/discontinuities.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{adjustSlidingStart:()=>u,alignMediaPlaylistByPDT:()=>f,alignPDT:()=>h,alignStream:()=>c,findDiscontinuousReferenceFrag:()=>l,findFirstFragWithCC:()=>a,shouldAlignOnDiscontinuities:()=>o});var i=r("./src/polyfills/number.ts"),n=r("./src/utils/logger.ts"),s=r("./src/controller/level-helper.ts");function a(t,e){for(var r=null,i=0,n=t.length;i<n;i++){var s=t[i];if(s&&s.cc===e){r=s;break}}return r}function o(t,e,r){return!(!e.details||!(r.endCC>r.startCC||t&&t.cc<r.startCC))}function l(t,e,r){void 0===r&&(r=0);var i=t.fragments,s=e.fragments;if(s.length&&i.length){var o=a(i,s[0].cc);if(o&&(!o||o.startPTS))return o;n.logger.log("No frag in previous level to align on")}else n.logger.log("No fragments to align")}function d(t,e){if(t){var r=t.start+e;t.start=t.startPTS=r,t.endPTS=r+t.duration}}function u(t,e){for(var r=e.fragments,i=0,n=r.length;i<n;i++)d(r[i],t);e.fragmentHint&&d(e.fragmentHint,t),e.alignedSliding=!0}function c(t,e,r){e&&(function(t,e,r){if(o(t,r,e)){var s=l(r.details,e);s&&(0,i.isFiniteNumber)(s.start)&&(n.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),u(s.start,e))}}(t,r,e),!r.alignedSliding&&e.details&&h(r,e.details),r.alignedSliding||!e.details||r.skippedSegments||(0,s.adjustSliding)(e.details,r))}function h(t,e){if(e.fragments.length&&t.hasProgramDateTime&&e.hasProgramDateTime){var r=e.fragments[0].programDateTime,s=t.fragments[0].programDateTime,a=(s-r)/1e3+e.fragments[0].start;a&&(0,i.isFiniteNumber)(a)&&(n.logger.log("Adjusting PTS using programDateTime delta "+(s-r)+"ms, sliding:"+a.toFixed(3)+" "+t.url+" "),u(a,t))}}function f(t,e){if(t.hasProgramDateTime&&e.hasProgramDateTime){var r=t.fragments,i=e.fragments;if(r.length&&i.length){var n=i[Math.round(i.length/2)-1],s=a(r,n.cc)||r[Math.round(r.length/2)-1],o=n.programDateTime,l=s.programDateTime;null!==o&&null!==l&&u((l-o)/1e3-(s.start-n.start),t)}}}},"./src/utils/ewma-bandwidth-estimator.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>n});var i=r("./src/utils/ewma.ts");const n=function(){function t(t,e,r){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new i.default(t),this.fast_=new i.default(e)}var e=t.prototype;return e.update=function(t,e){var r=this.slow_,n=this.fast_;this.slow_.halfLife!==t&&(this.slow_=new i.default(t,r.getEstimate(),r.getTotalWeight())),this.fast_.halfLife!==e&&(this.fast_=new i.default(e,n.getEstimate(),n.getTotalWeight()))},e.sample=function(t,e){var r=(t=Math.max(t,this.minDelayMs_))/1e3,i=8*e/r;this.fast_.sample(r,i),this.slow_.sample(r,i)},e.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},e.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.destroy=function(){},t}()},"./src/utils/ewma.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>i});const i=function(){function t(t,e,r){void 0===e&&(e=0),void 0===r&&(r=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=r}var e=t.prototype;return e.sample=function(t,e){var r=Math.pow(this.alpha_,t);this.estimate_=e*(1-r)+r*this.estimate_,this.totalWeight_+=t},e.getTotalWeight=function(){return this.totalWeight_},e.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_},t}()},"./src/utils/fetch-loader.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>v,fetchSupported:()=>c});var i=r("./src/polyfills/number.ts"),n=r("./src/loader/load-stats.ts"),s=r("./src/demux/chunk-cache.ts");function a(t){var e="function"==typeof Map?new Map:void 0;return a=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return o(t,arguments,d(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),l(i,t)},a(t)}function o(t,e,r){return o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct.bind():function(t,e,r){var i=[null];i.push.apply(i,e);var n=new(Function.bind.apply(t,i));return r&&l(n,r.prototype),n},o.apply(null,arguments)}function l(t,e){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},l(t,e)}function d(t){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},d(t)}function u(){return u=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},u.apply(this,arguments)}function c(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(t){}return!1}var h=function(){function t(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||f,this.controller=new self.AbortController,this.stats=new n.LoadStats}var e=t.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var t=this.response;t&&t.ok||(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(t,e,r){var n=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var a=function(t,e){var r={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(u({},t.headers))};return t.rangeEnd&&r.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),r}(t,this.controller.signal),o=r.onProgress,l="arraybuffer"===t.responseType,d=l?"byteLength":"length";this.context=t,this.config=e,this.callbacks=r,this.request=this.fetchSetup(t,a),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout((function(){n.abortInternal(),r.onTimeout(s,t,n.response)}),e.timeout),self.fetch(this.request).then((function(r){if(n.response=n.loader=r,!r.ok){var a=r.status,d=r.statusText;throw new p(d||"fetch, bad network response",a,r)}return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(r.headers.get("Content-Length")||"0"),o&&(0,i.isFiniteNumber)(e.highWaterMark)?n.loadProgressively(r,s,t,e.highWaterMark,o):l?r.arrayBuffer():r.text()})).then((function(a){var l=n.response;self.clearTimeout(n.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first);var u=a[d];u&&(s.loaded=s.total=u);var c={url:l.url,data:a};o&&!(0,i.isFiniteNumber)(e.highWaterMark)&&o(s,t,a,l),r.onSuccess(c,s,t,l)})).catch((function(e){if(self.clearTimeout(n.requestTimeout),!s.aborted){var i=e&&e.code||0,a=e?e.message:null;r.onError({code:i,text:a},t,e?e.details:null)}}))},e.getCacheAge=function(){var t=null;if(this.response){var e=this.response.headers.get("age");t=e?parseFloat(e):null}return t},e.loadProgressively=function(t,e,r,i,n){void 0===i&&(i=0);var a=new s.default,o=t.body.getReader();return function s(){return o.read().then((function(o){if(o.done)return a.dataLength&&n(e,r,a.flush(),t),Promise.resolve(new ArrayBuffer(0));var l=o.value,d=l.length;return e.loaded+=d,d<i||a.dataLength?(a.push(l),a.dataLength>=i&&n(e,r,a.flush(),t)):n(e,r,l,t),s()})).catch((function(){return Promise.reject()}))}()},t}();function f(t,e){return new self.Request(t.url,e)}var p=function(t){var e,r;function i(e,r,i){var n;return(n=t.call(this,e)||this).code=void 0,n.details=void 0,n.code=r,n.details=i,n}return r=t,(e=i).prototype=Object.create(r.prototype),e.prototype.constructor=e,l(e,r),i}(a(Error));const v=h},"./src/utils/hex.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>i});const i={hexDump:function(t){for(var e="",r=0;r<t.length;r++){var i=t[r].toString(16);i.length<2&&(i="0"+i),e+=i}return e}}},"./src/utils/imsc1-ttml-parser.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{IMSC1_CODEC:()=>u,parseIMSC1:()=>p});var i=r("./src/utils/mp4-tools.ts"),n=r("./src/utils/vttparser.ts"),s=r("./src/utils/vttcue.ts"),a=r("./src/demux/id3.ts"),o=r("./src/utils/timescale-conversion.ts"),l=r("./src/utils/webvtt-parser.ts");function d(){return d=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},d.apply(this,arguments)}var u="stpp.ttml.im1t",c=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,h=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,f={left:"start",center:"center",right:"end",start:"start",end:"end"};function p(t,e,r,n,u){var c=(0,i.findBox)(new Uint8Array(t),["mdat"]);if(0!==c.length){var h=c.map((function(t){return(0,a.utf8ArrayToStr)(t)})),p=(0,o.toTimescaleFromScale)(e,1,r);try{h.forEach((function(t){return n(function(t,e){var r=(new DOMParser).parseFromString(t,"text/xml"),i=r.getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");var n={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(n).reduce((function(t,e){return t[e]=i.getAttribute("ttp:"+e)||n[e],t}),{}),o="preserve"!==i.getAttribute("xml:space"),u=g(v(i,"styling","style")),c=g(v(i,"layout","region")),h=v(i,"body","[begin]");return[].map.call(h,(function(t){var r=m(t,o);if(!r||!t.hasAttribute("begin"))return null;var i=T(t.getAttribute("begin"),a),n=T(t.getAttribute("dur"),a),h=T(t.getAttribute("end"),a);if(null===i)throw E(t);if(null===h){if(null===n)throw E(t);h=i+n}var p=new s.default(i-e,h-e,r);p.id=(0,l.generateCueId)(p.startTime,p.endTime,p.text);var v=function(t,e,r){var i="http://www.w3.org/ns/ttml#styling",n=null,s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=null!=t&&t.hasAttribute("style")?t.getAttribute("style"):null;return a&&r.hasOwnProperty(a)&&(n=r[a]),s.reduce((function(r,s){var a=y(e,i,s)||y(t,i,s)||y(n,i,s);return a&&(r[s]=a),r}),{})}(c[t.getAttribute("region")],u[t.getAttribute("style")],u),g=v.textAlign;if(g){var S=f[g];S&&(p.lineAlign=S),p.align=g}return d(p,v),p})).filter((function(t){return null!==t}))}(t,p))}))}catch(t){u(t)}}else u(new Error("Could not parse IMSC1 mdat"))}function v(t,e,r){var i=t.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(r)):[]}function g(t){return t.reduce((function(t,e){var r=e.getAttribute("xml:id");return r&&(t[r]=e),t}),{})}function m(t,e){return[].slice.call(t.childNodes).reduce((function(t,r,i){var n;return"br"===r.nodeName&&i?t+"\n":null!==(n=r.childNodes)&&void 0!==n&&n.length?m(r,e):e?t+r.textContent.trim().replace(/\s+/g," "):t+r.textContent}),"")}function y(t,e,r){return t&&t.hasAttributeNS(e,r)?t.getAttributeNS(e,r):null}function E(t){return new Error("Could not parse ttml timestamp "+t)}function T(t,e){if(!t)return null;var r=(0,n.parseTimeStamp)(t);return null===r&&(c.test(t)?r=function(t,e){var r=c.exec(t),i=(0|r[4])+(0|r[5])/e.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+i/e.frameRate}(t,e):h.test(t)&&(r=function(t,e){var r=h.exec(t),i=Number(r[1]);switch(r[2]){case"h":return 3600*i;case"m":return 60*i;case"ms":return 1e3*i;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}(t,e))),r}},"./src/utils/keysystem-util.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{changeEndianness:()=>n,convertDataUriToArrayBytes:()=>s,strToUtf8array:()=>a});var i=r("./src/utils/numeric-encoding-utils.ts");function n(t){var e=function(t,e,r){var i=t[e];t[e]=t[r],t[r]=i};e(t,0,3),e(t,1,2),e(t,4,5),e(t,6,7)}function s(t){var e,r,n=t.split(":"),s=null;if("data"===n[0]&&2===n.length){var o=n[1].split(";"),l=o[o.length-1].split(",");if(2===l.length){var d="base64"===l[0],u=l[1];d?(o.splice(-1,1),s=(0,i.base64Decode)(u)):(e=a(u).subarray(0,16),(r=new Uint8Array(16)).set(e,16-e.length),s=r)}}return s}function a(t){return Uint8Array.from(unescape(encodeURIComponent(t)),(function(t){return t.charCodeAt(0)}))}},"./src/utils/logger.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{enableLogs:()=>o,logger:()=>l});var i=function(){},n={trace:i,debug:i,log:i,warn:i,info:i,error:i},s=n;function a(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];r.forEach((function(e){s[e]=t[e]?t[e].bind(t):function(t){var e=self.console[t];return e?e.bind(self.console,"["+t+"] >"):i}(e)}))}function o(t,e){if(self.console&&!0===t||"object"==typeof t){a(t,"debug","log","info","warn","error");try{s.log('Debug logs enabled for "'+e+'"')}catch(t){s=n}}else s=n}var l=n},"./src/utils/mediakeys-helper.ts":(t,e,r)=>{"use strict";var i,n,s;function a(t){switch(t){case n.FAIRPLAY:return i.FAIRPLAY;case n.PLAYREADY:return i.PLAYREADY;case n.WIDEVINE:return i.WIDEVINE;case n.CLEARKEY:return i.CLEARKEY}}function o(t){if(t===s.WIDEVINE)return i.WIDEVINE}function l(t){switch(t){case i.FAIRPLAY:return n.FAIRPLAY;case i.PLAYREADY:return n.PLAYREADY;case i.WIDEVINE:return n.WIDEVINE;case i.CLEARKEY:return n.CLEARKEY}}function d(t){var e=t.drmSystems,r=t.widevineLicenseUrl,n=e?[i.FAIRPLAY,i.WIDEVINE,i.PLAYREADY,i.CLEARKEY].filter((function(t){return!!e[t]})):[];return!n[i.WIDEVINE]&&r&&n.push(i.WIDEVINE),n}r.r(e),r.d(e,{KeySystemFormats:()=>n,KeySystemIds:()=>s,KeySystems:()=>i,getKeySystemsForConfig:()=>d,getSupportedMediaKeySystemConfigurations:()=>c,keySystemDomainToKeySystemFormat:()=>l,keySystemFormatToKeySystemDomain:()=>a,keySystemIdToKeySystemDomain:()=>o,requestMediaKeySystemAccess:()=>u}),function(t){t.CLEARKEY="org.w3.clearkey",t.FAIRPLAY="com.apple.fps",t.PLAYREADY="com.microsoft.playready",t.WIDEVINE="com.widevine.alpha"}(i||(i={})),function(t){t.CLEARKEY="org.w3.clearkey",t.FAIRPLAY="com.apple.streamingkeydelivery",t.PLAYREADY="com.microsoft.playready",t.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"}(n||(n={})),function(t){t.WIDEVINE="edef8ba979d64acea3c827dcd51d21ed"}(s||(s={}));var u="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function c(t,e,r,n){var s;switch(t){case i.FAIRPLAY:s=["cenc","sinf"];break;case i.WIDEVINE:case i.PLAYREADY:s=["cenc"];break;case i.CLEARKEY:s=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+t)}return function(t,e,r,i){var n={initDataTypes:t,persistentState:i.persistentState||"not-allowed",distinctiveIdentifier:i.distinctiveIdentifier||"not-allowed",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map((function(t){return{contentType:'audio/mp4; codecs="'+t+'"',robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null}})),videoCapabilities:r.map((function(t){return{contentType:'video/mp4; codecs="'+t+'"',robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}}))};return[n]}(s,e,r,n)}},"./src/utils/mediasource-helper.ts":(t,e,r)=>{"use strict";function i(){return self.MediaSource||self.WebKitMediaSource}r.r(e),r.d(e,{getMediaSource:()=>i})},"./src/utils/mp4-tools.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{RemuxerTrackIdConfig:()=>u,appendUint8Array:()=>I,bin2str:()=>c,computeRawDurationFromSamples:()=>L,discardEPB:()=>C,findBox:()=>g,getDuration:()=>b,getStartDTS:()=>S,mp4Box:()=>M,mp4pssh:()=>x,offsetStartDTS:()=>A,parseEmsg:()=>R,parseInitSegment:()=>y,parsePssh:()=>N,parseSEIMessageFromNALu:()=>w,parseSamples:()=>D,parseSegmentIndex:()=>m,parseSinf:()=>T,patchEncyptionData:()=>E,readSint32:()=>p,readUint16:()=>h,readUint32:()=>f,segmentValidRange:()=>_,writeUint32:()=>v});var i=r("./src/loader/fragment.ts"),n=r("./src/utils/typed-array.ts"),s=r("./src/demux/id3.ts"),a=r("./src/utils/logger.ts"),o=r("./src/utils/hex.ts"),l=Math.pow(2,32)-1,d=[].push,u={video:1,audio:2,id3:3,text:4};function c(t){return String.fromCharCode.apply(null,t)}function h(t,e){var r=t[e]<<8|t[e+1];return r<0?65536+r:r}function f(t,e){var r=p(t,e);return r<0?4294967296+r:r}function p(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function v(t,e,r){t[e]=r>>24,t[e+1]=r>>16&255,t[e+2]=r>>8&255,t[e+3]=255&r}function g(t,e){var r=[];if(!e.length)return r;for(var i=t.byteLength,n=0;n<i;){var s=f(t,n),a=s>1?n+s:i;if(c(t.subarray(n+4,n+8))===e[0])if(1===e.length)r.push(t.subarray(n+8,a));else{var o=g(t.subarray(n+8,a),e.slice(1));o.length&&d.apply(r,o)}n=a}return r}function m(t){var e=[],r=t[0],i=8,n=f(t,i);i+=4,i+=0===r?8:16,i+=2;var s=t.length+0,a=h(t,i);i+=2;for(var o=0;o<a;o++){var l=i,d=f(t,l),u=2147483647&d;if(1==(2147483648&d)>>>31)return null;var c=f(t,l+=4);l+=4,e.push({referenceSize:u,subsegmentDuration:c,info:{duration:c/n,start:s,end:s+u-1}}),s+=u,i=l+=4}return{earliestPresentationTime:0,timescale:n,version:r,referencesCount:a,references:e}}function y(t){for(var e=[],r=g(t,["moov","trak"]),n=0;n<r.length;n++){var s=r[n],a=g(s,["tkhd"])[0];if(a){var o=a[0],l=0===o?12:20,d=f(a,l),u=g(s,["mdia","mdhd"])[0];if(u){var h=f(u,l=0===(o=u[0])?12:20),p=g(s,["mdia","hdlr"])[0];if(p){var v=c(p.subarray(8,12)),m={soun:i.ElementaryStreamTypes.AUDIO,vide:i.ElementaryStreamTypes.VIDEO}[v];if(m){var y=g(s,["mdia","minf","stbl","stsd"])[0],E=void 0;y&&(E=c(y.subarray(12,16))),e[d]={timescale:h,type:m},e[m]={timescale:h,id:d,codec:E}}}}}}return g(t,["moov","mvex","trex"]).forEach((function(t){var r=f(t,4),i=e[r];i&&(i.default={duration:f(t,12),flags:f(t,20)})})),e}function E(t,e){if(!t||!e)return t;var r=e.keyId;return r&&e.isCommonEncryption&&g(t,["moov","trak"]).forEach((function(t){var e=g(t,["mdia","minf","stbl","stsd"])[0].subarray(8),i=g(e,["enca"]),n=i.length>0;n||(i=g(e,["encv"])),i.forEach((function(t){g(n?t.subarray(28):t.subarray(78),["sinf"]).forEach((function(t){var e=T(t);if(e){var i=e.subarray(8,24);i.some((function(t){return 0!==t}))||(a.logger.log("[eme] Patching keyId in 'enc"+(n?"a":"v")+">sinf>>tenc' box: "+o.default.hexDump(i)+" -> "+o.default.hexDump(r)),e.set(r,8))}}))}))})),t}function T(t){var e=g(t,["schm"])[0];if(e){var r=c(e.subarray(4,8));if("cbcs"===r||"cenc"===r)return g(t,["schi","tenc"])[0]}return a.logger.error("[eme] missing 'schm' box"),null}function S(t,e){return g(e,["moof","traf"]).reduce((function(e,r){var i=g(r,["tfdt"])[0],n=i[0],s=g(r,["tfhd"]).reduce((function(e,r){var s=f(r,4),a=t[s];if(a){var o=f(i,4);1===n&&(o*=Math.pow(2,32),o+=f(i,8));var l=o/(a.timescale||9e4);if(isFinite(l)&&(null===e||l<e))return l}return e}),null);return null!==s&&isFinite(s)&&(null===e||s<e)?s:e}),null)||0}function b(t,e){for(var r=0,n=0,s=0,a=g(t,["moof","traf"]),o=0;o<a.length;o++){var l=a[o],d=g(l,["tfhd"])[0],u=e[f(d,4)];if(u){var c=u.default,h=f(d,0)|(null==c?void 0:c.flags),p=null==c?void 0:c.duration;8&h&&(p=f(d,2&h?12:8));for(var v=u.timescale||9e4,y=g(l,["trun"]),E=0;E<y.length;E++)!(r=L(y[E]))&&p&&(r=p*f(y[E],4)),u.type===i.ElementaryStreamTypes.VIDEO?n+=r/v:u.type===i.ElementaryStreamTypes.AUDIO&&(s+=r/v)}}if(0===n&&0===s){for(var T=0,S=g(t,["sidx"]),b=0;b<S.length;b++){var A=m(S[b]);null!=A&&A.references&&(T+=A.references.reduce((function(t,e){return t+e.info.duration||0}),0))}return T}return n||s}function L(t){var e=f(t,0),r=8;1&e&&(r+=4),4&e&&(r+=4);for(var i=0,n=f(t,4),s=0;s<n;s++)256&e&&(i+=f(t,r),r+=4),512&e&&(r+=4),1024&e&&(r+=4),2048&e&&(r+=4);return i}function A(t,e,r){g(e,["moof","traf"]).forEach((function(e){g(e,["tfhd"]).forEach((function(i){var n=f(i,4),s=t[n];if(s){var a=s.timescale||9e4;g(e,["tfdt"]).forEach((function(t){var e=t[0],i=f(t,4);if(0===e)i-=r*a,v(t,4,i=Math.max(i,0));else{i*=Math.pow(2,32),i+=f(t,8),i-=r*a,i=Math.max(i,0);var n=Math.floor(i/(l+1)),s=Math.floor(i%(l+1));v(t,4,n),v(t,8,s)}}))}}))}))}function _(t){var e={valid:null,remainder:null},r=g(t,["moof"]);if(!r)return e;if(r.length<2)return e.remainder=t,e;var i=r[r.length-1];return e.valid=(0,n.sliceUint8)(t,0,i.byteOffset-8),e.remainder=(0,n.sliceUint8)(t,i.byteOffset-8),e}function I(t,e){var r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r}function D(t,e){var r=[],n=e.samples,s=e.timescale,a=e.id,o=!1;return g(n,["moof"]).map((function(l){var d=l.byteOffset-8;g(l,["traf"]).map((function(l){var u=g(l,["tfdt"]).map((function(t){var e=t[0],r=f(t,4);return 1===e&&(r*=Math.pow(2,32),r+=f(t,8)),r/s}))[0];return void 0!==u&&(t=u),g(l,["tfhd"]).map((function(u){var c=f(u,4),h=16777215&f(u,0),v=0,m=0!=(16&h),y=0,E=0!=(32&h),T=8;c===a&&(0!=(1&h)&&(T+=8),0!=(2&h)&&(T+=4),0!=(8&h)&&(v=f(u,T),T+=4),m&&(y=f(u,T),T+=4),E&&(T+=4),"video"===e.type&&(o=function(t){if(!t)return!1;var e=t.indexOf("."),r=e<0?t:t.substring(0,e);return"hvc1"===r||"hev1"===r||"dvh1"===r||"dvhe"===r}(e.codec)),g(l,["trun"]).map((function(a){var l=a[0],u=16777215&f(a,0),c=0!=(1&u),h=0,g=0!=(4&u),m=0!=(256&u),E=0,T=0!=(512&u),S=0,b=0!=(1024&u),L=0!=(2048&u),A=0,_=f(a,4),I=8;c&&(h=f(a,I),I+=4),g&&(I+=4);for(var D=h+d,C=0;C<_;C++){if(m?(E=f(a,I),I+=4):E=v,T?(S=f(a,I),I+=4):S=y,b&&(I+=4),L&&(A=0===l?f(a,I):p(a,I),I+=4),e.type===i.ElementaryStreamTypes.VIDEO)for(var R=0;R<S;){var M=f(n,D);k(o,n[D+=4])&&w(n.subarray(D,D+M),o?2:1,t+A/s,r),D+=M,R+=M+4}t+=E/s}})))}))}))})),r}function k(t,e){if(t){var r=e>>1&63;return 39===r||40===r}return 6==(31&e)}function w(t,e,r,i){var n=C(t),a=0;a+=e;for(var o=0,l=0,d=!1,u=0;a<n.length;){o=0;do{if(a>=n.length)break;o+=u=n[a++]}while(255===u);l=0;do{if(a>=n.length)break;l+=u=n[a++]}while(255===u);var c=n.length-a;if(!d&&4===o&&a<n.length){if(d=!0,181===n[a++]){var p=h(n,a);if(a+=2,49===p){var v=f(n,a);if(a+=4,1195456820===v){var g=n[a++];if(3===g){var m=n[a++],y=64&m,E=y?2+3*(31&m):0,T=new Uint8Array(E);if(y){T[0]=m;for(var S=1;S<E;S++)T[S]=n[a++]}i.push({type:g,payloadType:o,pts:r,bytes:T})}}}}}else if(5===o&&l<c){if(d=!0,l>16){for(var b=[],L=0;L<16;L++){var A=n[a++].toString(16);b.push(1==A.length?"0"+A:A),3!==L&&5!==L&&7!==L&&9!==L||b.push("-")}for(var _=l-16,I=new Uint8Array(_),D=0;D<_;D++)I[D]=n[a++];i.push({payloadType:o,pts:r,uuid:b.join(""),userData:(0,s.utf8ArrayToStr)(I),userDataBytes:I})}}else if(l<c)a+=l;else if(l>c)break}}function C(t){for(var e=t.byteLength,r=[],i=1;i<e-2;)0===t[i]&&0===t[i+1]&&3===t[i+2]?(r.push(i+2),i+=2):i++;if(0===r.length)return t;var n=e-r.length,s=new Uint8Array(n),a=0;for(i=0;i<n;a++,i++)a===r[0]&&(a++,r.shift()),s[i]=t[a];return s}function R(t){var e=t[0],r="",i="",n=0,s=0,a=0,o=0,l=0,d=0;if(0===e){for(;"\0"!==c(t.subarray(d,d+1));)r+=c(t.subarray(d,d+1)),d+=1;for(r+=c(t.subarray(d,d+1)),d+=1;"\0"!==c(t.subarray(d,d+1));)i+=c(t.subarray(d,d+1)),d+=1;i+=c(t.subarray(d,d+1)),d+=1,n=f(t,12),s=f(t,16),o=f(t,20),l=f(t,24),d=28}else if(1===e){n=f(t,d+=4);var u=f(t,d+=4),h=f(t,d+=4);for(d+=4,a=Math.pow(2,32)*u+h,Number.isSafeInteger(a)||(a=Number.MAX_SAFE_INTEGER),o=f(t,d),l=f(t,d+=4),d+=4;"\0"!==c(t.subarray(d,d+1));)r+=c(t.subarray(d,d+1)),d+=1;for(r+=c(t.subarray(d,d+1)),d+=1;"\0"!==c(t.subarray(d,d+1));)i+=c(t.subarray(d,d+1)),d+=1;i+=c(t.subarray(d,d+1)),d+=1}return{schemeIdUri:r,value:i,timeScale:n,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:t.subarray(d,t.byteLength)}}function M(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];for(var n=r.length,s=8,a=n;a--;)s+=r[a].byteLength;var o=new Uint8Array(s);for(o[0]=s>>24&255,o[1]=s>>16&255,o[2]=s>>8&255,o[3]=255&s,o.set(t,4),a=0,s=8;a<n;a++)o.set(r[a],s),s+=r[a].byteLength;return o}function x(t,e,r){if(16!==t.byteLength)throw new RangeError("Invalid system id");var i,n,s;if(e){i=1,n=new Uint8Array(16*e.length);for(var a=0;a<e.length;a++){var o=e[a];if(16!==o.byteLength)throw new RangeError("Invalid key");n.set(o,16*a)}}else i=0,n=new Uint8Array;i>0?(s=new Uint8Array(4),e.length>0&&new DataView(s.buffer).setUint32(0,e.length,!1)):s=new Uint8Array;var l=new Uint8Array(4);return r&&r.byteLength>0&&new DataView(l.buffer).setUint32(0,r.byteLength,!1),M([112,115,115,104],new Uint8Array([i,0,0,0]),t,s,n,l,r||new Uint8Array)}function N(t){if(!(t instanceof ArrayBuffer)||t.byteLength<32)return null;var e={version:0,systemId:"",kids:null,data:null},r=new DataView(t),i=r.getUint32(0);if(t.byteLength!==i&&i>44)return null;if(1886614376!==r.getUint32(4))return null;if(e.version=r.getUint32(8)>>>24,e.version>1)return null;e.systemId=o.default.hexDump(new Uint8Array(t,12,16));var n=r.getUint32(28);if(0===e.version){if(i-32<n)return null;e.data=new Uint8Array(t,32,n)}else if(1===e.version){e.kids=[];for(var s=0;s<n;s++)e.kids.push(new Uint8Array(t,32+16*s,16))}return e}},"./src/utils/numeric-encoding-utils.ts":(t,e,r)=>{"use strict";function i(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function n(t){return btoa(t)}function s(t){return atob(t)}function a(t){return btoa(String.fromCharCode.apply(String,t))}function o(t){return i(a(t))}function l(t){return Uint8Array.from(atob(t),(function(t){return t.charCodeAt(0)}))}r.r(e),r.d(e,{base64Decode:()=>l,base64DecodeToStr:()=>s,base64Encode:()=>a,base64ToBase64Url:()=>i,base64UrlEncode:()=>o,strToBase64Encode:()=>n})},"./src/utils/output-filter.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>i});var i=function(){function t(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}var e=t.prototype;return e.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},e.newCue=function(t,e,r){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)},e.reset=function(){this.cueRanges=[],this.startTime=null},t}()},"./src/utils/texttrack-utils.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{addCueToTrack:()=>s,clearCurrentCues:()=>a,getCuesInRange:()=>l,removeCuesInRange:()=>o,sendAddTrackEvent:()=>n});var i=r("./src/utils/logger.ts");function n(t,e){var r;try{r=new Event("addtrack")}catch(t){(r=document.createEvent("Event")).initEvent("addtrack",!1,!1)}r.track=t,e.dispatchEvent(r)}function s(t,e){var r=t.mode;if("disabled"===r&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(r){i.logger.debug("[texttrack-utils]: "+r);var n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,t.addCue(n)}"disabled"===r&&(t.mode=r)}function a(t){var e=t.mode;if("disabled"===e&&(t.mode="hidden"),t.cues)for(var r=t.cues.length;r--;)t.removeCue(t.cues[r]);"disabled"===e&&(t.mode=e)}function o(t,e,r,i){var n=t.mode;if("disabled"===n&&(t.mode="hidden"),t.cues&&t.cues.length>0)for(var s=l(t.cues,e,r),a=0;a<s.length;a++)i&&!i(s[a])||t.removeCue(s[a]);"disabled"===n&&(t.mode=n)}function l(t,e,r){var i=[],n=function(t,e){if(e<t[0].startTime)return 0;var r=t.length-1;if(e>t[r].endTime)return-1;for(var i=0,n=r;i<=n;){var s=Math.floor((n+i)/2);if(e<t[s].startTime)n=s-1;else{if(!(e>t[s].startTime&&i<r))return s;i=s+1}}return t[i].startTime-e<e-t[n].startTime?i:n}(t,e);if(n>-1)for(var s=n,a=t.length;s<a;s++){var o=t[s];if(o.startTime>=e&&o.endTime<=r)i.push(o);else if(o.startTime>r)return i}return i}},"./src/utils/time-ranges.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>i});const i={toString:function(t){for(var e="",r=t.length,i=0;i<r;i++)e+="["+t.start(i).toFixed(3)+"-"+t.end(i).toFixed(3)+"]";return e}}},"./src/utils/timescale-conversion.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{toMpegTsClockFromTimescale:()=>o,toMsFromMpegTsClock:()=>a,toTimescaleFromBase:()=>n,toTimescaleFromScale:()=>s});var i=9e4;function n(t,e,r,i){void 0===r&&(r=1),void 0===i&&(i=!1);var n=t*e*r;return i?Math.round(n):n}function s(t,e,r,i){return void 0===r&&(r=1),void 0===i&&(i=!1),n(t,e,1/r,i)}function a(t,e){return void 0===e&&(e=!1),n(t,1e3,1/i,e)}function o(t,e){return void 0===e&&(e=1),n(t,i,1/e)}},"./src/utils/typed-array.ts":(t,e,r)=>{"use strict";function i(t,e,r){return Uint8Array.prototype.slice?t.slice(e,r):new Uint8Array(Array.prototype.slice.call(t,e,r))}r.r(e),r.d(e,{sliceUint8:()=>i})},"./src/utils/vttcue.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>i});const i=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var t=["","lr","rl"],e=["start","middle","end","left","right"];function r(t,e){if("string"!=typeof e)return!1;if(!Array.isArray(t))return!1;var r=e.toLowerCase();return!!~t.indexOf(r)&&r}function i(t){return r(e,t)}function n(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var a in s)t[a]=s[a]}return t}function s(e,s,a){var o=this,l={enumerable:!0};o.hasBeenReset=!1;var d="",u=!1,c=e,h=s,f=a,p=null,v="",g=!0,m="auto",y="start",E=50,T="middle",S=50,b="middle";Object.defineProperty(o,"id",n({},l,{get:function(){return d},set:function(t){d=""+t}})),Object.defineProperty(o,"pauseOnExit",n({},l,{get:function(){return u},set:function(t){u=!!t}})),Object.defineProperty(o,"startTime",n({},l,{get:function(){return c},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");c=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",n({},l,{get:function(){return h},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");h=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",n({},l,{get:function(){return f},set:function(t){f=""+t,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",n({},l,{get:function(){return p},set:function(t){p=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",n({},l,{get:function(){return v},set:function(e){var i=function(e){return r(t,e)}(e);if(!1===i)throw new SyntaxError("An invalid or illegal string was specified.");v=i,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",n({},l,{get:function(){return g},set:function(t){g=!!t,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",n({},l,{get:function(){return m},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",n({},l,{get:function(){return y},set:function(t){var e=i(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",n({},l,{get:function(){return E},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",n({},l,{get:function(){return T},set:function(t){var e=i(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");T=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",n({},l,{get:function(){return S},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");S=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",n({},l,{get:function(){return b},set:function(t){var e=i(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");b=e,this.hasBeenReset=!0}})),o.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}()},"./src/utils/vttparser.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{VTTParser:()=>h,fixLineBreaks:()=>c,parseTimeStamp:()=>s});var i=r("./src/utils/vttcue.ts"),n=function(){function t(){}return t.prototype.decode=function(t,e){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))},t}();function s(t){function e(t,e,r,i){return 3600*(0|t)+60*(0|e)+(0|r)+parseFloat(i||0)}var r=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?e(r[2],r[3],0,r[4]):e(r[1],r[2],r[3],r[4]):null}var a=function(){function t(){this.values=Object.create(null)}var e=t.prototype;return e.set=function(t,e){this.get(t)||""===e||(this.values[t]=e)},e.get=function(t,e,r){return r?this.has(t)?this.values[t]:e[r]:this.has(t)?this.values[t]:e},e.has=function(t){return t in this.values},e.alt=function(t,e,r){for(var i=0;i<r.length;++i)if(e===r[i]){this.set(t,e);break}},e.integer=function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},e.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var r=parseFloat(e);if(r>=0&&r<=100)return this.set(t,r),!0}return!1},t}();function o(t,e,r,i){var n=i?t.split(i):[t];for(var s in n)if("string"==typeof n[s]){var a=n[s].split(r);2===a.length&&e(a[0],a[1])}}var l=new i.default(0,0,""),d="middle"===l.align?"middle":"center";function u(t,e,r){var i=t;function n(){var e=s(t);if(null===e)throw new Error("Malformed timestamp: "+i);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function u(){t=t.replace(/^\s+/,"")}if(u(),e.startTime=n(),u(),"--\x3e"!==t.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);t=t.slice(3),u(),e.endTime=n(),u(),function(t,e){var i=new a;o(t,(function(t,e){var n;switch(t){case"region":for(var s=r.length-1;s>=0;s--)if(r[s].id===e){i.set(t,r[s].region);break}break;case"vertical":i.alt(t,e,["rl","lr"]);break;case"line":n=e.split(","),i.integer(t,n[0]),i.percent(t,n[0])&&i.set("snapToLines",!1),i.alt(t,n[0],["auto"]),2===n.length&&i.alt("lineAlign",n[1],["start",d,"end"]);break;case"position":n=e.split(","),i.percent(t,n[0]),2===n.length&&i.alt("positionAlign",n[1],["start",d,"end","line-left","line-right","auto"]);break;case"size":i.percent(t,e);break;case"align":i.alt(t,e,["start",d,"end","left","right"])}}),/:/,/\s/),e.region=i.get("region",null),e.vertical=i.get("vertical","");var n=i.get("line","auto");"auto"===n&&-1===l.line&&(n=-1),e.line=n,e.lineAlign=i.get("lineAlign","start"),e.snapToLines=i.get("snapToLines",!0),e.size=i.get("size",100),e.align=i.get("align",d);var s=i.get("position","auto");"auto"===s&&50===l.position&&(s="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=s}(t,e)}function c(t){return t.replace(/<br(?: \/)?>/gi,"\n")}var h=function(){function t(){this.state="INITIAL",this.buffer="",this.decoder=new n,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var e=t.prototype;return e.parse=function(t){var e=this;function r(){var t=e.buffer,r=0;for(t=c(t);r<t.length&&"\r"!==t[r]&&"\n"!==t[r];)++r;var i=t.slice(0,r);return"\r"===t[r]&&++r,"\n"===t[r]&&++r,e.buffer=t.slice(r),i}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{var n="";if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;var s=(n=r()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var a=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(a?a=!1:n=r(),e.state){case"HEADER":/:/.test(n)?o(n,(function(t,e){}),/:/):n||(e.state="ID");continue;case"NOTE":n||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){e.state="NOTE";break}if(!n)continue;if(e.cue=new i.default(0,0,""),e.state="CUE",-1===n.indexOf("--\x3e")){e.cue.id=n;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{u(n,e.cue,e.regionList)}catch(t){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var l=-1!==n.indexOf("--\x3e");if(!n||l&&(a=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(null===e.cue)continue;e.cue.text&&(e.cue.text+="\n"),e.cue.text+=n;continue;case"BADCUE":n||(e.state="ID")}}}catch(t){"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this},e.flush=function(){var t=this;try{if((t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state||"BADWEBVTT"===t.state)throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this},t}()},"./src/utils/webvtt-parser.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{generateCueId:()=>h,parseWebVTT:()=>p});var i=r("./src/polyfills/number.ts"),n=r("./src/utils/vttparser.ts"),s=r("./src/demux/id3.ts"),a=r("./src/utils/timescale-conversion.ts"),o=r("./src/remux/mp4-remuxer.ts"),l=/\r\n|\n\r|\n|\r/g,d=function(t,e,r){return void 0===r&&(r=0),t.slice(r,r+e.length)===e},u=function(t){var e=parseInt(t.slice(-3)),r=parseInt(t.slice(-6,-4)),n=parseInt(t.slice(-9,-7)),s=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!((0,i.isFiniteNumber)(e)&&(0,i.isFiniteNumber)(r)&&(0,i.isFiniteNumber)(n)&&(0,i.isFiniteNumber)(s)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t);return e+=1e3*r,e+=6e4*n,e+=36e5*s},c=function(t){for(var e=5381,r=t.length;r;)e=33*e^t.charCodeAt(--r);return(e>>>0).toString()};function h(t,e,r){return c(t.toString())+c(e.toString())+c(r)}var f=function(t,e,r){var i=t[e],n=t[i.prevCC];if(!n||!n.new&&i.new)return t.ccOffset=t.presentationOffset=i.start,void(i.new=!1);for(;null!==(s=n)&&void 0!==s&&s.new;){var s;t.ccOffset+=i.start-n.start,i.new=!1,n=t[(i=n).prevCC]}t.presentationOffset=r};function p(t,e,r,i,c,p,v,g){var m,y=new n.VTTParser,E=(0,s.utf8ArrayToStr)(new Uint8Array(t)).trim().replace(l,"\n").split("\n"),T=[],S=(0,a.toMpegTsClockFromTimescale)(e,r),b="00:00.000",L=0,A=0,_=!0;y.oncue=function(t){var e=i[c],r=i.ccOffset,n=(L-S)/9e4;null!=e&&e.new&&(void 0!==A?r=i.ccOffset=e.start:f(i,c,n)),n&&(r=n-i.presentationOffset);var s=t.endTime-t.startTime,a=(0,o.normalizePts)(9e4*(t.startTime+r-A),9e4*p)/9e4;t.startTime=Math.max(a,0),t.endTime=Math.max(a+s,0);var l=t.text.trim();t.text=decodeURIComponent(encodeURIComponent(l)),t.id||(t.id=h(t.startTime,t.endTime,l)),t.endTime>0&&T.push(t)},y.onparsingerror=function(t){m=t},y.onflush=function(){m?g(m):v(T)},E.forEach((function(t){if(_){if(d(t,"X-TIMESTAMP-MAP=")){_=!1,t.slice(16).split(",").forEach((function(t){d(t,"LOCAL:")?b=t.slice(6):d(t,"MPEGTS:")&&(L=parseInt(t.slice(7)))}));try{A=u(b)/1e3}catch(t){m=t}return}""===t&&(_=!1)}y.parse(t+"\n")})),y.flush()}},"./src/utils/xhr-loader.ts":(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>a});var i=r("./src/utils/logger.ts"),n=r("./src/loader/load-stats.ts"),s=/^age:\s*[\d.]+\s*$/m;const a=function(){function t(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t?t.xhrSetup:null,this.stats=new n.LoadStats,this.retryDelay=0}var e=t.prototype;return e.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},e.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))},e.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},e.load=function(t,e,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=r,this.retryDelay=e.retryDelay,this.loadInternal()},e.loadInternal=function(){var t=this.config,e=this.context;if(t){var r=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0;var n=this.xhrSetup;try{if(n)try{n(r,e.url)}catch(t){r.open("GET",e.url,!0),n(r,e.url)}r.readyState||r.open("GET",e.url,!0);var s=this.context.headers;if(s)for(var a in s)r.setRequestHeader(a,s[a])}catch(t){return void this.callbacks.onError({code:r.status,text:t.message},e,r)}e.rangeEnd&&r.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=e.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),r.send()}},e.readystatechange=function(){var t=this.context,e=this.loader,r=this.stats;if(t&&e){var n=e.readyState,s=this.config;if(!r.aborted&&n>=2)if(self.clearTimeout(this.requestTimeout),0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start)),4===n){e.onreadystatechange=null,e.onprogress=null;var a=e.status,o="arraybuffer"===e.responseType;if(a>=200&&a<300&&(o&&e.response||null!==e.responseText)){var l,d;if(r.loading.end=Math.max(self.performance.now(),r.loading.first),d=o?(l=e.response).byteLength:(l=e.responseText).length,r.loaded=r.total=d,!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(r,t,l,e),!this.callbacks)return;var c={url:e.responseURL,data:l};this.callbacks.onSuccess(c,r,t,e)}else r.retry>=s.maxRetry||a>=400&&a<499?(i.logger.error(a+" while loading "+t.url),this.callbacks.onError({code:a,text:e.statusText},t,e)):(i.logger.warn(a+" while loading "+t.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),r.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout)}},e.loadtimeout=function(){i.logger.warn("timeout while loading "+this.context.url);var t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))},e.loadprogress=function(t){var e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)},e.getCacheAge=function(){var t=null;if(this.loader&&s.test(this.loader.getAllResponseHeaders())){var e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t},t}()},"./node_modules/eventemitter3/index.js":t=>{"use strict";var e=Object.prototype.hasOwnProperty,r="~";function i(){}function n(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function s(t,e,i,s,a){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new n(i,s||t,a),l=r?r+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],o]:t._events[l].push(o):(t._events[l]=o,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function o(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),o.prototype.eventNames=function(){var t,i,n=[];if(0===this._eventsCount)return n;for(i in t=this._events)e.call(t,i)&&n.push(r?i.slice(1):i);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},o.prototype.listeners=function(t){var e=r?r+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,s=i.length,a=new Array(s);n<s;n++)a[n]=i[n].fn;return a},o.prototype.listenerCount=function(t){var e=r?r+t:t,i=this._events[e];return i?i.fn?1:i.length:0},o.prototype.emit=function(t,e,i,n,s,a){var o=r?r+t:t;if(!this._events[o])return!1;var l,d,u=this._events[o],c=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,i),!0;case 4:return u.fn.call(u.context,e,i,n),!0;case 5:return u.fn.call(u.context,e,i,n,s),!0;case 6:return u.fn.call(u.context,e,i,n,s,a),!0}for(d=1,l=new Array(c-1);d<c;d++)l[d-1]=arguments[d];u.fn.apply(u.context,l)}else{var h,f=u.length;for(d=0;d<f;d++)switch(u[d].once&&this.removeListener(t,u[d].fn,void 0,!0),c){case 1:u[d].fn.call(u[d].context);break;case 2:u[d].fn.call(u[d].context,e);break;case 3:u[d].fn.call(u[d].context,e,i);break;case 4:u[d].fn.call(u[d].context,e,i,n);break;default:if(!l)for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=arguments[h];u[d].fn.apply(u[d].context,l)}}return!0},o.prototype.on=function(t,e,r){return s(this,t,e,r,!1)},o.prototype.once=function(t,e,r){return s(this,t,e,r,!0)},o.prototype.removeListener=function(t,e,i,n){var s=r?r+t:t;if(!this._events[s])return this;if(!e)return a(this,s),this;var o=this._events[s];if(o.fn)o.fn!==e||n&&!o.once||i&&o.context!==i||a(this,s);else{for(var l=0,d=[],u=o.length;l<u;l++)(o[l].fn!==e||n&&!o[l].once||i&&o[l].context!==i)&&d.push(o[l]);d.length?this._events[s]=1===d.length?d[0]:d:a(this,s)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&a(this,e)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,t.exports=o},"./node_modules/url-toolkit/src/url-toolkit.js":function(t){var e,r,i,n,s;e=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,i=/(?:\/|^)\.(?=\/)/g,n=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(t,e,i){if(i=i||{},t=t.trim(),!(e=e.trim())){if(!i.alwaysNormalize)return t;var n=s.parseURL(t);if(!n)throw new Error("Error trying to parse base URL.");return n.path=s.normalizePath(n.path),s.buildURLFromParts(n)}var a=s.parseURL(e);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):e;var o=s.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=r.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var d={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(d.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var u=o.path,c=u.substring(0,u.lastIndexOf("/")+1)+a.path;d.path=s.normalizePath(c)}else d.path=o.path,a.params||(d.params=o.params,a.query||(d.query=o.query));return null===d.path&&(d.path=i.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(d)},parseURL:function(t){var r=e.exec(t);return r?{scheme:r[1]||"",netLoc:r[2]||"",path:r[3]||"",params:r[4]||"",query:r[5]||"",fragment:r[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(i,"");t.length!==(t=t.replace(n,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=s}},e={};function r(i){var n=e[i];if(void 0!==n)return n.exports;var s=e[i]={exports:{}};return t[i].call(s.exports,s,s.exports,r),s.exports}r.m=t,r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i=r("./src/hls.ts");return i=i.default})(),t.exports=e())},379:t=>{"use strict";var e=[];function r(t){for(var r=-1,i=0;i<e.length;i++)if(e[i].identifier===t){r=i;break}return r}function i(t,i){for(var s={},a=[],o=0;o<t.length;o++){var l=t[o],d=i.base?l[0]+i.base:l[0],u=s[d]||0,c="".concat(d," ").concat(u);s[d]=u+1;var h=r(c),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)e[h].references++,e[h].updater(f);else{var p=n(f,i);i.byIndex=o,e.splice(o,0,{identifier:c,updater:p,references:1})}a.push(c)}return a}function n(t,e){var r=e.domAPI(e);r.update(t);return function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;r.update(t=e)}else r.remove()}}t.exports=function(t,n){var s=i(t=t||[],n=n||{});return function(t){t=t||[];for(var a=0;a<s.length;a++){var o=r(s[a]);e[o].references--}for(var l=i(t,n),d=0;d<s.length;d++){var u=r(s[d]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}s=l}}},569:t=>{"use strict";var e={};t.exports=function(t,r){var i=function(t){if(void 0===e[t]){var r=document.querySelector(t);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[t]=r}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(r)}},216:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,r)=>{"use strict";t.exports=function(t){var e=r.nc;e&&t.setAttribute("nonce",e)}},795:t=>{"use strict";t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(r){!function(t,e,r){var i="";r.supports&&(i+="@supports (".concat(r.supports,") {")),r.media&&(i+="@media ".concat(r.media," {"));var n=void 0!==r.layer;n&&(i+="@layer".concat(r.layer.length>0?" ".concat(r.layer):""," {")),i+=r.css,n&&(i+="}"),r.media&&(i+="}"),r.supports&&(i+="}");var s=r.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,r)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},893:()=>{}},e={};function r(i){var n=e[i];if(void 0!==n)return n.exports;var s=e[i]={id:i,exports:{}};return t[i].call(s.exports,s,s.exports,r),s.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.nc=void 0,(()=>{"use strict";var t=r(11),e=r.n(t),i=r(48),n=r.n(i);const s=e().navigator&&e().navigator.userAgent||"",a=/AppleWebKit\/([\d.]+)/i.exec(s),o=(a&&parseFloat(a.pop()),/iPod/i.test(s)),l=(function(){const t=s.match(/OS (\d+)_/i);t&&t[1]&&t[1]}(),/Android/i.test(s)),d=(function(){const t=s.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!t)return null;const e=t[1]&&parseFloat(t[1]),r=t[2]&&parseFloat(t[2]);e&&r&&parseFloat(t[1]+"."+t[2])}(),/Firefox/i.test(s),/Edg/i.test(s)),u=!d&&(/Chrome/i.test(s)||/CriOS/i.test(s)),c=(function(){const t=s.match(/(Chrome|CriOS)\/(\d+)/);t&&t[2]&&parseFloat(t[2])}(),function(){const t=/MSIE\s(\d+)\.\d/.exec(s);let e=t&&parseFloat(t[1]);!e&&/Trident\/7.0/i.test(s)&&/rv:11.0/.test(s)&&(e=11)}(),/Safari/i.test(s)&&!u&&!l&&!d),h=(/Windows/i.test(s),Boolean("ontouchstart"in e()||e().navigator.maxTouchPoints||e().DocumentTouch&&e().document instanceof e().DocumentTouch)),f=/iPad/i.test(s)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1||c&&h&&!/iPhone/i.test(s),p=/iPhone/i.test(s)&&!f||f||o,v=function(){let t=!1;var e;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e=s)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t}();function g(t){const e=t.getBoundingClientRect(),r=e.height,i=function(){let t,e,r=window,i=r.document,n=i.location.href;i=i.referrer;let s=0,a=encodeURIComponent,o=new Date;for(t=screen;r!==r.parent;)try{n=(e=r.parent).location.href,i=e.document.referrer,r=e}catch(t){s=top!==r.parent?2:1;break}let l,d=e=void 0;try{e=void 0!==r.document.hidden?r.document.hidden:void 0!==r.document.msHidden?r.document.msHidden:void 0!==r.document.webkitHidden?r.document.webkitHidden:null}catch(t){e=null}try{d=r.pageXOffset,l=r.pageYOffset}catch(t){l=d=null}const u=r.performance.timing&&r.performance.timing.navigationStart?r.performance.timing.navigationStart:r.performance.timeOrigin;return{timeOrigin:Math.floor(u),location:a(n),referrer:a(i)||"0",masked:s,wWidth:r.innerWidth,wHeight:r.innerHeight,oWidth:r.outerWidth,oHeight:r.outerHeight,sWidth:t.width,sHeight:t.height,aWidth:t.availWidth,aHeight:t.availHeight,sLeft:"screenLeft"in r?r.screenLeft:r.screenX,sTop:"screenTop"in r?r.screenTop:r.screenY,xOffset:d,yOffset:l,docHidden:e,hLength:history.length,date:o.toUTCString(),timeOffset:o.getTimezoneOffset()}}().wHeight,n=e.top,s=e.bottom;return Math.max(0,n>0?Math.min(r,i-n):s<i?s:i)/r}function m(){const t=document.createElement("video");return["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some((function(e){return/maybe|probably/i.test(t.canPlayType(e))}))}const y=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,E=/^application\/dash\+xml/i,T=t=>"hls"===t?m():"dash"===t&&/maybe|probably/i.test(document.createElement("video").canPlayType("application/dash+xml"));function S(t){let e=11,r=8;return t<3600&&(e=14,r=5),new Date(1e3*t).toISOString().substr(e,r)}const b=(new Date).getTime();function L(){return(new Date).getTime()-b}function A(t){return Math.floor(t/1e3)}function _(t,e){return!!function(t,e){if(p)return e.webkitDisplayingFullscreen;if(t.fullscreenElement||t.webkitFullscreenElement||t.mozFullScreenElement)return!0;return!1}(t,e)}const I={"1:1":"100%","16:9":"56.25%","4:3":"75%","3:2":"66.66%","8:5":"62.5%","9:16":"177.77%"};function D(t,e){if(!e||"string"!=typeof e||e.length<1)return;let r=null;t?(r=document.getElementById(t),r?r.textContent=e:(r=document.createElement("style"),r.id=t,r.textContent=e,document.head.appendChild(r))):(r=document.createElement("style"),r.textContent=e,document.head.appendChild(r))}function k(t,e){if(!t||!e)return"";if("function"==typeof window.getComputedStyle){let r;try{r=window.getComputedStyle(t)}catch(t){return""}return r?r.getPropertyValue(e)||r[e]:""}return""}function w(t){if(!t||t&&!t.offsetParent)return{left:0,top:0,width:0,height:0};const e=t.offsetWidth,r=t.offsetHeight;let i=0,n=0;for(;t.offsetParent;)i+=t.offsetLeft,n+=t.offsetTop,t=t.offsetParent;return{left:i,top:n,width:e,height:r}}function C(t,e){const r={x:0,y:0};if(p){let e=t;for(;e&&"html"!==e.nodeName.toLowerCase();){const t=k(e,"transform");if(/^matrix/.test(t)){const e=t.slice(7,-1).split(/,\s/).map(Number);r.x+=e[4],r.y+=e[5]}else if(/^matrix3d/.test(t)){const e=t.slice(9,-1).split(/,\s/).map(Number);r.x+=e[12],r.y+=e[13]}e=e.parentNode}}const i={},n=w(e.target),s=w(t),a=s.width,o=s.height;let l=e.offsetY-(s.top-n.top),d=e.offsetX-(s.left-n.left);if(e.changedTouches){const i=function(t){if(t&&t.getBoundingClientRect&&t.parentNode){const e=t.getBoundingClientRect(),r={};return["bottom","height","left","right","top","width"].forEach((t=>{void 0!==e[t]&&(r[t]=e[t])})),r.height||(r.height=parseFloat(k(t,"height"))),r.width||(r.width=parseFloat(k(t,"width"))),r}}(t);d=e.changedTouches[0].pageX-i.left,l=e.changedTouches[0].pageY+i.top,p&&(d-=r.x,l-=r.y)}return i.y=1-Math.max(0,Math.min(1,l/o)),i.x=Math.max(0,Math.min(1,d/a)),i}function R(t){if(!(t&&"object"==typeof t&&t.hasOwnProperty("ver")&&t.hasOwnProperty("complete")&&t.hasOwnProperty("nodes")))return"";const e="asi sid hp rid name domain".split(" ");return t.ver+","+t.complete+"!"+t.nodes.map((function(t){return e.map((function(e){return t[e]?encodeURIComponent(t[e]):""})).join(",")})).join("!")}const M=Object.prototype.toString,x=function(t){return N(t)?Object.keys(t):[]};function N(t){return!!t&&"object"==typeof t}function P(t){return N(t)&&"[object Object]"===M.call(t)&&t.constructor===Object}function O(...t){const e={};return t.forEach((t=>{var r,i;t&&(i=(t,r)=>{P(t)?(P(e[r])||(e[r]={}),e[r]=O(e[r],t)):e[r]=t},x(r=t).forEach((t=>i(r[t],t))))})),e}const F=function(t){try{return new URL(t).hostname}catch(e){const r=n().createElement("a");return r.href=t,r.hostname}},U=function(t){const e=(t=t.replace(".cdn.ampproject.org","")).lastIndexOf("-");return 0<=e?(t=t.substring(0,e)+"."+t.substring(e+1),F(t)):null},B=function(){const t=e().location.href;n().referrer;if(e().parent!=e()){const t=e(),r=n();let i=null,s=null,a=null,o=null,l=null,d=null,u=null,c=null,h=null,f=null,p=null,v=null,g=null,m=null,y=null,E=null,T=0,S=T=-1;const b=[],L=[],A=[];try{g=t.location.href}catch(t){}try{v=t.top.location.href}catch(t){}try{p=t.location.hostname}catch(t){}try{f=t.top.location.hostname}catch(t){}try{h=t.location.origin}catch(t){}try{c=t.top.location.origin}catch(t){}try{u=r.referrer,d=F(u)}catch(t){}try{l=[],o=[];for(let e=0;e<t.location.ancestorOrigins.length;e++){const r=t.location.ancestorOrigins[e];l.push(r);const n=F(r);o.push(n),r.endsWith(".cdn.ampproject.org")&&(i=U(r))}}catch(t){}null!==l&&l.length>0&&(a=l[l.length-1]),null!==o&&o.length>0&&(s=o[o.length-1]);try{let e=t;T=0;do{try{b.push(e)}catch(t){}try{L.push({url:e.location.href}),m=e.location.href}catch(t){}try{A.push({url:e.location.hostname}),E=e.location.hostname,S=T+1}catch(t){}e=e.parent,T++}while(e!==t.top&&e!==e.parent&&50>T)}catch(t){}return y=function(){if(null!==v&&""!==v)return v;if(!(1>=T)){if(!(2===T||2>=S)&&null!==m&&""!==m)return m;if(null!==u&&""!==u)return u}return null!==g&&""!==g?g:null!==a&&""!==a?a:null}(),y}return t},j={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",mpd:"application/dash+xml",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"},V=function(t=""){const e=function(t){if("string"==typeof t){const e=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(t);if(e)return e.pop().toLowerCase()}return""}(t);return j[e.toLowerCase()]||""},G=function(t){if(Array.isArray(t)){let e=[];t.forEach((function(t){t=G(t),Array.isArray(t)?e=e.concat(t):N(t)&&e.push(t)})),t=e}else t="string"==typeof t&&t.trim()?[H({src:t})]:N(t)&&"string"==typeof t.src&&t.src&&t.src.trim()?[H(t)]:[];return t};function H(t){if(!t.type){const e=V(t.src);e&&(t.type=e)}return t}const z=G;let K=[];const Y=function t(r){let i,n="info";const s=function(...t){i("log",n,t)};return i=((t,r)=>(i,n,s)=>{const a=r.levels[n],o=new RegExp(`^(${a})$`);if("log"!==i&&s.unshift(i.toUpperCase()+":"),s.unshift(t+":"),K){K.push([].concat(s));const t=K.length-1e3;K.splice(0,t>0?t:0)}if(!e().console)return;let l=e().console[i];l||"debug"!==i||(l=e().console.info||e().console.log),l&&a&&o.test(i)&&l[Array.isArray(s)?"apply":"call"](e().console,s)})(r,s),s.createLogger=e=>t(r+": "+e),s.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:n},s.level=t=>{if("string"==typeof t){if(!s.levels.hasOwnProperty(t))throw new Error(`"${t}" in not a valid log level`);n=t}return n},(s.history=()=>K?[].concat(K):[]).filter=t=>(K||[]).filter((e=>new RegExp(`.*${t}.*`).test(e[0]))),s.history.clear=()=>{K&&(K.length=0)},s.history.disable=()=>{null!==K&&(K.length=0,K=null)},s.history.enable=()=>{null===K&&(K=[])},s.error=(...t)=>i("error",n,t),s.warn=(...t)=>i("warn",n,t),s.debug=(...t)=>i("debug",n,t),s}("adserve.tv.Player"),W=Y.createLogger,Q=Y;function Z(){const t=n().createElement("div");t.classList.add("adsrv-spinner"),this.render=()=>t}function X(){const t=n().createElement("div");t.classList.add("adsrv-title-bar"),this.render=()=>t,this.setTitle=(e,r)=>{t.innerHTML="";const i=n().createElement("div");i.classList.add("adsrv-title"),i.innerHTML=e||"",t.appendChild(i)},this.setDescription=e=>{const r=n().createElement("div");r.classList.add("adsrv-description"),r.innerHTML=e||"",t.appendChild(r)},this.hide=()=>{t.style.display="none"},this.show=()=>{t.style.display="block"}}function q(){const t=n().createElement("div");t.classList.add("adsrv-gradient");const e=n().createElement("div");e.classList.add("adsrv-gradient-top"),t.appendChild(e);const r=n().createElement("div");r.classList.add("adsrv-gradient-bottom"),t.appendChild(r),this.render=()=>t,this.hide=()=>{t.style.display="none"},this.show=()=>{t.style.display="block"}}function J(){const t=n().createElement("div");t.classList.add("adsrv-timeline");const e=n().createElement("div");e.classList.add("adsrv-timeline-buffer"),t.appendChild(e);const r=n().createElement("div");r.classList.add("adsrv-timeline-progress");const i=n().createElement("div");i.innerHTML=S(0),i.classList.add("adsrv-time-tooltip"),r.appendChild(i),t.appendChild(r),this.onmousedown=null,this.onmousemove=null,this.onmouseup=null;let s=0,a=0,o=!1;const l=()=>{const e=t.ownerDocument;t.classList.remove("adsrv-sliding"),this.onmouseup&&"function"==typeof this.onmouseup&&this.onmouseup(),o=!1,e.removeEventListener("mousemove",d),e.removeEventListener("mouseup",l),e.removeEventListener("touchmove",d),e.removeEventListener("touchend",l)},d=e=>{if(o){const r=(e=>C(t,e).x)(e);a=r*s,this.onmousemove&&"function"==typeof this.onmousemove&&this.onmousemove(a)}},c=e=>{const r=t.ownerDocument;"mousedown"===e.type&&e.preventDefault(),"touchstart"!==e.type||u||e.cancelable&&e.preventDefault(),t.classList.add("adsrv-sliding"),this.onmousedown&&"function"==typeof this.onmousedown&&this.onmousedown(),o=!0,r.addEventListener("mousemove",d),r.addEventListener("mouseup",l),r.addEventListener("touchmove",d),r.addEventListener("touchend",l),d(e)};t.addEventListener("mousedown",c),t.addEventListener("touchstart",c),t.addEventListener("click",(t=>{t.stopPropagation(),t.preventDefault()})),this.render=()=>t,this.setDuration=(t=0)=>{s=t},this.updateProgress=t=>{t<0?t=0:t>1&&(t=1),r.style.width=100*t+"%"},this.updateTimeTooltip=t=>{i.innerHTML=S(t)},this.updateBuffer=t=>{t<0?t=0:t>1&&(t=1),e.style.width=100*t+"%"},this.hide=()=>{t.style.display="none"},this.show=()=>{t.style.display="block"}}function $(){const t=n().createElement("button");t.classList.add("adsrv-prev"),this.render=()=>t,this.hide=()=>{t.style.display="none"},this.show=()=>{t.style.display="block"}}function tt(){let t=!1;const e=n().createElement("button");e.classList.add("adsrv-play"),this.onclick=null,e.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.onclick&&"function"==typeof this.onclick&&this.onclick(t)})),this.render=()=>e,this.setState=r=>{t=r,t?e.classList.add("adsrv-pause"):e.classList.remove("adsrv-pause")},this.hide=()=>{e.style.display="none"},this.show=()=>{e.style.display="block"}}function et(){const t=n().createElement("button");t.classList.add("adsrv-next"),this.onclick=null,t.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),this.onclick&&"function"==typeof this.onclick&&this.onclick()})),this.render=()=>t,this.hide=()=>{t.style.display="none"},this.show=()=>{t.style.display="block"}}function rt(){let t=!1;const e=n().createElement("div");e.classList.add("adsrv-volume"),this.onclick=null,e.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.onclick&&"function"==typeof this.onclick&&this.onclick(t)})),this.render=()=>e,this.setState=r=>{t=r,t?e.classList.add("adsrv-muted"):e.classList.remove("adsrv-muted")},this.hide=()=>{e.style.display="none"},this.show=()=>{e.style.display="block"}}function it(){const t=n().createElement("div");t.classList.add("adsrv-timer"),t.innerHTML=S(0),this.render=()=>t;let e=0,r=0;this.setDuration=(i=0)=>{e=i,t.innerHTML=S(r)+" / "+S(e)},this.updateTimeElapsed=(i=0)=>{r=i,t.innerHTML=S(r)+" / "+S(e)},this.hide=()=>{t.style.display="none"},this.show=()=>{t.style.display="show"}}function nt(){const t=n().createElement("div");t.classList.add("adsrv-big-play"),this.render=()=>t,this.hide=()=>{t.style.display="none"},this.show=()=>{t.style.display="block"}}function st(){const t=n().createElement("button");t.classList.add("adsrv-playback-rate");const e=n().createElement("div");e.classList.add("adsrv-playback-rate-value"),t.appendChild(e);const r=n().createElement("ul");r.classList.add("adsrv-list-items"),t.appendChild(r),this.onchange=null;this.buttonPressed=!1;const i=()=>{this.buttonPressed?a():s()},s=()=>{this.buttonPressed=!0,t.classList.add("adsrv-hover"),p&&function(){try{return window.parent!==window.self}catch(t){return!0}}()||t.focus()},a=()=>{this.buttonPressed=!1,t.classList.remove("adsrv-hover")};t.addEventListener("blur",(()=>{p||a()})),t.addEventListener("tap",i),t.addEventListener("click",i),this.items=[],this.selectedIndex=0,this.lastSelectedItem=null,this.addItems=t=>{this.items=t};const o=t=>{const r=t.target;this.selectedIndex=parseInt(r.dataset.index),null!=this.lastSelectedItem&&this.lastSelectedItem!=r&&this.lastSelectedItem.classList.remove("adsrv-selected"),r.classList.add("adsrv-selected"),this.lastSelectedItem=r,e.innerHTML=this.items[this.selectedIndex]+"x",this.onchange&&"function"==typeof this.onchange&&this.onchange(this.items[this.selectedIndex])};this.render=()=>(this.items.forEach(((t,i)=>{const s=n().createElement("li");s.innerHTML=t+"x",s.dataset.index=i,s.addEventListener("click",o),i==this.selectedIndex&&(e.innerHTML=t+"x",s.classList.add("adsrv-selected"),this.lastSelectedItem=s),r.appendChild(s)})),t),this.hide=()=>{t.style.display="none"},this.show=()=>{t.style.display="block"}}function at(){let t=!1;const e=n().createElement("button");e.classList.add("adsrv-fullscreen"),this.onclick=null,e.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.onclick&&"function"==typeof this.onclick&&this.onclick(t)})),this.render=()=>e,this.setState=r=>{t=r,t?e.classList.add("adsrv-off"):e.classList.remove("adsrv-off")},this.hide=()=>{e.style.display="none"},this.show=()=>{e.style.display="block"}}function ot(){const t=n().createElement("button");t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 15 15"><path d="M3.25,3.25l8.5,8.5M11.75,3.25l-8.5,8.5"></path></svg>',t.classList.add("adsrv-close"),this.onclick=null,t.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),this.onclick&&"function"==typeof this.onclick&&this.onclick()})),this.render=()=>t,this.hide=()=>{t.style.display="none"},this.show=()=>{t.style.display="block"}}var lt=r(379),dt=r.n(lt),ut=r(795),ct=r.n(ut),ht=r(569),ft=r.n(ht),pt=r(565),vt=r.n(pt),gt=r(216),mt=r.n(gt),yt=r(589),Et=r.n(yt),Tt=r(704),St={};St.styleTagTransform=Et(),St.setAttributes=vt(),St.insert=ft().bind(null,"head"),St.domAPI=ct(),St.insertStyleElement=mt();dt()(Tt.Z,St);Tt.Z&&Tt.Z.locals&&Tt.Z.locals;function bt(t){if(t instanceof bt)return t;"number"==typeof t?this.code=t:"string"==typeof t?this.message=t:N(t)&&("number"==typeof t.code&&(this.code=t.code),Object.assign(this,t)),this.message||(this.message=bt.defaultMessages[this.code]||"")}bt.prototype.code=0,bt.prototype.message="",bt.prototype.status=null,bt.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],bt.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(let t=0;t<bt.errorTypes.length;t++)bt[bt.errorTypes[t]]=t,bt.prototype[bt.errorTypes[t]]=t;const Lt=bt,At=new WeakMap;let _t,It=3;function Dt(){return It++}function kt(t,e){if(!At.has(t))return;const r=At.get(t);0===r.handlers[e].length&&(delete r.handlers[e],t.removeEventListener?t.removeEventListener(e,r.dispatcher,!1):t.detachEvent&&t.detachEvent("on"+e,r.dispatcher)),Object.getOwnPropertyNames(r.handlers).length<=0&&(delete r.handlers,delete r.dispatcher,delete r.disabled),0===Object.getOwnPropertyNames(r).length&&At.delete(t)}function wt(t,e,r,i){r.forEach((function(r){t(e,r,i)}))}function Ct(t){if(t.fixed_)return t;function r(){return!0}function i(){return!1}if(!t||!t.isPropagationStopped||!t.isImmediatePropagationStopped){const s=t||e().event;t={};for(const e in s)"layerX"!==e&&"layerY"!==e&&"keyLocation"!==e&&"webkitMovementX"!==e&&"webkitMovementY"!==e&&"path"!==e&&("returnValue"===e&&s.preventDefault||(t[e]=s[e]));if(t.target||(t.target=t.srcElement||n()),t.relatedTarget||(t.relatedTarget=t.fromElement===t.target?t.toElement:t.fromElement),t.preventDefault=function(){s.preventDefault&&s.preventDefault(),t.returnValue=!1,s.returnValue=!1,t.defaultPrevented=!0},t.defaultPrevented=!1,t.stopPropagation=function(){s.stopPropagation&&s.stopPropagation(),t.cancelBubble=!0,s.cancelBubble=!0,t.isPropagationStopped=r},t.isPropagationStopped=i,t.stopImmediatePropagation=function(){s.stopImmediatePropagation&&s.stopImmediatePropagation(),t.isImmediatePropagationStopped=r,t.stopPropagation()},t.isImmediatePropagationStopped=i,null!==t.clientX&&void 0!==t.clientX){const e=n().documentElement,r=n().body;t.pageX=t.clientX+(e&&e.scrollLeft||r&&r.scrollLeft||0)-(e&&e.clientLeft||r&&r.clientLeft||0),t.pageY=t.clientY+(e&&e.scrollTop||r&&r.scrollTop||0)-(e&&e.clientTop||r&&r.clientTop||0)}t.which=t.charCode||t.keyCode,null!==t.button&&void 0!==t.button&&(t.button=1&t.button?0:4&t.button?1:2&t.button?2:0)}return t.fixed_=!0,t}const Rt=function(){if("boolean"!=typeof _t){_t=!1;try{const t=Object.defineProperty({},"passive",{get(){_t=!0}});e().addEventListener("test",null,t),e().removeEventListener("test",null,t)}catch(t){}}return _t},Mt=["touchstart","touchmove"];function xt(t,e,r){if(Array.isArray(e))return wt(xt,t,e,r);At.has(t)||At.set(t,{});const i=At.get(t);if(i.handlers||(i.handlers={}),i.handlers[e]||(i.handlers[e]=[]),r.guid||(r.guid=Dt()),i.handlers[e].push(r),i.dispatcher||(i.disabled=!1,i.dispatcher=function(e,r){if(i.disabled)return;e=Ct(e);const n=i.handlers[e.type];if(n){const i=n.slice(0);for(let n=0,s=i.length;n<s&&!e.isImmediatePropagationStopped();n++)try{i[n].call(t,e,r)}catch(t){Q.error(t)}}}),1===i.handlers[e].length)if(t.addEventListener){let r=!1;Rt()&&Mt.indexOf(e)>-1&&(r={passive:!0}),t.addEventListener(e,i.dispatcher,r)}else t.attachEvent&&t.attachEvent("on"+e,i.dispatcher)}function Nt(t,e,r){if(!At.has(t))return;const i=At.get(t);if(!i.handlers)return;if(Array.isArray(e))return wt(Nt,t,e,r);const n=function(t,e){i.handlers[e]=[],kt(t,e)};if(void 0===e){for(const e in i.handlers)Object.prototype.hasOwnProperty.call(i.handlers||{},e)&&n(t,e);return}const s=i.handlers[e];if(s)if(r){if(r.guid)for(let t=0;t<s.length;t++)s[t].guid===r.guid&&s.splice(t--,1);kt(t,e)}else n(t,e)}function Pt(t,e,r){const i=At.has(t)?At.get(t):{},n=t.parentNode||t.ownerDocument;if("string"==typeof e?e={type:e,target:t}:e.target||(e.target=t),e=Ct(e),i.dispatcher&&i.dispatcher.call(t,e,r),n&&!e.isPropagationStopped()&&!0===e.bubbles)Pt.call(null,n,e,r);else if(!n&&!e.defaultPrevented&&e.target&&e.target[e.type]){At.has(e.target)||At.set(e.target,{});const t=At.get(e.target);e.target[e.type]&&(t.disabled=!0,"function"==typeof e.target[e.type]&&e.target[e.type](),t.disabled=!1)}return!e.defaultPrevented}function Ot(t,e,r){if(Array.isArray(e))return wt(Ot,t,e,r);const i=function(){Nt(t,e,i),r.apply(this,arguments)};i.guid=r.guid=r.guid||Dt(),xt(t,e,i)}let Ft;class Ut{on(t,e){const r=this.addEventListener;this.addEventListener=()=>{},xt(this,t,e),this.addEventListener=r}off(t,e){Nt(this,t,e)}one(t,e){const r=this.addEventListener;this.addEventListener=()=>{},Ot(this,t,e),this.addEventListener=r}any(t,e){const r=this.addEventListener;this.addEventListener=()=>{},function(t,e,r){const i=function(){Nt(t,e,i),r.apply(this,arguments)};i.guid=r.guid=r.guid||Dt(),xt(t,e,i)}(this,t,e),this.addEventListener=r}trigger(t){const e=t.type||t;"string"==typeof t&&(t={type:e}),t=Ct(t),this.allowedEvents_[e]&&this["on"+e]&&this["on"+e](t),Pt(this,t)}queueTrigger(t){Ft||(Ft=new Map);const r=t.type||t;let i=Ft.get(this);i||(i=new Map,Ft.set(this,i));const n=i.get(r);i.delete(r),e().clearTimeout(n);const s=e().setTimeout((()=>{i.delete(r),0===i.size&&(i=null,Ft.delete(this)),this.trigger(t)}),0);i.set(r,s)}}Ut.prototype.allowedEvents_={},Ut.prototype.addEventListener=Ut.prototype.on,Ut.prototype.removeEventListener=Ut.prototype.off,Ut.prototype.dispatchEvent=Ut.prototype.trigger;const Bt=Ut;let jt=0,Vt=[];const Gt=(t=>{try{return new Worker(URL.createObjectURL(new Blob(["("+t+")()"])))}catch(t){}})((function(){const t=20,e=200;let r,i=0;function n(){const s=performance.now();i||(i=s);s-i>=e&&(postMessage({type:"timeUpdate",time:s}),i+=e),r=setTimeout(n,t)}self.onmessage=function(t){if(t&&t.data)switch(t.data.type){case"pause":r&&(clearTimeout(r),r=null,postMessage("timeBus paused"));break;case"resume":null===r&&(r=setTimeout(n,0),postMessage("timeBus resumed"))}},r=setTimeout(n,0),postMessage("timeBus initialized")}));Gt.onmessage=t=>{if("timeUpdate"===t.data.type)jt=t.data.time,(t=>{Vt.forEach((e=>{t%e.interval<200&&e.callback.call(null,t)}))})(jt)};let Ht,zt="",Kt=5;const Yt={};function Wt(){if(zt="",!window.__tcfapi&&window!==window.top){let t,e=window;for(;!t;){try{e.frames.__tcfapiLocator&&(t=e)}catch(t){}if(e===window.top)break;e=e.parent}window.__tcfapi=function(e,r,i,n){if(t){const s=Math.random()+"",a={__tcfapiCall:{command:e,parameter:n,version:r,callId:s}};Yt[s]=i,t.postMessage(a,"*")}else i({msg:"CMP not found"},!1)},window.addEventListener("message",(function(t){let e;if("string"==typeof t.data)try{e=JSON.parse(t.data)}catch(t){}else e=t.data;if(e&&e.__tcfapiReturn){const t=e.__tcfapiReturn;if(t&&Yt.hasOwnProperty(t.callId))try{Yt[t.callId](t.returnValue,t.success),delete Yt[t.callId]}catch(t){}}}))}"function"==typeof window.__tcfapi?(window.__tcfapi("ping",2,((t,e)=>{})),window.__tcfapi("getTCData",2,((t,e)=>{e?(Ht=t.gdprApplies,zt=t.tcString):0==Kt--||window.setTimeout(Wt,1200)}))):Kt-- >0&&window.setTimeout(Wt,1200)}let Qt="",Zt=5;const Xt={};function qt(){if(Qt="",!window.__uspapi&&window!==window.top){let t,e=window;for(;!t;){try{e.frames.__uspapiLocator&&(t=e)}catch(t){}if(e===window.top)break;e=e.parent}window.__uspapi=function(e,r,i){if(!t)return void i({msg:"CMP not found"},!1);const n=Math.random()+"",s={__uspapiCall:{command:e,version:r,callId:n}};Xt[n]=i,t.postMessage(s,"*")},window.addEventListener("message",(function(t){let e;if("string"==typeof t.data)try{e=JSON.parse(t.data)}catch(t){}else e=t.data;if(e&&e.__uspapiReturn){const t=e.__uspapiReturn;if(t&&Xt.hasOwnProperty(t.callId))try{Xt[t.callId](t.returnValue,t.success),delete Xt[t.callId]}catch(t){}}}))}"function"==typeof window.__uspapi?window.__uspapi("getUSPData",1,((t,e)=>{e?Qt=t.uspString:0==Zt--||window.setTimeout(qt,1200)})):Zt-- >0&&window.setTimeout(qt,1200)}var Jt={686:function(t,e){!function(t){function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function r(t){for(var r=1;r<arguments.length;r++){var i=null!=arguments[r]?arguments[r]:{};r%2?e(Object(i),!0).forEach((function(e){o(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function a(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e)}function d(t){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},d(t)}function u(t,e){return u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},u(t,e)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,i=d(t);if(e){var n=d(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,r)}}function h(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:t.id||null,adId:t.adId||null,sequence:t.sequence||null,apiFramework:t.apiFramework||null,universalAdIds:[],creativeExtensions:[]}}var v=["ADCATEGORIES","ADCOUNT","ADPLAYHEAD","ADSERVINGID","ADTYPE","APIFRAMEWORKS","APPBUNDLE","ASSETURI","BLOCKEDADCATEGORIES","BREAKMAXADLENGTH","BREAKMAXADS","BREAKMAXDURATION","BREAKMINADLENGTH","BREAKMINDURATION","BREAKPOSITION","CLICKPOS","CLICKTYPE","CLIENTUA","CONTENTID","CONTENTPLAYHEAD","CONTENTURI","DEVICEIP","DEVICEUA","DOMAIN","EXTENSIONS","GDPRCONSENT","IFA","IFATYPE","INVENTORYSTATE","LATLONG","LIMITADTRACKING","MEDIAMIME","MEDIAPLAYHEAD","OMIDPARTNER","PAGEURL","PLACEMENTTYPE","PLAYERCAPABILITIES","PLAYERSIZE","PLAYERSTATE","PODSEQUENCE","REGULATIONS","SERVERSIDE","SERVERUA","TRANSACTIONID","UNIVERSALADID","VASTVERSIONS","VERIFICATIONVENDORS"];function g(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=[],n=E(t);for(var s in!e.ERRORCODE||r.isCustomCode||/^[0-9]{3}$/.test(e.ERRORCODE)||(e.ERRORCODE=900),e.CACHEBUSTING=L(Math.round(1e8*Math.random())),e.TIMESTAMP=(new Date).toISOString(),e.RANDOM=e.random=e.CACHEBUSTING,e)e[s]=b(e[s]);for(var a in n){var o=n[a];"string"==typeof o&&i.push(m(o,e))}return i}function m(t,e){var r=(t=y(t,e)).match(/[^[\]]+(?=])/g);if(!r)return t;var i=r.filter((function(t){return v.indexOf(t)>-1}));return 0===i.length?t:y(t,i=i.reduce((function(t,e){return t[e]=-1,t}),{}))}function y(t,e){var r=t;for(var i in e){var n=e[i];r=r.replace(new RegExp("(?:\\[|%%)(".concat(i,")(?:\\]|%%)"),"g"),n)}return r}function E(t){return Array.isArray(t)?t.map((function(t){return t&&t.hasOwnProperty("url")?t.url:t})):t}function T(t,e){for(var r=0;r<e.length;r++)if(S(e[r],t))return!0;return!1}function S(t,e){if(t&&e){var r=Object.getOwnPropertyNames(t),i=Object.getOwnPropertyNames(e);return r.length===i.length&&t.id===e.id&&t.url===e.url}return!1}function b(t){return encodeURIComponent(t).replace(/[!'()*]/g,(function(t){return"%".concat(t.charCodeAt(0).toString(16))}))}function L(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return t.toString().padStart(e,"0")}var A={track:function(t,e,r){g(t,e,r).forEach((function(t){"undefined"!=typeof window&&null!==window&&((new Image).src=t)}))},resolveURLTemplates:g,extractURLsFromTemplates:E,containsTemplateObject:T,isTemplateObjectEqual:S,encodeURIComponentRFC3986:b,replaceUrlMacros:m,isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},flatten:function t(e){return e.reduce((function(e,r){return e.concat(Array.isArray(r)?t(r):r)}),[])},joinArrayOfUniqueTemplateObjs:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=Array.isArray(t)?t:[],i=Array.isArray(e)?e:[];return r.concat(i).reduce((function(t,e){return T(e,t)||t.push(e),t}),[])},isValidTimeValue:function(t){return Number.isFinite(t)&&t>=-2},addLeadingZeros:L};function _(t){return-1!==["true","TRUE","True","1"].indexOf(t)}var I={childByName:function(t,e){var r=t.childNodes;for(var i in r){var n=r[i];if(n.nodeName===e)return n}},childrenByName:function(t,e){var r=[],i=t.childNodes;for(var n in i){var s=i[n];s.nodeName===e&&r.push(s)}return r},resolveVastAdTagURI:function(t,e){if(!e)return t;if(0===t.indexOf("//")){var r=location.protocol;return"".concat(r).concat(t)}if(-1===t.indexOf("://")){var i=e.slice(0,e.lastIndexOf("/"));return"".concat(i,"/").concat(t)}return t},parseBoolean:_,parseNodeText:function(t){return t&&(t.textContent||t.text||"").trim()},copyNodeAttribute:function(t,e,r){var i=e.getAttribute(t);i&&r.setAttribute(t,i)},parseAttributes:function(t){for(var e=t.attributes,r={},i=0;i<e.length;i++)r[e[i].nodeName]=e[i].nodeValue;return r},parseDuration:function(t){if(null==t)return-1;if(A.isNumeric(t))return parseInt(t);var e=t.split(":");if(3!==e.length)return-1;var r=e[2].split("."),i=parseInt(r[0]);2===r.length&&(i+=parseFloat("0.".concat(r[1])));var n=parseInt(60*e[1]),s=parseInt(60*e[0]*60);return isNaN(s)||isNaN(n)||isNaN(i)||n>3600||i>60?-1:s+n+i},splitVAST:function(t){var e=[],r=null;return t.forEach((function(i,n){if(i.sequence&&(i.sequence=parseInt(i.sequence,10)),i.sequence>1){var s=t[n-1];if(s&&s.sequence===i.sequence-1)return void(r&&r.push(i));delete i.sequence}r=[i],e.push(r)})),e},assignAttributes:function(t,e){if(t)for(var r in t){var i=t[r];if(i.nodeName&&i.nodeValue&&e.hasOwnProperty(i.nodeName)){var n=i.nodeValue;"boolean"==typeof e[i.nodeName]&&(n=_(n)),e[i.nodeName]=n}}},mergeWrapperAdData:function(t,e){t.errorURLTemplates=e.errorURLTemplates.concat(t.errorURLTemplates),t.impressionURLTemplates=e.impressionURLTemplates.concat(t.impressionURLTemplates),t.extensions=e.extensions.concat(t.extensions),e.viewableImpression.length>0&&(t.viewableImpression=[].concat(h(t.viewableImpression),h(e.viewableImpression))),t.followAdditionalWrappers=e.followAdditionalWrappers,t.allowMultipleAds=e.allowMultipleAds,t.fallbackOnNoAd=e.fallbackOnNoAd;var r=(e.creatives||[]).filter((function(t){return t&&"companion"===t.type})),i=r.reduce((function(t,e){return(e.variations||[]).forEach((function(e){(e.companionClickTrackingURLTemplates||[]).forEach((function(e){A.containsTemplateObject(e,t)||t.push(e)}))})),t}),[]);t.creatives=r.concat(t.creatives);var n=e.videoClickTrackingURLTemplates&&e.videoClickTrackingURLTemplates.length,s=e.videoCustomClickURLTemplates&&e.videoCustomClickURLTemplates.length;t.creatives.forEach((function(t){if(e.trackingEvents&&e.trackingEvents[t.type])for(var r in e.trackingEvents[t.type]){var a=e.trackingEvents[t.type][r];Array.isArray(t.trackingEvents[r])||(t.trackingEvents[r]=[]),t.trackingEvents[r]=t.trackingEvents[r].concat(a)}"linear"===t.type&&(n&&(t.videoClickTrackingURLTemplates=t.videoClickTrackingURLTemplates.concat(e.videoClickTrackingURLTemplates)),s&&(t.videoCustomClickURLTemplates=t.videoCustomClickURLTemplates.concat(e.videoCustomClickURLTemplates)),!e.videoClickThroughURLTemplate||null!==t.videoClickThroughURLTemplate&&void 0!==t.videoClickThroughURLTemplate||(t.videoClickThroughURLTemplate=e.videoClickThroughURLTemplate)),"companion"===t.type&&i.length&&(t.variations||[]).forEach((function(t){t.companionClickTrackingURLTemplates=A.joinArrayOfUniqueTemplateObjs(t.companionClickTrackingURLTemplates,i)}))})),e.adVerifications&&(t.adVerifications=t.adVerifications.concat(e.adVerifications)),e.blockedAdCategories&&(t.blockedAdCategories=t.blockedAdCategories.concat(e.blockedAdCategories))}};function D(t,e){var r=function(){var t=p(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return{id:t.id,adId:t.adId,sequence:t.sequence,apiFramework:t.apiFramework,type:"companion",required:null,variations:[]}}(e);return r.required=t.getAttribute("required")||null,r.variations=I.childrenByName(t,"Companion").map((function(t){var e=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:t.id||null,adType:"companionAd",width:t.width||0,height:t.height||0,assetWidth:t.assetWidth||null,assetHeight:t.assetHeight||null,expandedWidth:t.expandedWidth||null,expandedHeight:t.expandedHeight||null,apiFramework:t.apiFramework||null,adSlotID:t.adSlotID||null,pxratio:t.pxratio||"1",renderingMode:t.renderingMode||"default",staticResources:[],htmlResources:[],iframeResources:[],adParameters:null,xmlEncoded:null,altText:null,companionClickThroughURLTemplate:null,companionClickTrackingURLTemplates:[],trackingEvents:{}}}(I.parseAttributes(t));e.htmlResources=I.childrenByName(t,"HTMLResource").reduce((function(t,e){var r=I.parseNodeText(e);return r?t.concat(r):t}),[]),e.iframeResources=I.childrenByName(t,"IFrameResource").reduce((function(t,e){var r=I.parseNodeText(e);return r?t.concat(r):t}),[]),e.staticResources=I.childrenByName(t,"StaticResource").reduce((function(t,e){var r=I.parseNodeText(e);return r?t.concat({url:r,creativeType:e.getAttribute("creativeType")||null}):t}),[]),e.altText=I.parseNodeText(I.childByName(t,"AltText"))||null;var r=I.childByName(t,"TrackingEvents");r&&I.childrenByName(r,"Tracking").forEach((function(t){var r=t.getAttribute("event"),i=I.parseNodeText(t);r&&i&&(Array.isArray(e.trackingEvents[r])||(e.trackingEvents[r]=[]),e.trackingEvents[r].push(i))})),e.companionClickTrackingURLTemplates=I.childrenByName(t,"CompanionClickTracking").map((function(t){return{id:t.getAttribute("id")||null,url:I.parseNodeText(t)}})),e.companionClickThroughURLTemplate=I.parseNodeText(I.childByName(t,"CompanionClickThrough"))||null;var i=I.childByName(t,"AdParameters");return i&&(e.adParameters=I.parseNodeText(i),e.xmlEncoded=i.getAttribute("xmlEncoded")||null),e})),r}function k(t,e){var r,i=function(){var t=p(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return{id:t.id,adId:t.adId,sequence:t.sequence,apiFramework:t.apiFramework,type:"linear",duration:0,skipDelay:null,mediaFiles:[],mezzanine:null,interactiveCreativeFile:null,closedCaptionFiles:[],videoClickThroughURLTemplate:null,videoClickTrackingURLTemplates:[],videoCustomClickURLTemplates:[],adParameters:null,icons:[],trackingEvents:{}}}(e);i.duration=I.parseDuration(I.parseNodeText(I.childByName(t,"Duration")));var n=t.getAttribute("skipoffset");if(null==n)i.skipDelay=null;else if("%"===n.charAt(n.length-1)&&-1!==i.duration){var s=parseInt(n,10);i.skipDelay=i.duration*(s/100)}else i.skipDelay=I.parseDuration(n);var a=I.childByName(t,"VideoClicks");if(a){var o=I.childByName(a,"ClickThrough");i.videoClickThroughURLTemplate=o?{id:o.getAttribute("id")||null,url:I.parseNodeText(o)}:null,I.childrenByName(a,"ClickTracking").forEach((function(t){i.videoClickTrackingURLTemplates.push({id:t.getAttribute("id")||null,url:I.parseNodeText(t)})})),I.childrenByName(a,"CustomClick").forEach((function(t){i.videoCustomClickURLTemplates.push({id:t.getAttribute("id")||null,url:I.parseNodeText(t)})}))}var l=I.childByName(t,"AdParameters");l&&(i.adParameters=I.parseNodeText(l)),I.childrenByName(t,"TrackingEvents").forEach((function(t){I.childrenByName(t,"Tracking").forEach((function(t){var e=t.getAttribute("event"),n=I.parseNodeText(t);if(e&&n){if("progress"===e){if(!(r=t.getAttribute("offset")))return;e="%"===r.charAt(r.length-1)?"progress-".concat(r):"progress-".concat(Math.round(I.parseDuration(r)))}Array.isArray(i.trackingEvents[e])||(i.trackingEvents[e]=[]),i.trackingEvents[e].push(n)}}))})),I.childrenByName(t,"MediaFiles").forEach((function(t){I.childrenByName(t,"MediaFile").forEach((function(t){i.mediaFiles.push(function(t){var e={id:null,fileURL:null,fileSize:0,deliveryType:"progressive",mimeType:null,mediaType:null,codec:null,bitrate:0,minBitrate:0,maxBitrate:0,width:0,height:0,apiFramework:null,scalable:null,maintainAspectRatio:null};e.id=t.getAttribute("id"),e.fileURL=I.parseNodeText(t),e.deliveryType=t.getAttribute("delivery"),e.codec=t.getAttribute("codec"),e.mimeType=t.getAttribute("type"),e.mediaType=t.getAttribute("mediaType")||"2D",e.apiFramework=t.getAttribute("apiFramework"),e.fileSize=parseInt(t.getAttribute("fileSize")||0),e.bitrate=parseInt(t.getAttribute("bitrate")||0),e.minBitrate=parseInt(t.getAttribute("minBitrate")||0),e.maxBitrate=parseInt(t.getAttribute("maxBitrate")||0),e.width=parseInt(t.getAttribute("width")||0),e.height=parseInt(t.getAttribute("height")||0);var r=t.getAttribute("scalable");r&&"string"==typeof r&&(e.scalable=I.parseBoolean(r));var i=t.getAttribute("maintainAspectRatio");return i&&"string"==typeof i&&(e.maintainAspectRatio=I.parseBoolean(i)),e}(t))}));var e=I.childByName(t,"InteractiveCreativeFile");e&&(i.interactiveCreativeFile=function(t){var e=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:t.type||null,apiFramework:t.apiFramework||null,variableDuration:I.parseBoolean(t.variableDuration),fileURL:null}}(I.parseAttributes(t));return e.fileURL=I.parseNodeText(t),e}(e));var r=I.childByName(t,"ClosedCaptionFiles");r&&I.childrenByName(r,"ClosedCaptionFile").forEach((function(t){var e=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:t.type||null,language:t.language||null,fileURL:null}}(I.parseAttributes(t));e.fileURL=I.parseNodeText(t),i.closedCaptionFiles.push(e)}));var n,s,a,o=I.childByName(t,"Mezzanine"),l=(n=o,s={},a=!1,["delivery","type","width","height"].forEach((function(t){n&&n.getAttribute(t)?s[t]=n.getAttribute(t):a=!0})),a?null:s);if(l){var d={id:null,fileURL:null,delivery:null,codec:null,type:null,width:0,height:0,fileSize:0,mediaType:"2D"};d.id=o.getAttribute("id"),d.fileURL=I.parseNodeText(o),d.delivery=l.delivery,d.codec=o.getAttribute("codec"),d.type=l.type,d.width=parseInt(l.width,10),d.height=parseInt(l.height,10),d.fileSize=parseInt(o.getAttribute("fileSize"),10),d.mediaType=o.getAttribute("mediaType")||"2D",i.mezzanine=d}}));var d=I.childByName(t,"Icons");return d&&I.childrenByName(d,"Icon").forEach((function(t){i.icons.push(function(t){var e={program:null,height:0,width:0,xPosition:0,yPosition:0,apiFramework:null,offset:null,duration:0,type:null,staticResource:null,htmlResource:null,iframeResource:null,pxratio:"1",iconClickThroughURLTemplate:null,iconClickTrackingURLTemplates:[],iconViewTrackingURLTemplate:null};e.program=t.getAttribute("program"),e.height=parseInt(t.getAttribute("height")||0),e.width=parseInt(t.getAttribute("width")||0),e.xPosition=function(t){return-1!==["left","right"].indexOf(t)?t:parseInt(t||0)}(t.getAttribute("xPosition")),e.yPosition=function(t){return-1!==["top","bottom"].indexOf(t)?t:parseInt(t||0)}(t.getAttribute("yPosition")),e.apiFramework=t.getAttribute("apiFramework"),e.pxratio=t.getAttribute("pxratio")||"1",e.offset=I.parseDuration(t.getAttribute("offset")),e.duration=I.parseDuration(t.getAttribute("duration")),I.childrenByName(t,"HTMLResource").forEach((function(t){e.type=t.getAttribute("creativeType")||"text/html",e.htmlResource=I.parseNodeText(t)})),I.childrenByName(t,"IFrameResource").forEach((function(t){e.type=t.getAttribute("creativeType")||0,e.iframeResource=I.parseNodeText(t)})),I.childrenByName(t,"StaticResource").forEach((function(t){e.type=t.getAttribute("creativeType")||0,e.staticResource=I.parseNodeText(t)}));var r=I.childByName(t,"IconClicks");return r&&(e.iconClickThroughURLTemplate=I.parseNodeText(I.childByName(r,"IconClickThrough")),I.childrenByName(r,"IconClickTracking").forEach((function(t){e.iconClickTrackingURLTemplates.push({id:t.getAttribute("id")||null,url:I.parseNodeText(t)})}))),e.iconViewTrackingURLTemplate=I.parseNodeText(I.childByName(t,"IconViewTracking")),e}(t))})),i}function w(t,e){var r=function(){var t=p(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return{id:t.id,adId:t.adId,sequence:t.sequence,apiFramework:t.apiFramework,type:"nonlinear",variations:[],trackingEvents:{}}}(e);return I.childrenByName(t,"TrackingEvents").forEach((function(t){var e,i;I.childrenByName(t,"Tracking").forEach((function(t){e=t.getAttribute("event"),i=I.parseNodeText(t),e&&i&&(Array.isArray(r.trackingEvents[e])||(r.trackingEvents[e]=[]),r.trackingEvents[e].push(i))}))})),I.childrenByName(t,"NonLinear").forEach((function(t){var e={id:null,width:0,height:0,expandedWidth:0,expandedHeight:0,scalable:!0,maintainAspectRatio:!0,minSuggestedDuration:0,apiFramework:"static",adType:"nonLinearAd",type:null,staticResource:null,htmlResource:null,iframeResource:null,nonlinearClickThroughURLTemplate:null,nonlinearClickTrackingURLTemplates:[],adParameters:null};e.id=t.getAttribute("id")||null,e.width=t.getAttribute("width"),e.height=t.getAttribute("height"),e.expandedWidth=t.getAttribute("expandedWidth"),e.expandedHeight=t.getAttribute("expandedHeight"),e.scalable=I.parseBoolean(t.getAttribute("scalable")),e.maintainAspectRatio=I.parseBoolean(t.getAttribute("maintainAspectRatio")),e.minSuggestedDuration=I.parseDuration(t.getAttribute("minSuggestedDuration")),e.apiFramework=t.getAttribute("apiFramework"),I.childrenByName(t,"HTMLResource").forEach((function(t){e.type=t.getAttribute("creativeType")||"text/html",e.htmlResource=I.parseNodeText(t)})),I.childrenByName(t,"IFrameResource").forEach((function(t){e.type=t.getAttribute("creativeType")||0,e.iframeResource=I.parseNodeText(t)})),I.childrenByName(t,"StaticResource").forEach((function(t){e.type=t.getAttribute("creativeType")||0,e.staticResource=I.parseNodeText(t)}));var i=I.childByName(t,"AdParameters");i&&(e.adParameters=I.parseNodeText(i)),e.nonlinearClickThroughURLTemplate=I.parseNodeText(I.childByName(t,"NonLinearClickThrough")),I.childrenByName(t,"NonLinearClickTracking").forEach((function(t){e.nonlinearClickTrackingURLTemplates.push({id:t.getAttribute("id")||null,url:I.parseNodeText(t)})})),r.variations.push(e)})),r}function C(t){var e=[];return t.forEach((function(t){var r=R(t);r&&e.push(r)})),e}function R(t){if("#comment"===t.nodeName)return null;var e,r={name:null,value:null,attributes:{},children:[]},i=t.attributes,n=t.childNodes;if(r.name=t.nodeName,t.attributes)for(var s in i)if(i.hasOwnProperty(s)){var a=i[s];a.nodeName&&a.nodeValue&&(r.attributes[a.nodeName]=a.nodeValue)}for(var o in n)if(n.hasOwnProperty(o)){var l=R(n[o]);l&&r.children.push(l)}if(0===r.children.length||1===r.children.length&&["#cdata-section","#text"].indexOf(r.children[0].name)>=0){var d=I.parseNodeText(t);""!==d&&(r.value=d),r.children=[]}return null===(e=r).value&&0===Object.keys(e.attributes).length&&0===e.children.length?null:r}function M(t){var e=[];return t.forEach((function(t){var r,i={id:t.getAttribute("id")||null,adId:x(t),sequence:t.getAttribute("sequence")||null,apiFramework:t.getAttribute("apiFramework")||null},n=[];I.childrenByName(t,"UniversalAdId").forEach((function(t){var e={idRegistry:t.getAttribute("idRegistry")||"unknown",value:I.parseNodeText(t)};n.push(e)}));var s=I.childByName(t,"CreativeExtensions");for(var a in s&&(r=C(I.childrenByName(s,"CreativeExtension"))),t.childNodes){var o=t.childNodes[a],l=void 0;switch(o.nodeName){case"Linear":l=k(o,i);break;case"NonLinearAds":l=w(o,i);break;case"CompanionAds":l=D(o,i)}l&&(n&&(l.universalAdIds=n),r&&(l.creativeExtensions=r),e.push(l))}})),e}function x(t){return t.getAttribute("AdID")||t.getAttribute("adID")||t.getAttribute("adId")||null}var N={Wrapper:{subElements:["VASTAdTagURI","Impression"]},BlockedAdCategories:{attributes:["authority"]},InLine:{subElements:["AdSystem","AdTitle","Impression","AdServingId","Creatives"]},Category:{attributes:["authority"]},Pricing:{attributes:["model","currency"]},Verification:{oneOfinLineResources:["JavaScriptResource","ExecutableResource"],attributes:["vendor"]},UniversalAdId:{attributes:["idRegistry"]},JavaScriptResource:{attributes:["apiFramework","browserOptional"]},ExecutableResource:{attributes:["apiFramework","type"]},Tracking:{attributes:["event"]},Creatives:{subElements:["Creative"]},Creative:{subElements:["UniversalAdId"]},Linear:{subElements:["MediaFiles","Duration"]},MediaFiles:{subElements:["MediaFile"]},MediaFile:{attributes:["delivery","type","width","height"]},Mezzanine:{attributes:["delivery","type","width","height"]},NonLinear:{oneOfinLineResources:["StaticResource","IFrameResource","HTMLResource"],attributes:["width","height"]},Companion:{oneOfinLineResources:["StaticResource","IFrameResource","HTMLResource"],attributes:["width","height"]},StaticResource:{attributes:["creativeType"]},Icons:{subElements:["Icon"]},Icon:{oneOfinLineResources:["StaticResource","IFrameResource","HTMLResource"]}};function P(t,e){if(N[t.nodeName]&&N[t.nodeName].attributes){var r=N[t.nodeName].attributes.filter((function(e){return!t.getAttribute(e)}));r.length>0&&U({name:t.nodeName,parentName:t.parentNode.nodeName,attributes:r},e)}}function O(t,e,r){var i=N[t.nodeName],n=!r&&"Wrapper"!==t.nodeName;if(i&&!n){if(i.subElements){var s=i.subElements.filter((function(e){return!I.childByName(t,e)}));s.length>0&&U({name:t.nodeName,parentName:t.parentNode.nodeName,subElements:s},e)}r&&i.oneOfinLineResources&&(i.oneOfinLineResources.some((function(e){return I.childByName(t,e)}))||U({name:t.nodeName,parentName:t.parentNode.nodeName,oneOfResources:i.oneOfinLineResources},e))}}function F(t){return t.children&&0!==t.children.length}function U(t,e){var r=t.name,i=t.parentName,n=t.attributes,s=t.subElements,a=t.oneOfResources,o="Element '".concat(r,"'");e("VAST-warning",{message:o+=n?" missing required attribute(s) '".concat(n.join(", "),"' "):s?" missing required sub element(s) '".concat(s.join(", "),"' "):a?" must provide one of the following '".concat(a.join(", "),"' "):" is empty",parentElement:i,specVersion:4.1})}var B={verifyRequiredValues:function t(e,r,i){if(e&&e.nodeName)if("InLine"===e.nodeName&&(i=!0),P(e,r),F(e)){O(e,r,i);for(var n=0;n<e.children.length;n++)t(e.children[n],r,i)}else 0===I.parseNodeText(e).length&&U({name:e.nodeName,parentName:e.parentNode.nodeName},r)},hasSubElements:F,emitMissingValueWarning:U,verifyRequiredAttributes:P,verifyRequiredSubElements:O};function j(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.allowMultipleAds,n=r.followAdditionalWrappers,s=t.childNodes;for(var a in s){var o=s[a];if(-1!==["Wrapper","InLine"].indexOf(o.nodeName)&&("Wrapper"!==o.nodeName||!1!==n)){if(I.copyNodeAttribute("id",t,o),I.copyNodeAttribute("sequence",t,o),I.copyNodeAttribute("adType",t,o),"Wrapper"===o.nodeName)return{ad:H(o,e),type:"WRAPPER"};if("InLine"===o.nodeName)return{ad:V(o,e,{allowMultipleAds:i}),type:"INLINE"}}}}function V(t,e){return!1===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allowMultipleAds&&t.getAttribute("sequence")?null:G(t,e)}function G(t,e){var r=[];e&&B.verifyRequiredValues(t,e);var i=t.childNodes,n=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:t.id||null,sequence:t.sequence||null,adType:t.adType||null,adServingId:null,categories:[],expires:null,viewableImpression:[],system:null,title:null,description:null,advertiser:null,pricing:null,survey:null,errorURLTemplates:[],impressionURLTemplates:[],creatives:[],extensions:[],adVerifications:[],blockedAdCategories:[],followAdditionalWrappers:!0,allowMultipleAds:!1,fallbackOnNoAd:null}}(I.parseAttributes(t));for(var s in i){var a=i[s];switch(a.nodeName){case"Error":n.errorURLTemplates.push(I.parseNodeText(a));break;case"Impression":n.impressionURLTemplates.push({id:a.getAttribute("id")||null,url:I.parseNodeText(a)});break;case"Creatives":n.creatives=M(I.childrenByName(a,"Creative"));break;case"Extensions":var o=I.childrenByName(a,"Extension");n.extensions=C(o),n.adVerifications.length||(r=K(o));break;case"AdVerifications":n.adVerifications=z(I.childrenByName(a,"Verification"));break;case"AdSystem":n.system={value:I.parseNodeText(a),version:a.getAttribute("version")||null};break;case"AdTitle":n.title=I.parseNodeText(a);break;case"AdServingId":n.adServingId=I.parseNodeText(a);break;case"Category":n.categories.push({authority:a.getAttribute("authority")||null,value:I.parseNodeText(a)});break;case"Expires":n.expires=parseInt(I.parseNodeText(a),10);break;case"ViewableImpression":n.viewableImpression.push(Y(a));break;case"Description":n.description=I.parseNodeText(a);break;case"Advertiser":n.advertiser={id:a.getAttribute("id")||null,value:I.parseNodeText(a)};break;case"Pricing":n.pricing={value:I.parseNodeText(a),model:a.getAttribute("model")||null,currency:a.getAttribute("currency")||null};break;case"Survey":n.survey=I.parseNodeText(a);break;case"BlockedAdCategories":n.blockedAdCategories.push({authority:a.getAttribute("authority")||null,value:I.parseNodeText(a)})}}return r.length&&(n.adVerifications=n.adVerifications.concat(r)),n}function H(t,e){var r=G(t,e),i=t.getAttribute("followAdditionalWrappers"),n=t.getAttribute("allowMultipleAds"),s=t.getAttribute("fallbackOnNoAd");r.followAdditionalWrappers=!i||I.parseBoolean(i),r.allowMultipleAds=!!n&&I.parseBoolean(n),r.fallbackOnNoAd=s?I.parseBoolean(s):null;var a=I.childByName(t,"VASTAdTagURI");if(a?r.nextWrapperURL=I.parseNodeText(a):(a=I.childByName(t,"VASTAdTagURL"))&&(r.nextWrapperURL=I.parseNodeText(I.childByName(a,"URL"))),r.creatives.forEach((function(t){if(-1!==["linear","nonlinear"].indexOf(t.type)){if(t.trackingEvents){r.trackingEvents||(r.trackingEvents={}),r.trackingEvents[t.type]||(r.trackingEvents[t.type]={});var e=function(e){var i=t.trackingEvents[e];Array.isArray(r.trackingEvents[t.type][e])||(r.trackingEvents[t.type][e]=[]),i.forEach((function(i){r.trackingEvents[t.type][e].push(i)}))};for(var i in t.trackingEvents)e(i)}t.videoClickTrackingURLTemplates&&(Array.isArray(r.videoClickTrackingURLTemplates)||(r.videoClickTrackingURLTemplates=[]),t.videoClickTrackingURLTemplates.forEach((function(t){r.videoClickTrackingURLTemplates.push(t)}))),t.videoClickThroughURLTemplate&&(r.videoClickThroughURLTemplate=t.videoClickThroughURLTemplate),t.videoCustomClickURLTemplates&&(Array.isArray(r.videoCustomClickURLTemplates)||(r.videoCustomClickURLTemplates=[]),t.videoCustomClickURLTemplates.forEach((function(t){r.videoCustomClickURLTemplates.push(t)})))}})),r.nextWrapperURL)return r}function z(t){var e=[];return t.forEach((function(t){var r={resource:null,vendor:null,browserOptional:!1,apiFramework:null,type:null,parameters:null,trackingEvents:{}},i=t.childNodes;for(var n in I.assignAttributes(t.attributes,r),i){var s=i[n];switch(s.nodeName){case"JavaScriptResource":case"ExecutableResource":r.resource=I.parseNodeText(s),I.assignAttributes(s.attributes,r);break;case"VerificationParameters":r.parameters=I.parseNodeText(s)}}var a=I.childByName(t,"TrackingEvents");a&&I.childrenByName(a,"Tracking").forEach((function(t){var e=t.getAttribute("event"),i=I.parseNodeText(t);e&&i&&(Array.isArray(r.trackingEvents[e])||(r.trackingEvents[e]=[]),r.trackingEvents[e].push(i))})),e.push(r)})),e}function K(t){var e=null,r=[];return t.some((function(t){return e=I.childByName(t,"AdVerifications")})),e&&(r=z(I.childrenByName(e,"Verification"))),r}function Y(t){var e={};e.id=t.getAttribute("id")||null;var r=t.childNodes;for(var i in r){var n=r[i],s=n.nodeName,a=I.parseNodeText(n);if(("Viewable"===s||"NotViewable"===s||"ViewUndetermined"===s)&&a){var o=s.toLowerCase();Array.isArray(e[o])||(e[o]=[]),e[o].push(a)}}return e}var W=function(){function t(){n(this,t),this._handlers=[]}return a(t,[{key:"on",value:function(t,e){if("function"!=typeof e)throw new TypeError("The handler argument must be of type Function. Received type ".concat(i(e)));if(!t)throw new TypeError("The event argument must be of type String. Received type ".concat(i(t)));return this._handlers.push({event:t,handler:e}),this}},{key:"once",value:function(t,e){return this.on(t,function(t,e,r){var i={fired:!1,wrapFn:void 0};function n(){i.fired||(t.off(e,i.wrapFn),i.fired=!0,r.bind(t).apply(void 0,arguments))}return i.wrapFn=n,n}(this,t,e))}},{key:"off",value:function(t,e){return this._handlers=this._handlers.filter((function(r){return r.event!==t||r.handler!==e})),this}},{key:"emit",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var n=!1;return this._handlers.forEach((function(e){"*"===e.event&&(n=!0,e.handler.apply(e,[t].concat(r))),e.event===t&&(n=!0,e.handler.apply(e,r))})),n}},{key:"removeAllListeners",value:function(t){return t?(this._handlers=this._handlers.filter((function(e){return e.event!==t})),this):(this._handlers=[],this)}},{key:"listenerCount",value:function(t){return this._handlers.filter((function(e){return e.event===t})).length}},{key:"listeners",value:function(t){return this._handlers.reduce((function(e,r){return r.event===t&&e.push(r.handler),e}),[])}},{key:"eventNames",value:function(){return this._handlers.map((function(t){return t.event}))}}]),t}(),Q=function(t,e,r){r(new Error("Please bundle the library for node to use the node urlHandler"))},Z=12e4;function X(){try{var t=new window.XMLHttpRequest;return"withCredentials"in t?t:null}catch(t){return null}}function q(t,e,r){var i=r?408:t.status,n=r?"XHRURLHandler: Request timed out after ".concat(t.timeout," ms (").concat(i,")"):"XHRURLHandler: ".concat(t.statusText," (").concat(i,")");e(new Error(n),null,{statusCode:i})}var J=function(t,e,r){if("https:"===window.location.protocol&&0===t.indexOf("http://"))return r(new Error("XHRURLHandler: Cannot go from HTTPS to HTTP."));try{var i=X();i.open("GET",t),i.timeout=e.timeout||Z,i.withCredentials=e.withCredentials||!1,i.overrideMimeType&&i.overrideMimeType("text/xml"),i.onload=function(){return function(t,e){200===t.status?e(null,t.responseXML,{byteLength:t.response.length,statusCode:t.status}):q(t,e,!1)}(i,r)},i.onerror=function(){return q(i,r,!1)},i.onabort=function(){return q(i,r,!1)},i.ontimeout=function(){return q(i,r,!0)},i.send()}catch(t){r(new Error("XHRURLHandler: Unexpected error"))}},$=function(){return!!X()},tt={get:function(t,e,r){return r||("function"==typeof e&&(r=e),e={}),"undefined"==typeof window||null===window?Q(t,e,r):$()?J(t,e,r):r(new Error("Current context is not supported by any of the default URLHandlers. Please provide a custom URLHandler"))}},et=0,rt=0,it=function(t,e){!t||!e||t<=0||e<=0||(rt=(rt*et+8*t/e)/++et)},nt={ERRORCODE:900,extensions:[]},st=function(t){l(r,t);var e=c(r);function r(){var t;return n(this,r),(t=e.call(this)).remainingAds=[],t.parentURLs=[],t.errorURLTemplates=[],t.rootErrorURLTemplates=[],t.maxWrapperDepth=null,t.URLTemplateFilters=[],t.fetchingOptions={},t.parsingOptions={},t}return a(r,[{key:"addURLTemplateFilter",value:function(t){"function"==typeof t&&this.URLTemplateFilters.push(t)}},{key:"removeURLTemplateFilter",value:function(){this.URLTemplateFilters.pop()}},{key:"countURLTemplateFilters",value:function(){return this.URLTemplateFilters.length}},{key:"clearURLTemplateFilters",value:function(){this.URLTemplateFilters=[]}},{key:"trackVastError",value:function(t,e){for(var r=arguments.length,i=new Array(r>2?r-2:0),n=2;n<r;n++)i[n-2]=arguments[n];this.emit("VAST-error",Object.assign.apply(Object,[{},nt,e].concat(i))),A.track(t,e)}},{key:"getErrorURLTemplates",value:function(){return this.rootErrorURLTemplates.concat(this.errorURLTemplates)}},{key:"getEstimatedBitrate",value:function(){return rt}},{key:"fetchVAST",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Promise((function(s,a){e.URLTemplateFilters.forEach((function(e){t=e(t)})),e.parentURLs.push(t);var o=Date.now();e.emit("VAST-resolving",{url:t,previousUrl:i,wrapperDepth:r,maxWrapperDepth:e.maxWrapperDepth,timeout:e.fetchingOptions.timeout,wrapperAd:n}),e.urlHandler.get(t,e.fetchingOptions,(function(n,l){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=Math.round(Date.now()-o),c=Object.assign({url:t,previousUrl:i,wrapperDepth:r,error:n,duration:u},d);e.emit("VAST-resolved",c),it(d.byteLength,u),n?a(n):s(l)}))}))}},{key:"initParsingStatus",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.errorURLTemplates=[],this.fetchingOptions={timeout:t.timeout||Z,withCredentials:t.withCredentials},this.maxWrapperDepth=t.wrapperLimit||10,this.parentURLs=[],this.parsingOptions={allowMultipleAds:t.allowMultipleAds},this.remainingAds=[],this.rootErrorURLTemplates=[],this.rootURL="",this.urlHandler=t.urlHandler||t.urlhandler||tt,this.vastVersion=null,it(t.byteLength,t.requestDuration)}},{key:"getRemainingAds",value:function(t){var e=this;if(0===this.remainingAds.length)return Promise.reject(new Error("No more ads are available for the given VAST"));var r=t?A.flatten(this.remainingAds):this.remainingAds.shift();return this.errorURLTemplates=[],this.parentURLs=[],this.resolveAds(r,{wrapperDepth:0,url:this.rootURL}).then((function(t){return e.buildVASTResponse(t)}))}},{key:"getAndParseVAST",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initParsingStatus(r),this.URLTemplateFilters.forEach((function(e){t=e(t)})),this.rootURL=t,this.fetchVAST(t).then((function(i){return r.previousUrl=t,r.isRootVAST=!0,r.url=t,e.parse(i,r).then((function(t){return e.buildVASTResponse(t)}))}))}},{key:"parseVAST",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initParsingStatus(r),r.isRootVAST=!0,this.parse(t,r).then((function(t){return e.buildVASTResponse(t)}))}},{key:"buildVASTResponse",value:function(t){var e,r={ads:(e={ads:t,errorURLTemplates:this.getErrorURLTemplates(),version:this.vastVersion}).ads||[],errorURLTemplates:e.errorURLTemplates||[],version:e.version||null};return this.completeWrapperResolving(r),r}},{key:"parseVastXml",value:function(t,e){var r=e.isRootVAST,i=void 0!==r&&r,n=e.url,s=void 0===n?null:n,a=e.wrapperDepth,o=void 0===a?0:a,l=e.allowMultipleAds,d=e.followAdditionalWrappers;if(!t||!t.documentElement||"VAST"!==t.documentElement.nodeName)throw this.emit("VAST-ad-parsed",{type:"ERROR",url:s,wrapperDepth:o}),new Error("Invalid VAST XMLDocument");var u=[],c=t.documentElement.childNodes,h=t.documentElement.getAttribute("version");for(var f in i&&h&&(this.vastVersion=h),c){var p=c[f];if("Error"===p.nodeName){var v=I.parseNodeText(p);i?this.rootErrorURLTemplates.push(v):this.errorURLTemplates.push(v)}else if("Ad"===p.nodeName){if(this.vastVersion&&parseFloat(this.vastVersion)<3)l=!0;else if(!1===l&&u.length>1)break;var g=j(p,this.emit.bind(this),{allowMultipleAds:l,followAdditionalWrappers:d});g.ad?(u.push(g.ad),this.emit("VAST-ad-parsed",{type:g.type,url:s,wrapperDepth:o,adIndex:u.length-1,vastVersion:h})):this.trackVastError(this.getErrorURLTemplates(),{ERRORCODE:101})}}return u}},{key:"parse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.url,i=void 0===r?null:r,n=e.resolveAll,s=void 0===n||n,a=e.wrapperSequence,o=void 0===a?null:a,l=e.previousUrl,d=void 0===l?null:l,u=e.wrapperDepth,c=void 0===u?0:u,h=e.isRootVAST,f=void 0!==h&&h,p=e.followAdditionalWrappers,v=e.allowMultipleAds,g=[];this.vastVersion&&parseFloat(this.vastVersion)<3&&f&&(v=!0);try{g=this.parseVastXml(t,{isRootVAST:f,url:i,wrapperDepth:c,allowMultipleAds:v,followAdditionalWrappers:p})}catch(t){return Promise.reject(t)}return 1===g.length&&null!=o&&(g[0].sequence=o),!1===s&&(this.remainingAds=I.splitVAST(g),g=this.remainingAds.shift()),this.resolveAds(g,{wrapperDepth:c,previousUrl:d,url:i})}},{key:"resolveAds",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0,i=r.wrapperDepth,n=r.previousUrl,s=r.url,a=[];return n=s,e.forEach((function(e){var r=t.resolveWrappers(e,i,n);a.push(r)})),Promise.all(a).then((function(e){var r=A.flatten(e);if(!r&&t.remainingAds.length>0){var a=t.remainingAds.shift();return t.resolveAds(a,{wrapperDepth:i,previousUrl:n,url:s})}return r}))}},{key:"resolveWrappers",value:function(t,e,r){var i=this;return new Promise((function(n){var s;if(e++,!t.nextWrapperURL)return delete t.nextWrapperURL,n(t);if(e>=i.maxWrapperDepth||-1!==i.parentURLs.indexOf(t.nextWrapperURL))return t.errorCode=302,delete t.nextWrapperURL,n(t);t.nextWrapperURL=I.resolveVastAdTagURI(t.nextWrapperURL,r),i.URLTemplateFilters.forEach((function(e){t.nextWrapperURL=e(t.nextWrapperURL)}));var a=null!==(s=i.parsingOptions.allowMultipleAds)&&void 0!==s?s:t.allowMultipleAds,o=t.sequence;i.fetchVAST(t.nextWrapperURL,e,r,t).then((function(s){return i.parse(s,{url:t.nextWrapperURL,previousUrl:r,wrapperSequence:o,wrapperDepth:e,followAdditionalWrappers:t.followAdditionalWrappers,allowMultipleAds:a}).then((function(e){if(delete t.nextWrapperURL,0===e.length)return t.creatives=[],n(t);e.forEach((function(e){e&&I.mergeWrapperAdData(e,t)})),n(e)}))})).catch((function(e){t.errorCode=301,t.errorMessage=e.message,n(t)}))}))}},{key:"completeWrapperResolving",value:function(t){if(0===t.ads.length)this.trackVastError(t.errorURLTemplates,{ERRORCODE:303});else for(var e=t.ads.length-1;e>=0;e--){var r=t.ads[e];(r.errorCode||0===r.creatives.length)&&(this.trackVastError(r.errorURLTemplates.concat(t.errorURLTemplates),{ERRORCODE:r.errorCode||303},{ERRORMESSAGE:r.errorMessage||""},{extensions:r.extensions},{system:r.system}),t.ads.splice(e,1))}}}]),r}(W),at=null,ot={data:{},length:0,getItem:function(t){return this.data[t]},setItem:function(t,e){this.data[t]=e,this.length=Object.keys(this.data).length},removeItem:function(t){delete this.data[t],this.length=Object.keys(this.data).length},clear:function(){this.data={},this.length=0}},lt=function(){function t(){n(this,t),this.storage=this.initStorage()}return a(t,[{key:"initStorage",value:function(){if(at)return at;try{at="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(t){at=null}return at&&!this.isStorageDisabled(at)||(at=ot).clear(),at}},{key:"isStorageDisabled",value:function(t){var e="__VASTStorage__";try{if(t.setItem(e,e),t.getItem(e)!==e)return t.removeItem(e),!0}catch(t){return!0}return t.removeItem(e),!1}},{key:"getItem",value:function(t){return this.storage.getItem(t)}},{key:"setItem",value:function(t,e){return this.storage.setItem(t,e)}},{key:"removeItem",value:function(t){return this.storage.removeItem(t)}},{key:"clear",value:function(){return this.storage.clear()}}]),t}(),dt=function(){function t(e,r,i){n(this,t),this.cappingFreeLunch=e||0,this.cappingMinimumTimeInterval=r||0,this.defaultOptions={withCredentials:!1,timeout:0},this.vastParser=new st,this.storage=i||new lt,void 0===this.lastSuccessfulAd&&(this.lastSuccessfulAd=0),void 0===this.totalCalls&&(this.totalCalls=0),void 0===this.totalCallsTimeout&&(this.totalCallsTimeout=0)}return a(t,[{key:"getParser",value:function(){return this.vastParser}},{key:"lastSuccessfulAd",get:function(){return this.storage.getItem("vast-client-last-successful-ad")},set:function(t){this.storage.setItem("vast-client-last-successful-ad",t)}},{key:"totalCalls",get:function(){return this.storage.getItem("vast-client-total-calls")},set:function(t){this.storage.setItem("vast-client-total-calls",t)}},{key:"totalCallsTimeout",get:function(){return this.storage.getItem("vast-client-total-calls-timeout")},set:function(t){this.storage.setItem("vast-client-total-calls-timeout",t)}},{key:"hasRemainingAds",value:function(){return this.vastParser.remainingAds.length>0}},{key:"getNextAds",value:function(t){return this.vastParser.getRemainingAds(t)}},{key:"get",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Date.now();return(r=Object.assign({},this.defaultOptions,r)).hasOwnProperty("resolveAll")||(r.resolveAll=!1),this.totalCallsTimeout<i?(this.totalCalls=1,this.totalCallsTimeout=i+36e5):this.totalCalls++,new Promise((function(n,s){if(e.cappingFreeLunch>=e.totalCalls)return s(new Error("VAST call canceled – FreeLunch capping not reached yet ".concat(e.totalCalls,"/").concat(e.cappingFreeLunch)));var a=i-e.lastSuccessfulAd;if(a<0)e.lastSuccessfulAd=0;else if(a<e.cappingMinimumTimeInterval)return s(new Error("VAST call canceled – (".concat(e.cappingMinimumTimeInterval,")ms minimum interval reached")));e.vastParser.getAndParseVAST(t,r).then((function(t){return n(t)})).catch((function(t){return s(t)}))}))}}]),t}(),ut=function(t){l(s,t);var e=c(s);function s(t,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;for(var l in n(this,s),(a=e.call(this)).ad=r,a.creative=i,a.variation=o,a.muted=!1,a.impressed=!1,a.skippable=!1,a.trackingEvents={},a.lastPercentage=0,a._alreadyTriggeredQuartiles={},a.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"],a.creative.trackingEvents){var d=a.creative.trackingEvents[l];a.trackingEvents[l]=d.slice(0)}return function(t){return"linear"===t.type}(a.creative)?a._initLinearTracking():a._initVariationTracking(),t&&a.on("start",(function(){t.lastSuccessfulAd=Date.now()})),a}return a(s,[{key:"_initLinearTracking",value:function(){this.linear=!0,this.skipDelay=this.creative.skipDelay,this.setDuration(this.creative.duration),this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates}},{key:"_initVariationTracking",value:function(){if(this.linear=!1,this.skipDelay=-1,this.variation){for(var t in this.variation.trackingEvents){var e=this.variation.trackingEvents[t];this.trackingEvents[t]?this.trackingEvents[t]=this.trackingEvents[t].concat(e.slice(0)):this.trackingEvents[t]=e.slice(0)}"nonLinearAd"===this.variation.adType?(this.clickThroughURLTemplate=this.variation.nonlinearClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.nonlinearClickTrackingURLTemplates,this.setDuration(this.variation.minSuggestedDuration)):function(t){return"companionAd"===t.adType}(this.variation)&&(this.clickThroughURLTemplate=this.variation.companionClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.companionClickTrackingURLTemplates)}}},{key:"setDuration",value:function(t){A.isValidTimeValue(t)&&(this.assetDuration=t,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100})}},{key:"setProgress",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(A.isValidTimeValue(t)&&"object"===i(r)){var n=this.skipDelay||-1;if(-1===n||this.skippable||(n>t?this.emit("skip-countdown",n-t):(this.skippable=!0,this.emit("skip-countdown",0))),this.assetDuration>0){var s=Math.round(t/this.assetDuration*100),a=[];if(t>0){a.push("start");for(var o=this.lastPercentage;o<s;o++)a.push("progress-".concat(o+1,"%"));for(var l in a.push("progress-".concat(Math.round(t))),this.quartiles)this.isQuartileReached(l,this.quartiles[l],t)&&(a.push(l),this._alreadyTriggeredQuartiles[l]=!0);this.lastPercentage=s}a.forEach((function(t){e.track(t,{macros:r,once:!0})})),t<this.progress&&this.track("rewind",{macros:r})}this.progress=t}}},{key:"isQuartileReached",value:function(t,e,r){var i=!1;return e<=r&&!this._alreadyTriggeredQuartiles[t]&&(i=!0),i}},{key:"setMuted",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"boolean"==typeof t&&"object"===i(e)&&(this.muted!==t&&this.track(t?"mute":"unmute",{macros:e}),this.muted=t)}},{key:"setPaused",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"boolean"==typeof t&&"object"===i(e)&&(this.paused!==t&&this.track(t?"pause":"resume",{macros:e}),this.paused=t)}},{key:"setFullscreen",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"boolean"==typeof t&&"object"===i(e)&&(this.fullscreen!==t&&this.track(t?"fullscreen":"exitFullscreen",{macros:e}),this.fullscreen=t)}},{key:"setExpand",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"boolean"==typeof t&&"object"===i(e)&&(this.expanded!==t&&(this.track(t?"expand":"collapse",{macros:e}),this.track(t?"playerExpand":"playerCollapse",{macros:e})),this.expanded=t)}},{key:"setSkipDelay",value:function(t){A.isValidTimeValue(t)&&(this.skipDelay=t)}},{key:"trackImpression",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===i(t)&&(this.impressed||(this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates,t),this.track("creativeView",{macros:t})))}},{key:"error",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"object"===i(t)&&"boolean"==typeof e&&this.trackURLs(this.ad.errorURLTemplates,t,{isCustomCode:e})}},{key:"errorWithCode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"string"==typeof t&&"boolean"==typeof e&&this.error({ERRORCODE:t},e)}},{key:"complete",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===i(t)&&this.track("complete",{macros:t})}},{key:"notUsed",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===i(t)&&(this.track("notUsed",{macros:t}),this.trackingEvents=[])}},{key:"otherAdInteraction",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===i(t)&&this.track("otherAdInteraction",{macros:t})}},{key:"acceptInvitation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===i(t)&&this.track("acceptInvitation",{macros:t})}},{key:"adExpand",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===i(t)&&this.track("adExpand",{macros:t})}},{key:"adCollapse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===i(t)&&this.track("adCollapse",{macros:t})}},{key:"minimize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===i(t)&&this.track("minimize",{macros:t})}},{key:"verificationNotExecuted",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof t&&"object"===i(e)){if(!this.ad||!this.ad.adVerifications||!this.ad.adVerifications.length)throw new Error("No adVerifications provided");if(!t)throw new Error("No vendor provided, unable to find associated verificationNotExecuted");var r=this.ad.adVerifications.find((function(e){return e.vendor===t}));if(!r)throw new Error("No associated verification element found for vendor: ".concat(t));var n=r.trackingEvents;if(n&&n.verificationNotExecuted){var s=n.verificationNotExecuted;this.trackURLs(s,e),this.emit("verificationNotExecuted",{trackingURLTemplates:s})}}}},{key:"overlayViewDuration",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"==typeof t&&"object"===i(e)&&(e.ADPLAYHEAD=t,this.track("overlayViewDuration",{macros:e}))}},{key:"close",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===i(t)&&this.track(this.linear?"closeLinear":"close",{macros:t})}},{key:"skip",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===i(t)&&this.track("skip",{macros:t})}},{key:"load",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===i(t)&&this.track("loaded",{macros:t})}},{key:"click",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((null===t||"string"==typeof t)&&"object"===i(e)){this.clickTrackingURLTemplates&&this.clickTrackingURLTemplates.length&&this.trackURLs(this.clickTrackingURLTemplates,e);var n=this.clickThroughURLTemplate||t,s=r({},e);if(n){this.progress&&(s.ADPLAYHEAD=this.progressFormatted());var a=A.resolveURLTemplates([n],s)[0];this.emit("clickthrough",a)}}}},{key:"track",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.macros,n=void 0===r?{}:r,s=e.once,a=void 0!==s&&s;if("object"===i(n)){"closeLinear"===t&&!this.trackingEvents[t]&&this.trackingEvents.close&&(t="close");var o=this.trackingEvents[t],l=this.emitAlwaysEvents.indexOf(t)>-1;o?(this.emit(t,{trackingURLTemplates:o}),this.trackURLs(o,n)):l&&this.emit(t,null),a&&(delete this.trackingEvents[t],l&&this.emitAlwaysEvents.splice(this.emitAlwaysEvents.indexOf(t),1))}}},{key:"trackURLs",value:function(t){var e,i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=r({},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});this.linear&&(this.creative&&this.creative.mediaFiles&&this.creative.mediaFiles[0]&&this.creative.mediaFiles[0].fileURL&&(s.ASSETURI=this.creative.mediaFiles[0].fileURL),this.progress&&(s.ADPLAYHEAD=this.progressFormatted())),null!==(e=this.creative)&&void 0!==e&&null!==(i=e.universalAdIds)&&void 0!==i&&i.length&&(s.UNIVERSALADID=this.creative.universalAdIds.map((function(t){return t.idRegistry.concat(" ",t.value)})).join(",")),this.ad&&(this.ad.sequence&&(s.PODSEQUENCE=this.ad.sequence),this.ad.adType&&(s.ADTYPE=this.ad.adType),this.ad.adServingId&&(s.ADSERVINGID=this.ad.adServingId),this.ad.categories&&this.ad.categories.length&&(s.ADCATEGORIES=this.ad.categories.map((function(t){return t.value})).join(",")),this.ad.blockedAdCategories&&this.ad.blockedAdCategories.length&&(s.BLOCKEDADCATEGORIES=this.ad.blockedAdCategories)),A.track(t,s,n)}},{key:"convertToTimecode",value:function(t){if(!A.isValidTimeValue(t))return"";var e=1e3*t,r=Math.floor(e/36e5),i=Math.floor(e/6e4%60),n=Math.floor(e/1e3%60),s=Math.floor(e%1e3);return"".concat(A.addLeadingZeros(r,2),":").concat(A.addLeadingZeros(i,2),":").concat(A.addLeadingZeros(n,2),".").concat(A.addLeadingZeros(s,3))}},{key:"progressFormatted",value:function(){return this.convertToTimecode(this.progress)}}]),s}(W);t.VASTClient=dt,t.VASTParser=st,t.VASTTracker=ut,Object.defineProperty(t,"__esModule",{value:!0})}(e)}},$t={};function te(t){var e=$t[t];if(void 0!==e)return e.exports;var r=$t[t]={exports:{}};return Jt[t].call(r.exports,r,r.exports,te),r.exports}te.d=(t,e)=>{for(var r in e)te.o(e,r)&&!te.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},te.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var ee={};(()=>{te.d(ee,{Z:()=>a});var t=te(686);const e=function(t,e,r){this.message=t,this.errorCode=e,this.innerError=r};e.prototype.getMessage=function(){return this.message},e.prototype.getErrorCode=function(){return this.errorCode},e.prototype.getInnerError=function(){return this.innerError instanceof Object?this.innerError:null},e.prototype.setInnerError=function(t){this.innerError=t},e.prototype.formatMessage=function(...t){return this.message=function(t,...e){try{e.forEach(((e,r)=>{t=t.replace(new RegExp("\\{"+r+"}","g"),e)}))}catch(t){}return t}(this.message,t),this},e.prototype.toString=function(){return"AdError "+this.getErrorCode()+": "+this.getMessage()+(null!=this.getInnerError()?" Caused by: "+this.getInnerError():"")};const r=e,i=function(t){this.adId=t.adId,this.duration=t.duration,this.linear="linear"===t.type};i.prototype.getAdId=function(){return this.adId},i.prototype.getDuration=function(){return this.duration},i.prototype.getMediaUrl=function(){return null},i.prototype.isLinear=function(){return this.linear};const n=i,s=function(t){if(!t||!(t instanceof HTMLElement||t.getRootNode))throw new Error("ad container is not defined");this._adContainer=t,this._ownSlot=null,this._videoSlot=null,this._slot=null,this.createOwnSlot(),this.EVENTS={AdsManagerLoaded:"AdsManagerLoaded",AdStarted:"AdStarted",AdStopped:"AdStopped",AdSkipped:"AdSkipped",AdLoaded:"AdLoaded",AdLinearChange:"AdLinearChange",AdSizeChange:"AdSizeChange",AdExpandedChange:"AdExpandedChange",AdSkippableStateChange:"AdSkippableStateChange",AdDurationChange:"AdDurationChange",AdRemainingTimeChange:"AdRemainingTimeChange",AdVolumeChange:"AdVolumeChange",AdImpression:"AdImpression",AdClickThru:"AdClickThru",AdInteraction:"AdInteraction",AdVideoStart:"AdVideoStart",AdVideoFirstQuartile:"AdVideoFirstQuartile",AdVideoMidpoint:"AdVideoMidpoint",AdVideoThirdQuartile:"AdVideoThirdQuartile",AdVideoComplete:"AdVideoComplete",AdUserAcceptInvitation:"AdUserAcceptInvitation",AdUserMinimize:"AdUserMinimize",AdUserClose:"AdUserClose",AdPaused:"AdPaused",AdPlaying:"AdPlaying",AdError:"AdError",AdLog:"AdLog",AllAdsCompleted:"AllAdsCompleted"},this._eventCallbacks={},this._creativeEventCallbacks={},this._attributes={width:300,height:154,viewMode:"normal",desiredBitrate:-1,duration:10,remainingTime:10,currentTime:0,volume:0,version:"1.2.15"},this._quartileEvents=[{event:"AdImpression",value:0},{event:"AdVideoStart",value:0},{event:"AdVideoFirstQuartile",value:25},{event:"AdVideoMidpoint",value:50},{event:"AdVideoThirdQuartile",value:75},{event:"AdVideoComplete",value:100}],this._nextQuartileIndex=0,this._defaultEventCallbacks={AdImpression:this.onAdImpression.bind(this),AdVideoStart:this.onAdVideoStart.bind(this),AdVideoFirstQuartile:this.onAdVideoFirstQuartile.bind(this),AdVideoMidpoint:this.onAdVideoMidpoint.bind(this),AdVideoThirdQuartile:this.onAdVideoThirdQuartile.bind(this),AdVideoComplete:this.onAdVideoComplete.bind(this)},this._options={autoplay:!0,muted:!0,vastLoadTimeout:23e3,loadVideoTimeout:8e3,withCredentials:!1,wrapperLimit:10,resolveAll:!0},this.ERROR_CODES={VAST_MALFORMED_RESPONSE:100,ADS_REQUEST_NETWORK_ERROR:1012,FAILED_TO_REQUEST_ADS:1005,UNKNOWN_AD_RESPONSE:1010,VAST_ASSET_NOT_FOUND:1007,VAST_EMPTY_RESPONSE:1009,VAST_LINEAR_ASSET_MISMATCH:403,VAST_LOAD_TIMEOUT:301,VAST_MEDIA_LOAD_TIMEOUT:402,VIDEO_PLAY_ERROR:400,VPAID_ERROR:901},this.ERROR_MESSAGES={VAST_MALFORMED_RESPONSE:"VAST response was malformed and could not be parsed.",ADS_REQUEST_ERROR:"Unable to request ads from server. Cause: {0}.",ADS_REQUEST_NETWORK_ERROR:"Unable to request ads from server due to network error.",FAILED_TO_REQUEST_ADS:"The was a problem requesting ads from the server.",NO_ADS_FOUND:"The response does not contain any valid ads.",UNKNOWN_AD_RESPONSE:"The ad response was not understood and cannot be parsed.",VAST_ASSET_NOT_FOUND:"No assets were found in the VAST ad response.",VAST_EMPTY_RESPONSE:"The VAST response document is empty.",VAST_LINEAR_ASSET_MISMATCH:"Linear assets were found in the VAST ad response, but none of them matched the player's capabilities.",VAST_LOAD_TIMEOUT:"Ad request reached a timeout.",VAST_MEDIA_LOAD_TIMEOUT:"VAST media file loading reached a timeout of {0} seconds.",VIDEO_PLAY_ERROR:"There was an error playing the video ad.",VPAID_CREATIVE_ERROR:"An unexpected error occurred within the VPAID creative. Refer to the inner error for more info."},this.ERRORS={VAST_MALFORMED_RESPONSE:new r(this.ERROR_MESSAGES.VAST_MALFORMED_RESPONSE,this.ERROR_CODES.VAST_MALFORMED_RESPONSE),VAST_EMPTY_RESPONSE:new r(this.ERROR_MESSAGES.VAST_EMPTY_RESPONSE,this.ERROR_CODES.VAST_EMPTY_RESPONSE),VAST_ASSET_NOT_FOUND:new r(this.ERROR_MESSAGES.VAST_ASSET_NOT_FOUND,this.ERROR_CODES.VAST_ASSET_NOT_FOUND),VAST_LINEAR_ASSET_MISMATCH:new r(this.ERROR_MESSAGES.VAST_LINEAR_ASSET_MISMATCH,this.ERROR_CODES.VAST_LINEAR_ASSET_MISMATCH),VAST_LOAD_TIMEOUT:new r(this.ERROR_MESSAGES.VAST_LOAD_TIMEOUT,this.ERROR_CODES.VAST_LOAD_TIMEOUT),VAST_MEDIA_LOAD_TIMEOUT:new r(this.ERROR_MESSAGES.VAST_MEDIA_LOAD_TIMEOUT,this.ERROR_CODES.VAST_MEDIA_LOAD_TIMEOUT),VIDEO_PLAY_ERROR:new r(this.ERROR_MESSAGES.VIDEO_PLAY_ERROR,this.ERROR_CODES.VIDEO_PLAY_ERROR),VPAID_CREATIVE_ERROR:new r(this.ERROR_MESSAGES.VPAID_CREATIVE_ERROR,this.ERROR_CODES.VPAID_ERROR)},this._vastClient=null,this._vastParser=null,this._vastTracker=null,this._ad=null,this._adPod=null,this._isAdPod=!1,this._creative=null,this._mediaFiles=null,this._mediaFileIndex=0,this._mediaFile=null,this._isVPAID=!1,this._vpaidIframe=null,this._vpaidCreative=null,this._vastMediaLoadTimer=null,this._vpaidProgressTimer=null,this._requestId=null,this._handleLoadCreativeMessage=this.handleLoadCreativeMessage.bind(this),this._handleSlotClick=this.handleSlotClick.bind(this),this._handleVideoSlotError=this.handleVideoSlotError.bind(this),this._handleVideoSlotCanPlay=this.handleVideoSlotCanPlay.bind(this),this._handleVideoSlotVolumeChange=this.handleVideoSlotVolumeChange.bind(this),this._handleVideoSlotTimeUpdate=this.handleVideoSlotTimeUpdate.bind(this),this._handleVideoSlotLoadedMetaData=this.handleVideoSlotLoadedMetaData.bind(this),this._handleVideoSlotEnded=this.handleVideoSlotEnded.bind(this),this.MIN_VPAID_VERSION=2,this._hasLoaded=!1,this._hasError=!1,this._hasImpression=!1,this._hasStarted=!1,this._isDestroyed=!1};s.prototype.createOwnSlot=function(){this._ownSlot=document.createElement("div"),this._ownSlot.style.position="absolute",this._adContainer.appendChild(this._ownSlot),this.createVideoSlot(),this.createSlot()},s.prototype.removeSlot=function(){this._ownSlot.parentNode&&this._ownSlot.parentNode.removeChild(this._ownSlot)},s.prototype.showSlot=function(){""===this._videoSlot.src&&this.hideVideoSlot(),this._ownSlot.style.display="block"},s.prototype.hideSlot=function(){this._ownSlot.style.display="none"},s.prototype.resizeSlot=function(t,e){this._ownSlot.style.width=t+"px",this._ownSlot.style.height=e+"px"},s.prototype.createVideoSlot=function(){this._videoSlot=document.createElement("video"),this._videoSlot.setAttribute("webkit-playsinline",!0),this._videoSlot.setAttribute("playsinline",!0),this._videoSlot.style.width="100%",this._videoSlot.style.height="100%",this._videoSlot.style.backgroundColor="rgb(0, 0, 0)",this._videoSlot.style.display="none";const t=this,e=Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype,"src");Object.defineProperty(this._videoSlot,"src",{set:function(r){e.set.call(this,r),t.showHideVideoSlot()},get:e.get});const r=this._videoSlot.setAttribute;this._videoSlot.setAttribute=function(){const e=r.apply(this,[].slice.call(arguments));return"src"===arguments[0]&&t.showHideVideoSlot(),e},this._ownSlot.appendChild(this._videoSlot)},s.prototype.createSlot=function(){this._slot=document.createElement("div"),this._slot.style.position="absolute",this._slot.style.top="0px",this._slot.style.left="0px",this._slot.style.right="0px",this._slot.style.bottom="0px",this._ownSlot.appendChild(this._slot)},s.prototype.hideVideoSlot=function(){this._videoSlot.style.display="none"},s.prototype.showVideoSlot=function(){this._videoSlot.style.display="block"},s.prototype.showHideVideoSlot=function(){""===this._videoSlot.getAttribute("src")?this.hideVideoSlot():this.showVideoSlot()},s.prototype.stopVASTMediaLoadTimeout=function(){this._vastMediaLoadTimer&&(clearTimeout(this._vastMediaLoadTimer),this._vastMediaLoadTimer=null)},s.prototype.startVASTMediaLoadTimeout=function(){this.stopVASTMediaLoadTimeout(),this._vastMediaLoadTimer=setTimeout((()=>{this.onAdError(this.ERRORS.VAST_MEDIA_LOAD_TIMEOUT.formatMessage(Math.floor(this._options.loadVideoTimeout/1e3%60)))}),this._options.loadVideoTimeout)},s.prototype.updateVPAIDProgress=function(){this._attributes.remainingTime=this._isCreativeFunctionInvokable("getAdRemainingTime")?this._vpaidCreative.getAdRemainingTime():-1,isNaN(this._attributes.remainingTime)||1===this._attributes.remainingTime||(this._attributes.currentTime=this._attributes.duration-this._attributes.remainingTime,this._vastTracker.setProgress(this._attributes.currentTime))},s.prototype.startVPAIDProgress=function(){this.stopVPAIDProgress(),this._vpaidProgressTimer=setInterval((()=>{this._isVPAID&&this._vpaidCreative&&this._vastTracker?this.updateVPAIDProgress():this.stopVPAIDProgress()}),1e3)},s.prototype.stopVPAIDProgress=function(){this._vpaidProgressTimer&&(clearInterval(this._vpaidProgressTimer),this._vpaidProgressTimer=null)},s.prototype._callEvent=function(t){t in this._eventCallbacks&&this._eventCallbacks[t]()},s.prototype.addEventListener=function(t,e,r){const i=e.bind(r);this._eventCallbacks[t]=i},s.prototype.removeEventListener=function(t){this._eventCallbacks[t]=null},s.prototype.removeEventListeners=function(t){for(const e in t)t.hasOwnProperty(e)&&this.removeEventListener(e)},s.prototype.onAdsManagerLoaded=function(){this._callEvent(this.EVENTS.AdsManagerLoaded)},s.prototype.onAdLoaded=function(){this._hasLoaded=!0,this.stopVASTMediaLoadTimeout(),this.EVENTS.AdLoaded in this._eventCallbacks&&this._eventCallbacks[this.EVENTS.AdLoaded](new n(this._creative))},s.prototype.onAdDurationChange=function(){this._isVPAID&&this._vpaidCreative&&this._vastTracker&&(this._attributes.duration=this._isCreativeFunctionInvokable("getAdDuration")?this._vpaidCreative.getAdDuration():-1,-1!==this._attributes.duration&&this._vastTracker.setDuration(this._attributes.duration)),this._callEvent(this.EVENTS.AdDurationChange)},s.prototype.onAdSizeChange=function(){this._callEvent(this.EVENTS.AdSizeChange)},s.prototype.onAdStarted=function(){this._hasStarted=!0,this._callEvent(this.EVENTS.AdStarted)},s.prototype.onAdVideoStart=function(){this._isVPAID&&this._vpaidCreative&&this._vastTracker&&this.updateVPAIDProgress(),this._callEvent(this.EVENTS.AdVideoStart)},s.prototype.onAdStopped=function(){this._hasStarted?this._isAdPod&&0!=this._adPod.length?(this._nextQuartileIndex=0,this._hasImpression=!1,window.removeEventListener("message",this._handleLoadCreativeMessage),this._isVPAID&&(this.removeCallbacksForCreative(this._creativeEventCallbacks),this.removeCreativeAsset(),this._isVPAID=!1),this._removeHandlers(),this._videoSlot.pause(),this._videoSlot.removeAttribute("src"),this._videoSlot.load(),setTimeout((()=>{this._nextAd()}),75)):(this._callEvent(this.EVENTS.AdStopped),this._abort()):this.onAdError(this.ERRORS.VPAID_CREATIVE_ERROR)},s.prototype.onAdSkipped=function(){this._callEvent(this.EVENTS.AdSkipped),this._abort()},s.prototype.onAdVolumeChange=function(){this._callEvent(this.EVENTS.AdVolumeChange)},s.prototype.onAdImpression=function(){this._isVPAID&&this._vpaidCreative&&this._vastTracker&&(this._hasImpression||(this._attributes.duration=this._isCreativeFunctionInvokable("getAdDuration")?this._vpaidCreative.getAdDuration():-1,-1!==this._attributes.duration&&this._vastTracker.setDuration(this._attributes.duration),this._vastTracker.trackImpression(),this.startVPAIDProgress(),this._hasImpression=!0)),this._callEvent(this.EVENTS.AdImpression)},s.prototype.onAdClickThru=function(t,e,r){this._isVPAID&&this._vpaidCreative&&this._vastTracker&&this._vastTracker.click(),this.EVENTS.AdClickThru in this._eventCallbacks&&this._eventCallbacks[this.EVENTS.AdClickThru](t,e,r)},s.prototype.onAdVideoFirstQuartile=function(){this._isVPAID&&this._vpaidCreative&&this._vastTracker&&this.updateVPAIDProgress(),this._callEvent(this.EVENTS.AdVideoFirstQuartile)},s.prototype.onAdVideoMidpoint=function(){this._isVPAID&&this._vpaidCreative&&this._vastTracker&&this.updateVPAIDProgress(),this._callEvent(this.EVENTS.AdVideoMidpoint)},s.prototype.onAdVideoThirdQuartile=function(){this._isVPAID&&this._vpaidCreative&&this._vastTracker&&this.updateVPAIDProgress(),this._callEvent(this.EVENTS.AdVideoThirdQuartile)},s.prototype.onAdPaused=function(){this._vastTracker&&this._vastTracker.setPaused(!0),this._callEvent(this.EVENTS.AdPaused)},s.prototype.onAdPlaying=function(){this._vastTracker&&this._vastTracker.setPaused(!1),this._callEvent(this.EVENTS.AdPlaying)},s.prototype.onAdVideoComplete=function(){this._isVPAID&&this._vpaidCreative&&this._vastTracker&&this._vastTracker.complete(),this._callEvent(this.EVENTS.AdVideoComplete)},s.prototype.onAllAdsCompleted=function(){this._callEvent(this.EVENTS.AllAdsCompleted)},s.prototype.onAdError=function(t){this._hasError=!0,this.abort(),this.EVENTS.AdError in this._eventCallbacks&&this._eventCallbacks[this.EVENTS.AdError]("object"!=typeof t?new r(t):t)},s.prototype.onAdLog=function(t){this.EVENTS.AdLog in this._eventCallbacks&&this._eventCallbacks[this.EVENTS.AdLog](t)},s.prototype.processVASTResponse=function(t){const e=t.ads;0!=e.length?(e.length>1?(this._isAdPod=!0,this._adPod=e.sort((function(t,e){const r=t.sequence,i=e.sequence;return r===i?0:null===r?1:null===i||r<i?-1:r>i?1:0})),this._ad=this._adPod.shift()):this._ad=e[0],this._processAd()):this.onAdError(this.ERRORS.VAST_EMPTY_RESPONSE)},s.prototype.requestAds=function(e,r={}){if(this._isDestroyed)return;this._requestId=(new Date).getTime(),Object.assign(this._options,r);const i={timeout:this._options.vastLoadTimeout,withCredentials:this._options.withCredentials,wrapperLimit:this._options.wrapperLimit,resolveAll:this._options.resolveAll};if(this.abort(),e&&"string"==typeof e){let r=!1;try{new URL(e),r=!0}catch(t){}if(r)this._vastClient=new t.VASTClient,this._vastClient.get(e,i).then((t=>{this.processVASTResponse(t)})).catch((t=>{this.onAdError(t.message)}));else{const r=(new window.DOMParser).parseFromString(e,"text/xml");this._vastParser=new t.VASTParser,this._vastParser.parseVAST(r,i).then((t=>{this.processVASTResponse(t)})).catch((t=>{this.onAdError(t.message)}))}}else this.onAdError("VAST URL/XML is empty")},s.prototype.canPlayVideoType=function(t){return!!("video/3gpp"===t&&this.supportsThreeGPVideo()||"video/webm"===t&&this.supportsWebmVideo()||"video/ogg"===t&&this.supportsOggTheoraVideo()||"video/mp4"===t&&this.supportsH264BaselineVideo())},s.prototype.supportsVideo=function(){return!!document.createElement("video").canPlayType},s.prototype.supportsH264BaselineVideo=function(){return!!this.supportsVideo()&&document.createElement("video").canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')},s.prototype.supportsOggTheoraVideo=function(){return!!this.supportsVideo()&&document.createElement("video").canPlayType('video/ogg; codecs="theora, vorbis"')},s.prototype.supportsWebmVideo=function(){return!!this.supportsVideo()&&document.createElement("video").canPlayType('video/webm; codecs="vp8, vorbis"')},s.prototype.supportsThreeGPVideo=function(){return!!this.supportsVideo()&&document.createElement("video").canPlayType('video/3gpp; codecs="mp4v.20.8, samr"')},s.prototype.handshakeVersion=function(t){return this._vpaidCreative.handshakeVersion(t)},s.prototype._isCreativeFunctionInvokable=function(t){return!!this._vpaidCreative&&(t=this._vpaidCreative[t])&&"function"==typeof t},s.prototype.checkVPAIDInterface=function(t){const e={passed:!0,missingInterfaces:""};for(let r=t.length-1;0<=r;r--)this._isCreativeFunctionInvokable(t[r])||(e.passed=!1,e.missingInterfaces+=t[r]+" ");return e},s.prototype.setCallbacksForCreative=function(t,e){for(const r in t)t.hasOwnProperty(r)&&this._vpaidCreative.subscribe(t[r],r,e)},s.prototype.removeCallbacksForCreative=function(t){if(null!==this._vpaidCreative)for(const e in t)t.hasOwnProperty(e)&&this._vpaidCreative.unsubscribe(e)},s.prototype.creativeAssetLoaded=function(){if(function(t){const e=t.checkVPAIDInterface("handshakeVersion initAd startAd stopAd subscribe unsubscribe getAdLinear".split(" "));return e.passed||t.onAdError("Missing interfaces in the VPAID creative: "+e.missingInterfaces),e.passed}(this)&&(()=>{const t=this.handshakeVersion(this.MIN_VPAID_VERSION.toFixed(1));return t?!(parseFloat(t)<this.MIN_VPAID_VERSION&&(this.onAdError("Only support creatives with VPAID version >= "+this.MIN_VPAID_VERSION.toFixed(1)),1)):(this.onAdError("Cannot get VPAID version from the creative"),!1)})()){this._creativeEventCallbacks={AdStarted:this.onAdStarted,AdStopped:this.onAdStopped,AdSkipped:this.onAdSkipped,AdLoaded:this.onAdLoaded,AdSizeChange:this.onAdSizeChange,AdDurationChange:this.onAdDurationChange,AdVolumeChange:this.onAdVolumeChange,AdImpression:this.onAdImpression,AdClickThru:this.onAdClickThru,AdVideoStart:this.onAdVideoStart,AdVideoFirstQuartile:this.onAdVideoFirstQuartile,AdVideoMidpoint:this.onAdVideoMidpoint,AdVideoThirdQuartile:this.onAdVideoThirdQuartile,AdVideoComplete:this.onAdVideoComplete,AdPaused:this.onAdPaused,AdPlaying:this.onAdPlaying,AdError:this.onAdError,AdLog:this.onAdLog},this.setCallbacksForCreative(this._creativeEventCallbacks,this);const t=this._attributes.width,e=this._attributes.height,r={AdParameters:this._creative.adParameters},i={slot:this._slot,videoSlot:this._videoSlot,videoSlotCanAutoPlay:!0};this.startVASTMediaLoadTimeout();try{this._vpaidCreative.initAd(t,e,this._attributes.viewMode,this._attributes.desiredBitrate,r,i)}catch(t){this.onAdError(t)}}},s.prototype.handleLoadCreativeMessage=function(t){if(t&&t.data){const e=String(t.data).match(new RegExp("adm:"+this._requestId+"://(.*)"));if(e){const r=JSON.parse(e[1]);if("load"==r)try{let t=this._vpaidIframe.contentWindow.getVPAIDAd;t&&"function"==typeof t?(t=t(),void 0===t?this.onAdError("getVPAIDAd() returns undefined value"):null==t?this.onAdError("getVPAIDAd() returns null"):(this._vpaidCreative=t,this.creativeAssetLoaded())):this.onAdError("getVPAIDAd() is undefined")}catch(t){this.onAdError(t)}else"error"==r&&this.onAdError("Error load VPAID")}}},s.prototype.loadCreativeAsset=function(t){window.addEventListener("message",this._handleLoadCreativeMessage),this._vpaidIframe=document.createElement("iframe"),this._vpaidIframe.style.display="none",this._vpaidIframe.style.width="0px",this._vpaidIframe.style.height="0px",this._adContainer.appendChild(this._vpaidIframe),this._vpaidIframe.contentWindow.document.open(),this._vpaidIframe.contentWindow.document.write(`\n<script>function sendMessage(msg) {\n  var postMsg = 'adm:${this._requestId}://' + JSON.stringify(msg);\n  window.parent.postMessage(postMsg, '*');\n} <\/script>\n<script type="text/javascript" onload="sendMessage('load')" onerror="sendMessage('error')" src="${t}"> <\/script>`),this._vpaidIframe.contentWindow.document.close()},s.prototype.removeCreativeAsset=function(){this._vpaidIframe&&this._vpaidIframe.parentNode.removeChild(this._vpaidIframe),[...this._ownSlot.children].forEach((t=>{t!==this._videoSlot&&t!==this._slot&&this._ownSlot.removeChild(t)})),[...this._slot.children].forEach((t=>{this._slot.removeChild(t)}))},s.prototype._removeHandlers=function(){this._ownSlot.removeEventListener("click",this._handleSlotClick),this._videoSlot.removeEventListener("error",this._handleVideoSlotError,!1),this._videoSlot.removeEventListener("canplay",this._handleVideoSlotCanPlay),this._videoSlot.removeEventListener("volumechange",this._handleVideoSlotVolumeChange),this._videoSlot.removeEventListener("timeupdate",this._handleVideoSlotTimeUpdate,!0),this._videoSlot.removeEventListener("loadedmetadata",this._handleVideoSlotLoadedMetaData),this._videoSlot.removeEventListener("ended",this._handleVideoSlotEnded)},s.prototype._abort=function(){this.abort(),this.onAllAdsCompleted()},s.prototype.isCreativeExists=function(){return this._creative&&0!=this._creative.mediaFiles.length},s.prototype.handleSlotClick=function(){!this._isVPAID&&this._vastTracker&&this._vastTracker.click()},s.prototype.handleVideoSlotError=function(){this.onAdError(this.ERRORS.VIDEO_PLAY_ERROR)},s.prototype.handleVideoSlotCanPlay=function(){},s.prototype.handleVideoSlotVolumeChange=function(t){this._vastTracker&&this._vastTracker.setMuted(t.target.muted)},s.prototype.handleVideoSlotTimeUpdate=function(t){if(this.isCreativeExists()){if(this._nextQuartileIndex>=this._quartileEvents.length)return;const e=t.target.currentTime/t.target.duration*100;if(e>=this._quartileEvents[this._nextQuartileIndex].value){const t=this._quartileEvents[this._nextQuartileIndex].event;this._defaultEventCallbacks[t](),this._nextQuartileIndex+=1}e>=0&&(this._hasImpression||(this._vastTracker&&this._vastTracker.trackImpression(),this._hasImpression=!0)),this._vastTracker&&this._vastTracker.setProgress(t.target.currentTime),t.target.duration>0&&(this._attributes.remainingTime=t.target.duration-t.target.currentTime)}},s.prototype.handleVideoSlotLoadedMetaData=function(t){this._attributes.duration=t.target.duration,this._vastTracker&&this._vastTracker.setDuration(t.target.duration),this.onAdDurationChange()},s.prototype.handleVideoSlotEnded=function(){this._vastTracker&&this._vastTracker.complete(),this.onAdStopped()},s.prototype._processAd=function(e=!1){this._creative=this._ad.creatives.filter((t=>"linear"===t.type))[0],this._creative?0!=this._creative.mediaFiles.length?(this._mediaFiles=this._creative.mediaFiles.filter((t=>this.canPlayVideoType(t.mimeType)||"application/javascript"===t.mimeType?t:void 0)),this._mediaFiles.sort((function(t,e){const r=t.height,i=e.height;return r<i?-1:r>i?1:0})),this._mediaFiles&&0!=this._mediaFiles.length?(this._vastTracker=new t.VASTTracker(null,this._ad,this._creative),this._vastTracker.load(),e?this.init(this._attributes.width,this._attributes.height,this._attributes.viewMode,e):this.onAdsManagerLoaded()):this.onAdError(this.ERRORS.VAST_LINEAR_ASSET_MISMATCH)):this.onAdError(this.ERRORS.VAST_ASSET_NOT_FOUND):this.onAdError("non linear")},s.prototype._nextAd=function(){this._ad=this._adPod.shift(),this._processAd(!0)},s.prototype.init=function(t,e,r,i=!1){this._isDestroyed||this.isCreativeExists()&&(i||this._options.muted&&(this._videoSlot.muted=!0,this._videoSlot.volume=0),this._mediaFileIndex=this._mediaFiles.findIndex((function(t){return t.height>=e})),-1!=this._mediaFileIndex?this._mediaFile=this._mediaFiles[this._mediaFileIndex]:this._mediaFile=this._mediaFiles[this._mediaFiles.length-1],this._mediaFile&&("application/javascript"===this._mediaFile.mimeType&&(this._isVPAID=!0),this._attributes.width=t,this._attributes.height=e,this._attributes.viewMode=r,this.resizeSlot(this._attributes.width,this._attributes.height),this._videoSlot.addEventListener("error",this._handleVideoSlotError,!1),this._isVPAID?this.loadCreativeAsset(this._mediaFile.fileURL):(this._ownSlot.addEventListener("click",this._handleSlotClick),this._videoSlot.addEventListener("canplay",this._handleVideoSlotCanPlay),this._videoSlot.addEventListener("volumechange",this._handleVideoSlotVolumeChange),this._videoSlot.addEventListener("timeupdate",this._handleVideoSlotTimeUpdate,!0),this._videoSlot.addEventListener("loadedmetadata",this._handleVideoSlotLoadedMetaData),this._videoSlot.addEventListener("ended",this._handleVideoSlotEnded),this._videoSlot.setAttribute("src",this._mediaFile.fileURL),this.onAdLoaded()),this._vastTracker&&this._vastTracker.on("clickthrough",(t=>{this._isVPAID||this.onAdClickThru(t);const e=window.open(t,"_blank");void 0!==e?e.focus():window.location.href=t}))))},s.prototype.start=function(){if(this.isCreativeExists()){const t=this._videoSlot.play,e=3;let r=0;this._videoSlot.play=function(){const i=t.apply(this,[].slice.call(arguments));return i instanceof Promise&&i.then((t=>{})).catch((t=>{r<=e&&(this.muted=!0,this.play(),r++)})),i},this._isVPAID?this._isCreativeFunctionInvokable("startAd")&&this._vpaidCreative.startAd():(this._videoSlot.load(),this._videoSlot.play(),this.onAdStarted())}},s.prototype.getDuration=function(){return this.isCreativeExists()&&this._attributes.duration},s.prototype.pause=function(){this.isCreativeExists()&&(this._isVPAID?this._isCreativeFunctionInvokable("pauseAd")&&this._vpaidCreative.pauseAd():(this._videoSlot.pause(),this.onAdPaused()))},s.prototype.resume=function(){this.isCreativeExists()&&(this._isVPAID?this._isCreativeFunctionInvokable("resumeAd")&&this._vpaidCreative.resumeAd():(this._videoSlot.play(),this.onAdPlaying()))},s.prototype.stop=function(){this.isCreativeExists()&&(this._isVPAID?this._isCreativeFunctionInvokable("stopAd")&&this._vpaidCreative.stopAd():this.onAdStopped())},s.prototype.skip=function(){this.isCreativeExists()&&(this._isVPAID?this._isCreativeFunctionInvokable("skipAd")&&this._vpaidCreative.skipAd():this.onAdSkipped())},s.prototype.resize=function(t,e,r){this.isCreativeExists()&&(this._attributes.width=t,this._attributes.height=e,this._attributes.viewMode=r,this.resizeSlot(this._attributes.width,this._attributes.height),this._isVPAID?this._isCreativeFunctionInvokable("resizeAd")&&this._vpaidCreative.resizeAd(t,e,r):this.onAdSizeChange())},s.prototype.getVolume=function(){if(this.isCreativeExists())return this._isVPAID?this._isCreativeFunctionInvokable("getAdVolume")?this._vpaidCreative.getAdVolume():-1:this._videoSlot.muted?0:this._videoSlot.volume},s.prototype.setVolume=function(t){if(this.isCreativeExists()){this._isVPAID&&this._isCreativeFunctionInvokable("setAdVolume")&&this._vpaidCreative.setAdVolume(t);const e=t!==this.getVolume();this._attributes.volume=t,0!==this._attributes.volume?this._videoSlot.muted=!1:this._videoSlot.muted=!0,this._videoSlot.volume=this._attributes.volume,e&&this.onAdVolumeChange()}},s.prototype.getRemainingTime=function(){if(this.isCreativeExists())return this._isVPAID?this._isCreativeFunctionInvokable("getAdRemainingTime")?this._vpaidCreative.getAdRemainingTime():-1:this._attributes.remainingTime},s.prototype.collapse=function(){this.isCreativeExists()&&this._isVPAID&&this._isCreativeFunctionInvokable("collapseAd")&&this._vpaidCreative.collapseAd()},s.prototype.expand=function(){this.isCreativeExists()&&this._isVPAID&&this._isCreativeFunctionInvokable("expandAd")&&this._vpaidCreative.expandAd()},s.prototype.abort=function(){this._isDestroyed||(window.removeEventListener("message",this._handleLoadCreativeMessage),this.stopVASTMediaLoadTimeout(),this.stopVPAIDProgress(),this._isVPAID&&(this.removeCallbacksForCreative(this._creativeEventCallbacks),this.removeCreativeAsset()),this._nextQuartileIndex=0,this._isVPAID=!1,this._hasLoaded=!1,this._hasError=!1,this._hasImpression=!1,this._hasStarted=!1,this._ad=null,this._adPod=null,this._isAdPod=!1,this._creative=null,this._mediaFile=null,this._vpaidCreative=null,this._vastTracker=null,this._removeHandlers(),this._videoSlot.pause(),this._videoSlot.removeAttribute("src"),this._videoSlot.load(),this.hideVideoSlot())},s.prototype.destroy=function(){this._isDestroyed||(this.abort(),this.removeEventListeners(this._eventCallbacks),this.removeSlot(),this._adContainer=null,this._ownSlot=null,this._videoSlot=null,this._slot=null,this._isDestroyed=!0)},s.prototype.isDestroyed=function(){return this._isDestroyed},s.prototype.getVersion=function(){return this._attributes.version};const a=s})();var re=ee.Z;const ie=function(t,e,r){this.player_=t,this.adContainer_=e,this.adsManager_=null,this.options_=O({desktop:{becomeInView:!0,inView:{preroll:!0,midroll:!0,vastUrl:null,interval:5e3,retryInterval:1e4},notInView:{preroll:!0,midroll:!0,vastUrl:null,interval:15e3,retryInterval:1e4}},mobile:{becomeInView:!0,inView:{preroll:!0,midroll:!0,vastUrl:null,interval:5e3,retryInterval:1e4},notInView:{preroll:!0,midroll:!0,vastUrl:null,interval:15e3,retryInterval:1e4}},gdpr:!1,usp:!1,schain:null,customMacros:{}},r),this.lastAdHasError=!1,this.lastAdErrorRuntime=0,this.lastAdRequestRuntime=0,this.lastAdCompleteRuntime=0,this.isAdPlaying=!1,this.isChecked=!1,this.boundHandlePlayerSourceChange=this.handlePlayerSourceChange.bind(this),this.boundHandlePlayerEnded=this.handlePlayerEnded.bind(this),this.player_.on(this.player_.EVENTS.PlayerSourceChange,this.boundHandlePlayerSourceChange),this.player_.on(this.player_.EVENTS.PlayerVideoEnded,this.boundHandlePlayerEnded),this.options_.gdpr&&Wt(),this.options_.usp&&qt(),this.adContainer_&&this.initAdsManager()};ie.prototype.handlePlayerSourceChange=function(){this.lastAdCompleteRuntime=0},ie.prototype.handlePlayerEnded=function(){this.lastAdCompleteRuntime=0},ie.prototype.isBecomeInView=function(){return v?this.options_.mobile.becomeInView:this.options_.desktop.becomeInView},ie.prototype.hasPreroll=function(){return this.player_.visible()?this.hasInViewPreroll():this.hasNotInViewPreroll()},ie.prototype.hasInViewPreroll=function(){return v?this.options_.mobile.inView.preroll:this.options_.desktop.inView.preroll},ie.prototype.hasNotInViewPreroll=function(){return v?this.options_.mobile.notInView.preroll:this.options_.desktop.notInView.preroll},ie.prototype.hasMidroll=function(){return this.player_.visible()?this.hasInViewMidroll():this.hasNotInViewMidroll()},ie.prototype.hasInViewMidroll=function(){return v?this.options_.mobile.inView.midroll:this.options_.desktop.inView.midroll},ie.prototype.hasNotInViewMidroll=function(){return v?this.options_.mobile.notInView.midroll:this.options_.desktop.notInView.midroll},ie.prototype.getInterval=function(){if(this.lastAdHasError){const t=1e3*this.getRetryInterval(),e=this.lastAdErrorRuntime-this.lastAdRequestRuntime;let r=0;return e<t&&(r=t-e),A(r)}return this.player_.visible()?A(this.getInViewInterval()):A(this.getNotInViewInterval())},ie.prototype.getRetryInterval=function(){return this.player_.visible()?A(this.getInViewRetryInterval()):A(this.getNotInViewRetryInterval())},ie.prototype.getInViewInterval=function(){return v?this.options_.mobile.inView.interval:this.options_.desktop.inView.interval},ie.prototype.getNotInViewInterval=function(){return v?this.options_.mobile.notInView.interval:this.options_.desktop.notInView.interval},ie.prototype.getInViewRetryInterval=function(){return v?this.options_.mobile.inView.retryInterval:this.options_.desktop.inView.retryInterval},ie.prototype.getNotInViewRetryInterval=function(){return v?this.options_.mobile.notInView.retryInterval:this.options_.desktop.notInView.retryInterval},ie.prototype.getInViewVastUrl=function(){return v?this.options_.mobile.inView.vastUrl:this.options_.desktop.inView.vastUrl},ie.prototype.getNotInViewVastUrl=function(){return v?this.options_.mobile.notInView.vastUrl:this.options_.desktop.notInView.vastUrl},ie.prototype.getVastUrl=function(){return this.player_.visible()?this.getInViewVastUrl():this.getNotInViewVastUrl()},ie.prototype.handleAdError=function(t){this.lastAdHasError=!0,this.isAdPlaying=!1,this.lastAdErrorRuntime=L(),this.lastAdCompleteRuntime=this.lastAdErrorRuntime,this.adsManager_&&this.adsManager_.abort(),this.player_.el_.classList.remove("adsrv-ads"),this.player_.paused()&&this.player_.play()},ie.prototype.handleAdStopped=function(){this.player_.el_.classList.remove("adsrv-ads"),this.player_.ended()||this.player_.play()},ie.prototype.initAdsManager=function(){this.adsManager_=new re(this.adContainer_),this.adsManager_.addEventListener("AdError",this.handleAdError.bind(this)),this.adsManager_.addEventListener("AdsManagerLoaded",(()=>{const t=this.player_.getVideoWidth(),e=this.player_.getVideoHeight(),r=this.getViewMode();try{this.adsManager_.init(t,e,r)}catch(t){this.handleAdError(t)}})),this.adsManager_.addEventListener("AdLoaded",(t=>{if(t.isLinear())try{this.adsManager_.start()}catch(t){this.handleAdError(t)}else this.handleAdError("non-linear")})),this.adsManager_.addEventListener("AdStarted",(()=>{})),this.adsManager_.addEventListener("AdDurationChange",(()=>{})),this.adsManager_.addEventListener("AdSizeChange",(()=>{})),this.adsManager_.addEventListener("AdVideoStart",(()=>{this.player_.el_.classList.add("adsrv-ads"),this.player_.paused()||this.player_.pause()})),this.adsManager_.addEventListener("AdImpression",(()=>{})),this.adsManager_.addEventListener("AdVideoFirstQuartile",(()=>{})),this.adsManager_.addEventListener("AdVideoMidpoint",(()=>{})),this.adsManager_.addEventListener("AdVideoThirdQuartile",(()=>{})),this.adsManager_.addEventListener("AdPaused",(()=>{})),this.adsManager_.addEventListener("AdPlaying",(()=>{})),this.adsManager_.addEventListener("AdVideoComplete",(()=>{})),this.adsManager_.addEventListener("AdStopped",this.handleAdStopped.bind(this)),this.adsManager_.addEventListener("AdSkipped",this.handleAdStopped.bind(this)),this.adsManager_.addEventListener("AdClickThru",((t,e)=>{})),this.adsManager_.addEventListener("AllAdsCompleted",(()=>{this.lastAdHasError=!1,this.isAdPlaying=!1,this.lastAdCompleteRuntime=L()}))},ie.prototype.checkIfPlayAd=function(){if(this.isChecked||(this.isChecked=!0,((t,e=200)=>{e=parseInt(e),Vt.push({callback:t,interval:e})})(this.checkIfPlayAd.bind(this))),p&&this.player_.fullscreen())return;let t=!1;this.player_.attributes_.becomeVisible&&this.isBecomeInView()&&(t=!0,this.player_.attributes_.becomeVisible=!1),this.hasPreroll()&&0===this.lastAdCompleteRuntime&&!this.isAdPlaying&&this.playAd(),this.hasMidroll()&&(!(L()-this.lastAdCompleteRuntime>=1e3*this.getInterval()||t)||this.isAdPlaying||this.player_.ended()||this.player_.paused()||this.playAd())},ie.prototype.getViewMode=function(){return this.player_.fullscreen()?"fullscreen":"normal"},ie.prototype.populateCustomMacros=function(t){return this.options_.customMacros&&Object.getOwnPropertyNames(this.options_.customMacros).forEach((e=>{if(-1!=t.indexOf("["+e+"]"))try{const r="function"==typeof this.options_.customMacros[e],i=encodeURIComponent(r?this.options_.customMacros[e]():this.options_.customMacros[e]);t=t.replace(new RegExp(`(?:\\[|%%)(${e})(?:\\]|%%)`,"g"),i),r&&(this.options_.customMacros[e]=i)}catch(t){}})),t},ie.prototype.getMacros=function(){return{CACHEBUSTER:Math.floor(1e6*Math.random()),TIMESTAMP:Date.now(),WIDTH:this.player_.getVideoWidth(),HEIGHT:this.player_.getVideoHeight(),URL:encodeURIComponent(B()),DOMAIN:F(B()),USER_AGENT:encodeURIComponent(navigator.userAgent),DEVICE:v?2:1,DNT:"yes"==navigator.doNotTrack||"1"==navigator.doNotTrack||"1"==navigator.msDoNotTrack?1:0,UTM:"",DURATION:this.player_.getDuration(),VISIBILITY:this.player_.visible()?1:0,GDPR:this.options_.gdpr&&Ht?1:0,GDPR_CONSENT:this.options_.gdpr?"string"!=typeof zt?"":zt:"",US_PRIVACY:this.options_.usp?"string"!=typeof Qt?"":Qt:"",SCHAIN:R(this.options_.schain),ABC:encodeURIComponent(this.player_.getVariantName())}},ie.prototype.playAd=function(){this.adsManager_&&(this.isAdPlaying=!0,this.lastAdRequestRuntime=L(),this.getVastUrl()?this.adsManager_.requestAds(this.populateCustomMacros(function(t,e){let r=t;for(const t in e){const i=e[t];r=r.replace(new RegExp(`(?:\\[|%%|\\{\\{)(${t})(?:\\]|%%|\\}\\})`,"g"),i)}return r}(this.getVastUrl(),this.getMacros())),{muted:this.player_.muted()}):this.handleAdError("no vast tag"))},ie.prototype.resizeAd=function(t,e){this.adsManager_&&this.adsManager_.resize(t,e,this.getViewMode())};const ne=ie;var se=r(286),ae=r.n(se);class oe{#t;#e=-1;#r;#i=!1;#n=0;#s=this.#a.bind(this);constructor(t,e,r=0,i=!1,n=!1){this.#t=t,this.#r=e,this.#i=i,n&&this.shuffle(),this.#o(r),this.#t.on(this.#t.EVENTS.PlayerVideoEnded,this.#s)}get loopCount(){return this.#n}#a(){this.next()}#o(t){"number"==typeof t&&this.#e!==t&&t>=0&&t<this.#r.length&&(this.#e=t,this.#l(this.#r[this.#e]),t>0&&this.#t.setPoster(""))}getCurrentIndex(){return this.#e}getLastIndex(){return this.#r.length-1}getNextIndex(){const t=this.getCurrentIndex();if(-1===t)return-1;const e=this.getLastIndex();return this.#i&&t===e?(this.#n++,0):Math.min(t+1,e)}getPreviousIndex(){const t=this.getCurrentIndex();return-1===t?-1:this.#i&&0===t?this.getLastIndex():Math.max(t-1,0)}first(){this.#o(0)}last(){this.#o(this.getLastIndex())}next(){const t=this.getNextIndex();t!==this.getCurrentIndex()&&this.#o(t)}previous(){const t=this.getPreviousIndex();t!==this.getCurrentIndex()&&this.#o(t)}shuffle(t=!1){let e=0,r=this.#r;t&&(e=this.getCurrentIndex()+1,r=this.#r.slice(e)),r.length<=1||(!function(t){let e,r,i=t.length;for(;0!==i;)r=Math.floor(Math.random()*i),i-=1,e=t[i],t[i]=t[r],t[r]=e}(r),t&&this.#r.splice(...[e,r.length].concat(r)))}#l(t){const e=!this.#t.paused()||this.#t.ended();this.#t.setTitle(t.title||""),this.#t.setDescription(t.description||""),this.#t.setPoster(t.poster||""),this.#t.setSrc(t.sources),e&&this.#t.play()}}e().adserve=e().adserve||{},e().adserve.Player=class extends Bt{#d;constructor(t,r={},i){if(super(),!(t instanceof Element||t instanceof HTMLDocument))throw new Error("player element is not defined");if(this.el_=t,this.id_=function(){let t="";const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<32;r++)t+=e.charAt(Math.floor(62*Math.random()));return t}(),this.el_.classList.add("paused"),this.wrapper_=null,this.slot_=null,this.videoSlot_=null,this.log=W(this.id_),this.resizer_=null,this.ads_=null,this.playPromise_=null,this.gradient_=null,this.titleBar_=null,this.spinner_=null,this.bigPlayButton_=null,this.controlBar_=null,this.timeline_=null,this.prevButton_=null,this.playButton_=null,this.nextButton_=null,this.timer_=null,this.closedCaptionsButton_=null,this.playbackRateButton_=null,this.fullscreenButton_=null,this.closeButton_=null,this.attributes_={variantName:"",sessionId:this.id_,isReady:!1,userActive:!1,userActivity:!1,aspectRatioPercentage:null,poster:null,src:null,duration:0,remainingTime:0,currentTime:0,muted:!0,volume:0,playbackRate:1,playbackRates:[],get hidden(){return n().hidden},fullscreen:!1,becomeVisible:!1,visibilityThreshold:50,intersectionRatio:0,get visible(){return!this.hidden&&(!!this.fullscreen||(t=this.intersectionRatio,e=this.visibilityThreshold,100*t>=e));var t,e},prevVisible:!0,inactivityTimeout:2e3,version:"1.0.13"},this.options_=O({width:"auto",height:"auto",aspectRatio:"16:9",title:null,url:null,poster:null,src:null,sources:null,crossOrigin:null,notSupportedMessage:"No compatible source was found for this media.",playlist:null,autoplay:!1,preload:"metadata",clickToPlay:!1,loop:!1,playbackRate:1,playbackRates:[],muted:!0,volume:1,controls:!0,inactivityTimeout:2e3,context:"instream",sticky:{enabled:!1,floating:!0,alignment:"bottom-right",width:320,afterClose:!1,closeButton:!0},ads:null,timeRanges:null,abTest:null},r),this.hls_=new(ae()),this.isSupportNativeHls=m(),this.isSupportNativeHls,this.changingSrc_=!1,this.resetCache_(),this.handleVideoSlotLoadStart__=this.handleVideoSlotLoadStart_.bind(this),this.handleVideoSlotWaiting__=this.handleVideoSlotWaiting_.bind(this),this.handleVideoSlotEnded__=this.handleVideoSlotEnded_.bind(this),this.handleVideoSlotPlaying__=this.handleVideoSlotPlaying_.bind(this),this.handleVideoSlotSeeking__=this.handleVideoSlotSeeking_.bind(this),this.handleVideoSlotCanPlay__=this.handleVideoSlotCanPlay_.bind(this),this.handleVideoSlotCanPlayThrough__=this.handleVideoSlotCanPlayThrough_.bind(this),this.handleVideoSlotPlay__=this.handleVideoSlotPlay_.bind(this),this.handleVideoSlotPause__=this.handleVideoSlotPause_.bind(this),this.handleVideoSlotVolumeChange__=this.handleVideoSlotVolumeChange_.bind(this),this.handleVideoSlotProgress__=this.handleVideoSlotProgress_.bind(this),this.handleVideoSlotTimeUpdate__=this.handleVideoSlotTimeUpdate_.bind(this),this.handleVideoSlotRateChange__=this.handleVideoSlotRateChange_.bind(this),this.handleVideoSlotLoadedMetaData__=this.handleVideoSlotLoadedMetaData_.bind(this),this.handleVideoSlotDurationChange__=this.handleVideoSlotDurationChange_.bind(this),this.handleVideoSlotError__=this.handleVideoSlotError_.bind(this),this.options_.abTest&&this.options_.abTest.enabled&&this.options_.abTest.hasOwnProperty("variants")){let t=null;const e=function(t){const e=[];let r=0;return t&&t.variants.forEach((t=>{r+=t.percentage,e.push(r)})),{ranges:e,lastRange:r}},r=function(t,e,r){let i=null;const n=Math.round(Math.random()*r);for(let r=0;r<e.length;r++)if(n<=e[r]){i=t.variants[r];break}return i},i=function(t,e){let r=null;const i=t.variants;return e&&(r=i.find((t=>t.name==e))),r};let n=null;if(function(t,e=window.location.href){return e.includes(t)}("ab_test_variant_name")&&(n=function(t,e=window.location.href,r){let i=null;try{i=new URL(e).searchParams.get(t)}catch(t){}return i||r}("ab_test_variant_name")),n)t=i(this.options_.abTest,n);else{const{ranges:i,lastRange:n}=e(this.options_.abTest);t=r(this.options_.abTest,i,n)}t&&(this.attributes_.variantName=t.name,this.options_=O(this.options_,t.options))}if(this.attributes_.muted=this.options_.muted,this.attributes_.volume=this.attributes_.muted?0:this.options_.volume,this.attributes_.muted||0!=this.attributes_.volume||(this.attributes_.muted=!0),!0!==this.options_.autoplay&&"muted"!==this.options_.autoplay||(this.attributes_.muted=!0,this.attributes_.volume=0),this.options_.autoplay||(this.options_.clickToPlay=!0),this.attributes_.aspectRatioPercentage=I[this.options_.aspectRatio],this.attributes_.aspectRatioPercentage&&(this.el_.style.aspectRatio=this.options_.aspectRatio.replace(":","/"),D(null,`.adsrv-player-${this.attributes_.sessionId} .adsrv-video-container {\n        padding-bottom: ${this.attributes_.aspectRatioPercentage}\n      }`)),this.options_.inactivityTimeout&&(this.attributes_.inactivityTimeout=this.options_.inactivityTimeout),this.options_.playbackRate&&"number"==typeof this.options_.playbackRate&&(this.attributes_.playbackRate=this.options_.playbackRate),this.playbackRates(this.options_.playbackRates),this.options_.timeRanges&&0!=this.options_.timeRanges.length){const t=this.options_.timeRanges.filter((t=>t.enabled));if(!t.length)return;const r=t=>{if(!t)return NaN;const e=t.split(":");return 3600*parseInt(e[0]||"0")+60*parseInt(e[1]||"0")+parseInt(e[2]||"0")};e().setInterval((()=>{const e=new Date,i=3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds();t.find((t=>{const e=r(t.range[0]),n=r(t.range[1]);if(!isNaN(e)&&!isNaN(n))return e<=n?i>=e&&i<=n:i<=n||i>=e}))}),1e3)}this.EVENTS={PlayerReady:"PlayerReady",PlayerVisibilityChange:"PlayerVisibilityChange",PlayerFullscreenChange:"PlayerFullscreenChange",PlayerVolumeChange:"PlayerVolumeChange",PlayerPlaybackRateChange:"PlayerPlaybackRateChange",PlayerVideoPlaying:"PlayerVideoPlaying",PlayerVideoPause:"PlayerVideoPause",PlayerVideoEnded:"PlayerVideoEnded",PlayerSourceChange:"PlayerSourceChange",PlayerUserActive:"PlayerUserActive",PlayerUserInactive:"PlayerUserInactive",PlayerResize:"PlayerResize",PlayerError:"PlayerError"},this.callback_=i,this.eventCallbacks_={},this.createSlot_(),function(t,e){const r=new IntersectionObserver(e,{root:null,threshold:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]});try{r.observe(t)}catch(t){}}(this.wrapper_,(t=>{const{intersectionRatio:e}=t[t.length-1];this.attributes_.intersectionRatio=e,this.onVisibilityChange_()})),n().addEventListener("visibilitychange",(()=>{this.onVisibilityChange_()}))}createSlot_(){this.wrapper_=n().createElement("div"),this.wrapper_.classList.add("adsrv-wrapper"),this.slot_=n().createElement("div"),this.slot_.classList.add("adsrv-video-container"),this.wrapper_.appendChild(this.slot_),this.el_.appendChild(this.wrapper_),this.el_.classList.add("adsrv-player"),this.el_.classList.add("adsrv-player-"+this.attributes_.sessionId),"auto"===this.options_.width&&"auto"===this.options_.height||(this.el_.style.width="number"==typeof this.options_.width?this.options_.width+"px":this.options_.width,this.el_.style.height="number"==typeof this.options_.height?this.options_.height+"px":this.options_.height),this.createVideoSlot_()}createVideoSlot_(){this.videoSlot_=n().createElement("video"),this.videoSlot_.setAttribute("webkit-playsinline",!0),this.videoSlot_.setAttribute("playsinline",!0),this.videoSlot_.setAttribute("preload",this.options_.preload),this.videoSlot_.setAttribute("tabindex",-1),this.videoSlot_.style.backgroundColor="rgb(0, 0, 0)",this.videoSlot_.classList.add("adsrv-video"),this.attributes_.muted&&(this.videoSlot_.muted=!0),this.crossOrigin(this.options_.crossOrigin),this.slot_.appendChild(this.videoSlot_),p?(this.videoSlot_.addEventListener("webkitbeginfullscreen",(t=>this.onFullscreenChange())),this.videoSlot_.addEventListener("webkitendfullscreen",(t=>this.onFullscreenChange()))):(n().addEventListener("fullscreenchange",(t=>this.onFullscreenChange())),n().addEventListener("webkitfullscreenchange",(t=>this.onFullscreenChange())),n().addEventListener("mozfullscreenchange",(t=>this.onFullscreenChange()))),this.resizer_=n().createElement("iframe"),this.resizer_.classList.add("adsrv-resizer"),this.resizer_.setAttribute("allowtransparency",!0),this.slot_.appendChild(this.resizer_),this.resizer_.contentWindow.onresize=this.onResize.bind(this),this.createOverlay_(),this.attributes_.intersectionRatio=g(this.el_),this.options_.ads&&this.options_.ads.enabled&&this.createAdContainer_(),this.options_.src&&this.setSrc(this.options_.src),this.setPlaybackRate(this.attributes_.playbackRate),this.setPoster(this.options_.poster),this.options_.playlist&&this.setPlaylist(this.options_.playlist,0,this.options_.loop,!0),this.userActive(!0),this.listenForUserActivity_(),this.setSticky_(),e().setTimeout((()=>{this.attributes_.isReady=!0,e().adserve.players.push(this),this.callback_&&"function"==typeof this.callback_&&this.callback_(this),this.onPlayerReady()}),75)}createOverlay_(){const t=n().createElement("div");if(t.classList.add("adsrv-overlay"),this.gradient_=new q,t.appendChild(this.gradient_.render()),this.titleBar_=new X,t.appendChild(this.titleBar_.render()),this.spinner_=new Z,t.appendChild(this.spinner_.render()),this.bigPlayButton_=new nt,t.appendChild(this.bigPlayButton_.render()),this.options_.controls){this.controlBar_=n().createElement("div"),this.controlBar_.classList.add("adsrv-control-bar"),this.timeline_=new J;let e=!1;this.timeline_.onmousedown=()=>{this.el_.classList.add("slider-active"),e=!this.paused(),this.pause()},this.timeline_.onmousemove=t=>{this.setCurrentTime(t)},this.timeline_.onmouseup=()=>{this.el_.classList.remove("slider-active"),e&&!this.ended()&&this.play()},this.controlBar_.appendChild(this.timeline_.render());const r=n().createElement("div");r.classList.add("adsrv-controls"),this.prevButton_=new $,r.appendChild(this.prevButton_.render()),this.prevButton_.hide(),this.playButton_=new tt,this.playButton_.onclick=()=>{this.paused()?this.play():this.pause()},r.appendChild(this.playButton_.render()),this.nextButton_=new et,this.nextButton_.onclick=()=>{this.next()},r.appendChild(this.nextButton_.render()),this.nextButton_.hide(),this.volumeButton_=new rt,this.attributes_.muted&&this.volumeButton_.setState(!0),this.volumeButton_.onclick=()=>{this.getVolume()?this.setVolume(0):this.setVolume(1)},r.appendChild(this.volumeButton_.render()),this.timer_=new it,r.appendChild(this.timer_.render()),this.attributes_.playbackRates&&0!=this.attributes_.playbackRates.length&&(this.playbackRateButton_=new st,this.playbackRateButton_.addItems(this.attributes_.playbackRates),this.playbackRateButton_.selectedIndex=this.attributes_.playbackRates.indexOf(this.attributes_.playbackRate),r.appendChild(this.playbackRateButton_.render())),this.fullscreenButton_=new at,this.fullscreenButton_.onclick=()=>{this.fullscreen()?this.exitFullscreen():this.requestFullscreen()},r.appendChild(this.fullscreenButton_.render()),this.controlBar_.appendChild(r),t.appendChild(this.controlBar_)}this.wrapper_.appendChild(t)}createAdContainer_(){const t=n().createElement("div");t.classList.add("adsrv-ad-container"),this.slot_.appendChild(t),this.ads_=new ne(this,t,this.options_.ads)}userActive(t){if(void 0===t)return this.attributes_.userActive;if((t=!!t)!==this.attributes_.userActive){if(this.attributes_.userActive=t,this.attributes_.userActive)return this.attributes_.userActivity=!0,this.el_.classList.remove("adsrv-user-inactive"),this.el_.classList.add("adsrv-user-active"),void this.onUserActive();this.el_.addEventListener("mousemove",(t=>{t.stopPropagation(),t.preventDefault()}),{once:!0}),this.attributes_.userActivity=!1,this.el_.classList.remove("adsrv-user-active"),this.el_.classList.add("adsrv-user-inactive"),this.onUserInactive()}}reportUserActivity(){this.attributes_.userActivity=!0}listenForUserActivity_(){let t,r,i;const n=this.reportUserActivity.bind(this),s=()=>{n(),e().clearInterval(t)};let a;this.el_.addEventListener("mousedown",(()=>{n(),e().clearInterval(t),t=e().setInterval(n,250)})),this.el_.addEventListener("mousemove",(t=>{t.screenX===r&&t.screenY===i||(r=t.screenX,i=t.screenY,n())})),this.el_.addEventListener("mouseup",s),this.el_.addEventListener("mouseleave",s),!this.controlBar_||p||l||(this.controlBar_.addEventListener("mouseenter",(()=>{this.options_.inactivityTimeout=0})),this.controlBar_.addEventListener("mouseleave",(()=>{this.options_.inactivityTimeout=this.attributes_.inactivityTimeout}))),e().setInterval((()=>{if(!this.attributes_.userActivity)return;this.attributes_.userActivity=!1,this.userActive(!0),e().clearTimeout(a);const t=this.options_.inactivityTimeout;t<=0||(a=e().setTimeout((()=>{this.attributes_.userActivity||this.userActive(!1)}),t))}),250)}onUserActive(){this.onPlayerUserActive()}onPlayerUserActive(){this.callEvent_(this.EVENTS.PlayerUserActive)}onUserInactive(){this.onPlayerUserInactive()}onPlayerUserInactive(){this.callEvent_(this.EVENTS.PlayerUserInactive)}onResize(){this.ads_&&this.ads_.resizeAd(this.videoSlot_.clientWidth,this.videoSlot_.clientHeight),this.onPlayerResize()}onPlayerResize(){this.callEvent_(this.EVENTS.PlayerResize)}onFullscreenChange(){this.attributes_.fullscreen=_(n(),this.videoSlot_),this.fullscreenButton_&&this.fullscreenButton_.setState(this.attributes_.fullscreen),this.onPlayerFullscreenChange(this.attributes_.fullscreen)}onPlayerFullscreenChange(t){this.EVENTS.PlayerFullscreenChange in this.eventCallbacks_&&this.eventCallbacks_[this.EVENTS.PlayerFullscreenChange](t)}onVisibilityChange_(){const t=this.attributes_.visible;this.attributes_.prevVisible!==t&&(this.attributes_.prevVisible=t,this.attributes_.becomeVisible=!!t,this.onPlayerVisibilityChange(t))}onPlayerVisibilityChange(t){this.EVENTS.PlayerVisibilityChange in this.eventCallbacks_&&this.eventCallbacks_[this.EVENTS.PlayerVisibilityChange](t)}onPlayerReady(){this.callEvent_(this.EVENTS.PlayerReady)}onPlayerVolumeChange(){this.callEvent_(this.EVENTS.PlayerVolumeChange)}onPlayerPlaybackRateChange(){this.callEvent_(this.EVENTS.PlayerPlaybackRateChange)}onPlayerVideoPlaying(){this.callEvent_(this.EVENTS.PlayerVideoPlaying)}onPlayerVideoPause(){this.callEvent_(this.EVENTS.PlayerVideoPause)}onContentEnded(){this.el_.classList.add("adsrv-ended"),this.options_.loop&&(this.setCurrentTime(0),this.play()),this.onPlayerVideoEnded()}onPlayerVideoEnded(){this.trigger(this.EVENTS.PlayerVideoEnded),this.callEvent_(this.EVENTS.PlayerVideoEnded)}error(t){return void 0===t?this.error_||null:null===t?(this.error_=t,void this.el_.classList.remove("adsrv-error")):(this.error_=new Lt(t),this.el_.classList.add("adsrv-error"),void(this.EVENTS.PlayerError in this.eventCallbacks_&&this.eventCallbacks_[this.EVENTS.PlayerError](this.error_.message)))}callEvent_(t){t in this.eventCallbacks_&&this.eventCallbacks_[t]()}addEventListener(t,e,r){const i=e.bind(r);this.eventCallbacks_[t]=i}removeEventListener(t){t in this.eventCallbacks_&&delete this.eventCallbacks_[t]}removeEventListeners_(t){for(const e in t)t.hasOwnProperty(e)&&this.removeEventListener(e)}canUseMsePlayback(t){const e=(t=>y.test(t)?"hls":E.test(t)?"dash":null)(t.type);if(!e)return"";return!T(e)?"maybe":""}handleVideoSlotLoadStart_(t){this.error(null),"muted"===this.options_.autoplay&&this.play(),!0!==this.options_.autoplay&&"play"!==this.options_.autoplay&&"any"!==this.options_.autoplay||this.play()}handleVideoSlotWaiting_(t){this.el_.classList.add("adsrv-waiting");const e=this.getCurrentTime(),r=()=>{e!==this.getCurrentTime()&&(this.el_.classList.remove("adsrv-waiting"),this.videoSlot_.removeEventListener("timeupdate",r))};this.videoSlot_.addEventListener("timeupdate",r)}handleVideoSlotEnded_(){this.playButton_&&this.playButton_.setState(!1),this.onContentEnded()}handleVideoSlotPlaying_(){this.el_.classList.remove("adsrv-waiting")}handleVideoSlotSeeking_(){}handleVideoSlotCanPlay_(){this.el_.classList.remove("adsrv-waiting")}handleVideoSlotCanPlayThrough_(){this.el_.classList.remove("adsrv-waiting")}handleVideoSlotPlay_(){this.el_.classList.remove("adsrv-ended"),this.el_.classList.remove("adsrv-paused"),this.playButton_&&this.playButton_.setState(!0),this.onPlayerVideoPlaying()}handleVideoSlotPause_(){this.el_.classList.remove("adsrv-ended"),this.el_.classList.add("adsrv-paused"),this.playButton_&&this.playButton_.setState(!1),this.onPlayerVideoPause()}handleVideoSlotVolumeChange_(){this.volumeButton_&&this.volumeButton_.setState(!this.getVolume()),this.onPlayerVolumeChange()}handleVideoSlotProgress_(t){let e=0;const r=t.target.buffered,i=t.target.currentTime;try{for(;!(r.start(e)<=i&&i<=r.end(e));)e+=1;const n=r.start(e)/t.target.duration,s=r.end(e)/t.target.duration-n;this.timeline_&&this.timeline_.updateBuffer(s)}catch(t){}}handleVideoSlotTimeUpdate_(t){t.target.currentTime,t.target.duration;this.cache_.currentTime=t.target.currentTime,this.cache_.remainingTime=t.target.duration-t.target.currentTime,this.timeline_&&(this.timeline_.updateProgress(t.target.currentTime>0&&t.target.duration>0?t.target.currentTime/t.target.duration:0),this.timeline_.updateTimeTooltip(t.target.currentTime)),this.timer_&&this.timer_.updateTimeElapsed(t.target.currentTime)}handleVideoSlotRateChange_(){}handleVideoSlotLoadedMetaData_(t){t.target.duration!==1/0&&(this.cache_.duration=t.target.duration,this.timeline_&&this.timeline_.setDuration(t.target.duration),this.timer_&&this.timer_.setDuration(t.target.duration))}handleVideoSlotDurationChange_(t){t.target.duration!==1/0&&(this.cache_.duration=t.target.duration,this.timeline_&&this.timeline_.setDuration(t.target.duration),this.timer_&&this.timer_.setDuration(t.target.duration))}handleVideoSlotError_(t){this.el_.classList.remove("adsrv-waiting"),this.pause(),this.error(t.target.error)}loadVideoSlot_(t){this.unloadVideoSlot_(),this.videoSlot_.addEventListener("loadstart",this.handleVideoSlotLoadStart__),this.videoSlot_.addEventListener("waiting",this.handleVideoSlotWaiting__),this.videoSlot_.addEventListener("ended",this.handleVideoSlotEnded__),this.videoSlot_.addEventListener("playing",this.handleVideoSlotPlaying__),this.videoSlot_.addEventListener("seeking",this.handleVideoSlotSeeking__),this.videoSlot_.addEventListener("canplay",this.handleVideoSlotCanPlay__),this.videoSlot_.addEventListener("canplaythrough",this.handleVideoSlotCanPlayThrough__),this.videoSlot_.addEventListener("play",this.handleVideoSlotPlay__),this.videoSlot_.addEventListener("pause",this.handleVideoSlotPause__),this.videoSlot_.addEventListener("volumechange",this.handleVideoSlotVolumeChange__),this.videoSlot_.addEventListener("progress",this.handleVideoSlotProgress__),this.videoSlot_.addEventListener("timeupdate",this.handleVideoSlotTimeUpdate__),this.videoSlot_.addEventListener("ratechange",this.handleVideoSlotRateChange__),this.videoSlot_.addEventListener("loadedmetadata",this.handleVideoSlotLoadedMetaData__),this.videoSlot_.addEventListener("durationchange",this.handleVideoSlotDurationChange__),this.videoSlot_.addEventListener("error",this.handleVideoSlotError__);this.canUseMsePlayback(t.source)?(this.hls_.on(ae().Events.MEDIA_ATTACHED,(()=>{})),this.hls_.on(ae().Events.MANIFEST_PARSED,((t,e)=>{e.levels.length>1&&(this.hls_.currentLevel=0)})),this.hls_.loadSource(t.src),this.hls_.attachMedia(this.videoSlot_)):this.videoSlot_.setAttribute("src",t.src),this.trigger(this.EVENTS.PlayerSourceChange)}unloadVideoSlot_(){this.videoSlot_.removeEventListener("loadstart",this.handleVideoSlotLoadStart__),this.videoSlot_.removeEventListener("waiting",this.handleVideoSlotWaiting__),this.videoSlot_.removeEventListener("ended",this.handleVideoSlotEnded__),this.videoSlot_.removeEventListener("playing",this.handleVideoSlotPlaying__),this.videoSlot_.removeEventListener("seeking",this.handleVideoSlotSeeking__),this.videoSlot_.removeEventListener("canplay",this.handleVideoSlotCanPlay__),this.videoSlot_.removeEventListener("canplaythrough",this.handleVideoSlotCanPlayThrough__),this.videoSlot_.removeEventListener("play",this.handleVideoSlotPlay__),this.videoSlot_.removeEventListener("pause",this.handleVideoSlotPause__),this.videoSlot_.removeEventListener("volumechange",this.handleVideoSlotVolumeChange__),this.videoSlot_.removeEventListener("progress",this.handleVideoSlotProgress__),this.videoSlot_.removeEventListener("timeupdate",this.handleVideoSlotTimeUpdate__),this.videoSlot_.removeEventListener("ratechange",this.handleVideoSlotRateChange__),this.videoSlot_.removeEventListener("loadedmetadata",this.handleVideoSlotLoadedMetaData__),this.videoSlot_.removeEventListener("durationchange",this.handleVideoSlotDurationChange__),this.videoSlot_.removeEventListener("error",this.handleVideoSlotError__),this.hls_&&this.hls_.detachMedia(),this.videoSlot_.removeAttribute("src"),this.videoSlot_.load()}getCache(){return this.cache_}resetCache_(){this.cache_={currentTime:0,remainingTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.getPlaybackRate(),media:null,src:"",source:{},sources:[],playbackRates:[],volume:1}}updateSourceCaches_(t=""){let e=t,r="";"string"!=typeof e&&(e=t.src,r=t.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],e&&!r&&(r=((t,e)=>{if(!e)return"";if(t.source.src===e&&t.source.type)return t.source.type;const r=t.sources.filter((t=>t.src===e));return r.length?r[0].type:V(e)})(this.cache_,e)),this.cache_.source=O({},t,{src:e,type:r}),this.cache_.src=e,this.options_.title&&this.setTitle(this.options_.title),this.loadVideoSlot_(this.cache_)}handleSrc_(t,r=!1){if(void 0===t)return;this.resetRetryOnError_&&this.resetRetryOnError_();const i=z(t);i.length?(this.changingSrc_=!0,r||(this.cache_.sources=i),this.updateSourceCaches_(i[0])):e().setTimeout((()=>{this.error({code:4,message:this.options_.notSupportedMessage})}),0)}setSrc(t){this.handleSrc_(t,!1)}getCurrentSources(){const t=this.getCurrentSource(),e=[];return 0!==Object.keys(t).length&&e.push(t),this.cache_.sources||e}getCurrentSource(){return this.cache_.source||{}}getCurrentSrc(){return this.getCurrentSource()&&this.getCurrentSource().src||""}setPlaylist(t,e=0,r=!1,i=!1){this.#d=new oe(this,t,e,r,i),t.length>1&&this.nextButton_&&this.nextButton_.show()}setTitle(t){this.titleBar_&&this.titleBar_.setTitle(t)}setDescription(t){this.titleBar_&&this.titleBar_.setDescription(t)}setPoster(t){t&&(this.attributes_.poster=t,this.videoSlot_.poster=this.attributes_.poster)}getPoster(){return this.attributes_.poster}play_(){let t=0;this.playPromise_=this.videoSlot_.play(),this.playPromise_ instanceof Promise&&this.playPromise_.then((()=>{})).catch((e=>{t<=3&&(!0!==this.options_.autoplay&&"any"!==this.options_.autoplay||(this.attributes_.muted=!0,this.attributes_.volume=0,this.play()),t++)}))}first(){this.#d?.first()}last(){this.#d?.last()}previous(){this.#d?.previous()}next(){this.#d?.next()}play(t){t&&this.setSrc(t);const e=Boolean(this.getCurrentSrc());this.videoSlot_&&e?this.videoSlot_.paused&&(this.attributes_.muted&&(this.videoSlot_.muted=!0,this.videoSlot_.volume=0,this.attributes_.muted=!0,this.attributes_.volume=0),this.options_.clickToPlay?(this.ads_?(this.ads_.hasPreroll()&&0===this.ads_.lastAdCompleteRuntime&&!this.ads_.isAdPlaying||this.play_(),this.ads_.checkIfPlayAd()):this.play_(),this.options_.clickToPlay=!1):this.ads_?(this.ads_.hasPreroll()&&0===this.ads_.lastAdCompleteRuntime&&!this.ads_.isAdPlaying||this.play_(),this.ads_.checkIfPlayAd()):this.play_()):this.error({code:0,message:"source not exists"})}paused(){return!!this.videoSlot_&&this.videoSlot_.paused}pause(){this.videoSlot_&&!this.videoSlot_.paused&&this.videoSlot_.pause()}ended(){return!!this.videoSlot_&&this.videoSlot_.ended}muted(){return!!this.videoSlot_&&this.videoSlot_.muted}getVolume(){return this.videoSlot_?this.videoSlot_.muted?0:this.videoSlot_.volume:this.attributes_.volume}setVolume(t){if(this.videoSlot_){t?(this.videoSlot_.muted=!1,this.attributes_.muted=!1):(this.videoSlot_.muted=!0,this.attributes_.muted=!0);t!==this.videoSlot_.volume&&(this.videoSlot_.volume=t,this.attributes_.volume=t)}}crossOrigin(t){if(void 0===t)return this.videoSlot_&&this.videoSlot_.crossOrigin;null===t||"anonymous"===t||"use-credentials"===t?this.videoSlot_&&(this.videoSlot_.crossOrigin=t):Q.warn(`crossOrigin must be null,  "anonymous" or "use-credentials", given "${t}"`)}setPlaybackRate(t){void 0!==t&&"number"==typeof t&&(this.videoSlot_&&(this.videoSlot_.playbackRate=t),t!=this.attributes_.playbackRate&&(this.attributes_.playbackRate=t,this.onPlayerPlaybackRateChange()))}getPlaybackRate(){return this.videoSlot_?this.videoSlot_.playbackRate:this.attributes_.playbackRate}playbackRates(t){if(void 0===t)return this.attributes_.playbackRates;Array.isArray(t)&&t.every((t=>"number"==typeof t))&&(this.attributes_.playbackRates=t)}getDuration(){return this.cache_.duration}getCurrentTime(){return this.cache_.currentTime}setCurrentTime(t){if(void 0!==t){t<0&&(t=0);const e=Boolean(this.getCurrentSrc());this.videoSlot_&&e&&(t!==this.cache_.duration&&this.el_.classList.remove("adsrv-ended"),this.cache_.currentTime=this.videoSlot_.currentTime=t)}}getRemainingTime(){return this.cache_.remainingTime}getWidth(){return this.el_.clientWidth}getHeight(){return this.el_.clientHeight}getVideoWidth(){return this.videoSlot_&&this.videoSlot_.clientWidth||0}getVideoHeight(){return this.videoSlot_&&this.videoSlot_.clientHeight||0}visible(){return this.attributes_.visible}hidden(){return this.attributes_.hidden}fullscreen(){return this.videoSlot_&&_(n(),this.videoSlot_)}requestFullscreen(){const t=Boolean(this.getCurrentSrc());var e,r;this.videoSlot_&&t&&!_(n(),this.videoSlot_)&&(e=this.el_,r=this.videoSlot_,p?r.webkitEnterFullscreen():"requestFullscreen"in e?e.requestFullscreen():"webkitRequestFullscreen"in e?e.webkitRequestFullscreen():"mozRequestFullScreen"in e&&e.mozRequestFullScreen())}exitFullscreen(){const t=Boolean(this.getCurrentSrc());var e,r;this.videoSlot_&&t&&_(n(),this.videoSlot_)&&(e=n(),r=this.videoSlot_,p?r.webkitExitFullscreen():"exitFullscreen"in e?e.exitFullscreen():"webkitExitFullscreen"in e?e.webkitExitFullscreen():"mozCancelFullScreen"in e&&e.mozCancelFullScreen())}setSticky_(){if("outstream"===this.options_.context&&this.options_?.sticky?.enabled&&(this.options_.sticky.floating=!1,this.el_.classList.add("adsrv-hidden")),this.options_.sticky&&this.options_.sticky.enabled){const t=this.options_.sticky.alignment.split("-");D(null,`.adsrv-player-${this.attributes_.sessionId}.adsrv-sticky .adsrv-wrapper {\n        width: ${"number"==typeof this.options_.sticky.width?this.options_.sticky.width+"px":this.options_.sticky.width};\n        ${t[0]}: 20px;\n        ${t[1]}: 20px\n      }`),this.visible()&&this.options_.sticky.floating||this.el_.classList.add("adsrv-sticky");const r=w(this.el_),i=()=>{e().scrollY>r.top+r.height||e().scrollY+e().innerHeight<r.top?this.options_.sticky.afterClose||this.el_.classList.add("adsrv-sticky"):(this.options_.sticky.afterClose=!1,this.el_.classList.remove("adsrv-sticky"))};this.options_.sticky.floating&&e().addEventListener("scroll",i),this.options_.sticky.closeButton&&(this.closeButton_=new ot,this.closeButton_.onclick=()=>{this.options_.sticky.afterClose=!0,this.el_.classList.remove("adsrv-sticky")},this.wrapper_.appendChild(this.closeButton_.render()))}}getSessionId(){return this.attributes_.sessionId}getVariantName(){return this.attributes_.variantName}getVersion(){return this.attributes_.version}readyState(){return null}destroy(){}},e().adserve.players=e().adserve.players||[],async function(){const t=n().currentScript;let r;if(t&&(r=function(t){const e={src:"src",widgetId:"data-wid",pubId:"data-pid"},r={};return Object.keys(e).forEach((i=>{const n=t.getAttribute(e[i]);n&&(r[i]=n)})),r}(t)),r.pubId&&r.widgetId){const i="https://v.adserve.tech/{{pubId}}/{{widgetId}}/conf.js";try{let s=i;s=s.replace("{{pubId}}",r.pubId).replace("{{widgetId}}",r.widgetId),function(t,e=!1){return new Promise(((r,i)=>{const n=document.getElementsByTagName("head")[0]||document.documentElement,s=document.createElement("script");s.type="text/javascript",s.src=t,s.async=e,s.onload=r,s.onerror=i,n.insertBefore(s,n.firstChild)}))}(s).then((()=>{const i=n().createElement("div");i.setAttribute("data-pid",r.pubId),i.setAttribute("data-wid",r.widgetId),t.parentNode.insertBefore(i,t);new(e().adserve.Player)(i,e().adserve.conf,(()=>{}))})).catch((t=>{}))}catch(t){}}}()})()})();